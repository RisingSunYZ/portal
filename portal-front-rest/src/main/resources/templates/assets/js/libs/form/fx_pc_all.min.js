!function (a) {
    function b(a, b) {
        var c = Math.max(0, a[0] - b[0], b[0] - a[1]), d = Math.max(0, a[2] - b[1], b[1] - a[3]);
        return c + d
    }

    function c(b, c, d, e) {
        var f = b.length, g = e ? "offset" : "position";
        for (d = d || 0; f--;) {
            var h = b[f].el ? b[f].el : a(b[f]), i = h[g]();
            i.left += parseInt(h.css("margin-left"), 10), i.top += parseInt(h.css("margin-top"), 10), c[f] = [i.left - d, i.left + h.outerWidth() + d, i.top - d, i.top + h.outerHeight() + d]
        }
    }

    function d(a, b) {
        var c = b.offset();
        return {left: a.left - c.left, top: a.top - c.top}
    }

    function e(a, c, d) {
        c = [c.left, c.top], d = d && [d.left, d.top];
        for (var e, f = a.length, g = []; f--;)e = a[f], g[f] = [f, b(e, c), d && b(e, d)];
        return g = g.sort(function (a, b) {
            return b[1] - a[1] || b[2] - a[2] || b[0] - a[0]
        })
    }

    function f(b) {
        this.options = a.extend({}, k, b), this.containers = [], this.options.parentContainer || (this.scrollProxy = a.proxy(this.scroll, this), this.dragProxy = a.proxy(this.drag, this), this.dropProxy = a.proxy(this.drop, this), this.placeholder = a(this.options.placeholder), b.isValidTarget || (this.options.isValidTarget = void 0))
    }

    function g(b, c) {
        this.el = b, this.options = a.extend({}, j, c), this.group = f.get(this.options), this.rootGroup = this.options.rootGroup || this.group, this.parentContainer = this.options.parentContainer, this.handle = this.rootGroup.options.handle || this.rootGroup.options.itemSelector;
        var d = this.rootGroup.options.itemPath, e = d ? this.el.find(d) : this.el;
        e.on(h.start, this.handle, a.proxy(this.dragInit, this)), this.options.drop && this.group.containers.push(this)
    }

    var h, i = "sortable", j = {
        drag: !0,
        drop: !0,
        exclude: "",
        nested: !0,
        vertical: !0
    }, k = {
        afterMove: function (a, b, c) {
        },
        containerPath: "",
        containerSelector: "ol, ul",
        distance: 0,
        delay: 100,
        handle: "",
        itemPath: "",
        itemSelector: "li",
        scroll: !1,
        scrollSensitivity: 40,
        scrollSpeed: 15,
        getScrollEl: function (a, b, c, d) {
            return null
        },
        isValidTarget: function (a, b) {
            return !0
        },
        onCancel: function (a, b, c, d) {
        },
        onDrag: function (a, b, c, d) {
            a.css(b)
        },
        onDragStart: function (b, c, d, e) {
            b.css({
                height: b.outerHeight(),
                width: b.outerWidth()
            }), b.addClass("dragged"), a("body").addClass("dragging")
        },
        onDrop: function (b, c, d, e) {
            b.removeClass("dragged").removeAttr("style"), a("body").removeClass("dragging")
        },
        onMousedown: function (a, b, c) {
            return c.preventDefault(), !0
        },
        placeholder: '<li class="placeholder"/>',
        pullPlaceholder: !0,
        serialize: function (b, c, d) {
            var e = a.extend({}, b.data());
            return d ? c : (c[0] && (e.children = c, delete e.subContainer), delete e.sortable, e)
        },
        tolerance: 0
    }, l = {}, m = 0, n = {left: 0, top: 0, bottom: 0, right: 0};
    h = {
        start: "touchstart.sortable mousedown.sortable",
        drop: "touchend.sortable touchcancel.sortable mouseup.sortable",
        drag: "touchmove.sortable mousemove.sortable",
        scroll: "scroll.sortable"
    }, f.get = function (a) {
        return l[a.group] || (void 0 === a.group && (a.group = m++), l[a.group] = new f(a)), l[a.group]
    }, f.prototype = {
        dragInit: function (b, c) {
            if (this.$document = a(c.el[0].ownerDocument), c.enabled()) {
                if (this.item = a(b.target).closest(this.options.itemSelector), this.itemContainer = c, this.item.is(this.options.exclude) || !this.options.onMousedown(this.item, k.onMousedown, b))return;
                this.setPointer(b), this.toggleListeners("on")
            } else this.toggleListeners("on", ["drop"]);
            this.setupDelayTimer(), this.dragInitDone = !0
        }, drag: function (a) {
            if (!this.dragging) {
                if (!this.distanceMet(a) || !this.delayMet)return;
                if (this.options.onDragStart(this.item, this.itemContainer, k.onDragStart, a), this.placeholder.outerHeight(this.item.outerHeight()), this.item.before(this.placeholder), this.options.scroll === !0) {
                    var b = this.options.getScrollEl(this.item, this.itemContainer, k.getScrollEl, a);
                    b && (this.scrollEl = b[0])
                }
                this.dragging = !0
            }
            if (this.options.scroll) {
                var c, e, f = this.options, g = f.scrollSensitivity, h = f.scrollSpeed, i = a.clientX, j = a.clientY, l = 0, m = 0;
                this.scrollEl && (c = this.scrollEl, e = this.scrollEl.getBoundingClientRect(), m = (Math.abs(e.right - i) <= g) - (Math.abs(e.left - i) <= g), l = (Math.abs(e.bottom - j) <= g) - (Math.abs(e.top - j) <= g)), clearInterval(this.scrollpid), c && (this.clearDimensions(), this.scrollpid = setInterval(function () {
                    c === window ? window.scrollTo(window.scrollX + m * h, window.scrollY + l * h) : (l && (c.scrollTop += l * h), m && (c.scrollLeft += m * h))
                }, 24))
            }
            this.setPointer(a), this.options.onDrag(this.item, d(this.pointer, this.item.offsetParent()), k.onDrag, a);
            var i = a.pageX, j = a.pageY, n = this.sameResultBox, o = this.options.tolerance;
            (!n || n.top - o > j || n.bottom + o < j || n.left - o > i || n.right + o < i) && (this.searchValidTarget() || this.placeholder.detach())
        }, drop: function (a) {
            this.toggleListeners("off"), clearInterval(this.scrollpid), this.dragInitDone = !1, this.dragging && (this.placeholder.closest("html")[0] ? this.placeholder.before(this.item).detach() : this.options.onCancel(this.item, this.itemContainer, k.onCancel, a), this.options.onDrop(this.item, this.getContainer(this.item), k.onDrop, a), this.clearDimensions(), this.clearOffsetParent(), this.lastAppendedItem = this.sameResultBox = void 0, this.dragging = !1)
        }, searchValidTarget: function (a, b) {
            a || (a = this.relativePointer || this.pointer, b = this.lastRelativePointer || this.lastPointer);
            for (var c = e(this.getContainerDimensions(), a, b), f = c.length; f--;) {
                var g = c[f][0], h = c[f][1];
                if (!h || this.options.pullPlaceholder) {
                    var i = this.containers[g];
                    if (!i.disabled) {
                        if (!this.$getOffsetParent()) {
                            var j = i.getItemOffsetParent();
                            a = d(a, j), b = d(b, j)
                        }
                        if (i.searchValidTarget(a, b))return !0
                    }
                }
            }
            this.sameResultBox && (this.sameResultBox = void 0)
        }, movePlaceholder: function (a, b, c, d) {
            var e = this.lastAppendedItem;
            !d && e && e[0] === b[0] || (b[c](this.placeholder), this.lastAppendedItem = b, this.sameResultBox = d, this.options.afterMove(this.placeholder, a, b))
        }, getContainerDimensions: function () {
            return this.containerDimensions || c(this.containers, this.containerDimensions = [], this.options.tolerance, !this.$getOffsetParent()), this.containerDimensions
        }, getContainer: function (a) {
            return a.closest(this.options.containerSelector).data(i)
        }, $getOffsetParent: function () {
            if (void 0 === this.offsetParent) {
                var a = this.containers.length - 1, b = this.containers[a].getItemOffsetParent();
                if (!this.options.parentContainer)for (; a--;)if (b[0] != this.containers[a].getItemOffsetParent()[0]) {
                    b = !1;
                    break;
                }
                this.offsetParent = b
            }
            return this.offsetParent
        }, setPointer: function (a) {
            var b = {left: a.pageX, top: a.pageY};
            if (this.$getOffsetParent()) {
                var c = d(b, this.$getOffsetParent());
                this.lastRelativePointer = this.relativePointer, this.relativePointer = c
            }
            this.lastPointer = this.pointer, this.pointer = b
        }, distanceMet: function (a) {
            return Math.max(Math.abs(this.pointer.left - a.pageX), Math.abs(this.pointer.top - a.pageY)) >= this.options.distance
        }, setupDelayTimer: function () {
            var a = this;
            this.delayMet = !this.options.delay, this.delayMet || (clearTimeout(this._mouseDelayTimer), this._mouseDelayTimer = setTimeout(function () {
                a.delayMet = !0
            }, this.options.delay))
        }, scroll: function (a) {
            this.clearDimensions(), this.clearOffsetParent()
        }, toggleListeners: function (b, c) {
            var d = this;
            c = c || ["drag", "drop", "scroll"], a.each(c, function (a, c) {
                d.$document[b](h[c], d[c + "Proxy"])
            })
        }, clearOffsetParent: function () {
            this.offsetParent = void 0
        }, clearDimensions: function () {
            this.containerDimensions = void 0;
            for (var a = this.containers.length; a--;)this.containers[a].clearDimensions()
        }, destroy: function () {
            l[this.options.group] = void 0
        }
    }, g.prototype = {
        dragInit: function (a) {
            var b = this.rootGroup;
            !b.dragInitDone && 1 === a.which && this.options.drag && b.dragInit(a, this)
        }, searchValidTarget: function (a, b) {
            var c = e(this.getItemDimensions(), a, b), d = c.length, f = this.rootGroup, g = !f.options.isValidTarget || f.options.isValidTarget(f.item, this);
            if (!d && g) {
                var h = this.rootGroup.options.itemPath, i = h ? this.el.find(h) : this.el;
                return f.movePlaceholder(this, i, "append"), !0
            }
            for (; d--;) {
                var j = c[d][0], k = c[d][1];
                if (!k && this.hasChildGroup(j)) {
                    var l = this.getContainerGroup(j).searchValidTarget(a, b);
                    if (l)return !0
                } else if (g)return this.movePlaceholder(j, a), !0
            }
        }, movePlaceholder: function (b, c) {
            var d = a(this.items[b]), e = this.itemDimensions[b], f = "after", g = d.outerWidth(), h = d.outerHeight(), i = d.offset(), j = {
                left: i.left,
                right: i.left + g,
                top: i.top,
                bottom: i.top + h
            };
            if (this.options.vertical) {
                var k = (e[2] + e[3]) / 2, l = c.top <= k;
                l ? (f = "before", j.bottom -= h / 2) : j.top += h / 2
            } else {
                var m = (e[0] + e[1]) / 2, o = c.left <= m;
                o ? (f = "before", j.right -= g / 2) : j.left += g / 2
            }
            this.hasChildGroup(b) && (j = n), this.rootGroup.movePlaceholder(this, d, f, j)
        }, getItemDimensions: function () {
            return this.itemDimensions || (this.items = this.$getChildren(this.el, "item").filter(":not(.placeholder, .dragged)").get(), c(this.items, this.itemDimensions = [], this.options.tolerance)), this.itemDimensions
        }, getItemOffsetParent: function () {
            var a, b = this.el;
            return a = "relative" === b.css("position") || "absolute" === b.css("position") || "fixed" === b.css("position") ? b : b.offsetParent()
        }, hasChildGroup: function (a) {
            return this.options.nested && this.getContainerGroup(a)
        }, getContainerGroup: function (b) {
            var c = a.data(this.items[b], "subContainer");
            if (void 0 === c) {
                var d = this.$getChildren(this.items[b], "container");
                if (c = !1, d[0]) {
                    var e = a.extend({}, this.options, {parentContainer: this, rootGroup: this.rootGroup, group: m++});
                    c = d[i](e).data(i).group
                }
                a.data(this.items[b], "subContainer", c)
            }
            return c
        }, enabled: function () {
            return !this.disabled && (!this.parentContainer || this.parentContainer.enabled())
        }, $getChildren: function (b, c) {
            var d = this.rootGroup.options, e = d[c + "Path"], f = d[c + "Selector"];
            return b = a(b), e && (b = b.find(e)), b.children(f)
        }, _serialize: function (b, c) {
            var d = this, e = c ? "item" : "container", f = this.$getChildren(b, e).not(this.options.exclude).map(function () {
                return d._serialize(a(this), !c)
            }).get();
            return this.rootGroup.options.serialize(b, f, c)
        }, clearDimensions: function () {
            if (this.itemDimensions = void 0, this.items && this.items[0])for (var b = this.items.length; b--;) {
                var c = a.data(this.items[b], "subContainer");
                c && c.clearDimensions()
            }
        }
    };
    var o = {
        fieldEnable: function (a) {
            this.disabled = !1
        }, disable: function (a) {
            this.disabled = !0
        }, serialize: function () {
            return this._serialize(this.el, !0)
        }, destroy: function () {
            this.rootGroup.destroy()
        }
    };
    a.extend(g.prototype, o), a.fn[i] = function (b) {
        var c = Array.prototype.slice.call(arguments, 1);
        return this.map(function () {
            var d = a(this), e = d.data(i);
            return e && o[b] ? o[b].apply(e, c) || this : (e || void 0 !== b && "object" != typeof b || d.data(i, new g(d, b)), this)
        })
    }
}(jQuery), function (a) {
    function b(b) {
        a(b).addClass("droppable"), a(b).bind("_dragenter", function (c, d) {
            a.data(b, "droppable").options.onDragEnter.apply(b, [c, d])
        }), a(b).bind("_dragleave", function (c, d) {
            a.data(b, "droppable").options.onDragLeave.apply(b, [c, d])
        }), a(b).bind("_dragover", function (c, d) {
            a.data(b, "droppable").options.onDragOver.apply(b, [c, d])
        }), a(b).bind("_drop", function (c, d) {
            a.data(b, "droppable").options.onDrop.apply(b, [c, d])
        })
    }

    a.fn.droppable = function (c, d) {
        return "string" == typeof c ? a.fn.droppable.methods[c](this, d) : (c = c || {}, this.each(function () {
            var d = a.data(this, "droppable");
            d ? a.extend(d.options, c) : (b(this), a.data(this, "droppable", {options: a.extend({}, a.fn.droppable.defaults, c)}))
        }))
    }, a.fn.droppable.methods = {
        options: function (b) {
            return a.data(b[0], "droppable").options
        }, fieldEnable: function (b) {
            return b.each(function () {
                a(this).droppable({disabled: !1})
            })
        }, disable: function (b) {
            return b.each(function () {
                a(this).droppable({disabled: !0})
            })
        }
    }, a.fn.droppable.defaults = {
        accept: null, disabled: !1, onDragEnter: function (a, b) {
        }, onDragOver: function (a, b) {
        }, onDragLeave: function (a, b) {
        }, onDrop: function (a, b) {
        }
    }
}(jQuery), function (a) {
    function b(b) {
        var c = a.data(b.data.target, "draggable"), d = c.options, e = c.proxy, f = b.data, g = f.startLeft + b.pageX - f.startX, h = f.startTop + b.pageY - f.startY;
        e && (e.parent()[0] == document.body ? (g = null != d.deltaX && void 0 != d.deltaX ? b.pageX + d.deltaX : b.pageX - b.data.offsetWidth, h = null != d.deltaY && void 0 != d.deltaY ? b.pageY + d.deltaY : b.pageY - b.data.offsetHeight) : (null != d.deltaX && void 0 != d.deltaX && (g += b.data.offsetWidth + d.deltaX), null != d.deltaY && void 0 != d.deltaY && (h += b.data.offsetHeight + d.deltaY))), b.data.parent != document.body && (g += a(b.data.parent).scrollLeft(), h += a(b.data.parent).scrollTop()), "h" == d.axis ? f.left = g : "v" == d.axis ? f.top = h : (f.left = g, f.top = h)
    }

    function c(b) {
        var c = a.data(b.data.target, "draggable"), d = c.options, e = c.proxy;
        e || (e = a(b.data.target)), e.css({left: b.data.left, top: b.data.top}), a("body").css("cursor", d.cursor)
    }

    function d(d) {
        a.fn.draggable.isDragging = !0;
        var e = a.data(d.data.target, "draggable"), f = e.options, g = a(".droppable").filter(function () {
            return d.data.target != this
        }).filter(function () {
            var b = a.data(this, "droppable").options.accept;
            return !b || a(b).filter(function () {
                    return this == d.data.target
                }).length > 0
        });
        e.droppables = g;
        var h = e.proxy;
        return h || (f.proxy ? (h = "clone" == f.proxy ? a(d.data.target).clone().insertAfter(d.data.target) : f.proxy.call(d.data.target, d.data.target), e.proxy = h) : h = a(d.data.target)), h.css("position", "absolute"), b(d), c(d), f.onStartDrag.call(d.data.target, d), !1
    }

    function e(d) {
        var e = a.data(d.data.target, "draggable");
        b(d), 0 != e.options.onDrag.call(d.data.target, d) && c(d);
        var f = d.data.target;
        return e.droppables.each(function () {
            var b = a(this);
            if (!b.droppable("options").disabled) {
                var c = b.offset();
                d.pageX > c.left && d.pageX < c.left + b.outerWidth() && d.pageY > c.top && d.pageY < c.top + b.outerHeight() ? (this.entered || (a(this).trigger("_dragenter", [f]), this.entered = !0), a(this).trigger("_dragover", [f])) : this.entered && (a(this).trigger("_dragleave", [f]), this.entered = !1)
            }
        }), !1
    }

    function f(b) {
        function c() {
            g && g.remove(), f.proxy = null
        }

        function d() {
            var d = !1;
            return f.droppables.each(function () {
                var e = a(this);
                if (!e.droppable("options").disabled) {
                    var f = e.offset();
                    return b.pageX > f.left && b.pageX < f.left + e.outerWidth() && b.pageY > f.top && b.pageY < f.top + e.outerHeight() ? (h.revert && a(b.data.target).css({
                        position: b.data.startPosition,
                        left: b.data.startLeft,
                        top: b.data.startTop
                    }), a(this).trigger("_drop", [b.data.target]), c(), d = !0, this.entered = !1, !1) : void 0
                }
            }), d || h.revert || c(), d
        }

        a.fn.draggable.isDragging = !1, e(b);
        var f = a.data(b.data.target, "draggable"), g = f.proxy, h = f.options;
        if (h.revert)if (1 == d())a(b.data.target).css({
            position: b.data.startPosition,
            left: b.data.startLeft,
            top: b.data.startTop
        }); else if (g) {
            var i, j;
            g.parent()[0] == document.body ? (i = b.data.startX - b.data.offsetWidth, j = b.data.startY - b.data.offsetHeight) : (i = b.data.startLeft, j = b.data.startTop), g.animate({
                left: i,
                top: j
            }, function () {
                c()
            })
        } else a(b.data.target).animate({left: b.data.startLeft, top: b.data.startTop}, function () {
            a(b.data.target).css("position", b.data.startPosition)
        }); else a(b.data.target).css({position: "absolute", left: b.data.left, top: b.data.top}), d();
        return h.onStopDrag.call(b.data.target, b), a(document).unbind(".draggable"), setTimeout(function () {
            a("body").css("cursor", "")
        }, 100), !1
    }

    a.fn.draggable = function (b, c) {
        return "string" == typeof b ? a.fn.draggable.methods[b](this, c) : this.each(function () {
            function c(b) {
                var c = a.data(b.data.target, "draggable"), d = c.handle, e = a(d).offset(), f = a(d).outerWidth(), g = a(d).outerHeight(), h = b.pageY - e.top, i = e.left + f - b.pageX, j = e.top + g - b.pageY, k = b.pageX - e.left;
                return Math.min(h, i, j, k) > c.options.edge
            }

            var g, h = a.data(this, "draggable");
            h ? (h.handle.unbind(".draggable"), g = a.extend(h.options, b)) : g = a.extend({}, a.fn.draggable.defaults, b || {});
            var i = g.handle ? "string" == typeof g.handle ? a(g.handle, this) : g.handle : a(this);
            return a.data(this, "draggable", {
                options: g,
                handle: i
            }), g.disabled ? void a(this).css("cursor", "") : void i.unbind(".draggable").bind("mousemove.draggable", {target: this}, function (b) {
                if (!a.fn.draggable.isDragging) {
                    var d = a.data(b.data.target, "draggable").options;
                    c(b) ? a(this).css("cursor", d.cursor) : a(this).css("cursor", "")
                }
            }).bind("mouseleave.draggable", {target: this}, function (b) {
                a(this).css("cursor", "")
            }).bind("mousedown.draggable", {target: this}, function (b) {
                if (0 != c(b)) {
                    a(this).css("cursor", "");
                    var g = a(b.data.target).position(), h = a(b.data.target).offset(), i = {
                        startPosition: a(b.data.target).css("position"),
                        startLeft: g.left,
                        startTop: g.top,
                        left: g.left,
                        top: g.top,
                        startX: b.pageX,
                        startY: b.pageY,
                        offsetWidth: b.pageX - h.left,
                        offsetHeight: b.pageY - h.top,
                        target: b.data.target,
                        parent: a(b.data.target).parent()[0]
                    };
                    a.extend(b.data, i);
                    var j = a.data(b.data.target, "draggable").options;
                    0 != j.onBeforeDrag.call(b.data.target, b) && (a(document).bind("mousedown.draggable", b.data, d), a(document).bind("mousemove.draggable", b.data, e), a(document).bind("mouseup.draggable", b.data, f))
                }
            })
        })
    }, a.fn.draggable.methods = {
        options: function (b) {
            return a.data(b[0], "draggable").options
        }, proxy: function (b) {
            return a.data(b[0], "draggable").proxy
        }, fieldEnable: function (b) {
            return b.each(function () {
                a(this).draggable({disabled: !1})
            })
        }, disable: function (b) {
            return b.each(function () {
                a(this).draggable({disabled: !0})
            })
        }
    }, a.fn.draggable.defaults = {
        proxy: null,
        revert: !1,
        cursor: "move",
        deltaX: null,
        deltaY: null,
        handle: null,
        disabled: !1,
        edge: 0,
        axis: null,
        onBeforeDrag: function (a) {
        },
        onStartDrag: function (a) {
        },
        onDrag: function (a) {
        },
        onStopDrag: function (a) {
        }
    }, a.fn.draggable.isDragging = !1
}(jQuery), function (a) {
    a.fn.resizable = function (b, c) {
        function d(b) {
            var c = b.data, d = a.data(c.target, "resizable").options;
            if (c.dir.indexOf("e") != -1) {
                var e = c.startWidth + b.pageX - c.startX;
                e = Math.min(Math.max(e, d.minWidth), d.maxWidth), c.width = e
            }
            if (c.dir.indexOf("s") != -1) {
                var f = c.startHeight + b.pageY - c.startY;
                f = Math.min(Math.max(f, d.minHeight), d.maxHeight), c.height = f
            }
            if (c.dir.indexOf("w") != -1) {
                var e = c.startWidth - b.pageX + c.startX;
                e = Math.min(Math.max(e, d.minWidth), d.maxWidth), c.width = e, c.left = c.startLeft + c.startWidth - c.width
            }
            if (c.dir.indexOf("n") != -1) {
                var f = c.startHeight - b.pageY + c.startY;
                f = Math.min(Math.max(f, d.minHeight), d.maxHeight), c.height = f, c.top = c.startTop + c.startHeight - c.height
            }
        }

        function e(b) {
            var c = b.data, d = a(c.target);
            d.css({
                left: c.left,
                top: c.top
            }), d.outerWidth() != c.width && d._outerWidth(c.width), d.outerHeight() != c.height && d._outerHeight(c.height)
        }

        function f(b) {
            return a.fn.resizable.isResizing = !0, a.data(b.data.target, "resizable").options.onStartResize.call(b.data.target, b), !1
        }

        function g(b) {
            return d(b), a.data(b.data.target, "resizable").options.onResize.call(b.data.target, b) !== !1 && e(b), !1
        }

        function h(b) {
            return a.fn.resizable.isResizing = !1, d(b, !0), e(b), a.data(b.data.target, "resizable").options.onStopResize.call(b.data.target, b), a(document).unbind(".resizable"), a("body").css("cursor", ""), !1
        }

        return "string" == typeof b ? a.fn.resizable.methods[b](this, c) : this.each(function () {
            function c(b) {
                var c = a(b.data.target), e = "", f = c.offset(), g = c.outerWidth(), h = c.outerHeight(), i = d.edge;
                b.pageY > f.top && b.pageY < f.top + i ? e += "n" : b.pageY < f.top + h && b.pageY > f.top + h - i && (e += "s"), b.pageX > f.left && b.pageX < f.left + i ? e += "w" : b.pageX < f.left + g && b.pageX > f.left + g - i && (e += "e");
                for (var j = d.handles.split(","), k = 0; k < j.length; k++) {
                    var l = j[k].replace(/(^\s*)|(\s*$)/g, "");
                    if ("all" == l || l == e)return e
                }
                return ""
            }

            var d = null, e = a.data(this, "resizable");
            e ? (a(this).unbind(".resizable"), d = a.extend(e.options, b || {})) : (d = a.extend({}, a.fn.resizable.defaults, b || {}), a.data(this, "resizable", {options: d})), d.disabled !== !0 && a(this).bind("mousemove.resizable", {target: this}, function (b) {
                if (!a.fn.resizable.isResizing) {
                    var d = c(b);
                    "" == d ? a(b.data.target).css("cursor", "") : a(b.data.target).css("cursor", d + "-resize")
                }
            }).bind("mouseleave.resizable", {target: this}, function (b) {
                a(b.data.target).css("cursor", "")
            }).bind("mousedown.resizable", {target: this}, function (b) {
                function d(c) {
                    var d = parseInt(a(b.data.target).css(c));
                    return isNaN(d) ? 0 : d
                }

                var e = c(b);
                if ("" != e) {
                    var i = {
                        target: b.data.target,
                        dir: e,
                        startLeft: d("left"),
                        startTop: d("top"),
                        left: d("left"),
                        top: d("top"),
                        startX: b.pageX,
                        startY: b.pageY,
                        startWidth: a(b.data.target).outerWidth(),
                        startHeight: a(b.data.target).outerHeight(),
                        width: a(b.data.target).outerWidth(),
                        height: a(b.data.target).outerHeight(),
                        deltaWidth: a(b.data.target).outerWidth() - a(b.data.target).width(),
                        deltaHeight: a(b.data.target).outerHeight() - a(b.data.target).height()
                    };
                    a(document).bind("mousedown.resizable", i, f), a(document).bind("mousemove.resizable", i, g), a(document).bind("mouseup.resizable", i, h), a("body").css("cursor", e + "-resize")
                }
            })
        })
    }, a.fn.resizable.methods = {
        options: function (b) {
            return a.data(b[0], "resizable").options
        }, fieldEnable: function (b) {
            return b.each(function () {
                a(this).resizable({disabled: !1})
            })
        }, disable: function (b) {
            return b.each(function () {
                a(this).resizable({disabled: !0})
            })
        }
    }, a.fn.resizable.defaults = {
        disabled: !1,
        handles: "n, e, s, w, ne, se, sw, nw, all",
        minWidth: 233,
        minHeight: 149,
        maxWidth: 1e4,
        maxHeight: 1e4,
        edge: 5,
        onStartResize: function (a) {
        },
        onResize: function (a) {
        },
        onStopResize: function (a) {
        }
    }, a.fn.resizable.isResizing = !1
}(jQuery), function (a) {
    window.YS = window.YS || {};
    var b = {};
    a.shortcut = function (c, d) {
        if (null != b[c])throw"shortcut:[" + c + "] has been registered";
        var e = c.split(",");
        $.each(e,function(f,g){
            b[g] = d, a.extend(d.prototype, {xtype: g})
        });
    }, YS.createWidget = function (c) {
        if (c instanceof a)return new YS.Widget({renderEl: c});
        var d = c.type.toLowerCase(), e = b[d];
        if (!e)throw d + " does not exist";
        return new e(c)
    }, YS.extend = function (b, c, d) {
        "object" == typeof c && (d = c, c = b, b = function () {
            c.apply(this, arguments)
        });
        var e = function () {
        }, f = c.prototype;
        return e.prototype = f, b.prototype = new e, b.superclass = f, a.extend(b.prototype, d), b
    }, YS.STATIC = {
        _st: (new Date).getTime(),
        _ct: (new Date).getTime(),
        zIndex: 10000,
        Language: "zh",
        num: 0,
        IDBase: new Date - 0,
        CSRF: a('meta[name="csrf-token"]').attr("content"),
        site: window.location.protocol + "//" + window.location.hostname
    }
}(jQuery), function (a) {
    var b = {};
    a.extend(YS, {
        subformItems: [],
        ValueWidgets: {
            text: 1,
            number: 1,
            textarea: 1,
            datetime: 1,
            checkboxgroup: 1,
            radiogroup: 1,
            combo: 1,
            combocheck: 1,
            address: 1,
            upload: 1,
            subform: 1,
            user: 1,
            usergroup: 1,
            dept: 1,
            deptgroup: 1,
            company: 1,
            companygroup: 1,
            linkdata: 1
        },
        ValueTypeMap: {
            text: "string",
            textarea: "string",
            combo: "string",
            radiogroup: "string",
            user: "id",
            combocheck: "array",
            checkboxgroup: "array",
            usergroup: "idarray",
            number: "number",
            datetime: "datetime",
            address: "address",
            dept: "did",
            deptgroup: "didarray"
        },
        WidgetValueOption: {CUSTOM: 0, ASYNC: 1, RELY: 2, FORMULA: 3},
        Keys: {
            ENTER: 13,
            BACKSPACE: 8,
            COMMA: 188,
            DELETE: 46,
            DOWN: 40,
            END: 35,
            ESCAPE: 27,
            HOME: 36,
            LEFT: 37,
            PAGE_DOWN: 34,
            PAGE_UP: 33,
            PERIOD: 190,
            RIGHT: 39,
            SPACE: 32,
            TAB: 9,
            UP: 38
        },
        States: {NORMAL: 0, SUCCESS: 1, ERROR: 2, WARNING: 3},
        Time: {excelDayOffset: 25569, millisecondsOfDay: 864e5},
        TimeZone: {defaultOffset: 288e5},
        Events: {RELY: "x-rely"},
        InvisibleSubmitRules: {KEEP: 1, NULL: 2, ALWAYS: 3},
        LimitFields: {
            filter: ["text", "radiogroup", "combo", "number", "datetime", "address", "user", "dept","company"],
            list: ["text", "textarea", "combo", "radiogroup", "checkboxgroup", "combocheck", "number", "datetime", "address", "user", "usergroup", "dept", "deptgroup", "company", "companygroup", "upload", "subform", "linkdata"],
            listJoin: ["text", "combo", "radiogroup", "number", "user", "dept"],
            group: ["text", "radiogroup", "combo", "number", "datetime", "address", "string", "subform", "user", "dept", "company", "id", "linkdata"],
            groupJoin: ["text", "combo", "radiogroup", "number", "user", "datetime", "address", "subform", "linkdata", "dept", "company"],
            validate: ["number", "text", "datetime", "radiogroup", "checkboxgroup", "combo", "combocheck", "user", "usergroup", "linkdata", "dept", "deptgroup", "company", "companygroup","deptadmin","bistable","usermsg","projectmsg"],
            rely: ["combo", "combocheck", "text", "datetime", "number", "radiogroup", "checkboxgroup", "user", "subform", "linkdata", "dept", "company"],
            link: ["combo", "combocheck", "text", "datetime", "number", "radiogroup", "checkboxgroup", "user", "linkdata", "dept", "deptgroup", "company", "companygroup"],
            brief: ["text", "textarea", "combo", "radiogroup", "combocheck", "checkboxgroup", "number", "datetime", "address", "user", "usergroup", "dept", "deptgroup", "company", "companygroup"],
            import: ["text", "textarea", "combo", "radiogroup", "combocheck", "checkboxgroup", "number", "datetime", "address", "subform"],
            combodata: ["combo", "combocheck", "text", "datetime", "number", "radiogroup", "checkboxgroup"],
            linkData: ["text", "textarea", "combo", "radiogroup", "checkboxgroup", "combocheck", "number", "datetime", "address", "user", "usergroup", "subform"],
            linkKey: ["text", "number", "datetime", "radiogroup", "combo"],
            subLinkData: ["text", "combo", "combocheck", "radiogroup", "checkboxgroup", "number", "datetime", "address"]
        },
        Operators: {group: ["+", "-", "*", "/", "."]},
        CONST: {
            QN_BUCKET: {PUBLIC_IMAGE: "media", PRIVATE_FILE: "file"},
            OSS_BUCKET: {PUBLIC_IMAGE: "oss_image"},
            DEPT_ID: {CURRENT: "110000000000000000000001"},
            PARAMETER: {EMPTY: "fx_param_empty"},
            TEXT_TYPE_REGEXP: {
                mobile: "^1[34578]\\d{9}$",
                tel: "^(0[0-9]{2,3}\\-)?([2-9][0-9]{6,7})+(\\-[0-9]{1,4})?$",
                zip: "^\\d{6}$",
                email: "^([a-zA-Z0-9_\\.\\-])+\\@(([a-zA-Z0-9\\-])+\\.)+([a-zA-Z0-9]{2,4})+$",
                ID: "(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)",
                money: "((^[$￥]?([1-9]\\d*))|^0)(\\.\\d{1,2})?$|(^[￥$]0\\.\\d{1,2}$)"
            },
            ORDER_STATE: {CANCELED: -1, UNPAID: 0, PAID: 1, RECEIPTING: 2, RECEIPTED: 3},
            FIELD: {DELIMITER: "@"},
            AUTH_GROUP: {SUBMIT: -1, VIEW_ALL: -2, MANAGE_OWN: -3, MANAGE_ALL: -4},
            TRACKER: {
                AUTH_GROUPS: "auth_groups",
                FORM_CREATE: "form_create",
                FORM_EDIT: "form_edit",
                ORDER_LIST: "order_list",
                MENU_PACK: "menu_pack",
                MEMBER_LIST: "member_list",
                TEMP_SEARCH: "temp_search",
                AUTH_GROUP_CREATE: "auth_group_create"
            },
            KEY_CODE: {LEFT: 37, RIGHT: 39},
            ALLIANCE_APPLY_STATE: {
                APPROVED: "approved",
                WAITING: "waiting",
                DENIED: "denied",
                NOT_APPLIED: "not_applied",
                BANNED: "banned"
            }
        }
    })
}(jQuery), $.extend(YS, {
    PROPERTIES: {
        zh: {
            Sunday: "星期日",
            Monday: "星期一",
            Tuesday: "星期二",
            Wednesday: "星期三",
            Thursday: "星期四",
            Friday: "星期五",
            Saturday: "星期六",
            "Short-Sun": "日",
            "Short-Mon": "一",
            "Short-Tue": "二",
            "Short-Wed": "三",
            "Short-Thu": "四",
            "Short-Fri": "五",
            "Short-Sat": "六",
            January: "一月",
            February: "二月",
            March: "三月",
            April: "四月",
            May: "五月",
            June: "六月",
            July: "七月",
            August: "八月",
            September: "九月",
            October: "十月",
            November: "十一月",
            December: "十二月",
            "Short-Jan": "一",
            "Short-Feb": "二",
            "Short-Mar": "三",
            "Short-Apr": "四",
            "Short-May": "五",
            "Short-Jun": "六",
            "Short-Jul": "七",
            "Short-Aug": "八",
            "Short-Sep": "九",
            "Short-Oct": "十",
            "Short-Nov": "十一",
            "Short-Dec": "十二"
        }
    }, i18nText: function (a) {
        return YS.PROPERTIES[YS.STATIC.Language][a]
    }
}), function ($) {
    YS.Utils = YS.Utils || {}, $.extend(YS.Utils, {
        isString: function (a) {
            return "string" == typeof a
        }, isNumber: function (b) {
            return $.isNumeric(b)
        }, isDate: function (a) {
            return a instanceof Date
        }, isEmpty: function (a) {
            return "" === a || a == null
        }, isBlank: function (a) {
            return a == null || "" === a.trim()
        }, isObjectEmpty: function (a) {
            if (null == a)return !0;
            if (a.length > 0)return !1;
            if (0 === a.length)return !0;
            for (var b in a)if (hasOwnProperty.call(a, b))return !1;
            return isNaN(a)
        }, isValueWidget: function (a) {
            return !!YS.ValueWidgets[a]
        }, pick: function (a, b) {
            var c = {};
            return YS.Utils.forEach(b, function (b, d) {
                d in a && (c[d] = a[d])
            }), c
        }, applyFunc: function (a, b, c, d) {
            return $.isFunction(b) ? b.apply(a, c ? c : []) : d
        }, forEach: function (a, b) {
            if (Array.isArray(a) || a instanceof jQuery)for (var c = 0, d = a.length; c < d && b.apply(a[c], [c, a[c]]) !== !1; c++); else if (a && "object" == typeof a)for (var e in a)if (a.hasOwnProperty(e) && b.apply(a[e], [e, a[e]]) === !1)break
        }, flatten: function (a, b, c) {
            if (c || (c = []), a)for (var d = 0, e = a.length; d < e; d++) {
                var f = a[d];
                Array.isArray(f) ? YS.Utils.flatten(f, b, c) : b && !b(f) || c.push(f)
            }
            return c
        }, applyCss: function (a, b) {
            YS.Utils.isEmpty(b) || (YS.Utils.isString(b) ? a.addClass(b) : a.css(b))
        }, getServerDate: function (a) {
            if (a && a.getResponseHeader) {
                var b = a.getResponseHeader("date");
                b && (YS.STATIC._st = new Date(b).getTime(), YS.STATIC._ct = (new Date).getTime())
            }
        }, ajaxUpload: function (b, c, d, e) {
            $.ajax({
                type: "POST",
                url: b.url,
                data: b.data,
                cache: !1,
                contentType: !1,
                processData: !1,
                beforeSend: function (a) {
                    a.setRequestHeader("X-CSRF-Token", YS.STATIC.CSRF)
                },
                xhr: function () {
                    var c = $.ajaxSettings.xhr();
                    return c.upload && b.onUpload && c.upload.addEventListener("progress", function (a) {
                        a.lengthComputable ? b.onUpload(a.loaded, a.total) : b.onUpload(3, 10)
                    }, !1), c
                }
            }).done(function () {
                c && c.apply(this, arguments), e && e.apply(this, arguments)
            }).fail(function () {
                d && d.apply(this, arguments), e && e.apply(this, arguments);
            })
        }, getUrlParameter: function (a) {
            for (var b = window.location.search.substring(1), c = b.split("&"), d = 0; d < c.length; d++) {
                var e = c[d].split("=");
                if (e[0] == a)return e[1]
            }
            return null
        }, validateEmail: function (a) {
            return /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(a)
        }, redirectTo: function (a) {
            window.location.href = a
        }, isCanvasSupported: function () {
            var a = document.createElement("canvas");
            return !(!a.getContext || !a.getContext("2d"))
        }, isFormDataSupported: function () {
            return void 0 !== window.FormData
        }, getFileDownloadURL: function (a, b, c) {
            //var arr = [];$.each(a, function(key, v){if(!isNaN(key))arr.push(a[key])});
            if(a.path && a.path!= "undefined"){
                b(getFlowConf().filePath + a.path);
            }else{
                b(getFlowConf().flowPath + "/assets/img/public/default-head.jpg");
            }
            return;
            $.ajax({
                url: getFlowConf().fileViewPath,
                data: {path:arr.join('')},
                success: function(a){
                    b(a.path);
                },
                error: function(){
                    YS.Msg.toast({type: "warning", msg: "文件获取失败"});
                }
            })
        }, evalFormula: function (a) {
            var b = [];
            YS.STATIC.FormulaEnv || (YS.Utils.forEach(Object.keys(YS.Formula), function (a, c) {
                b.push("var " + c + "=YS.Formula." + c)
            }), YS.STATIC.FormulaEnv = b.join(";") + ";");
            var c;
            try {
                c = new Function(YS.STATIC.FormulaEnv + "return " + a)()
            } catch (a) {
                c = null
            }
            return c
        }, createWidgetName: function () {
            return "_field_" + YS.STATIC.IDBase++
        }, formatFileSize: function (a) {
            return YS.Utils.isNumber(a) ? a >= 1e9 ? (a / 1e9).toFixed(2) + " GB" : a >= 1e6 ? (a / 1e6).toFixed(2) + " MB" : (a / 1e3).toFixed(2) + " KB" : "未知"
        }, chunkArray: function (a, b) {
            var c = [];
            if (!b || !a.length)return c;
            for (var d = 0, e = a.length; d < e; d += b) {
                var f = a.slice(d, d + b);
                c.push(f)
            }
            return c
        }, UUID: function (a) {
            return a ? (a ^ 16 * Math.random() >> a / 4).toString(16) : ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, this.UUID)
        }, GCD: function (a, b) {
            return b ? this.GCD(b, a % b) : a
        }, LCM: function (a, b) {
            return a * b / this.GCD(a, b)
        }, fixDecimalPrecision: function (a, b) {
            var c = "";
            if (b || (b = 8), !this.isEmpty(a)) {
                var d = parseFloat(a);
                if (!isNaN(d)) {
                    var e = (d + "").split(".")[1];
                    c = e && e.length > b ? parseFloat(d.toFixed(b)) : d, b > 6 && Math.abs(c) < 1 && /e-/.test(c + "") && (c = parseFloat(d.toFixed(6)))
                }
            }
            return c
        }, getSelectionText: function () {
            return window.getSelection ? window.getSelection().toString() : document.selection && document.selection.createRange ? document.selection.createRange().text : ""
        }, getWeekStartDate: function (a) {
            var b = a.getDay();
            return 0 === b && (b = 7), new Date(a.getFullYear(), a.getMonth(), a.getDate() - (b - 1))
        }, getWeekEndDate: function (a) {
            var b = a.getDay();
            return 0 === b && (b = 7), new Date(a.getFullYear(), a.getMonth(), a.getDate() + (7 - b))
        }, getMonthStartDate: function (a) {
            return new Date(a.getFullYear(), a.getMonth(), 1)
        }, getMonthEndDate: function (a) {
            return new Date(a.getFullYear(), a.getMonth() + 1, 0)
        }, setPageTitle: function (a) {
            YS.Utils.isEmpty(a) || (document.title = a)
        }, createMask: function (b, c) {
            var d = $('<div class="x-window-mask"/>'), e = c || {};
            if (e.isModal && d.addClass("modal"), e.isLight ? d.addClass("light") : e.isDark && d.addClass("dark"), e.hasLoader) {
                var f = !e.isDark;
                this.createLoadIcon(d, f)
            }
            return b && d.css({"z-index": YS.STATIC.zIndex++}).appendTo(b), d
        }, createLoadIcon: function (b, c) {
            var d = $('<div class="x-loader-icon"/>').appendTo(b);
            return c && d.addClass("colorful"), $("<div/>").appendTo(d), d
        }, doPrint: function (b, c) {
            $("body").children("div").addClass("x-ui-notprint");
            var d = $("#x-printer").removeClass().empty();
            0 === d.length && (d = $('<div id="x-printer"/>').appendTo("body")), b && d.append(b), c = c == null ? 0 : c, setTimeout(function () {
                window.print()
            }, c)
        }, cancelPrint: function () {
            $("body").children(".x-ui-notprint").removeClass("x-ui-notprint"), $("#x-printer").remove()
        }, copyToClipboard: function (a, b) {
            if (a && a.length) {
                var c = document.createElement("textarea");
                c.style.background = "transparent", c.style.color = "transparent", c.value = a, document.body.appendChild(c), c.select();
                var d;
                try {
                    d = document.execCommand("copy")
                } catch (a) {
                    d = !1
                }
                document.body.removeChild(c), d && YS.Utils.applyFunc(this, b, [], !1)
            }
        }, getColorNumber: function (a) {
            return YS.Utils.isEmpty(a) ? 1 : parseInt(a.toString().substring(0, 8), 16) % 6 + 1
        }, getFieldAttr: function (b, c) {
            if (!YS.Utils.isValueWidget(b.type))return null;
            if (c && c.indexOf(b.type) < 0)return null;
            var d = {id: formInfoId, text: b.labelName, name: b.fieldId, type: b.type};
            switch (b.type) {
                case"subform":
                    var e = [];
                    YS.Utils.forEach(b.items, function (d, f) {
                        $.extend(f, {formId: b.formId});
                        var g = YS.Utils.getFieldAttr(f, c);
                        g && ($.extend(g, {subform: b.fieldId}), e.push(g))
                    }), $.extend(d, {items: e});
                    break;
                case"linkdata":
                    $.extend(d, {
                        linkForm: b.linkForm,
                        linkFields: b.linkFields
                    });
                    break;
                case"combo":
                case"combocheck":
                case"radiogroup":
                case"checkboxgroup":
                    $.extend(d, {async: b.async, items: b.items});
                    break;
                case"datetime":
                    $.extend(d, {fieldFormat: b.fieldFormat})
            }
            return d
        }, leftPad: function (a, b, c) {
            var d = String(a);
            for (c || (c = " "); d.length < b;)d = c + d;
            return d.toString()
        }, startWith: function (a, b) {
            var c = a.length;
            return !(null == b || "" == b || 0 === c || b.length > c) && a.substr(0, b.length) == b
        },isImage : function(u){
            var type = u.substring(u.lastIndexOf(".")+1).toLowerCase();
            if (type == "png" || type == "jpeg" || type == "bmp" || type == "jpg" || type == "gif")
            {
                return true;
            }else{
                return false;
            }
        },getFieldInfoByFormula: function (a) {
            var b = {}, c = a + "", d = c.match(/(\$[0-9a-zA-Z\._]+)(#[0-9a-f]+)?(@[0-9a-f]+)?/), e = ["", "field", "entryId"];
            return YS.Utils.forEach(d, function (a, c) {
                0 !== a && c && (b[e[a]] = c.substr(1))
            }), b
        }, getFieldInfoById: function (a) {
            var b = {};
            a = "#" + a;
            var c = a.match(/(#[0-9a-f]+)(@[0-9a-f]+)?/), d = ["", "entryId"];
            return YS.Utils.forEach(c, function (a, c) {
                0 !== a && c && (b[d[a]] = c.substr(1))
            }), b
        }, isWpsWebView: function () {
            return /wpscloudform/.test(navigator.userAgent)
        }, callWPSAPI: function (a) {
            var b = "jsAsynCall(" + JSON.stringify(a) + ")";
            window.cefQuery && window.cefQuery({request: b})
        }, onWPSPageUnload: function (a, b) {
            a ? YS.Msg.alert({
                type: "warning",
                msg: "当前页面未保存，是否确定离开？",
                text4Ok: "离开",
                text4Cancel: "取消",
                onOk: function () {
                    YS.Utils.applyFunc(this, b, [], !1)
                }
            }) : YS.Utils.applyFunc(this, b, [], !1)
        }, fileDownload: function (a, b) {
            if (YS.Utils.isWpsWebView()) {
                var c = {method: "downloadUrl", url: a, filename: b}, d = b && b.split(".").pop();
                c.filter = "(*." + (d || "*") + ")", YS.Utils.callWPSAPI(c)
            } else YS.Utils.redirectTo(a)
        }, isSupportPdf: function () {
            return "undefined" != typeof navigator.mimeTypes["application/pdf"]
        }, dt: function (a, b) {
            if (a) {
                var c = ["e=" + a, "t=" + (new Date).getTime()];
                YS.Utils.isEmpty(b) || c.push("ext=" + b), YS.STATIC.user && YS.STATIC.user.username && c.push("u=" + YS.STATIC.user.username);
                var d = new Image;
                d.src = "";
            }
        } , myBrowser:function(){
            var userAgent = navigator.userAgent; //取得浏览器的userAgent字符串
            var isOpera = userAgent.indexOf("Opera") > -1;
            if (isOpera) {
                return "Opera"
            }; //判断是否Opera浏览器
            if (userAgent.indexOf("Firefox") > -1) {
                return "FF";
            } //判断是否Firefox浏览器
            if (userAgent.indexOf("Chrome") > -1){
                return "Chrome";
            }
            if (userAgent.indexOf("Safari") > -1) {
                return "Safari";
            } //判断是否Safari浏览器
            if (userAgent.indexOf("compatible") > -1 && userAgent.indexOf("MSIE") > -1 && !isOpera) {
                return "IE";
            }; //判断是否IE浏览器
            if (userAgent.indexOf("Trident") > -1) {
                return "Edge";
            } //判断是否Edge浏览器
        }
    })
}(jQuery), function ($) {
    YS.Utils = YS.Utils || {}, $.extend(YS.Utils, {
        address2Str: function (a, b, c) {
            if (c && a) {
                b = "";
                var d = !0;
                /p/.test(c) && a.province && (b += a.province, a.province === a.city && (d = !1)), /c/.test(c) && a.city && d && (b += a.city), /d/.test(c) && a.district && (b += a.district), /a/.test(c) && a.detail && (b += a.detail)
            }
            return b
        }, num2Str: function (a, b) {
            if (YS.Utils.isEmpty(a))return "";
            var c = a + "";
            if (YS.Utils.isEmpty(b))return c;
            var d = /\[Num0\]/;
            if (d.test(b))return b.replace(d, c);
            if (d = /\[Num1\]/, d.test(b))return b.replace(d, YS.Utils._num2CN(c, !1));
            if (d = /\[Num2\]/, d.test(b))return b.replace(d, YS.Utils._num2CN(c, !0));
            d = /[#0]+,?[#0]*\.?[#0]*%?/;
            var e = b.match(d);
            if (e && e.length > 0) {
                var f = e[0];
                return c = YS.Utils._numberFormat(a, f), b.replace(d, c)
            }
            return b
        }, _numberFormat: function (a, b) {
            var c = "", d = a + "";
            if (/%$/.test(b)) {
                c = "%", a = 100 * a, b = b.replace("%", "");
                var e = d.indexOf(".");
                if (e > -1) {
                    var f = d.length - 3 - e;
                    f = f < 0 ? 0 : f > 8 ? 8 : f, a = parseFloat(a.toFixed(f))
                }
                d = a + ""
            }
            var g = b.split("."), h = g[0], i = g[1];
            if ("" !== i) {
                var j = i ? i.length : 0;
                d = parseFloat(a).toFixed(j);
                for (var k = d.split(""), l = j; l > 0 && "#" === i.charAt(l - 1); l--) {
                    var m = k.pop();
                    if ("0" !== m) {
                        k.push(m);
                        break
                    }
                }
                var n = k.pop();
                "." === n && (n = ""), d = k.join("") + n
            }
            var o = d.split("."), p = o[0];
            if (/,/.test(h))o[0] = p.replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g, "$1,"); else {
                var q = h.match(/[0]+[0#]*$/);
                q && q.length > 0 && (o[0] = YS.Utils.leftPad(p, q[0].length, "0"))
            }
            return o.join(".") + c
        }, _num2CN: function (a, b) {
            var c = "〇一二三四五六七八九", d = "个十百千万亿";
            b && (c = "零壹贰叁肆伍陆柒捌玖", d = "个拾佰仟万亿");
            var e = Math.floor(Math.abs(a)), f = Math.abs(a).toString(), g = f.replace(/\..*$/, ""), h = f.split("."), i = c, j = d, k = "-.", l = i[0], m = new RegExp(i[0] + "*$"), n = new RegExp(i[0] + "+", "g"), o = "", p = "";
            if (o = a < 0 ? k[0] : "", h.length >= 2) {
                var q = h[1];
                if (q) {
                    p = k[1];
                    for (var r = 0; r < q.length; r++)p += i[+q[r]]
                }
            }
            if (1 == g.length)return o + i[e] + p;
            if (g.length <= 5) {
                for (var s = "", t = 0, e = g.length; e--;) {
                    var u = +g[t];
                    s += this._num2CN(g[t], b) + (u && e ? j[e] : ""), t++
                }
                return s = s.replace(n, l), s = s.replace(m, ""), o + s + p
            }
            for (var v = g.length / 4 >> 0, w = g.length % 4, s = ""; 0 == w || !j[3 + v];)w += 4, v--;
            if (+g.substr(0, w)) {
                s = this._num2CN(g.substr(0, w), b) + j[3 + v];
                var x = g.substr(w);
                "0" === x[0] && (s += i[0]), s += this._num2CN(x, b)
            } else s = this._num2CN(g.substr(0, w), b) + this._num2CN(g.substr(w), b);
            return s = s.replace(n, l), s = s.replace(m, ""), o + s + p
        }, date2Str: function (a, b) {
            if (!a)return "";
            var c = b.length, d = "";
            if (c > 0) {
                for (var e = b.charAt(0), f = 0, g = e, h = 1; h < c; h++) {
                    var i = b.charAt(h);
                    e !== i ? (d += YS.Utils._compileDateFormat({
                        char: e,
                        str: g,
                        len: h - f
                    }, a), e = i, f = h, g = e) : g += i
                }
                d += YS.Utils._compileDateFormat({char: e, str: g, len: c - f}, a)
            }
            return d
        }, _compileDateFormat: function (a, b) {
            var c = a.str, d = a.len, e = a.char;
            switch (e) {
                case"E":
                    c = d > 2 ? Date._DN[b.getDay()] : d > 1 ? Date._SDN[b.getDay()] : b.getDay() + "";
                    break;
                case"y":
                    c = d <= 3 ? (b.getFullYear() + "").slice(2, 4) : b.getFullYear();
                    break;
                case"M":
                    c = d > 2 ? Date._MN[b.getMonth()] : d < 2 ? b.getMonth() + 1 : YS.Utils.leftPad(b.getMonth() + 1 + "", 2, "0");
                    break;
                case"d":
                    c = d > 1 ? YS.Utils.leftPad(b.getDate() + "", 2, "0") : b.getDate();
                    break;
                case"h":
                    var f = b.getHours() % 12;
                    0 === f && (f = 12), c = d > 1 ? YS.Utils.leftPad(f + "", 2, "0") : f;
                    break;
                case"H":
                    c = d > 1 ? YS.Utils.leftPad(b.getHours() + "", 2, "0") : b.getHours();
                    break;
                case"m":
                    c = d > 1 ? YS.Utils.leftPad(b.getMinutes() + "", 2, "0") : b.getMinutes();
                    break;
                case"s":
                    c = d > 1 ? YS.Utils.leftPad(b.getSeconds() + "", 2, "0") : b.getSeconds();
                    break;
                case"a":
                    c = b.getHours() < 12 ? "am" : "pm";
                    break;
                default:
                    c = a.str
            }
            return c
        }
    })
}(jQuery), function ($) {
    YS.Formula = {
        AND: function () {
            for (var a = YS.Utils.flatten(arguments), b = 0, c = a.length; b < c; b++)if (!a[b])return !1;
            return !0
        }, OR: function () {
            for (var a = YS.Utils.flatten(arguments), b = 0, c = a.length; b < c; b++)if (a[b])return !0;
            return !1
        }, FALSE: function () {
            return !1
        }, TRUE: function () {
            return !0
        }, IF: function (a, b, c) {
            return a ? b : c
        }, NOT: function (a) {
            return !a
        }, XOR: function () {
            for (var a = 0, b = YS.Utils.flatten(arguments), c = 0, d = b.length; c < d; c++)b[c] && a++;
            return !!(1 & Math.floor(Math.abs(a)))
        }, CONCATENATE: function () {
            for (var a = YS.Utils.flatten(arguments), b = 0; (b = a.indexOf(!0)) > -1;)a[b] = "TRUE";
            for (var c = 0; (c = a.indexOf(!1)) > -1;)a[c] = "FALSE";
            return a.join("")
        }, EXACT: function (a, b) {
            return a === b
        }, LEFT: function (a, b) {
            return b = YS.Utils.isEmpty(b) ? 1 : b, a ? a.substring(0, b) : ""
        }, LEN: function (a) {
            return YS.Utils.isString(a) ? a ? a.length : 0 : a && a.length ? a.length : 0
        }, LOWER: function (a) {
            return YS.Utils.isString(a) ? a ? a.toLowerCase() : a : ""
        }, REPLACE: function (a, b, c, d) {
            return YS.Utils.isNumber(b) && YS.Utils.isNumber(c) ? (a = a || "", d = d || "", a.substr(0, b - 1) + d + a.substr(b - 1 + c)) : a
        }, REPT: function (a, b) {
            return b = b || 0, new Array(b + 1).join(a)
        }, RIGHT: function (a, b) {
            return b = void 0 === b ? 1 : b, a ? a.substring(a.length - b) : ""
        }, SEARCH: function (a, b, c) {
            var d;
            return YS.Utils.isString(a) && YS.Utils.isString(b) ? (c = c == null ? 0 : c, d = b.toLowerCase().indexOf(a.toLowerCase(), c - 1) + 1) : 0
        }, SPLIT: function (a, b) {
            return YS.Utils.isString(a) ? a.split(b) : []
        }, TRIM: function (a) {
            return YS.Utils.isString(a) ? a.replace(/ +/g, " ").trim() : ""
        }, UPPER: function (a) {
            return YS.Utils.isString(a) ? a.toUpperCase() : ""
        }, MID: function (a, b, c) {
            return a = a || "", YS.Utils.isNumber(b) && YS.Utils.isNumber(c) ? a.substr(b - 1, c) : a
        }, AVERAGE: function () {
            for (var a = YS.Utils.flatten(arguments, function (a) {
                return YS.Utils.isNumber(a)
            }), b = a.length, c = 0, d = 0, e = 0; e < b; e++)c += a[e], d += 1;
            return c / d
        }, COUNT: function () {
            return YS.Utils.flatten(arguments).length
        }, LARGE: function (a, b) {
            return a = YS.Utils.flatten(a, function (a) {
                return YS.Utils.isNumber(a)
            }), a.sort(function (a, b) {
                return b - a
            })[b - 1]
        }, MAX: function () {
            var a = YS.Utils.flatten(arguments, function (a) {
                return YS.Utils.isNumber(a)
            });
            return 0 === a.length ? 0 : Math.max.apply(Math, a)
        }, MIN: function () {
            var a = YS.Utils.flatten(arguments, function (a) {
                return YS.Utils.isNumber(a)
            });
            return 0 === a.length ? 0 : Math.min.apply(Math, a)
        }, SMALL: function (a, b) {
            return a = YS.Utils.flatten(a, function (a) {
                return YS.Utils.isNumber(a)
            }), a.sort(function (a, b) {
                return a - b
            })[b - 1]
        }, ABS: function (a) {
            return YS.Utils.isNumber(a) ? Math.abs(a) : 0
        }, ROUND: function (a, b) {
            return Math.round(a * Math.pow(10, b)) / Math.pow(10, b)
        }, CEILING: function (a, b) {
            if (0 === b)return 0;
            var c = b < 0 ? -1 : 0;
            b = Math.abs(b);
            var d = b - Math.floor(b), e = 0;
            return d > 0 && (e = -Math.floor(Math.log(d) / Math.log(10))), a >= 0 ? YS.Formula.ROUND(Math.ceil(a / b) * b, e) : 0 === c ? -YS.Formula.ROUND(Math.floor(Math.abs(a) / b) * b, e) : -YS.Formula.ROUND(Math.ceil(Math.abs(a) / b) * b, e)
        }, FLOOR: function (a, b) {
            if (0 === b)return 0;
            if (!(a > 0 && b > 0 || a < 0 && b < 0))return 0;
            b = Math.abs(b);
            var c = b - Math.floor(b), d = 0;
            return c > 0 && (d = -Math.floor(Math.log(c) / Math.log(10))), a >= 0 ? YS.Formula.ROUND(Math.floor(a / b) * b, d) : -YS.Formula.ROUND(Math.floor(Math.abs(a) / b) * b, d)
        }, INT: function (a) {
            return YS.Utils.isNumber(a) ? Math.floor(a) : 0
        }, LOG: function (a, b) {
            return b = void 0 === b ? 10 : b, YS.Utils.isNumber(b) ? Math.log(a) / Math.log(b) : 0
        }, MOD: function (a, b) {
            if (0 === b)return 0;
            var c = Math.abs(a % b);
            return b > 0 ? c : -c
        }, POWER: function (a, b) {
            var c = Math.pow(a, b);
            return isNaN(c) ? 0 : c
        }, PRODUCT: function () {
            for (var a = YS.Utils.flatten(arguments, function (a) {
                return YS.Utils.isNumber(a)
            }), b = 1, c = 0; c < a.length; c++)b *= a[c];
            return b
        }, SQRT: function (a) {
            return a < 0 ? 0 : Math.sqrt(a)
        }, SUM: function () {
            for (var a = 0, b = YS.Utils.flatten(arguments, function (a) {
                return YS.Utils.isNumber(a)
            }), c = 0, d = b.length; c < d; ++c)a += b[c]*1;
            return a
        }, SUMPRODUCT: function () {
            for (var a = 0, b = [], c = -1, d = 0; d < arguments.length; d++)arguments[d]instanceof Array && (c = c < 0 ? arguments[d].length : Math.min(arguments[d].length, c), b.push(arguments[d]));
            for (var e, f, g, h = 0; h < c; h++) {
                for (e = 1, f = 0; f < b.length; f++)g = parseFloat(b[f][h]), isNaN(g) && (g = 0), e *= g;
                a += e
            }
            return a
        }, FIXED: function (a, b) {
            return b = void 0 === b ? 0 : b, YS.Utils.isNumber(b) && b >= 0 ? Number(a).toFixed(b) : ""
        }, DATE: function () {
            return 6 === arguments.length ? new Date(parseInt(arguments[0], 10), parseInt(arguments[1], 10) - 1, parseInt(arguments[2], 10), parseInt(arguments[3], 10), parseInt(arguments[4], 10), parseInt(arguments[5], 10)) : 3 === arguments.length ? new Date(parseInt(arguments[0], 10), parseInt(arguments[1], 10) - 1, parseInt(arguments[2], 10)) : new Date(arguments[0])
        }, TIME: function (a, b, c) {
            return (3600 * a + 60 * b + c) / 86400
        }, TIMESTAMP: function (a) {
            return YS.Utils.isDate(a) ? a.getTime() : 0
        }, TODAY: function () {
            return new Date
        }, NOW: function () {
            return new Date
        }, SYSTIME: function () {
            var a = YS.STATIC._st, b = (new Date).getTime() - YS.STATIC._ct;
            return b > 0 && b < 36e5 && (a += b), new Date(a)
        }, DAY: function (a) {
            return a.getDate()
        }, MONTH: function (a) {
            return a.getMonth() + 1
        }, YEAR: function (a) {
            return a.getFullYear()
        }, HOUR: function (a) {
            return a.getHours()
        }, MINUTE: function (a) {
            return a.getMinutes()
        }, SECOND: function (a) {
            return a.getSeconds()
        }, DAYS: function (a, b) {
            var c = new Date(a.getFullYear(), a.getMonth(), a.getDate()), d = new Date(b.getFullYear(), b.getMonth(), b.getDate());
            return (c - d) / 864e5
        }, DAYS360: function (a, b, c) {
            var d, e, f = b.getMonth(), g = a.getMonth();
            if (c)d = 31 === b.getDate() ? 30 : b.getDate(), e = 31 === a.getDate() ? 30 : a.getDate(); else {
                var h = new Date(b.getFullYear(), f + 1, 0).getDate(), i = new Date(a.getFullYear(), g + 1, 0).getDate();
                d = b.getDate() === h ? 30 : b.getDate(), a.getDate() === i ? d < 30 ? (g++, e = 1) : e = 30 : e = a.getDate()
            }
            return 360 * (a.getFullYear() - b.getFullYear()) + 30 * (g - f) + (e - d)
        }, DATEDELTA: function (a, b) {
            return YS.Utils.isNumber(b) || (b = 0), new Date(a.getTime() + 864e5 * b)
        }, ISOWEEKNUM: function (a) {
            a.setHours(0, 0, 0), a.setDate(a.getDate() + 4 - (a.getDay() || 7));
            var b = new Date(a.getFullYear(), 0, 1);
            return Math.ceil(((a - b) / 864e5 + 1) / 7)
        }, WEEKNUM: function (a, b) {
            var c = 2 === b ? 1 : 0, d = new Date(a.getFullYear(), 0, 1), e = (c + 7 - d.getDay()) % 7, f = e > 0 ? 1 : 0, g = d.getTime() + 24 * e * 60 * 60 * 1e3;
            return Math.floor((a.getTime() - g) / 864e5 / 7 + 1) + f
        }, TEXT: function (a, b) {
            return a == null ? "" : YS.Utils.isDate(a) && !YS.Utils.isEmpty(b) ? YS.Utils.date2Str(a, b) : YS.Utils.num2Str(a, b)
        }, VALUE: function (a) {
            return YS.Utils.isEmpty(a) ? 0 : isNaN(a) ? 0 : parseFloat(a)
        }, UUID: function () {
            return YS.Utils.UUID()
        }, ISEMPTY: function (a) {
            return YS.Utils.isObjectEmpty(a)
        }, MAPX: function (a, b, c, d) {
            var e = null;
            if (YS.Utils.isEmpty(a) || YS.Utils.isObjectEmpty(b))return e;
            a = a.toLowerCase();
            var f = YS.Utils.getFieldInfoByFormula(c), g = YS.Utils.getFieldInfoByFormula(d);
            if (/^sum|avg|max|min|count|first|last$/.test(a) && f.entryId && f.entryId === g.entryId) {
                var h = YS.Utils.isDate(b), i = h ? b.getTime() : b;
            }
            return e
        }, MAP: function (a, b, c) {
            var d = [];
            if (YS.Utils.isObjectEmpty(a))return d;
            var e = YS.Utils.getFieldInfoByFormula(b), f = YS.Utils.getFieldInfoByFormula(c);
            return $.ajax({
                url: "/data/formula/map",
                async: !1,
                data: {
                    formId: e.entryId,
                    lookup_value: a,
                    lookup_field: e.field,
                    result_field: f.field,
                },
                success: function(a){
                    YS.Utils.forEach(a.result, function (a, b) {
                        d.push(b[f.field])
                    })
                }
            }), d
        }
    }
}(jQuery), YS.OB = function (a) {
    this.options = $.extend(this._defaultConfig(), a), this._beforeInit(), this._init(), this._afterInit()
}, $.extend(YS.OB.prototype, {
    _defaultConfig: function () {
        return {onBeforeInit: null, onAfterInit: null}
    }, _init: function () {
    }, _beforeInit: function () {
        YS.Utils.applyFunc(this, this.options.onBeforeInit, [], !1)
    }, _afterInit: function () {
        YS.Utils.applyFunc(this, this.options.onAfterInit, [], !1)
    }
}), YS.Widget = YS.extend(YS.OB, {
    _defaultConfig: function () {
        return $.extend(YS.Widget.superclass._defaultConfig.apply(this, arguments), {
            fieldId: "",
            baseCls: "",
            customCls: null,
            fieldEnable: !0,
            fieldIsshow: !0,
            fieldIswf: !1,
            fieldIsOwer: !1,
            fieldIsdel: !0,
            fieldIssubmit: !1,
            fieldIssubmitDept: !1,
            fieldIsname: !1,
            labelName: "",
            fieldName: "",
            fieldOrderno: -1,
            fieldContent: "",
            fieldLineWidth: 6,
            invalidateType: "blank",
            isShowEditable: !0,
            isShowEnable: !0,
            isFlowConfigEnable: !0,
            isSubmitConfigEnable: !0,
            fieldPid: ""
        })
    }, _init: function () {
        YS.Widget.superclass._init.apply(this, arguments), this._initRoot(), this._initNameEffects()
    }, _afterInit: function () {
        this._initElementSize(), this._initVisualEffects(), this._initDefaultValue(), YS.Widget.superclass._afterInit.apply(this, arguments)
    }, _initRoot: function () {
        var a = this.options;
        null != a.renderEl ? this.element = $(a.renderEl) : this.element = this._defaultRoot(), a.baseCls && this.element.addClass(a.baseCls), a.customCls && this.element.addClass(a.customCls)
    }, _initNameEffects: function () {
        var a = this.options;
        a.fieldId || (a.fieldId = "_field_" + YS.STATIC.IDBase++), this.element.attr({fieldId: a.fieldId})
    }, _initElementSize: function () {
        this.doResize()
    }, _initVisualEffects: function () {
        this.setEnable(this.options.fieldEnable), this.setVisible(this.options.fieldIsshow)
    }, _initDefaultValue: function () {
        var a = this.options;
        null != a.value ? this.setValue(a.value) : null != a.text && this.setText(a.text)
    }, _defaultRoot: function () {
        return $("<div/>")
    }, getWidgetByName: function (a) {
        return this.options.resultWidgets ? this.options.resultWidgets[a] : null
    }, getWidgetName: function () {
        return this.options.fieldId
    }, getWidgetType: function () {
        return this.options.type
    }, getText: function () {
        return this.options.text
    }, setText: function (a) {
        this.options.text = a
    }, getValue: function () {
        return this.options.value
    }, setValue: function (a) {
        this.options.value = a
    }, isEnabled: function () {
        return this.options.fieldEnable
    }, setEnable: function (a) {
        this.options.fieldEnable = !!a, this.options.fieldEnable === !0 ? this.element.removeClass("x-ui-disable") : this.element.addClass("x-ui-disable")
    }, isVisible: function () {
        return this.options.fieldIsshow
    }, setVisible: function (a) {
        this.options.fieldIsshow = !!a, this.options.fieldIsshow === !0 ? this.element.show() : this.element.hide()
    }, reset: function () {
        this.setValue(null)
    }, doResize: function (a) {
        var b = this.options;
        a && (b.width = a.width, b.height = a.height);
        /*if(b.fieldLayout == "normal" || (b.fieldLayout == "grid-2" && b.fieldLineWidth == 12)){
            b.width = 580;
        }else if(b.type == "textarea"){
            b.width = 200
        }*/
        YS.Utils.isEmpty(b.width) || this.element.css({width: b.width}), YS.Utils.isEmpty(b.height) || this.element.css({height: b.height})
    }, destroy: function () {
        this.element.remove()
    }, rebuild: function () {
        this.options.renderEl = this.element, this.element.empty(), this._beforeInit(), this._init(), this._afterInit()
    }, checkValidate: function () {
        return !0
    }, fireEvent: function (a, b) {
        this.element.trigger(a, b)
    }, getOptions: function () {
        var a = this.options, b = {
            type: a.type,
            baseCls: a.baseCls,
            fieldId: a.fieldId,
            fieldType: a.fieldType,
            fieldLength: a.fieldLength,
            ajaxurl: a.ajaxurl,
            text: a.text,
            value: a.value,
            isShowEditable: a.isShowEditable,
            isShowEnable: a.isShowEnable,
            fieldEnable: a.fieldEnable ? 1 : 0,
            fieldIsshow: a.fieldIsshow ? 1 : 0,
            fieldIsnull: a.fieldIsnull ? 1: 0,
            fieldIswf: a.fieldIswf ? 1 : 0,
            fieldIsOwer: a.fieldIsOwer ? 1 : 0,
            fieldIsdel: a.fieldIsdel ? 1 : 0,
            fieldIssubmit: a.fieldIssubmit ? 1 : 0,
            fieldIssubmitDept: a.fieldIssubmitDept ? 1 : 0,
    		fieldIsname: a.fieldIsname ? 1 : 0,
            labelName: a.labelName,
            fieldContent: a.fieldContent,
            fieldOrderno: a.fieldOrderno,
            fieldLineWidth: a.fieldLineWidth,
            fieldDefaultValueName: a.fieldDefaultValueName,
            formula: a.formula
        };
        a.fieldName && (b.fieldName = a.fieldName);
        a.fieldPid && (b.fieldPid = a.fieldPid);
        return b
    }, getInvalidateType: function () {
        return this.options.invalidateType
    }, setInvalidateType: function (a) {
        this.options.invalidateType = a
    }, getNullValue: function () {
        return null
    }, getLinkValue: function () {
        return this.getValue()
    }, getLinkType: function () {
        return this.getWidgetType()
    }
}), function (a) {
    YS.RelyProcessor = function (a) {
        this.options = {
            version: 0,
            items: [],
            versionMap: {},
            stateMap: {},
            asyncMap: {},
            defaults: [],
            relyMap: {},
            linkMap: {},
            subList: []
        }, this._init(a)
    }, a.extend(YS.RelyProcessor.prototype, {
        RELY_END: -1, _init: function (a) {
            this.options.items = a, this.options.relyMap = this._getRelyWidgetsMap(a), this.options.linkMap = this._getLinkMap(this.options.relyMap)
        }, _getLinkMap: function (a) {
            var b = this, c = {};
            return YS.Utils.forEach(a, function (a, d) {
                YS.Utils.forEach(d, function (d, e) {
                    b._add2LinkMap(c, e, a)
                })
            }), c
        }, _add2LinkMap: function (a, b, c) {
            if (a[b] || (a[b] = []), a[b].push(c), /\./.test(b) && !/\./.test(c)) {
                var d = b.split(".")[0];
                this._add2LinkMap(a, d, c)
            }
            return a
        }, _getRelyWidgetsMap: function (a, isSub) {
            var b = this, c = {};
            YS.Utils.forEach(a, function (a, d) {
                if(isSub){
                    b.options.subList.push(d.fieldId);
                }
                if (d && "linkdata" !== d.type) {
                    if ("subform" === d.type) {
                        var f = b._getRelyWidgetsMap(d.items, !0);
                        $.each(f, function (a, b) {
                            c[a] = b
                        })
                    }
                    d.formula && (c[d.fieldId] = b._getFormulaWidgets(d.formula))
                }
            });
            return c
        }, _getFormulaWidgets: function(a){
            var c = this, d = a.split(/(\$[0-9a-zA-Z\._#@]+)/g), e = [];
            $.each(d, function (a, d) {
                if (YS.Utils.startWith(d, "$_field_") || YS.Utils.startWith(d, "$ext")) {
                    var f = d.replace("$", "").split("#"), g = f[0], h = f[1];
                    if (YS.Utils.isEmpty(h)) {
                        var j = c.getWidgetByFieldId(g);
                        j && e.push(j.fieldId);
                    }
                }
            });
            return e;
        }, getWidgetByFieldId: function(a){
            var b = this, c = this.options, d = {};
            $.each(c.items, function(e, f){
                if(f.type == "subform"){
                    $.each(f.items, function(g, h){
                        if(h.fieldId == a){
                            d = h;return;
                        }
                    })
                }else if(f.fieldId == a){
                    d = f;
                    return;
                }
            });
            return d;
        }, _isSubformWidget: function (a) {
            var b = this.options, e = !1;
            $.each(b.subList, function(c, d){
                if(d == a){
                    e = !0;return;
                }
            })
            return e
        }, getRelyVersion: function (a, b, c, d) {
            var e = this;
            return d = d || {}, YS.Utils.forEach(a[b], function (b, f) {
                d[f] || (d[f] = c, e.getRelyVersion(a, f, c, d))
            }), d
        }, checkAsyncState: function () {
            var a = this, b = this.options, c = !0;
            return YS.Utils.forEach(b.asyncMap, function (d) {
                var e = b.asyncMap[d];
                if (a._isSubformWidget(d) ? YS.Utils.forEach(e, function (a, b) {
                        if (b === !1)return c = !1, !1
                    }) : c = e !== !1, !c)return !1
            }), c
        }, setStateMap: function (a, b) {
            this.options.stateMap[a] = b
        }, setAsyncMap: function (a, b) {
            this.options.asyncMap[a] = b
        }, addDefaultRely: function (a) {
            YS.Utils.isObjectEmpty(a.options.fieldDefaultValue) || this.options.defaults.push(a)
        }, getDefaultRely: function () {
            return this.options.defaults
        }, fireRely: function (b, c, d) {
            var e = this.options, f = this, g = -1, h = b.options.fieldId;
            b.options.fieldPid && (g = a(b.element).closest(".subform-line").index()), c || (e.version++, c = e.version, a.extend(e.versionMap, this.getRelyVersion(e.linkMap, h, c))), g > -1 ? (e.asyncMap[h] = e.asyncMap[h] || {}, e.asyncMap[h][g] = c) : e.asyncMap[h] = c;
            var i = b.getLinkValue();
            YS.Utils.forEach(e.linkMap[h], function (a, b) {
                if (!e.versionMap[b] || e.versionMap[b] === c) {
                    var h = !0;
                    YS.Utils.forEach(e.relyMap[b], function (a, d) {
                        if (e.versionMap[d] === c) {
                            var i = e.asyncMap[d];
                            if (f._isSubformWidget(d)){
                                if (i = i || {}, g > -1 && f._isSubformWidget(b)){
                                    h = i[g] === c;
                                } else {
                                    var j = e.stateMap[d] === c;
                                    YS.Utils.forEach(i, function (a, b) {
                                        if (e.stateMap[d + a] === c)return j = !0, b !== c ? (j = !1, !1) : void 0
                                    }), j || (h = !1)
                                }
                            } else {
                                h = i === c
                            };
                            return !!h && void 0
                        }
                    })
                    if (h) {
                        if (g > -1) {
                            if (e.stateMap[b + g] === c)return;
                            e.stateMap[b + g] = c
                        } else {
                            if (e.stateMap[b] === c)return;
                            e.stateMap[b] = c
                        }
                        var j;
                        if (f._isSubformWidget(b))if (g > -1) {
                            if (j = d.getWidgetByName(b, g), !j)return;
                            e.asyncMap[b] = e.asyncMap[b] || {}, e.asyncMap[b][g] = !1, d.dealRely(b, j, c, i)
                        } else {
                            var k = 0;
                            e.asyncMap[b] = e.asyncMap[b] || {};
                            do j = d.getWidgetByName(b, k), j && (e.asyncMap[b][k] = !1, d.dealRely(b, j, c, i)), k++; while (j)
                        } else {
                            if (j = d.getWidgetByName(b), !j)return;
                            e.asyncMap[b] = !1, d.dealRely(b, j, c, i)
                        }
                    }
                }
            })
        }
    })
}(jQuery), function () {
    function a() {
        try {
            return c in b && b[c]
        } catch (a) {
            return !1
        }
    }

    YS.Store = YS.Store || {}, $.extend(YS.Store, {
        set: function (a, b) {
        }, get: function (a, b) {
        }, has: function (a) {
            return void 0 !== this.get(a)
        }, remove: function (a) {
        }, clear: function () {
        }, transact: function (a, b, c) {
            null == c && (c = b, b = null), null == b && (b = {});
            var d = this.get(a, b);
            c(d), this.set(a, d)
        }, getAll: function () {
            var a = {};
            return this.forEach(function (b, c) {
                a[b] = c
            }), a
        }, forEach: function () {
        }, serialize: function (a) {
            return JSON.stringify(a)
        }, deserialize: function (a) {
            if ("string" == typeof a)try {
                return JSON.parse(a)
            } catch (b) {
                return a || void 0
            }
        }, getKey: function (a, b) {
            var c = "";
            switch (a) {
                case"paramFields":
                case"showFields":
                case"metaFields":
                    c = [a, b.entryId, b.groupId].join("");
                    break;
                case"authGroup":
                    c = [a, b.entryId].join("")
            }
            return c
        }
    });
    var b = "undefined" != typeof window ? window : global, c = "localStorage";
    a() && $.extend(YS.Store, {
        storage: b[c], set: function (a, b) {
            if (void 0 === b)return this.remove(a);
            try {
                this.storage.setItem(a, this.serialize(b))
            } catch (a) {
                return
            }
            return b
        }, get: function (a, b) {
            var c = this.deserialize(this.storage.getItem(a));
            return void 0 === c ? b : c
        }, remove: function (a) {
            this.storage.removeItem(a)
        }, clear: function () {
            this.storage.clear()
        }, forEach: function (a) {
            for (var b = 0; b < this.storage.length; b++) {
                var c = this.storage.key(b);
                a(c, this.get(c))
            }
        }
    })
}(), function (a) {
    YS.UI = {
        showPopover: function (b) {
            var c = a('<div class="x-ui-popover"/>').append('<i class="pop-icon" />').appendTo("body"), d = a.extend({
                anchor: null,
                position: "topLeft",
                content: null,
                maxWidth: null,
                type: "info"
            }, b);
            d.maxWidth && c.css({"max-width": d.maxWidth}), d.type && c.addClass(d.type), d.content && d.content.appendTo(c);
            var e = d.anchor, f = e.offset(), g = {"z-Index": YS.STATIC.zIndex++};
            switch (d.position) {
                case"topLeft":
                    c.addClass("top"), g.left = Math.max(f.left + e.width() / 2 - c.width() / 2 - 5, 4), g.bottom = document.body.clientHeight - f.top + 8;
                    break;
                case"topRight":
                    c.addClass("top"), g.right = Math.max(document.body.clientWidth - f.left - e.width() / 2 - c.width() / 2 - 5, 4), g.bottom = document.body.clientHeight - f.top + 8;
                    break;
                case"bottomLeft":
                    c.addClass("bottom"), g.left = Math.max(f.left + e.width() / 2 - c.width() / 2 - 5, 4), g.top = f.top + e.height() + 8;
                    break;
                case"bottomRight":
            }
            c.css(g), c.addClass("fadein")
        }, closePopover: function () {
            var b = a(".x-ui-popover");
            b.length > 0 && (b.remove(), b = null)
        }
    }
}(jQuery), $.extend(Array.prototype, {
    remove: function (a) {
        var b = this.indexOf(a);
        return b != -1 && this.splice(b, 1), this
    }, unique: function () {
        for (var a = {}, b = this.length, c = [], d = 0; d < b; d++) {
            var e = this[d];
            a.hasOwnProperty(e) || (a[e] = 1, c.push(e))
        }
        return c
    }
}), $.extend(Date.prototype, {
    getMonthDays: function (a) {
        var b = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31], c = this.getFullYear();
        return "undefined" == typeof a && (a = this.getMonth()), 0 !== c % 4 || 0 === c % 100 && 0 !== c % 400 || 1 !== a ? b[a] : 29
    }
}), function () {
    Date._DN = [YS.i18nText("Sunday"), YS.i18nText("Monday"), YS.i18nText("Tuesday"), YS.i18nText("Wednesday"), YS.i18nText("Thursday"), YS.i18nText("Friday"), YS.i18nText("Saturday")], Date._SDN = [YS.i18nText("Short-Sun"), YS.i18nText("Short-Mon"), YS.i18nText("Short-Tue"), YS.i18nText("Short-Wed"), YS.i18nText("Short-Thu"), YS.i18nText("Short-Fri"), YS.i18nText("Short-Sat")], Date._MN = [YS.i18nText("January"), YS.i18nText("February"), YS.i18nText("March"), YS.i18nText("April"), YS.i18nText("May"), YS.i18nText("June"), YS.i18nText("July"), YS.i18nText("August"), YS.i18nText("September"), YS.i18nText("October"), YS.i18nText("November"), YS.i18nText("December")], Date._SMN = [YS.i18nText("Short-Jan"), YS.i18nText("Short-Feb"), YS.i18nText("Short-Mar"), YS.i18nText("Short-Apr"), YS.i18nText("Short-May"), YS.i18nText("Short-Jun"), YS.i18nText("Short-Jul"), YS.i18nText("Short-Aug"), YS.i18nText("Short-Sep"), YS.i18nText("Short-Oct"), YS.i18nText("Short-Nov"), YS.i18nText("Short-Dec")]
}(), $.extend($.Event.prototype, {
    stopEvent: function () {
        this.stopPropagation(), this.preventDefault()
    }
}), function (a) {
    YS.Container = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.Container.superclass._defaultConfig.apply(), {
                baseCls: "fui_container",
                resultWidgets: {}
            })
        }, _addWidget: function (b) {
            var c = this.options, d = YS.createWidget(b);
            c.resultWidgets[d.options.fieldId] = d;
            var e = d.options.resultWidgets;
            return e && a.extend(c.resultWidgets, e), d
        }
    })
}(jQuery), function (a) {
    YS.TextEditor = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.TextEditor.superclass._defaultConfig.apply(), {
                baseCls: "fui_text",
                inputCls: "x-input",
                fieldType: "text",
                fieldLength: 128,
                ajaxurl: "",
                width: 200,
                height: 32,
                fieldErrMsg: "",
                fieldIsnull: !0,
                fieldIsAutoIncrement: !1,
                onValidateSuccess: null,
                onValidateFail: null,
                onAfterValidate: null,
                onBeforeEdit: null,
                onAfterEdit: null,
                onStopEdit: null
            })
        }, _init: function () {
            YS.TextEditor.superclass._init.apply(this, arguments);
            var a = this.options, b = this;
            this.editComp = this._createEditComp(), this.editComp.addClass(a.inputCls).attr('id',a.name).attr('name',a.name).appendTo(this.element), a.waterMark && this.editComp.attr("placeholder", a.waterMark), this.editComp.focus(function (c) {
                YS.UI.closePopover();
                b.$err && b.$err.hide(), b.isEnabled() && b._isScanEditable() && (b.editComp.addClass(a.inputCls + "-focus"), YS.Utils.applyFunc(b, a.onBeforeEdit, [c], !1))
            }).blur(function (c) {
                if (b.isEnabled() && b._isScanEditable()) {
                    b.editComp.removeClass(a.inputCls + "-focus");
                    var d = b.checkValidate();
                    YS.Utils.applyFunc(b, a.onStopEdit, [d, c], !1)
                }
            }).keyup(function (c) {
                b.isEnabled() && b._isScanEditable() && YS.Utils.applyFunc(b, a.onAfterEdit, [c], !1)
            })
        }, _createEditComp: function () {
            return a("<input type='text' onmouseover='this.title=this.value' />")
        }, checkValidate: function () {
            var a = this.options, b = this.editComp.val().trim(), c = !0;
            if (YS.Utils.isEmpty(b)){c = a.fieldIsnull; }else if (!YS.Utils.isEmpty(a.fieldRegexl)) {
                try {
                    c = new RegExp(a.fieldRegexl).test(b)
                } catch (a) {
                    c = !1
                }
                c || this.setInvalidateType("fieldRegexl")
            }
            return c ? YS.Utils.applyFunc(this, a.onValidateSuccess, [b], !1) === !1 && this.setState(YS.States.NORMAL) : YS.Utils.applyFunc(this, a.onValidateFail, [b], !1) === !1 && this.setState(YS.States.ERROR), YS.Utils.applyFunc(this, a.onAfterValidate, [b, c], !1), c
        }, showErrorMsg: function (b) {
            var c = this.options.fieldType;
            /*YS.UI.closePopover();
             YS.UI.showPopover({
             position: "bottomLeft",
             anchor: this.editComp,
             content: a("<span/>").text(b ? b : "内容不符合规范"),
             type: "dark"
             });*/
        }, select: function () {
            this.editComp && (this.editComp.select(), this.editComp.focus())
        }, _isScanEditable: function () {
            var a = this.options;
            return !a.scan || a.scan.editable
        }, setEnable: function (a) {
            YS.TextEditor.superclass.setEnable.apply(this, [a]), a && this._isScanEditable() ? this.editComp.removeAttr("readOnly") : this.editComp.attr("readOnly", "readOnly")
        }, setText: function (a) {
            this.setValue(a)
        }, setValue: function (a) {
            this.editComp.val(a)
        }, getText: function () {
            return this.getValue()
        }, getValue: function () {
            return this.editComp.val().trim()
        }, setState: function (a) {
            var b = this.options, c = b.inputCls + "-error " + b.inputCls + "-success " + b.inputCls + "-warning";
            switch (b.state = a, a) {
                case YS.States.SUCCESS:
                    this.editComp.removeClass(c).addClass(b.inputCls + "-success");
                    break;
                case YS.States.ERROR:
                    this.showErrorMsg(b.fieldErrMsg);
                    this.editComp.removeClass(c).addClass(b.inputCls + "-error");
                    break;
                case YS.States.WARNING:
                    this.editComp.removeClass(c).addClass(b.inputCls + "-warning");
                    break;
                default:
                    this.editComp.removeClass(c)
            }
        }, getState: function () {
            return this.options.state ? 0 : this.options.state
        }, getOptions: function () {
            var b = this.options;
            return a.extend(YS.TextEditor.superclass.getOptions.apply(this, arguments), {
                fieldRegexl: b.fieldRegexl,
                fieldErrMsg: b.fieldErrMsg,
                fieldIsAutoIncrement: b.fieldIsAutoIncrement ? 1 : 0,
                scan: b.scan
            })
        }, getNullValue: function () {
            return ""
        }
    }), a.shortcut("text", YS.TextEditor)
}(jQuery), function (a) {
    YS.TextArea = YS.extend(YS.TextEditor, {
        _defaultConfig: function () {
            return a.extend(YS.TextArea.superclass._defaultConfig.apply(), {
                baseCls: "fui_textarea",
                inputCls: "x-textarea",
                fieldLength: 1024,
                width: 200,
                height: 64
            })
        }, _createEditComp: function () {
            return a("<textarea onmouseover='this.title=this.value' onkeyup='CustomForm.textAutoHeight(this)'/>")
        }
    }), a.shortcut("textarea", YS.TextArea)
}(jQuery), function (a) {
    YS.Number = YS.extend(YS.TextEditor, {
        _defaultConfig: function () {
            return a.extend(YS.Number.superclass._defaultConfig.apply(), {fieldType:"int",allowDecimals: !1, allowNegative: !0,fieldDecimalLength: ""})
        }, _init: function () {
            YS.Number.superclass._init.apply(this, arguments);
            var a = this.options, b = "[\\d]{0,}", l = a.fieldDecimalLength;
            l>0 && (b = "[\\d]{0,}[\\.]?[\\d]{0,"+l+"}"), a.allowNegative && (b = "[-]?" + b), a.fieldRegexl = "^" + b + "$"
        }, _createEditComp: function () {
            return a("<input onmouseover='this.title=this.value'/>")
        }, getOptions: function () {
            var b = this.options;
            return a.extend(YS.Number.superclass.getOptions.apply(this, arguments), {
                allowDecimals: b.fieldDecimalLength>0 ? !0 : !1,
                allowNegative: b.allowNegative,
                fieldDecimalLength: b.fieldDecimalLength
            })
        }, setValue: function (a) {
            this.editComp.val(YS.Utils.fixDecimalPrecision(a))
        }, getValue: function () {
            var a = this.editComp.val();
            if (YS.Utils.isEmpty(a))return null;
            var b = parseFloat(a);
            return isNaN(b) ? null : (b==0 ? a : b)
        }, getNullValue: function () {
            return null
        }, getText: function () {
            return this.editComp.val()
        }
    }), a.shortcut("number", YS.Number)
}(jQuery), function (a) {
    YS.Password = YS.extend(YS.TextEditor, {
        _createEditComp: function () {
            return a('<input type="password"/>')
        }
    }), a.shortcut("password", YS.Password)
}(jQuery), function (a) {
    YS.Trigger = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.Trigger.superclass._defaultConfig.apply(), {
                baseCls: "fui_trigger",
                width: 200,
                height: 32,
                btnWidth: 32,
                waterMark: null,
                onElementCreate: null,
                triggerIcon: "",
                edge: {width: 200, height: 180}
            })
        }, _init: function () {
            YS.Trigger.superclass._init.apply(this, arguments);
            var a = this.options;
            YS.Utils.applyFunc(this, a.onElementCreate, [], !1) === !1 && (this.editComp = this._createEditComp(), a.waterMark && this.editComp.attr("placeholder", a.waterMark), this.triggerBtn = this._createTriggerBtn(), this._bindEvts())
        }, _createEditComp: function () {
            return a('<input onmouseover="this.title=this.value" class="fui_trigger-input" onfocus="this.blur();"/>').attr("readOnly", "readOnly").attr("UNSELECTABLE", "on").appendTo(this.element)
        }, _createTriggerBtn: function () {
            return a('<i class="fui_trigger-btn"/>').addClass(this.options.triggerIcon).appendTo(this.element)
        }, _bindEvts: function () {
            var b = this;
            this.element.unbind("click.trigger"), this.element.bind("click.trigger", function (c) {
                var d = a(c.target);
                (d.closest(".fui_trigger-input").length > 0 || d.closest(".fui_trigger-btn").length > 0) && b._onTriggerClick()
            })
        }, _onTriggerClick: function (a) {
        }, _getTriggerView: function () {
            var b = a(".x-dropdown-wrapper");
            return 0 === b.length && (b = a('<div class="x-dropdown-wrapper"/>').appendTo("body")), b
        }, _calTriggerViewPos: function () {
            var a = {"z-Index": YS.STATIC.zIndex++}, b = this.element.offset(), c = this.options.edge, d = document.body.clientWidth - b.left;
            d < c.width ? (a.right = d - this.element.outerWidth(), a.left = "auto") : (a.right = "auto", a.left = b.left);
            var e = document.body.clientHeight + document.body.scrollTop - b.top - this.element.outerHeight();
            if(document.body.clientHeight<650 && b.top<c.height){
                e = e + c.height
            }else{
                e = e - c.height
            }
            return e < c.height ? (a.top = "auto", a.bottom = document.body.clientHeight - b.top) : (a.top = b.top + this.element.outerHeight(), a.bottom = "auto"), a
        }, setValue: function (a) {
            this.setText(a)
        }, setText: function (a) {
            this.editComp.val(a)
        }, getValue: function () {
            return this.getText()
        }, getText: function () {
            return this.editComp.val()
        }, doResize: function (a) {
            YS.Trigger.superclass.doResize.apply(this, arguments);
            var b = this.options, c = b.height;
            this.element.css({"line-height": c - 2 + "px"})
        }
    })
}(jQuery), function (a) {
    YS.DateTime = YS.extend(YS.Trigger, {
        _defaultConfig: function () {
            return a.extend(YS.DateTime.superclass._defaultConfig.apply(), {
                baseCls: "fui_datetime",
                triggerIcon: "icon-datetime",
                startDate: null,
                endDate: null,
                fieldIsnull: !0,
                fieldType: "datetime",
                fieldLength: 32,
                ajaxurl: "",
                fieldFormat: "yyyy-MM-dd",
                onAfterEdit: null,
                edge: {width: 240, height: 315}
            })
        }, _init: function () {
            YS.DateTime.superclass._init.apply(this, arguments);
            var a = this.options;
            this.viewMode = this._initViewMode(), this.std = this._initStartDate(a.startDate, this.viewMode), this.edd = this._initEndDate(a.endDate, this.viewMode)
        }, _onTriggerClick: function () {
            if (this.isEnabled()) {
                var b = this;
                this._showDatePicker(), a(document).bind("mousedown.datepicker", function (c) {
                    var d = c.target, e = a(d).closest(b.datepicker.element);
                    0 === e.length && b._hideDatePicker()
                })
            }
        }, _initViewMode: function () {
            var a = this.options, b = 1;
            return a.fieldFormat.match(/[YyMDd]/) ? a.fieldFormat.match(/[Dd]/) ? a.fieldFormat.match(/[Hhms]/) && (b = 3) : b = 0 : b = a.fieldFormat.match(/s/) ? 2 : 4, b
        }, _initStartDate: function (a, b) {
            if (!a)return null;
            var c = new Date(a);
            switch (b) {
                case 0:
                    return new Date(c.getFullYear(), c.getMonth(), 1, 0, 0, 0);
                case 1:
                    return new Date(c.getFullYear(), c.getMonth(), c.getDate(), 0, 0, 0);
                case 2:
                    var d = new Date;
                    return d.setHours(0), d.setMinutes(0), d.setSeconds(0), d;
                case 3:
                    return new Date(c.getFullYear(), c.getMonth(), c.getDate(), 0, 0, 0);
                default:
                    return c
            }
        }, _initEndDate: function (a, b) {
            if (!a)return null;
            var c = new Date(a);
            switch (b) {
                case 0:
                    return new Date(c.getFullYear(), c.getMonth(), c.getMonthDays(), 23, 59, 59);
                case 1:
                    return new Date(c.getFullYear(), c.getMonth(), c.getDate(), 23, 59, 59);
                case 2:
                    var d = new Date;
                    return d.setHours(23), d.setMinutes(59), d.setSeconds(59), d;
                case 3:
                    return new Date(c.getFullYear(), c.getMonth(), c.getDate(), 23, 59, 59);
                default:
                    return c
            }
        }, _showDatePicker: function () {
            var a = this, b = this.options;
            if (!this.datepicker) {
                var c = {
                    viewMode: this.viewMode,
                    startDate: this.std,
                    endDate: this.edd,
                    customCls: "x-dropdown",
                    date: this.value ? new Date(this.value) : new Date,
                    onDateUpdate: function () {
                        var c = this.getValue();
                        c ? a.setValue(YS.Utils.date2Str(new Date(c), b.fieldFormat)) : a.setValue(null), YS.Utils.applyFunc(a, b.onAfterEdit, arguments, !1)
                    },
                    onClear: function () {
                        a._hideDatePicker()
                    },
                    onOk: function () {
                        a._hideDatePicker()
                    },
                    onClose: function () {
                        a._hideDatePicker()
                    },
                    onToday: function () {
                        a._hideDatePicker()
                    }
                };
                this.datepicker = new YS.DatePicker(c)
            }
            this.datepicker.element.appendTo("body").css(this._calTriggerViewPos()).show()
        }, _hideDatePicker: function () {
            this.datepicker && (a(document).unbind("mousedown.datepicker"), this.datepicker.element.detach(), YS.Utils.applyFunc(this, this.options.onStopEdit, [], !1))
        }, checkValidate: function () {
            var a = this.options;
            return !(!a.fieldIsnull && YS.Utils.isEmpty(this.getValue())) && (!(a.startDate && this.value < a.startDate) && !(a.endDate && this.value > a.endDate))
        }, getOptions: function () {
            var b = this.options;
            return a.extend(YS.DateTime.superclass.getOptions.apply(this, arguments), {fieldFormat: b.fieldFormat})
        }, rebuild: function () {
            YS.DateTime.superclass.rebuild.apply(this, arguments), this.datepicker && (this.datepicker.element.remove(), this.datepicker = null)
        }, setValue: function (a) {
            var b = this.options;
            if (a == null)return this.value = null, void this.setText(null);
            var c = null;
            c = "today" === a ? new Date : new Date(a.replace(/-/ig,'/')), 0 !== this.viewMode && 1 !== this.viewMode || c.setHours(0, 0, 0), c.setMilliseconds(0);
            var d = YS.Utils.date2Str(new Date(c), b.fieldFormat);
            return !d ? (this.value = null, void this.setText(null)) : (this.value = d, void this.setText(this.value))
        }, setText: function (a) {
            this.editComp.val(a)
        }, getValue: function () {
            return this.value
        }, getText: function () {
            return this.editComp.val()
        }
    }), a.shortcut("datetime", YS.DateTime)
}(jQuery), function (a) {
    YS.DatePicker = YS.extend(YS.Widget, {
        CONSTS: {
            VIEWMODE: {YM: 0, YMD: 1, HMS: 2, YMDHMS: 3, HM: 4},
            MINYEAR: 1900,
            MAXYEAR: 2999,
            NAV: {
                prevm: 2,
                nextm: 3,
                title: 4,
                clear: 5,
                today: 6,
                dok: 7,
                prevy: 8,
                nexty: 9,
                cancel: 10,
                mok: 11,
                plus: 12,
                minus: 13,
                current: 15,
                day: 100,
                month: 200,
                year: 300
            }
        },
        _TT: {CALENDAR: "日历", CLEAR: "清空", TODAY: "今天", OK: "确定", CURRENT: "当前", TIME: "时间"},
        _defaultConfig: function () {
            return a.extend(YS.DatePicker.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_datepicker",
                viewMode: 1,
                endDate: null,
                startDate: null,
                date: null,
                onDateUpdate: null,
                onClear: null,
                onOk: null,
                onClose: null,
                onToday: null
            })
        },
        _init: function () {
            YS.DatePicker.superclass._init.apply(this, arguments), this.cache = {
                showYear: null,
                showMonth: null
            }, this._initTables(), this._bindEvts()
        },
        _initTables: function () {
            var b = this.options;
            switch (this.$datetable = this._createDatePicker(), this._loadDateData(this.$datetable, new Date(this.options.date)), this.$monthtable = this._createMonthPicker(), this.$timetable = this._createTimePicker(), b.viewMode) {
                case this.CONSTS.VIEWMODE.YM:
                    this._loadMonthData(this.$monthtable, new Date(this.options.date)), this.$monthtable.appendTo(this.element).show();
                    break;
                case this.CONSTS.VIEWMODE.HMS:
                    this._loadTimeData(this.$timetable, this.options.date), this._addTimeOptPane(this.$timetable), this.$timetable.appendTo(this.element).show();
                    break;
                case this.CONSTS.VIEWMODE.HM:
                    this.$timetable.remove(), this.$timetable = this._createTimePicker({s: !1}), this._loadTimeData(this.$timetable, this.options.date), this.$timetable.appendTo(this.element).show();
                    break;
                case this.CONSTS.VIEWMODE.YMD:
                    this.$datetable.appendTo(this.element).show(), this.$monthtable.hide().appendTo(this.element);
                    break;
                default:
                    this.$datetable.appendTo(this.element).show(), this.$monthtable.hide().appendTo(this.element);
                    var c = a("<tr/>").prependTo(this.$datetable.find("tfoot"));
                    this._loadTimeData(this.$timetable, this.options.date), this.$timetable.show().appendTo(a('<td colspan="7"/>').appendTo(c))
            }
        },
        _createTimePicker: function (b) {
            b = b || {};
            var c = a('<table cellspacing = "0" cellpadding = "0" class="tt"/>'), d = a("<tbody>").appendTo(c), e = this, f = this.options, g = this.CONSTS.NAV, h = a("<td/>").append(a('<i class="icon-angleup"/>')).data("nav", g.plus), i = a("<td/>").append(a('<i class="icon-angledown"/>')).data("nav", g.minus), j = a("<tr/>").append(a('<td rowspan="2"/>').text(this._TT.TIME));
            return b.h !== !1 && (c.$h = a("<input/>").data("time", "h").keyup(function () {
                var a = this.value, b = parseInt(a, 10);
                b < 24 && b >= 0 && (f.date.setHours(b), YS.Utils.applyFunc(e, f.onDateUpdate, arguments))
            }).focus(function () {
                c.focus = a(this)
            }), c.focus = c.$h, j.append(a('<td rowspan="2"/>').append(c.$h))), b.m !== !1 && (c.$m = a("<input/>").data("time", "m").keyup(function () {
                var a = this.value, b = parseInt(a, 10);
                b < 60 && b >= 0 && (f.date.setMinutes(b), YS.Utils.applyFunc(e, f.onDateUpdate, arguments))
            }).focus(function () {
                c.focus = a(this)
            }), c.focus = c.$m, j.append(a('<td class="common" rowspan="2"/>').text(":")).append(a('<td rowspan="2"/>').append(c.$m))), b.s !== !1 && (c.$s = a("<input/>").data("time", "s").keyup(function () {
                var a = this.value, b = parseInt(a, 10);
                b < 60 && b >= 0 && (f.date.setSeconds(b), YS.Utils.applyFunc(e, f.onDateUpdate, arguments))
            }).focus(function () {
                c.focus = a(this)
            }), c.focus = c.$s, j.append(a('<td class="common" rowspan="2"/>').text(":")).append(a('<td rowspan="2"/>').append(c.$s))), j.append(h).appendTo(d), a("<tr/>").append(i).appendTo(d), c
        },
        _addTimeOptPane: function (b) {
            var c = this.CONSTS.NAV, d = a("<tfoot/>"), e = a("<tr/>").appendTo(d);
            this._createCell(e, this._TT.CLEAR, 2, c.clear, "clear"), this._createCell(e, this._TT.CURRENT, 3, c.current, "current"), this._createCell(e, this._TT.OK, 2, c.dok, "ok"), d.appendTo(b)
        },
        _createDatePicker: function () {
            var b = a('<table cellspacing = "2px" cellpadding = "0" class="dt"/>'), c = this.CONSTS.NAV, d = a("<thead/>").appendTo(b);
            h = a('<tr class = "mainhead"/>'), b.$prevm = this._createCell(h, '<i class="icon-angleleft"/>', 1, c.prevm, "prevm"), b.$title = a('<td class="title" colspan="5"/>').data("nav", c.title).appendTo(h), b.$nextm = this._createCell(h, '<i class="icon-angleright"/>', 1, c.nextm, "nextm"), h.appendTo(d), h = a("<tr/>");
            for (var e = 7; e > 0; --e)a("<td/>").appendTo(h);
            for (var e = 0; e < 7; ++e) {
                var f = h.children().eq(e);
                f.addClass("day name").text(Date._SDN[e]), [0, 6].indexOf(e) != -1 && f.addClass("weekend")
            }
            h.appendTo(d);
            var g = a('<tbody onselectstart="return false"/>').appendTo(b);
            for (e = 6; e > 0; e--)for (var h = a("<tr/>").appendTo(g), i = 0; i < 7; i++)a("<td/>").appendTo(h);
            var j = a("<tfoot/>").appendTo(b);
            this._createCell(a("<tr/>").appendTo(j), "", 7, null, "split");
            var h = a("<tr/>");
            return this._createCell(h, this._TT.CLEAR, 2, c.clear, "clear"), this._createCell(h, this._TT.TODAY, 3, c.today, "today"), this._createCell(h, this._TT.OK, 2, c.dok, "ok"), h.appendTo(j), b
        },
        _createMonthPicker: function () {
            for (var b = a('<table cellspacing = "2px" cellpadding = "0" class="mt"/>'), c = this.CONSTS.NAV, d = a("<tbody/>").appendTo(b), e = a("<tr/>").appendTo(d), f = 0; f < 2; f++)a('<td class="month"/>').appendTo(e);
            this._createCell(e, '<i class="icon-angleleft"/>', 1, c.prevy, " prevy"), this._createCell(e, '<i class="icon-angleright"/>', 1, c.nexty, " nexty");
            for (var g = 0; g < 5; g++)e = a("<tr/>").appendTo(d), a('<td class="month"/><td class="month"/><td class="year"/><td class="year"/>').appendTo(e);
            var h = a("<tfoot/>").appendTo(b);
            return e = a("<tr/>").appendTo(h), this._createCell(e, this._TT.OK, 4, c.mok, "ok"), b
        },
        _toPrevMonth: function () {
            var a = this.options.startDate, b = this.options.date, c = this.cache.showMonth, d = this.cache.showYear;
            return a ? void(d > a.getFullYear() ? c > 0 ? this._setMonth(c - 1) : (b.setFullYear(d - 1), this._setMonth(11)) : d == a.getFullYear() && c > a.getMonth() && c > 0 && (this._setMonth(c - 1), b < a && (b = new Date(a)))) : void(c > 0 ? this._setMonth(c - 1) : (b.setFullYear(d - 1), this._setMonth(11)))
        },
        _toNextMonth: function () {
            var a = this.options.endDate, b = this.options.date, c = this.cache.showMonth, d = this.cache.showYear;
            return a ? void(d < a.getFullYear() ? c < 11 ? this._setMonth(c + 1) : (b.setFullYear(d + 1), this._setMonth(0)) : d == a.getFullYear() && c < a.getMonth() && (this._setMonth(c + 1), b > a && (b = new Date(a)))) : void(c < 11 ? this._setMonth(c + 1) : (b.setFullYear(d + 1), this._setMonth(0)))
        },
        _toPrevDecade: function () {
            var a, b, c = this.options.startDate, d = this.options.date, e = d.getFullYear() - 10, f = d.getMonth();
            c && e == (b = c.getFullYear()) && (a = c.getMonth()), (!b || b < this.CONSTS.MINYEAR) && (b = this.CONSTS.MINYEAR), e < b ? (d.setFullYear(b), f < a && d.setMonth(a)) : d.setFullYear(e)
        },
        _toNextDecade: function () {
            var a, b, c = this.options.endDate, d = this.options.date, e = d.getFullYear() + 10, f = d.getMonth();
            c && e == (b = c.getFullYear()) && (a = c.getMonth()), (!b || b > this.CONSTS.MAXYEAR) && (b = this.CONSTS.MAXYEAR), e > b ? (d.setFullYear(b), f < a && d.setMonth(a)) : d.setFullYear(e)
        },
        _setMonth: function (a) {
            var b = this.options.date, c = b.getDate(), d = this.options.endDate, e = this.options.startDate, f = b.getMonthDays(a);
            c > f && b.setDate(f), b.setMonth(a), d && b > d && b.setDate(d.getDate()), e && b < e && b.setDate(e.getDate())
        },
        _loadDateData: function (a, b) {
            if (b) {
                var c = b.getFullYear(), d = b.getMonth(), e = b.getDate(), f = new Date, g = f.getFullYear(), h = f.getMonth(), i = f.getDate();
                this.cache.showYear = c, this.cache.showMonth = d;
                var j = this.options.startDate, k = this.options.endDate;
                a.$title.text(Date._MN[d] + ", " + c);
                var l = new Date(b);
                l.setDate(l.getMonthDays() + 1), k && l > k || l.getFullYear() > this.CONSTS.MAXYEAR ? a.$nextm.addClass("disabled").removeClass("hover").data("disabled", !0) : a.$nextm.removeClass("disabled").data("disabled", !1);
                var m = new Date(b);
                m.setDate(0), j && m < j || m.getFullYear() < this.CONSTS.MINYEAR ? a.$prevm.addClass("disabled").removeClass("hover").data("disabled", !0) : a.$prevm.removeClass("disabled").data("disabled", !1), b.setDate(1);
                var n = b.getDay() % 7;
                b.setDate(0 - n), b.setDate(b.getDate() + 1);
                for (var o = a.find("tbody").children().eq(0), p = 0; p < 6 && o.length; p++) {
                    for (var q, r = o.children(), s = 0; s < 7; ++s, b.setDate(q + 1)) {
                        var t = r.eq(s);
                        if (t.removeClass().data("nav", this.CONSTS.NAV.day), !t.length)break;
                        q = b.getDate(), t.text(q);
                        var u = b.getMonth() == d;
                        if (u) {
                            var v = !1;
                            if (null != j && j > b || null != k && k < b ? (t.addClass("day disabled"), v = !0) : t.addClass("day"), t.data("disabled", v), !v) {
                                u && q == e && (this.cache.selectedDate && this.cache.selectedDate.removeClass("selected"), t.addClass("selected"), this.cache.selectedDate = t, this.cache.showDay = q), b.getFullYear() == g && b.getMonth() == h && q == i && t.addClass("today");
                                var w = b.getDay();
                                [0, 6].indexOf(w) != -1 && t.addClass("weekend")
                            }
                        } else t.addClass("oday").data("disabled", !0)
                    }
                    o = o.next()
                }
            }
        },
        _loadMonthData: function (b, c) {
            if (c) {
                var d = c.getFullYear(), e = c.getMonth(), f = a(b).data("midYear");
                f ? d > f + 5 ? f += 10 : d < f - 4 && (f -= 10) : f = d, a(b).data("midYear", f);
                var g, h, i, j, k = [f - 4, f - 3, f - 2, f - 1, f, f + 1, f + 2, f + 3, f + 4, f + 5], l = a("td.year", b), m = a("td.month", b), n = this.options, o = n.endDate, p = n.startDate;
                o && o && d == (g = o.getFullYear()) && (h = o.getMonth()), (!g || g > this.CONSTS.MAXYEAR) && (g = this.CONSTS.MAXYEAR), p && p && d == (i = p.getFullYear()) && (j = p.getMonth()), (!i || i < this.CONSTS.MINYEAR) && (i = this.CONSTS.MINYEAR);
                for (var q = 0; q < 12; q++) {
                    var r = m.eq(q).text(Date._MN[q]).data("nav", this.CONSTS.NAV.month).data("month", q);
                    if (q == e && (this.cache.selectedMonth && this.cache.selectedMonth.removeClass("selected"), r.addClass("selected"), this.cache.selectedMonth = r), !YS.Utils.isEmpty(j) && q < j || !YS.Utils.isEmpty(h) && q > h ? r.addClass("disabled").data("disabled", !0) : r.removeClass("disabled").data("disabled", !1), q < 10) {
                        var s = l.eq(q).text(k[q]).data("nav", this.CONSTS.NAV.year);
                        k[q] == d && (this.cache.selectedYear && this.cache.selectedYear.removeClass("selected"), s.addClass("selected"), this.cache.selectedYear = s), !YS.Utils.isEmpty(i) && k[q] < i || !YS.Utils.isEmpty(g) && k[q] > g ? s.addClass("disabled").data("disabled", !0) : s.removeClass("disabled").data("disabled", !1)
                    }
                }
                var t = a("td.prevy", b).removeClass("disabled").data("disabled", !1);
                k[0] <= i && t.addClass("disabled").data("disabled", !0).removeClass("hover");
                var u = a("td.nexty", b).removeClass("disabled").data("disabled", !1);
                k[9] >= g && u.addClass("disabled").data("disabled", !0).removeClass("hover")
            }
        },
        _loadTimeData: function (a, b) {
            if (b) {
                var c = b.getHours() + "", d = b.getMinutes() + "", e = b.getSeconds() + "";
                a.$h && a.$h.val(YS.Utils.leftPad(c, 2, "0")), a.$m && a.$m.val(YS.Utils.leftPad(d, 2, "0")), a.$s && a.$s.val(YS.Utils.leftPad(e, 2, "0"))
            }
        },
        _doTimeInc: function (a, b) {
            var c = b.data("time"), d = this.options;
            if ("h" === c) {
                var e = (d.date.getHours() + 1) % 24;
                d.date.setHours(e), a.$h.val(YS.Utils.leftPad(e + "", 2, "0"))
            } else if ("m" === c) {
                var e = (d.date.getMinutes() + 1) % 60;
                d.date.setMinutes(e), a.$m.val(YS.Utils.leftPad(e + "", 2, "0"))
            } else {
                var e = (d.date.getSeconds() + 1) % 60;
                d.date.setSeconds(e), a.$s.val(YS.Utils.leftPad(e + "", 2, "0"))
            }
            b.select(), YS.Utils.applyFunc(this, d.onDateUpdate, arguments, !1)
        },
        _doTimeDec: function (a, b) {
            var c = b.data("time"), d = this.options;
            if ("h" === c) {
                var e = (d.date.getHours() + 23) % 24;
                d.date.setHours(e), a.$h.val(YS.Utils.leftPad(e + "", 2, "0"))
            } else if ("m" === c) {
                var e = (d.date.getMinutes() + 59) % 60;
                d.date.setMinutes(e), a.$m.val(YS.Utils.leftPad(e + "", 2, "0"))
            } else {
                var e = (d.date.getSeconds() + 59) % 60;
                d.date.setSeconds(e), a.$s.val(YS.Utils.leftPad(e + "", 2, "0"))
            }
            b.select(), YS.Utils.applyFunc(this, d.onDateUpdate, arguments, !1)
        },
        _bindEvts: function () {
            var b = this, c = this.options, d = this.CONSTS.NAV, e = this.$monthtable, f = this.$datetable, g = this.$timetable, h = function (h) {
                var i = h.target, j = a(i).closest("td"), k = h.type, l = j.data("nav");
                if (!j.data("disabled") && 0 !== j.length && l)if (b.options.date || (b.options.date = new Date), "mouseover" === k)j.addClass("hover"); else if ("mouseup" === k)switch (j.removeClass("hover"), l) {
                    case d.prevm:
                        b._toPrevMonth(), b._loadDateData(f, new Date(b.options.date)), YS.Utils.applyFunc(b, c.onDateUpdate, arguments);
                        break;
                    case d.nextm:
                        b._toNextMonth(), b._loadDateData(f, new Date(b.options.date)), YS.Utils.applyFunc(b, c.onDateUpdate, arguments);
                        break;
                    case d.title:
                        b._loadMonthData(e, new Date(b.cache.showYear, b.cache.showMonth)), e.css({
                            position: "absolute",
                            top: 0,
                            "z-index": YS.STATIC.zIndex++
                        }).show("fast");
                        break;
                    case d.clear:
                        b.options.date = null, b.cache.selectedDate && b.cache.selectedDate.removeClass("selected"), YS.Utils.applyFunc(b, c.onDateUpdate, arguments), YS.Utils.applyFunc(b, c.onClear, arguments);
                        break;
                    case d.current:
                        b.options.date = new Date, YS.Utils.applyFunc(b, c.onDateUpdate, arguments);
                    case d.today:
                        var m = new Date;
                        if (b.options.startDate && m < b.options.startDate || b.options.endDate && m > b.options.endDate)return;
                        b.options.date = m, b.cache.selectedDate && b.cache.selectedDate.removeClass("selected"), b.cache.selectedDate = b.$datetable.find("td.today").addClass("selected"), YS.Utils.applyFunc(b, c.onDateUpdate, arguments), YS.Utils.applyFunc(b, c.onToday, arguments);
                        break;
                    case d.dok:
                        YS.Utils.applyFunc(b, c.onDateUpdate, arguments), YS.Utils.applyFunc(b, c.onOk, arguments);
                        break;
                    case d.prevy:
                        b._toPrevDecade(), b._loadMonthData(e, new Date(b.options.date)), YS.Utils.applyFunc(b, c.onDateUpdate, arguments);
                        break;
                    case d.nexty:
                        b._toNextDecade(), b._loadMonthData(e, new Date(b.options.date)), YS.Utils.applyFunc(b, c.onDateUpdate, arguments);
                        break;
                    case d.mok:
                        b._loadDateData(f, new Date(b.options.date)), YS.Utils.applyFunc(b, c.onDateUpdate, arguments), e.hide("fast");
                        break;
                    case d.cancel:
                        b._loadDateData(f, new Date(b.options.date)), e.hide("fast");
                        break;
                    case d.year:
                        b.cache.selectedYear && b.cache.selectedYear.removeClass("selected"), b.cache.selectedYear = j;
                        var n = b.options.date;
                        n.setFullYear(j.text()), b._loadMonthData(e, new Date(n)), YS.Utils.applyFunc(b, c.onDateUpdate, arguments);
                        break;
                    case d.month:
                        b.cache.selectedMonth && b.cache.selectedMonth.removeClass("selected"), b.cache.selectedMonth = j.addClass("selected"), b.options.date.setMonth(j.data("month")), YS.Utils.applyFunc(b, c.onDateUpdate, arguments);
                        break;
                    case d.day:
                        b.cache.selectedDate && b.cache.selectedDate.removeClass("selected"), b.cache.selectedDate = j.addClass("selected");
                        var n = b.options.date;
                        n.setFullYear(b.cache.showYear), n.setMonth(b.cache.showMonth), n.setDate(j.text()), YS.Utils.applyFunc(b, c.onDateUpdate, arguments), g.parent().length || YS.Utils.applyFunc(b, c.onClose, arguments);
                        break;
                    case d.plus:
                        b._doTimeInc(g, g.focus);
                        break;
                    case d.minus:
                        b._doTimeDec(g, g.focus)
                } else"mouseout" === k && j.removeClass("hover")
            };
            this.element.unbind(), this.element.bind("mousedown", h).bind("mouseover", h).bind("mouseup", h).bind("mouseout", h)
        },
        _createCell: function (b, c, d, e, f) {
            var g = a("<td class/>").attr("colSpan", d).html(c).appendTo(b);
            return e && g.data("nav", e), f = f ? "btn " + f : "btn", g.addClass(f), g
        },
        getValue: function () {
            var a = this.options, b = this.CONSTS.VIEWMODE, c = this.options.date;
            return c && (c.setMilliseconds(0), a.viewMode !== b.YMD && a.viewMode !== b.YM || c.setHours(0, 0, 0)), c
        },
        setValue: function (a) {
            this.options.date = a
        },
        getText: function () {
            return this.getValue()
        },
        setText: function (a) {
            this.setValue(a)
        }
    }), a.shortcut("datepicker", YS.DatePicker)
}(jQuery), function (a) {
    YS.ComboBox = YS.extend(YS.Trigger, {
        _defaultConfig: function () {
            return a.extend(YS.ComboBox.superclass._defaultConfig.apply(), {
                baseCls: "fui_combo",
                triggerIcon: "icon-ui-combo",
                triggerList: "combo-list",
                textField: "text",
                valueField: "code",
                fieldIsnull: !0,
                fieldType: "varchar",
                fieldLength: 128,
                fieldDefaultValue: "",
                itemLinkeds: [],
                async: null,
                asyncResultKey: "items",
                items: [],
                searchable: !0,
                onDataFilter: null,
                onItemCreate: null,
                onAfterItemSelect: null,
                onAfterTriggerHide: null,
                limitData: 300,
                emptyTip: null
            })
        }, _init: function () {
            YS.ComboBox.superclass._init.apply(this, arguments), this._initStoreValue(), this._createTriggerView()
        }, _afterInit: function(){
            this._initElementSize(), this._initVisualEffects(), YS.Widget.superclass._afterInit.apply(this, arguments)
        }, _initStoreValue: function () {
            this.text = null, this.value = null
        }, _hasDefaultValue: function () {
            return !YS.Utils.isEmpty(this.options.fieldDefaultValue)
        }, _onTriggerClick: function (b) {
            if (this.isEnabled()) {
                this._showTriggerView();
                var c = this, d = "mousedown";
                a(document).bind(d + ".trigger", function (b) {
                    var d = b.target, e = a(d).closest(c.triggerView);
                    0 === e.length && c._hideTriggerView()
                })
            }
        }, _hideTriggerView: function () {
            var b = this.options;
            if (this.triggerView) {
                var c = "mousedown";
                if (a(document).unbind(c + ".trigger"), this.triggerView.detach(), YS.Utils.applyFunc(this, b.onAfterTriggerHide, [], !1), !this.changed)return;
                YS.Utils.applyFunc(this, b.onStopEdit, [], !1)
            }
        }, _showTriggerView: function () {
            null == this.triggerView && this._createTriggerView(), this.triggerView.appendTo("body").css(this._calTriggerViewPos()).show(), this.changed = !1
        }, _createTriggerView: function () {
            if (this.triggerView = a('<div class="x-dropdown"/>'), this.valueMap = {}, this.options.searchable) {
                var b = this, c = a('<div class="fui_combo-search"/>').appendTo(this.triggerView);
                a("<input/>").bind("input propertychange", function (a) {
                    if (b.searchValue !== this.value) {
                        b.searchinterval && clearTimeout(b.searchinterval), b.searchValue = this.value, b.$listView.empty();
                        var c = b._createLoadingIcon("搜索中...");
                        b.searchinterval = setTimeout(function () {
                            c.remove(), b.startIndex = 0, b._onBeforeItemsLoaded(), b._createItemList(b.searchValue)
                        }, 500)
                    }
                }).appendTo(c), c.append(a('<i class="combo-saerch icon-ui-filter"/>'))
            }
            this.$listView = a('<div class="x-dropdown-list"/>').addClass(this.options.triggerList).appendTo(this.triggerView), this._onLoadItems(), this._bindViewEvts()
        }, _hideItems: function (b) {
            var c = this.$listView.children(".x-dropdown-item");
            YS.Utils.forEach(c, function (c, d) {
                var e = a(d);
                e.text().indexOf(b) < 0 && e.addClass("hide")
            })
        }, _onLoadItems: function (a) {
            var b = this.options, c = this, z = b.value ? b.value.split(',') : b.fieldDefaultValue.split(',');
            c.$listView && c.$listView.empty();
            if(b.ajaxurl&&!b.items.length){
                var d = this._createLoadingIcon("加载中...");
                $.ajax({
                    url: getFlowConf().flowPath+'/common/getDictionaryItems',
                    data: {"mainId":b.ajaxurl},
                    async: false,
                    success: function(e){
                        e = e.data;
                        d.remove(), c._onBeforeItemsLoaded(), c.items = e, YS.Utils.applyFunc(c, b.onAsyncSuccess, [e], !1);
                        YS.Utils.forEach(c.items, function (b, d) {
                            for(var i=0; i<z.length;i++){
                                d.code == z[i] && (d.selected = !0);
                            }
                            c._onItemCreate(d, b, a)
                        }), c._onAfterItemsLoaded()
                    },
                    error:function(){
                        d.remove()
                    }
                })
            }else if (b.items) {
                if (c._onBeforeItemsLoaded(), $.isArray(b.items))YS.Utils.forEach(b.items, function (b, d) {
                	for(var i=0; i<z.length;i++){
                        d.code == z[i] && (d.selected = !0);
                    }
                    c._onItemCreate(d, b, a)
                }); else {
                    var e = 0;
                    for (var f in b.items) {
                        var g = {};
                        g[b.valueField] = f, g[b.textField] = b.items[f], c._onItemCreate(g, e, a), e++
                    }
                }
                c._onAfterItemsLoaded()
            }
        }, _sortItems: function (a) {
            var b = this.options;
            return a.sort(function (a, c) {
                var d = a[b.valueField] || a[b.textField] || a, e = c[b.valueField] || c[b.textField] || c;
                return +(d > e) || +(d === e) - 1
            })
        }, _createItemList: function (a) {
            var b = this, c = this.options;
            this.items || (this.items = c.items || []), this.startIndex = this.startIndex || 0;
            for (var d = 0, e = !0; d < c.limitData;) {
                if (this.startIndex >= this.items.length) {
                    e = !1;
                    break
                }
                var f = this.items[this.startIndex];
                this.startIndex++, b._onItemCreate(f, d, a) !== !1 && d++
            }
            e && b._bindLoadMore(a)
        }, _bindLoadMore: function (a) {
            var b = this;
            this.$listView.bind("scroll.loadMore", function () {
                b.$listView.scrollTop() + b.$listView.height() + 100 >= 26 * b.startIndex && (b.$listView.unbind("scroll.loadMore"), b._createItemList(a))
            })
        }, _createLoadingIcon: function (b) {
            var c = this.$listView.children(".loading-text");
            return 0 === c.length && (c = a('<div class="loading-text"/>').appendTo(this.$listView), a("<span/>").text(b).appendTo(c)), c
        }, _onAfterItemsLoaded: function () {
            var b = this.options, c = this.$listView.children(a(".x-dropdown-item")), d = b.fieldIsnull ? 1 : 0;
            b.emptyTip && c.length <= d && this.$listView.empty().append(a('<div class="empty-tip"/>').text(b.emptyTip))
        }, _onBeforeItemsLoaded: function () {
            var b = this.options, c = this;
            b.fieldIsnull && a('<a class="x-dropdown-item"/>').text("--请选择--").appendTo(c.$listView)
        }, _onItemCreate: function (b, c, d) {
            var e = this.options, f = this;
            if (YS.Utils.applyFunc(this, e.onItemCreate, [b, c], !1) === !1) {
                var g = YS.Utils.applyFunc(this, e.onDataFilter, [b, c], !1);
                g !== !1 && (b = g);
                var h = b[e.textField], i = b[e.valueField] ? b[e.valueField] : b.code;
                if (this.valueMap[i] = h, !YS.Utils.isEmpty(d) && (h + "").indexOf(d) < 0)return !1;
                var j = a('<a class="x-dropdown-item"/>').data("item", b).attr("option", i).attr("title", h).text(h).appendTo(this.$listView);
                (b.selected) && (f.editComp.val(h),a(".select", this.triggerView).removeClass("select"), j.addClass("select"), this.value = i, this.text = h)
            }
        }, _bindViewEvts: function () {
            var b = this, c = "click", d = !1;
            this.triggerView.bind(c, function (c) {
                if (d)return void(d = !1);
                var e = a(c.target).closest("a");
                if (e.length > 0) {
                    var f = e.data("item");
                    b._onItemClick(e, f)
                }
            })
        }, _onItemClick: function (b, c) {
            var d = this.options;
            a(".select", this.triggerView).removeClass("select"), c ? (b.addClass("select"), this.value = c[d.valueField], this.text = c[d.textField]) : (this.value = null, this.text = null), this.editComp.val(this.text), this.textOther && this.textOther.setVisible(b.hasClass("item-other")), YS.Utils.applyFunc(this, d.onAfterItemSelect, [b, c], !1), YS.Utils.applyFunc(this, d.onAfterEdit, [b, c], !1), this.changed = !0, this._hideTriggerView()
        }, effectItemLinkWidgets: function () {
            var b = this.options;
            if (this.triggerView) {
                var c = a(".select", this.triggerView);
                YS.Utils.applyFunc(this, b.onAfterItemSelect, [c, c.data("item")], !1)
            }
        }, checkValidate: function () {
            var a = this.options;
            return !(!a.fieldIsnull && YS.Utils.isEmpty(this.getValue()))
        }, setEnable: function (a) {
            YS.ComboBox.superclass.setEnable.apply(this, [a]), this.textOther && this.textOther.setEnable(a)
        }, setValue: function (b, callback) {
            var _this = this;
            if(this.options.ajaxurl && $.isEmptyObject(this.valueMap)){
                $.ajax({
                    url: getFlowConf().flowPath+'/common/getDictionaryItems',
                    data: {"mainId":this.options.ajaxurl},
                    success: function(e){
                        e = e.data;
                        _this.options.items = e;
                        !_this.valueMap&&(_this.valueMap={});
                        $.each(e, function(i,o){
                            _this.valueMap[o.code]=o.text;
                        });
                        if (_this.value = b, _this.valueMap && _this.valueMap[b] ? _this.text = _this.valueMap[b] : _this.text = "", _this.triggerView)if (a(".select", _this.triggerView).removeClass("select"), YS.Utils.isEmpty(b))_this.textOther && _this.textOther.setVisible(!1); else {
                            var c = [];
                            if (a("a.x-dropdown-item", _this.$listView).each(function (d, e) {
                                    var f = a(e).attr("option");
                                    f == b && (c = a(e).addClass("select"))
                                }), _this.textOther) {
                                if (0 === c.length)return void _this.setOtherItemSelect(b);
                                _this.textOther.setVisible(!1)
                            }
                        }
                        _this.editComp && _this.editComp.val(_this.text)
                        callback && callback();
                    },
                    error:function(){
                        d.remove()
                    }
                })
            }else{
                this.value = b;
                this.text = this.valueMap[b];
                _this.editComp && _this.editComp.val(_this.text);
                callback && callback();
            }
        }, setOtherItemSelect: function (a) {
            this.$listView.children(".item-other").addClass("select"), this.editComp.val("其他"), this.textOther.setVisible(!0), this.textOther.setValue(a)
        }, setText: function (a) {
            this.text = a, this.editComp && this.editComp.val(a)
        }, getValue: function () {
            return this.textOther && this.textOther.isVisible() ? this.textOther.getValue() : this.value
        }, getText: function () {
            return this.textOther && this.textOther.isVisible() ? this.textOther.getValue() : this.text
        }, rebuild: function () {
            this.triggerView && (this.triggerView.remove(), this.triggerView = null, this.$listView = null, this.textOther && (this.textOther.destroy(), this.textOther = null)), YS.ComboBox.superclass.rebuild.apply(this, arguments)
        }, getOptions: function () {
            var b = this.options;
            return a.extend(YS.ComboBox.superclass.getOptions.apply(this, arguments), {fieldDefaultValue: b.fieldDefaultValue,itemLinkeds:b.itemLinkeds})
        }
    }), a.shortcut("combo", YS.ComboBox)
}(jQuery), function (a) {
    YS.ComboCheckBox = YS.extend(YS.ComboBox, {
        _defaultConfig: function () {
            return a.extend(YS.ComboCheckBox.superclass._defaultConfig.apply(), {
                baseCls: "fui_combocheck",
                triggerList: "combocheck-list",
                limitData: 300,
                hasSelectAll: !0
            })
        }, _initStoreValue: function () {
            this.value = [], this.text = []
        }, _onBeforeItemsLoaded: function () {
            var a = this.options;
            this._initStoreValue();
            if (a.hasSelectAll) {
                var b = {selectAll: !0};
                b[this.options.textField] = "全选", this._onItemCreate(b)
            }
        }, _onAfterItemsLoaded: function () {
            (this.items && this.text.length == this.items.length) && this.$listView.find('.select-all').addClass('select').find('input').attr("checked",!0);
            this._setEditCompText()
        }, _createItemList: function (a) {
            YS.ComboCheckBox.superclass._createItemList.apply(this, arguments), this._checkSelectAll()
        }, _onItemCreate: function (b, c, d) {
            var e = this.options, f = b[e.valueField], g = b[e.textField];
            if (!YS.Utils.isEmpty(d) && (g + "").indexOf(d) < 0)return !1;
            var h = a('<a class="x-dropdown-item x-check"/>').data("item", b).attr("option", f).attr("title", g).appendTo(this.$listView), j = a('<input type="checkbox"/>').appendTo(h);
            a("<span/>").text(g).appendTo(h), b.selected && (h.addClass("select"), j.attr('checked',!0), b.selected && (this.value.push(f), this.text.push(g))), b.selectAll ? (h.addClass("select-all"), this.$selectAllItem = h) : this.valueMap[f] = g
        }, _onItemClick: function (b, c) {
            var d = this, e = this.options, f = b.hasClass("select");
            if (c.selectAll) {
                var g = a(".x-dropdown-item", this.triggerView);
                f ? (YS.Utils.isEmpty(this.searchValue) ? (this.value = [], this.text = []) : YS.Utils.forEach(g, function (b, c) {
                    var e = a(c).data("item");
                    d._removeItem(e)
                }), g.removeClass("select").find('input').attr('checked',!1)) : (YS.Utils.forEach(g, function (b, c) {
                    var e = a(c).data("item");
                    d._addItem(e)
                }), g.addClass("select").find('input').attr('checked',!0))
            } else{
                var g = b.find("input").attr("checked");
                if(f){
                    b.removeClass("select"), g && b.find('input').attr('checked',!1);
                    this._removeItem(b.data("item"));
                    this.$selectAllItem && this.$selectAllItem.removeClass("select")
                }else{
                    b.addClass("select"), g || b.find('input').attr('checked',!0);
                    this._addItem(b.data("item")), this._checkSelectAll()
                }
            }
            this._setEditCompText(), YS.Utils.applyFunc(this, e.onAfterItemSelect, [this.value, this.text], !1), YS.Utils.applyFunc(this, e.onAfterEdit, [this.value, this.text], !1), this.changed = !0
        }, _addItem: function (a) {
            var b = this.options;
            if (!a.selectAll) {
                var c = a[b.valueField], d = a[b.textField], e = this.value.indexOf(c);
                e > -1 || (this.value.push(c), this.text.push(d))
            }
        }, _removeItem: function (a) {
            var b = this.options;
            if (!a.selectAll) {
                var c = this.value.indexOf(a[b.valueField]);
                c < 0 || (this.value.splice(c, 1), this.text.splice(c, 1))
            }
        }, _checkSelectAll: function () {
            this.$listView && this.$selectAllItem && (this.$selectAllItem.hasClass("select") ? this.$listView.children().not(".select").length >= 1 && this.$selectAllItem.removeClass("select") : this.$listView.children().not(".select").length <= 1 && this.$selectAllItem.addClass("select"))
        }, _setEditCompText: function () {
            this.editComp && this.editComp.val(this.text.join(","))
        }, effectItemLinkWidgets: function () {
        }, checkValidate: function () {
            var a = this.options;
            return !(!a.fieldIsnull && 0 === this.value.length)
        }, setValue: function (b) {
            var c = this, d = b.split(",");
            c.triggerView.find("input").attr("checked",!1), this.text = [], this.value = d;
            if(this.options.ajaxurl && $.isEmptyObject(this.valueMap)){
                $.ajax({
                    url: getFlowConf().flowPath+'/common/getDictionaryItems',
                    data: {"mainId":this.options.ajaxurl},
                    success: function(e){
                        e = e.data;
                        c.options.items = e;
                        $.each(e, function(i,o){
                            c.valueMap[o.code]=o.text;
                        });
                        $.each(d, function (b, d) {
                            var e = c.valueMap[d];
                            e ? c.text.push(e) : c.text.push(d), c.triggerView && a("a.x-dropdown-item", c.$listView).each(function (b, c) {
                                a(c).attr("option") == d && a(c).addClass("select").find("input").attr("checked",true);
                            });
                        });
                        c._setEditCompText();
                    }
                })
            }else{
                this.valueMap ? $.each(d, function (b, d) {
                    var e = c.valueMap[d];
                    !e ? c.text.push(d) : c.text.push(e), c.triggerView && a("a.x-dropdown-item", c.$listView).each(function (b, c) {
                        a(c).attr("option") == d && a(c).addClass("select").find("input").attr("checked",true);
                    })
                }) : this.text = d.slice(0), this._setEditCompText()
            }
        }, setText: function (b) {
            this.text = a.makeArray(b), this.value = a.makeArray(b), this._setEditCompText()
        }, getValue: function () {
            return this.value
        }, getNullValue: function () {
            return []
        }, getText: function () {
            return this.text
        }
    }), a.shortcut("combocheck", YS.ComboCheckBox)
}(jQuery), function (a) {
    YS.XComboCheckBox = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.XComboCheckBox.superclass._defaultConfig.apply(), {
                baseCls: "fui_combocheck",
                waterMark: null,
                hasSelectAll: !0,
                hasSelectEmpty: !0,
                textField: "text",
                valueField: "value",
                async: null,
                asyncResultKey: "items",
                searchable: !0,
                onStopEdit: null,
                height: 30,
                width: 240,
                edge: {width: 240, height: 200},
                hasLimit: !1,
                searchKey: "keyword"
            })
        }, _init: function () {
            YS.XComboCheckBox.superclass._init.apply(this, arguments);
            var b = this.options;
            this.values = [], this.texts = [], this.valueMap = {}, b.hasSelectEmpty && (this.valueMap[YS.CONST.PARAMETER.EMPTY] = "未填写"), this.editComp = a('<input class="fui_trigger-input" />').attr("readonly", "readonly").attr("placeholder", b.waterMark).appendTo(this.element), a('<i class="fui_trigger-btn icon-ui-combo" />').appendTo(this.element), YS.Utils.isObjectEmpty(b.value) || this._createTriggerView(), this._bindEvents()
        }, _bindEvents: function () {
            var b = this;
            this.element.unbind("click.trigger"), this.element.bind("click.trigger", function (c) {
                var d = a(c.target);
                (d.closest(".fui_trigger-input").length > 0 || d.closest(".fui_trigger-btn").length > 0) && b._onTriggerClick()
            })
        }, _onTriggerClick: function () {
            var b = this;
            this._showTriggerView(), a(document).bind("mousedown.trigger", function (c) {
                var d = c.target, e = a(d).closest(b.$triggerView);
                0 === e.length && b._hideTriggerView()
            })
        }, _showTriggerView: function () {
            var a = this.options;
            this.$triggerView || this._createTriggerView(), a.hasLimit && !YS.Utils.isObjectEmpty(this.values) && (this._refreshItems(), this._afterLoadItems()), this.$triggerView.appendTo("body").css(this._calTriggerViewPos()).show()
        }, _hideTriggerView: function () {
            var b = this.options;
            this.$triggerView && (a(document).unbind("mousedown.trigger"), this.$triggerView.detach(), YS.Utils.applyFunc(this, b.onStopEdit, [], !1))
        }, _calTriggerViewPos: function () {
            var a = {"z-Index": YS.STATIC.zIndex++}, b = this.element.offset(), c = this.options.edge, d = document.body.clientWidth - b.left;
            d < c.width ? (a.right = d - this.element.outerWidth(), a.left = "auto") : (a.right = "auto", a.left = b.left);
            var e = document.body.clientHeight + document.body.scrollTop - b.top - this.element.outerHeight();
            return e < c.height ? (a.top = "auto", a.bottom = document.body.clientHeight - b.top) : (a.top = b.top + this.element.outerHeight(), a.bottom = "auto"), a
        }, _createTriggerView: function () {
            var b = this, c = this.options;
            if (this.$triggerView = a('<div class="x-dropdown" />'), c.searchable) {
                var d = a('<div class="fui_combo-search"/>').appendTo(this.$triggerView);
                a("<input />").bind("input propertychange", function () {
                    b.searchValue !== this.value && b._doSearch(this.value)
                }).appendTo(d), d.append(a('<i class="icon-search search-icon"/>'))
            }
            this.$listView = a('<div class="x-dropdown-list combocheck-list"/>').appendTo(this.$triggerView), this._loadItems(), this._refreshData()
        }, _loadItems: function () {
            var b = this, c = this.options;
            if (this.itemsMap = {}, c.async && c.async.url) {
                this.ajaxObj && this.ajaxObj.abort && this.ajaxObj.abort();
                var d = a('<div class="loading-text" />').append(a("<span />").text("加载中...")).appendTo(b.$listView), e = {hasLimit: c.hasLimit};
                YS.Utils.isEmpty(this.searchValue) || (e[c.searchKey] = this.searchValue), this.ajaxObj = $.ajax({
                    url: c.async.url,
                    data: a.extend(e, c.async.data),
                    success: function(a){
                        YS.Utils.forEach(a[c.asyncResultKey], function (a, d) {
                            var e = {};
                            e[c.textField] = d[c.textField] || d, e[c.valueField] = d[c.valueField] || d, b._createItem(e)
                        }), b._afterLoadItems()
                    },
                    error: function(){
                        d.remove(), b.ajaxObj = null
                    }
                })
            } else c.items && (YS.Utils.forEach(c.items, function (a, d) {
                var e = {};
                e[c.textField] = d[c.textField] || d, e[c.valueField] = d[c.valueField] || d, b._createItem(e)
            }), b._afterLoadItems())
        }, _doSearch: function (a) {
            var b = this, c = this.options;
            b.searchValue = a, b.$listView.children().addClass("hide");
            var d = b._createLoadingIcon("搜索中...");
            b.searchinterval && clearTimeout(b.searchinterval), c.async && c.hasLimit ? b.searchinterval = setTimeout(function () {
                d.remove(), b.items = null, b.$listView.empty(), b._loadItems()
            }, 600) : (b.searchinterval = setTimeout(function () {
                d.remove(), b.$listView.children().removeClass("hide"), YS.Utils.isEmpty(b.searchValue) || b._hideItems(b.searchValue)
            }, 500), YS.Utils.isEmpty(a) ? this.$selectAllItem.find("span").text("全选") : (this.$selectAllItem.find("span").text("搜索结果全选"), this.$listView.children("a.select-empty").addClass("hide")))
        }, _createLoadingIcon: function (b) {
            var c = this.$listView.children(".loading-text");
            return 0 === c.length && (c = a('<div class="loading-text"/>').appendTo(this.$listView), a("<span/>").text(b).appendTo(c)), c
        }, _createItem: function (b) {
            var c = this, d = this.options, e = b[d.valueField], f = b[d.textField], g = a('<a class="x-dropdown-item x-check"/>').data("item", b).attr("option", e).attr("title", f).appendTo(this.$listView);
            a('<i class="icon-blank"/>').appendTo(g), a("<span/>").text(f).appendTo(g), this.valueMap[e] = f, this.itemsMap[e] = !0, this.values.indexOf(e) > -1 && g.addClass("select").prependTo(this.$listView), g.click(function (a) {
                c._onItemClick(g, b), a.preventDefault()
            })
        }, _createCustomItem: function (b) {
            var c = this, d = this.options, e = b[d.valueField], f = b[d.textField], g = a('<a class="x-dropdown-item x-check"><i class="icon-blank"/><span>' + f + "</span></a>").data("item", b).attr("option", e).attr("title", f).prependTo(this.$listView);
            b.selectAll ? (g.addClass("select-all"), this.$selectAllItem = g) : b.selectEmpty && (g.addClass("select-empty"), this.values.indexOf(e) > -1 && g.addClass("select")), g.click(function (a) {
                c._onItemClick(g, b), a.preventDefault()
            })
        }, _afterLoadItems: function () {
            var b = this, c = this.options;
            if (YS.Utils.forEach(this.values, function (a, d) {
                    if (!(b.itemsMap[d] || c.hasSelectEmpty && d == YS.CONST.PARAMETER.EMPTY)) {
                        var e = {};
                        e[c.valueField] = d, e[c.textField] = b.valueMap[d] || d, b._createItem(e)
                    }
                }), c.hasSelectEmpty) {
                a(".select-empty", this.$listView).remove();
                var d = {selectEmpty: !0};
                d[c.valueField] = YS.CONST.PARAMETER.EMPTY, d[c.textField] = "未填写", this._createCustomItem(d)
            }
            if (c.hasSelectAll) {
                a(".select-all", this.$listView).remove();
                var e = {selectAll: !0};
                e[c.textField] = "全选", this._createCustomItem(e), this._checkSelectAll()
            }
            YS.Utils.isEmpty(this.searchValue) || (this.$selectAllItem.find("span").text("搜索结果全选"), this.$listView.children("a.select-empty").addClass("hide"))
        }, _hideItems: function (b) {
            var c = this.$listView.children("a").not(".select-all").not(".select-empty");
            YS.Utils.forEach(c, function (c, d) {
                var e = a(d);
                e.text().indexOf(b) < 0 && e.addClass("hide")
            })
        }, _onItemClick: function (b, c) {
            var d = this, e = b.hasClass("select");
            if (c.selectAll) {
                var f = this.$listView.children("a").not(".hide").not(".select-all");
                e ? (b.removeClass("select"), this.selectAll = !1, YS.Utils.isEmpty(this.searchValue) && (this.values = [])) : (b.addClass("select"), YS.Utils.isEmpty(this.searchValue) && (this.selectAll = !0)), YS.Utils.forEach(f, function (b, c) {
                    d._handleItemClick(a(c), e)
                })
            } else this._handleItemClick(b, e);
            this._refreshData()
        }, _refreshData: function () {
            var a = this;
            this.valueMap && (a.texts = [], YS.Utils.forEach(this.values, function (b, c) {
                var d = a.valueMap[c];
                d && a.texts.push(d)
            })), this.editComp.val(this.texts.join(","))
        }, _handleItemClick: function (a, b) {
            var c = this.options, d = a.data("item"), e = d[c.valueField];
            d[c.textField];
            if (b) {
                a.removeClass("select");
                var f = this.values.indexOf(e);
                f > -1 && this.values.splice(f, 1), this.$selectAllItem && this.$selectAllItem.removeClass("select"), this.selectAll = !1
            } else a.addClass("select"), this.values.indexOf(e) < 0 && this.values.push(e), this._checkSelectAll()
        }, _checkSelectAll: function () {
            var a = this.$listView.children("a").not(".hide").not(".select-all"), b = this.$listView.children("a.select").not(".hide").not(".select-all");
            a.length === b.length && (this.$selectAllItem && this.$selectAllItem.addClass("select"), YS.Utils.isEmpty(this.searchValue) && (this.selectAll = !0))
        }, _refreshItems: function () {
            var b = this, c = this.options;
            a("a", this.$listView).each(function (d, e) {
                var f = a(e).data("item");
                f && (b.values.indexOf(f[c.valueField]) > -1 ? (a(e).addClass("select"), c.hasLimit && a(e).prependTo(b.$listView)) : a(e).removeClass("select"))
            })
        }, doResize: function () {
            YS.XComboCheckBox.superclass.doResize.apply(this, arguments);
            var a = this.options, b = a.height;
            this.element.css({"line-height": b - 2 + "px"})
        }, setValue: function (a) {
            var b = this;
            a || (a = []);
            var c = [];
            $.isArray(a) ? c = a : (c = a.items || [], a.hasEmpty && c.indexOf(YS.CONST.PARAMETER.EMPTY) < 0 && c.unshift(YS.CONST.PARAMETER.EMPTY)), b.values = [], b.texts = [], YS.Utils.forEach(c, function (a, c) {
                var d = b.valueMap[c];
                d == null ? b.texts.push(c) : b.texts.push(d), b.values.push(c)
            }), this._refreshItems(), this.editComp.val(this.texts.join(","))
        }, getValue: function () {
            if (YS.Utils.isObjectEmpty(this.values))return {};
            var a = [].concat(this.values), b = !1, c = a.indexOf(YS.CONST.PARAMETER.EMPTY);
            return c > -1 && (b = !0, a.splice(c, 1)), {hasEmpty: b, items: a}
        }
    }), a.shortcut("xcombocheck", YS.XComboCheckBox)
}(jQuery), function (a) {
    YS.ButtonGroup = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.ButtonGroup.superclass._defaultConfig.apply(), {
                baseCls: "x-group",
                btnCls: "btn_group",
                fieldIsnull: !0,
                fieldDefaultValue: "",
                layout: null,
                items: []
            })
        }, _init: function () {
            YS.ButtonGroup.superclass._init.apply(this, arguments);
            var a = this.options, b = this, c = this.options.fieldDefaultValue,v=this.options.value;
            this.$btns = [], this.$btnOther = null, this._bindEvt();
            YS.Utils.isEmpty(a.ajaxurl) ? b._loadItems(a.items) : $.ajax({
                url: getFlowConf().flowPath+'/common/getDictionaryItems',
                data:{"mainId":a.ajaxurl},
                success: function(dt){
                    a.items = dt.data;
                    b._loadItems(a.items);
                },error:function(e){
                    console.log(e);
                }
            });

        },
        _loadItems: function(dt){
            var a = this.options, b = this, c = this.options.fieldDefaultValue;
            b.element.empty();
            if(c.toString().indexOf(',') != -1){
                c = c.split(',');
            }else{
                c = [c.toString()];
            };
            dt.length>0 && YS.Utils.forEach(dt, function (a, d) {
                for(var i=0; i<c.length;i++){
                    d.code == c[i] && (d.selected = !0);
                }
                b._createItem(d)
            })
        },
        _createItem: function (b) {
            var c = this.options, d = a('<div class="group_item"/>').attr("value", b.value).data("item", b).addClass(this.options.btnCls).appendTo(this.element);
            return c.layout && d.addClass(c.layout), a('<i class="icon-blank"/>').appendTo(d), b.selected && d.addClass("select"), a("<span/>").text(b.text).appendTo(d), this.$btns.push(d), d
        }, _bindEvt: function () {
            var b = this;
            this.element.unbind("click.group"), this.element.bind("click.group", function (c) {
                if (b.isEnabled()) {
                    var d = c.target.tagName ? c.target.tagName.toUpperCase() : "";
                    var e = a(c.target), f = e.closest(".group_item");
                    f && f.length > 0 && b._doItemClick(f)
                }
            })
        }, _doItemClick: function (a) {
        }, getOptions: function () {
            var b = this.options;
            return a.extend(YS.ButtonGroup.superclass.getOptions.apply(this, arguments), {fieldDefaultValue: b.fieldDefaultValue, items: b.items})
        }
    })
}(jQuery), function (a) {
    YS.RadioGroup = YS.extend(YS.ButtonGroup, {
        _defaultConfig: function () {
            return a.extend(YS.RadioGroup.superclass._defaultConfig.apply(), {
                btnCls: "x-radio",
                fieldType: "varchar",
                fieldLength: 128,
                fieldDefaultValue: "",
                ajaxurl: "",
                onAfterItemSelect: null
            })
        }, _doItemClick: function (b) {
            var c = this.options;
            a(".select", this.element).removeClass("select"), b.addClass("select");
            var f = a(".select", this.element);
            YS.Utils.applyFunc(this, c.onAfterItemSelect, [f, f.data("item")], !1), YS.Utils.applyFunc(this, c.onStopEdit, [], !1)
        }, _createItem: function (b) {
            var t = this, c = this.options, d = a('<label class="group_item"/>').data("item", b).addClass(this.options.btnCls).appendTo(this.element),
                e=a('<input type="radio"/>').attr("value", b.value).attr("name",c.fieldId).appendTo(d).click(function(){
                    a(".select", t.element).removeClass("select"), $(this).closest(".group_item").addClass("select");
                    var f = a(".select", t.element);
                    //YS.Utils.applyFunc(t, c.onAfterItemSelect, [f, f.data("item")], !1), YS.Utils.applyFunc(t, c.onStopEdit, [], !1)
                });
            !c.fieldEnable && e.attr('disabled',!0);
            return c.layout && d.addClass(c.layout), b.selected && (e.attr("checked",true),d.addClass('select')), a("<span/>").text(b.text).appendTo(d), this.$btns.push(d), d
        }, setEnable: function (a) {
            if (YS.RadioGroup.superclass.setEnable.apply(this, [a]), this.$btnOther) {
                var b = this.$btnOther.data("widget");
                this.$btnOther.hasClass("select") && a ? b.setEnable(!0) : b.setEnable(!1)
            }
        }, effectItemLinkWidgets: function () {
            var b = this.options, c = a(".select", this.element);
            YS.Utils.applyFunc(this, b.onAfterItemSelect, [c, c.data("item")], !1)
        }, setValue: function (b) {
            if (a(".select", this.element).removeClass("select"), YS.Utils.isEmpty(b))return void(this.$btnOther && this.$btnOther.removeClass("select"));
            var c = !1;
            if (YS.Utils.forEach(this.$btns, function (a, d) {
                    var e = d.data("item");
                    if (e.code === b)return d.addClass("select"), c = !0, !1
                }), !c && this.$btnOther) {
                this.$btnOther.addClass("select");
                var d = this.$btnOther.data("widget");
                d.setValue(b)
            }
        }, checkValidate: function () {
            var a = this.options;
            return !(!a.fieldIsnull && YS.Utils.isEmpty(this.getValue()))
        }, getValue: function () {
            var b = [], c = a(".select", this.element);
            return YS.Utils.forEach(c, function (c, d) {
                var e = a(d).data("item");
                b.push(e.code)
            }), b.length > 0 ? b.join("") : null
        }, setText: function (b) {
            var c = this;
            a(".select", this.element).removeClass("select"), YS.Utils.forEach(this.$btns, function (a, d) {
                var e = d.data("item");
                return e.text === b ? (d.addClass("select"), !1) : void(c.$btnOther && (c.$btnOther.addClass("select"), c.$btnOther.data("widget").setValue(b)))
            })
        }, getText: function () {
            var b = [], c = a(".select", this.element);
            return YS.Utils.forEach(c, function (c, d) {
                var e = a(d).data("item");
                e.isOther ? b.push(a(d).data("widget").getValue()) : b.push(e.text)
            }), b.length > 0 ? b.join("") : null
        }
    }), a.shortcut("radiogroup", YS.RadioGroup)
}(jQuery), function (a) {
    YS.CheckBoxGroup = YS.extend(YS.ButtonGroup, {
        _defaultConfig: function () {
            return a.extend(YS.CheckBoxGroup.superclass._defaultConfig.apply(), {
                btnCls: "x-check",
                fieldType: "varchar",
                fieldLength: 128,
                fieldDefaultValue:"",
                onAfterItemSelect: null
            })
        }, _doItemClick: function (a) {
            YS.CheckBoxGroup.superclass._doItemClick.apply(this, arguments);
            var b = this.options;
            a.toggleClass("select");
            var c = a.data("item"), d = a.hasClass("select");
            d ? a.find("input").attr("checked", true) : a.find("input").attr("checked", false);
            YS.Utils.applyFunc(this, b.onAfterItemSelect, [a, c, d], !1), YS.Utils.applyFunc(this, b.onStopEdit, [], !1)
        }, _createItem: function (b) {
            var c = this.options, d = a('<span class="group_item"/>').data("item", b).addClass(this.options.btnCls).appendTo(this.element),e=a('<input type="checkbox"/>').attr("value", b.value).attr("name",c.name).appendTo(d);
            !c.fieldEnable && e.attr('disabled',!0);
            return c.layout && d.addClass(c.layout), b.selected && (e.attr("checked",true),d.addClass('select')), a("<span/>").text(b.text).appendTo(d), this.$btns.push(d), d
        }, checkValidate: function () {
            var b = this.options;
            return !(!b.fieldIsnull && 0 === a(".select", this.element).length)
        }, setValue: function (b) {
            a(".select", this.element).removeClass("select");
            var c = b.split(",");
            YS.Utils.forEach(this.$btns, function (b, d) {
                var e = a(d).data("item");
                YS.Utils.forEach(c, function (i, v){
                    if(v == e.code){
                        a(d).addClass("select");
                    }
                })
            });
        }, getValue: function () {
            var b = [], c = a(".select", this.element);
            return YS.Utils.forEach(c, function (c, d) {
                var e = a(d).data("item");
                b.push(e.code)
            }), b
        }, setText: function (b) {
            a(".select", this.element).removeClass("select");
            var c = a.makeArray(b);
            YS.Utils.forEach(this.$btns, function (b, d) {
                var e = a(d).data("item");
                c.indexOf(e.text) > -1 && a(d).addClass("select")
            })
        }, getText: function () {
            var b = [], c = a(".select", this.element);
            return YS.Utils.forEach(c, function (c, d) {
                var e = a(d).data("item");
                b.push(e.text)
            }), b
        }, getNullValue: function () {
            return []
        }
    }), a.shortcut("checkboxgroup", YS.CheckBoxGroup)
}(jQuery), function (a) {
    YS.Address = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.Address.superclass._defaultConfig.apply(), {
                baseCls: "fui_address",
                needDetail: !0,
                fieldIsnull: !0,
                fieldLineWidth: 12,
                width: 693,
                resource: getFlowConf().flowPath + "/common/getAreaChildren",
                width4province: "110",
                width4city: "110",
                width4district: "110",
                width4detail: "235"
            })
        }, _init: function () {
            YS.Address.superclass._init.apply(this, arguments);
            var b = a('<div class="fui_address-select"/>').appendTo(this.element), c = this, d = this.options, e = [];
            this.provinceData = [];
            this.province = YS.createWidget({
                type: "combo",
                textField: "name",
                valueField: "code",
                customCls: "sel-province",
                items: c.provinceData,
                renderEl: a("<div/>").appendTo(c.element),
                fieldIsnull: d.fieldIsnull,
                width: d.width4province,
                waterMark: "省/自治区/直辖市",
                onAfterItemSelect: function () {
                    c.linkByProvince(this.getValue()), YS.Utils.applyFunc(c, d.onStopEdit, arguments, !1)
                }
            })
            this.city = YS.createWidget({
                type: "combo",
                textField: "name",
                valueField: "code",
                customCls: "sel-city",
                items: [],
                renderEl: a("<div/>").appendTo(c.element),
                fieldIsnull: d.fieldIsnull,
                width: d.width4city,
                waterMark: "市",
                onAfterItemSelect: function () {
                    c.linkByProvinceAndCity(this.getValue()), YS.Utils.applyFunc(c, d.onStopEdit, arguments, !1)
                }
            }), this.district = YS.createWidget({
                type: "combo",
                textField: "name",
                valueField: "code",
                renderEl: a("<div/>").appendTo(c.element),
                customCls: "sel-district",
                fieldIsnull: d.fieldIsnull,
                width: d.width4district,
                waterMark: "区/县",
                items: [],
                onAfterItemSelect: function () {
                    YS.Utils.applyFunc(c, d.onStopEdit, arguments, !1)
                }
            }), d.needDetail && (this.detail = YS.createWidget({
                type: "text",
                customCls: "address-detail",
                waterMark: "详细地址",
                fieldIsnull: d.fieldIsnull,
                width: d.width4detail,
                renderEl: a("<div/>").appendTo(this.element)
            }))
            c.getProvinceData(function(data){
                c.province.options.items = data;
                c.province.rebuild();
            });
        }, getProvinceData: function(callback){
            var a = this, b = this.options, c = [];
            $.ajax({
                url: b.resource,
                success: function (data) {
                    var provinces = data ? data.data : [];
                    callback && callback(provinces)
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    //alert('调用API错误');
                }
            });
            return c
        }, linkByProvince: function (a, callback) {
            var b = this, c = this.options, _url = c.resource.indexOf("?") >0?('&pcode=' + a):('?pcode=' + a);
            $.ajax({
                url: c.resource + _url,
                success: function (data) {
                    var cities = data ? data.data : [];
                    b.city.options.items = cities, b.district.options.items = [], b.city.rebuild(), b.district.rebuild();
                    callback && callback(cities)
                },
                error: function () {
                    //alert('调用API错误');
                }
            });
        }, linkByProvinceAndCity: function (a, callback) {
            var b = this, c = this.options, _url = c.resource.indexOf("?") >0?('&pcode=' + a):('?pcode=' + a);
            $.ajax({
                url: c.resource + _url,
                success: function (data) {
                    var area = data ? data.data : [];
                    b.district.options.items = area, b.district.rebuild();
                    callback && callback(area)
                },
                error: function () {
                }
            });
        }, setEnable: function (a) {
            this.options.fieldEnable = !!a, this.province.setEnable(a), this.city.setEnable(a), this.district.setEnable(a), this.detail && this.detail.setEnable(a)
        }, checkValidate: function () {
            var a = this.province.checkValidate() && this.city.checkValidate() && this.district.checkValidate();
            return this.detail && (a = this.detail.checkValidate() && a), a
        }, setValue: function (a) {
            var c = this, d = this.options;
            if(a){
                var b = a.split(",");
                YS.Utils.isEmpty(b[3]) || this.detail.setValue(b[3]);
                if(!YS.Utils.isEmpty(b[0])){
                    c.getProvinceData(function(data){
                        c.province.setValue(b[0]), c.linkByProvince(b[0],function(){
                            if(!YS.Utils.isEmpty(b[1])){
                                c.city.setValue(b[1]);
                                c.linkByProvinceAndCity(b[1], function(){
                                    YS.Utils.isEmpty(b[2]) || c.district.setValue(b[2])
                                });
                            }
                        });
                    });
                }else{
                    this.province.setValue(null), void this.linkByProvince(null)
                }
            }
        }, getValue: function () {
            var a = "", b = this.province.getValue(), c = this.city.getValue(), d = this.district.getValue(), e = this.detail ? this.detail.getValue() : null;
            return YS.Utils.isEmpty(b) || (a += b), YS.Utils.isEmpty(c) ? (a+=",") : (a += ("," + c)), YS.Utils.isEmpty(d) ? (a+=",") : (a += ("," + d)), YS.Utils.isEmpty(e) ? (a+=",") : (a += ("," + e)), a
        }, getOptions: function () {
            var b = this.options;
            return a.extend(YS.Address.superclass.getOptions.apply(this, arguments), {needDetail: b.needDetail})
        }, getNullValue: function () {
            return {}
        }
    }), a.shortcut("address", YS.Address)
}(jQuery), function (a) {
    YS.Upload = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.Upload.superclass._defaultConfig.apply(), {
                files: [],
                fileType: [],
                value: "",
                maxFileSize: 524288000,
                maxFileCount: 1,
                uploadURL: getFlowConf().flowPath + "/common/uploadAnnex",
                uploadToMedia: !1,
                uploadToForm: !1,
                fieldIsnull: !0,
                onValidateSuccess: null,
                onValidateFail: null,
                onAfterValidate: null,
                onUpload: null,
                onUploadSuccess: null,
                onUploadFail: null,
                onAfterUpload: null
            })
        }, _init: function () {
            YS.Upload.superclass._init.apply(this, arguments);
            var a = this.options;
            a.value && (a.files = ((a.value instanceof Object)?a.value:eval('('+a.value+')')));
            this.tokenKey = a.uploadToMedia ? "imageUploadToken" : "fileUploadToken", this.tokenExpireKey = this.tokenKey + "Expires", this._initUploadForm(), this._initUploadInput()
        }, _initUploadForm: function () {
            var b = this.options;
            this.$uploadForm = a('<form class="upload-form" action="' + b.uploadURL + '" enctype="multipart/form-data" method="post"/>')
        }, _initUploadInput: function () {
            var b = this.options;
            this.files = b.files || [], this.$uploadInput = a('<input type="file" id="'+b.name+'" name="'+b.name+'" class="upload-btn-input"/>').appendTo(this.$uploadForm), b.maxFileCount > 1 && this.$uploadInput.attr("multiple", !0)
        }, doUpload: function () {
            var a = this;
            if (!this.upFiles) {
                if (!this.$uploadInput[0].files.length > 1)return;
                this.upFiles = this.$uploadInput[0].files
            }
            this._doDataUpload();
        }, _isTokenValid: function () {
            return YS.STATIC[this.tokenKey] && Date.now() < YS.STATIC[this.tokenExpireKey]
        }, _doDataUpload: function () {
            var a = this;
            var b = 0, c = [], d = 0, e = 0, f = function () {
                return c.reduce(function (a, b) {
                    return a + b
                })
            }, g = function () {
                d + e === a.upFiles.length && (e > 0 ? a.onFail({failCount: e}) : a.onSuccess())
            };
            if (this.upFiles)for (var h = 0, i = this.upFiles.length; h < i; h++) {
                var j = this.upFiles[h];
                b += j.size, a._doXhrUpload(j, function (d, e) {
                    c[h] = d, a.onUpload(f(), b)
                }, function (e) {
                    c[h] = j.size, a.onUpload(f(), b), !e.file|| a.files.push(e.file), d++, g()
                }, function (d) {
                    c[h] = 0, a.onUpload(f(), b), e++, g()
                })
            }
        }, _doXhrUpload: function (a, b, c, d) {
            var e, f = this.options, g = a.name, h = new FormData, i = this, size = a.size;
            h.append("file", a);
            YS.Utils.ajaxUpload({url: f.uploadURL, data: h, onUpload: b}, function (a, b) {
                if(a.code == 100){
                    i.files.push({path:a.data,name:g, size:size}), f.value += f.value ? ","+a.data : a.data;
                    void(c && c.apply(this, arguments))
                }else{
                    d();
                }
            }, d)
        }, checkValidate: function () {
            var a = this.options, b = !0;
            return a.fieldIsnull || (b = this.isUploaded()), b ? YS.Utils.applyFunc(this, a.onValidateSuccess, [], !1) : YS.Utils.applyFunc(this, a.onValidateFail, [], !1), YS.Utils.applyFunc(this, a.onAfterValidate, [], !1), b
        }, checkFile: function (a) {
            var b = this.options;
            if (!a)return !1;
            var c = a.name, d = c.split(".").pop(), e = !0;
            e && b.fileType.length > 0 && b.fileType.indexOf(d.toLowerCase()) === -1 && (YS.Msg.toast({
                msg: "不支持选择的文件类型",
                type: "warning"
            }), e = !1);
            var f = b.maxFileSize;
            return e && a.size > f && (YS.Msg.toast({
                msg: "文件大小超出限制",
                type: "warning"
            }), e = !1), e
        }, doClear: function () {
            this.resetUploadInput(), this.files = []
        }, resetUploadInput: function () {
            this.$uploadInput.replaceWith(this.$uploadInput = this.$uploadInput.clone(!0))
        }, isImageFile: function (a) {
            return !!a.match(/^(jpg|jpeg|png|gif|svg)$/g)
        }, onUpload: function (a, b) {
            var c = this.options;
            YS.Utils.applyFunc(this, c.onUpload, [a, b], !1)
        }, onSuccess: function () {
            var a = this.options;
            YS.Utils.applyFunc(this, a.onUpload, [1, 1], !1), YS.Utils.applyFunc(this, a.onUploadSuccess, [this.files], !1), this.resetUploadInput()
        }, onFail: function (a) {
            var b = this.options;
            YS.Utils.applyFunc(this, b.onUploadFail, [a], !1), 413 === a ? YS.Msg.toast({
                type: "warning",
                msg: "文件大小超出限制"
            }) : YS.Msg.toast({type: "warning", msg: "文件上传失败"})
        }, onFinish: function () {
            var a = this.options;
            YS.Utils.applyFunc(this, a.onAfterUpload, [], !1)
        }, isUploaded: function () {
            return !YS.Utils.isObjectEmpty(this.files)
        }, setEnable: function (a) {
            this.options.fieldEnable = !!a, a ? this.$uploadInput.removeAttr("disabled").removeAttr("readonly") : this.$uploadInput.attr("disabled", "disabled").attr("readonly", "readonly")
        }, getValue: function () {
            var b= this, c = this.options, d = "";
            d = b.files && b.files.length>0 ? JSON.stringify(b.files) : c.value;
            return d
        }, getUpFiles: function () {
            return this.upFiles
        }, getNullValue: function () {
            return ""
        }, setValue: function (b) {
            var c = this.options;
            b = eval(b);
            c.value = b, this.files = b && b.length>0 ? b : [], this.files.length > c.maxFileCount && (this.files = this.files.slice(0, c.maxFileCount))
        }, getOptions: function () {
            var b = this.options;
            return a.extend(YS.Upload.superclass.getOptions.apply(this, arguments), {maxFileCount: b.maxFileCount})
        }
    })
}(jQuery), function (a) {
    YS.FileUpload = YS.extend(YS.Upload, {
        _defaultConfig: function () {
            return a.extend(YS.FileUpload.superclass._defaultConfig.apply(), {
                baseCls: "fui_upload",
                files: [],
                fileType: [],
                value: "",
                maxFileSize: 524288000,
                maxFileCount: 1,
                uploadURL: getFlowConf().flowPath + "/common/uploadAnnex",
                uploadToForm: !0,
                style: "white",
                size: "normal",
                mode: "upload",
                fieldIsnull: !0,
                thumbWidth: 180,
                thumbHeight: 100,
                hasProgress: !0,
                hasPreview: !0,
                hasPreviewList: !0,
                onBeforeUpload: null,
                onUpload: null,
                onAfterUpload: null,
                onUploadFail: null
            })
        }, _init: function () {
            YS.FileUpload.superclass._init.apply(this, arguments);
            var b = this.options;
            this._createUploadBtn(), b.hasProgress && (this.progress = YS.createWidget({
                type: "progress",
                renderEl: a("<div/>").appendTo(this.element),
                width: 420,
                height: 30,
                fieldIsshow: !1
            })), this.$previewList = a('<div class="upload-preview-list"/>').appendTo(this.element), "small" === b.size && this.$previewList.addClass("small"), this._bindFileEvent()
        }, _createUploadBtn: function () {
            var b = this, c = this.options;
            if (this.$uploadBtn = a('<div class="upload-btn x-btn"/>').addClass("style-" + c.style).appendTo(this.element), a('<i class="icon-upload upload-icon"/>').appendTo(this.$uploadBtn), a("<span/>").text("选择文件").appendTo(this.$uploadBtn), this.$uploadForm.appendTo(this.$uploadBtn), c.fileType.length > 0) {
                var d = "." + c.fileType.join(",.");
                this.$uploadInput.prop("accept", d)
            }
            this.$uploadInput.bind("change", function () {
                b.upFiles = this.files;
                if (!b.upFiles && !YS.Utils.isFormDataSupported()) {
                    if (!this.value)return;
                    b.upFiles = [{name: this.value.split("\\").pop(), size: this.size}]
                }
                return 1 === c.maxFileCount && (b.files = [], b.$previewList.empty()), b._checkUploadFiles(b.upFiles) ? void b.doUpload() : void(b.upFiles = null)
            })
        }, _checkUploadFiles: function (a) {
            var b = this, c = this.options;
            if (this.files.length + a.length > c.maxFileCount)return YS.Msg.toast({
                msg: "文件上传控件最多允许选择 " + c.maxFileCount + " 个文件",
                type: "warning"
            }), !1;
            var d = !0;
            if (a)for (var e = 0, f = a.length; e < f && (d = d && b.checkFile(a[e]), d); e++);
            return d
        }, _previewFiles: function (a) {
            var b = this, c = this.options;
            if (c.hasPreviewList && (a || (a = this.files), a))for (var d = 0, e = a.length; d < e; d++)a[d]!="[]"?b._createFilePreview(a[d]).appendTo(b.$previewList):1
        }, _createFilePreview: function (b) {
            b = b instanceof Object ? b : b instanceof Array ? b[0] : eval('(' + b + ')');
            b = b instanceof Array ? b[0] : b;
            var c = this, d = this.options, e = YS.Utils.formatFileSize(b.size), f = c._trimFileName(b.name),
                g = b.name ? b.name.split(".").pop() : "", h = YS.Utils.date2Str(new Date(b.uploadTime), "yyyy/MM/dd");
            var i = a('<div class="upload-info"/>').attr('title', f + '(' + e + ')').attr('filename', f),
                j = a('<div class="upload-preview"/>').appendTo(i), l = !1;
            c.isImageFile(g.toLowerCase()) && (l = !1, i.addClass('img-box'), a('<i class="icon-file icon-upload-image"/>').appendTo(j));
            if(!l){
                a('<i class="icon-file upload-file-mark icon-upload-'+g.toLowerCase()+'"/>').appendTo(j)
            }
            a('<div id="up-fileName" class="info-text"/>').text(f + '(' + e + ')').appendTo(i);
            m = a('<div class="upload-info-btn"/>').appendTo(i);
            a('<i class="icon-upload-download"/>').appendTo(m).click(function (evt) {
                var fileBox = a(evt.target).closest(".upload-info"), idx = fileBox.index();
                var fileUrl = c.files[idx].path, htmlName = c.files[idx].name;
                top.window.location.href = getFlowConf().flowPath + '/common/download?path='+encodeURIComponent(fileUrl)+'&name='+encodeURIComponent(htmlName);
            }), a('<i class="icon-upload-search"/>').appendTo(m).click(function (evt) {
                var fileBox = a(evt.target).closest(".upload-info"), idx = fileBox.index();
                var fileUrl = c.files[idx].path, htmlName = c.files[idx].name;
                if (fileUrl && 'undefined' != fileUrl) {
                    if (fileBox.hasClass('img-box')) {
                        var jsonArr = [], currIndex = 0;
                        a.each(c.files, function (i, o) {
                            if (YS.Utils.isImage(o.path)) {
                                jsonArr.push({name: o.name, url: getFlowConf().filePath+o.path});
                                o.path == fileUrl && (currIndex = i);
                            }
                        });
                        var opt = {current: currIndex, imgs: jsonArr};
                        try{
                            parent.imgPreviewCtrl(opt);
                        }catch(e){
                            c.imgPreviewCtrl(opt);
                        }
                    } else {
                        fileUrl = encodeURIComponent(fileUrl);
                        htmlName = encodeURIComponent(htmlName);
                        window.open(getFlowConf().fileViewPath + '?downloadUrl=' + fileUrl + '&htmlName=' + htmlName);
                    }
                } else {
                    alert('地址错误或文件已删除！');
                }
            });
            d.fieldEnable && "upload" === d.mode && (i.addClass('can-del'), a('<i class="icon-upload-remove"/>').appendTo(m).click(function (evt) {
                var fileBox = a(evt.target).closest(".upload-info");
                c.files.splice(fileBox.index(), 1), fileBox.remove();
            }));
            return i
        },
        imgPreviewCtrl: function(opt){
            var _box = a('<div />');
            if(opt && opt.imgs){
                $.each(opt.imgs, function (i, o) {
                    var img = a('<img />');
                    if (new RegExp("http://|https://").test(o.url) ){
                        img.attr('src', o.url);
                    }else{
                        img.attr('src', flowgetFlowConf().filePath + (o.url.indexOf('/')==0?o.url:"/"+o.url));
                    }
                    img.on('error', function(){
                        img.unbind('error')
                        this.src = getFlowConf().flowPath + "/a/img/public/img-onerror.png";
                    });
                    img.attr('alt', o.name);
                    _box.append(img);
                });
            }
            var viewer = new Viewer(_box[0], {zIndex:999999,
                hidden: function () {
                    viewer.destroy();
                    _box.remove();
                }
            });
            viewer.view(opt.current);
            viewer.show();

        }, _bindFileEvent: function () {
            var b = this, c = this.options, d = function (d) {
                var e = d.target, f = d.type, g = a(e).closest(".upload-info-btn"), h = a(e).closest(".upload-info");
                /*if(g && g.length > 0){
                    if("click" === f){
                        b.files.splice(h.index(), 1);
                        /!*o=a(e).closest("li");
                         z=$(o).data("widget");
                         z.setValue("[]")*!/
                        h.remove();
                    }
                }else{
                    c.hasPreview && h && h.length > 0 && new YS.FilePreview({
                        files: b.files,
                        currentItem: h.index(),
                        autoClose: !1
                    })
                }*/
            };
            this.$previewList.unbind(".file-op"), this.$previewList.bind({"click.file-op": d})
        }, _trimFileName: function (a) {
            if (YS.Utils.isEmpty(a))return "";
            var b = 20, c = a ? a.split(".").pop() : "";
            return a.length - c.length - 1 > b && (a = a.slice(0, b - 1), a = a + "..." + c), a
        }, _drawLocalPreview: function (b) {
            var c = this.options, d = a("<canvas/>"), e = window.URL || window.webkitURL, f = d[0].getContext("2d"), g = new Image, h = e.createObjectURL(b);
            g.src = h;
            var i = c.thumbWidth, j =   c.thumbHeight;
            return f.canvas.width = i, f.canvas.height = j, g.onload = function () {
                var a = Math.min(i / g.width, j / g.height);
                f.drawImage(g, 0, 0, g.width, g.height, 0, 0, g.width * a, g.height * a), e.revokeObjectURL(h)
            }, d
        }, _drawRemotePreview: function (b, c) {
            var d = this.options, e = a("<img/>").hide(), f = a.extend({
                thumb: {
                    width: d.thumbWidth,
                    height: d.thumbHeight
                }
            }, b);
            YS.Utils.getFileDownloadURL(f, function (a) {
                return e.attr("src", a).attr('width','173').attr('height', '98').show(), c(e)
            })
        }, doUpload: function () {
            YS.FileUpload.superclass.doUpload.apply(this, arguments);
            var a = this.options;
            !this.upFiles || this.upFiles.length <= 0 || (this.$uploadBtn.hide(), a.hasProgress && this.progress.setVisible(!0), YS.Utils.applyFunc(this, a.onBeforeUpload, [{
                files: null,
                up: 0,
                total: 0
            }], !1), this._setProgress(0, 1))
        }, _setProgress: function (a, b) {
            var c = this.options;
            if (c.hasProgress) {
                var d = parseInt(a / b * 100);
                d < 100 ? this.progress.setMessage("正在上传...") : this.progress.setMessage("上传完成"), this.progress.setProgress(d)
            }
        }, onUpload: function (a, b) {
            YS.FileUpload.superclass.onUpload.apply(this, arguments), YS.Utils.applyFunc(this, this.options.onUpload, [{
                files: null,
                up: a,
                total: b
            }], !1), this._setProgress(a, b)
        }, onSuccess: function () {
            YS.FileUpload.superclass.onSuccess.apply(this, arguments);
            var a = this.options;
            YS.Utils.isCanvasSupported() ? this._previewFiles(this.upFiles) : this._previewFiles(), a.hasProgress && this.progress.setVisible(!1), YS.Utils.applyFunc(this, a.onAfterUpload, [{
                files: this.files,
                up: 0,
                total: 0
            }], !1), this.$uploadBtn.show()
        }, onFail: function (a) {
            YS.FileUpload.superclass.onFail.apply(this, arguments);
            var b = this.options;
            b.hasProgress && this.progress.setVisible(!1), this.$uploadBtn.show(), YS.Utils.applyFunc(this, b.onUploadFail, [], !1)
        }, doClear: function () {
            YS.FileUpload.superclass.doClear.apply(this, arguments), this.$previewList.empty()
        }, setEnable: function (a) {
            YS.FileUpload.superclass.setEnable.apply(this, [a]), this.$uploadBtn && (a ? this.$uploadBtn.removeClass("x-ui-disable") : this.$uploadBtn.addClass("x-ui-disable")), this.$previewList.empty(), this._previewFiles()
        }, setValue: function (a) {
            YS.FileUpload.superclass.setValue.apply(this, arguments), a && (this.$previewList.empty(), this._previewFiles())
        }
    }), a.shortcut("upload", YS.FileUpload)
}(jQuery), function (a) {
    YS.SubForm = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.SubForm.superclass._defaultConfig.apply(), {
                baseCls: "fui_subform",
                fieldIsnull: !0,
                ignoreOptAuth: !1,
                items: [],
                itemMap: {},
                editFormFirst: !0,
                fieldLength: 2048,
                maxItemCount: 0,
                newItemText: "添加记录",
                noFieldText: "请添加字段",
                onBeforeWidgetCreate: null,
                onAfterWidgetCreate: null
            })
        }, _init: function () {
            YS.SubForm.superclass._init.apply(this, arguments);
            var b = this, c = this.options;
            if(c.editFormFirst){
                var v = {};
                $.each(c.items,function(i, itm){
                    if(itm.value){
                        v[itm.fieldId] = itm.value;
                    }else if(itm.fieldDefaultValue){
                        v[itm.fieldId] = itm.fieldDefaultValue
                    }
                    delete itm.fieldDefaultValue;
                    delete itm.value;
                });
                if(!$.isEmptyObject(v)){
                    c.value = v;
                }
                c.editFormFirst = !1;
            }
            this.$table = a('<table cellpadding="2px" cellspacing="0"/>').appendTo(this.element),
                this.$head = a("<thead/>").appendTo(this.$table), this.$body = a("<tbody/>").appendTo(this.$table), this.options.items.length > 0 ? (this._appendHead(), this._appendLine()) : a('<div class="subform-none-tip"/>').text(c.noFieldText).appendTo(this.element), this.addBtn = new YS.Button({
                renderEl: a("<div/>").appendTo(this.element),
                style: "none",
                iconCls: "icon-add",
                customCls: "btn-itemadd",
                text: c.newItemText,
                onClick: function () {
                    if (b.isEnabled()) {
                        if (a(".subform-line", b.$body).length >= 200)return void YS.Msg.toast({
                            type: "warning",
                            msg: "子表单数据量已超过200条最大限制"
                        });
                        b._appendLine(), YS.Utils.applyFunc(b, c.onStopEdit, [], !1)
                    }
                }
            })
        }, _appendHead: function () {
            var b = this.options, c = a('<tr class="subform-head"/>').appendTo(this.$head), width = 945/b.items.length;
            YS.Utils.forEach(b.items, function (d, e) {
                b.itemMap[e.fieldId] = e;
                var f = a("<td/>").attr("width", width).appendTo(c);
                var g = a('<span class="label-notnull x-ui-hidden"/>').text("*").appendTo(f);
                f.append(a('<span class="form-cell"/>').text(e.labelName));
                e.fieldIsnull === !1 && g.removeClass("x-ui-hidden"), b.ignoreOptAuth || e.fieldIsshow !== !1 || f.addClass("x-ui-hidden")
            }), a('<td class="navi-cell"/>').appendTo(c)
        }, _appendLine: function (b) {
            var c = this.options, d = this;
            if (0 !== c.items.length) {
                var e = a('<tr class="subform-line"/>').appendTo(d.$body), width = 945/c.items.length;
                YS.Utils.forEach(c.items, function (f, g) {
                    var h = a("<td/>").attr("width", width).appendTo(e);
                    YS.Utils.applyFunc(d, c.onBeforeWidgetCreate, [g], !1);
                    var i = a.extend({}, g, {
                        renderEl: a('<div class="form-cell"/>').appendTo(h),
                        fieldPid: c.fieldId,
                        width: width -5
                    });
                    c.ignoreOptAuth && (i.fieldEnable = !0, i.fieldIsshow = !0);
                    var j = YS.createWidget(i);
                    YS.Utils.applyFunc(d, c.onAfterWidgetCreate, [j], !1),YS.Utils.applyFunc(d, c._onAfterItemsLoaded, [j], !1), i.fieldIsshow === !1 && h.addClass("x-ui-hidden"), c.fieldEnable === !1 && j.setEnable(!1), h.attr("namecol", j.options.fieldId);
                    if (b) {
                        var k = b[j.options.fieldId];
                        k && j.setValue(k)
                    }
                    h.data("widget", j)
                });
                var f = a('<td class="navi-cell"/>').appendTo(e).append(a('<i class="icon-ui-remove"/>')).click(function () {
                    d.isEnabled() && (e.remove(), d._checkItemLimit(), YS.Utils.applyFunc(d, c.onStopEdit, [], !1))
                });
                c.fieldEnable || f.addClass("x-ui-disable"), this._checkItemLimit()
            }
        }, _checkItemLimit: function () {
            var a = this.options;
            if (a.maxItemCount && this.addBtn) {
                var b = this.$body.find("tr.subform-line");
                this.addBtn.setEnable(b.length < a.maxItemCount)
            }
        }, setEnable: function (a) {
            if (this.options.fieldEnable = !!a, this.$table) {
                var b = this.$table.find("td.navi-cell");
                a ? b.removeClass("x-ui-disable") : b.addClass("x-ui-disable")
            }
            this.addBtn.setEnable(a)
        }, getOptions: function () {
            var b = this.options, c = this, d = this.$body.children("tr").eq(0);
            if (d.length > 0) {
                var e = [], f = d.children("td"), m = {};
                $.each(f, function (g, h) {
                    var f = a(h).data("widget");
                    if(f) {
                        f.options.fieldPid = b.fieldId, e.push(f.getOptions())
                    }
                }), b.items = e
            }
            return a.extend(YS.SubForm.superclass.getOptions.apply(this, arguments), {itemMap: b.itemMap, items: b.items})
        }, getWidgetByName: function (b, c) {
            var d = [];
            $.each(this.$table.find('td[namecol="' + b + '"]'), function (b, c) {
                var e = a(c).data("widget");
                e && d.push(e)
            })
            return (c != undefined && c >= 0) ? d[c] : d
        }, getValue: function () {
            var b = {}, t = this, e = t.options.itemMap, trs = t.$table.find("tr.subform-line");
            trs.each(function (c, d) {
                var cells = a(d).find(".form-cell");
                cells.each(function (i, f) {
                    var d = a(f).parent().data("widget"), g = d.getValue() || '', h = d.getWidgetName();
                    if(h){
                        !b[h] && (b[h] = "");
                        (c >= trs.length-1 || trs.length==1) ? (b[h] += g) : (b[h] += (g + "$#"));
                    }
                });
            });
            return b
        }, getText: function () {
            var b = [];
            return this.$table.find("tr.subform-line").each(function (c, d) {
                var e = {}, f = !0;
                a(d).find(".form-cell").each(function (b, c) {
                    var d = a(c).parent().data("widget"), g = d.getText();
                    f = YS.Utils.isObjectEmpty(g) && f;
                    var h = d.getWidgetType();
                    "linkdata" === h ? a.extend(e, g) : e[d.getWidgetName()] = g
                }), f || b.push(e)
            }), b
        }, setValue: function (a) {
            var b = this, c = this.options.items, f = [];
            this.$table.find("tr.subform-line").remove();
            if(!YS.Utils.isObjectEmpty(a)){
                var len = 0;
                for(var key in a){
                    if(a[key]){
                        len = a[key].split("$#").length;
                        break;
                    }
                }
                for(var i=0 ; i<len; i++){
                    f[i] = {};
                    YS.Utils.forEach(a, function (g, h) {
                        var e = h ? h.split("$#") : [];
                        f[i][g] = e[i];
                    });
                    b._appendLine(f[i]);
                }
            }
        }, checkValidate: function () {
            var b = this.options, c = [], d = !0;
            return this.$table && this.$table.find("tr.subform-line").each(function (b, e) {
                var f = {}, g = !0, h = !0;
                a(e).find(".form-cell").each(function (b, c) {
                    var d = a(c).parent().data("widget");
                    h = d.checkValidate() && h;
                    var e = d.getValue();
                    g = YS.Utils.isObjectEmpty(e) && g, f[d.getWidgetName()] = e
                }), g ? h = !0 : c.push(f), d = h && d
            }), !(!b.fieldIsnull && c.length <= 0) && (d || this.setInvalidateType("regex"), d)
        }, getNullValue: function () {
            return []
        }
    }), a.shortcut("subform", YS.SubForm)
}(jQuery), function (a) {
    YS.Separator = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.Separator.superclass._defaultConfig.apply(), {baseCls: "fui_separator",fieldLineWidth:12, fieldIsnull: !0})
        }, _init: function () {
            YS.Separator.superclass._init.apply(this, arguments);
            a('<div class="sep-line"/>').appendTo(this.element), this.$description = a("<div/>").appendTo(this.element)
        }, setValue: function (a) {
            YS.Separator.superclass.setValue.apply(this, arguments), this.$description.empty(), YS.Utils.isEmpty(a) || this.$description.append(a)
        }
    }), a.shortcut("separator", YS.Separator)
}(jQuery), function (a) {
    YS.User = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.User.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_user",
                title: "选择人员",
                msg: "点击设置成员",
                rootText: "YASHA",
                width: 200,
                height: 32,
                fieldType: "varchar",
                fieldLength: 128,
                assignmentUrl: getFlowConf().flowPath+"/common/ajaxListPersonByNos",
                value: null,
                fieldIsnull: !0,
                editable: !1,
                count: 100,
                fieldLimit: [],
                dynamicType: "select",
                onStopEdit: null,
                onBeforeEdit: null
            })
        }, _init: function () {
            YS.User.superclass._init.apply(this, arguments), this._initSelectPane()
        }, _initData: function () {
            // debugger;
            var a = this.options, b = this, _this = this;
            this.items = [];
            if(a.value){
                //if(a.value && !a.fieldDefaultValueName){
                    $.ajax({async:false, data:{nos:a.value}, url:a.assignmentUrl, type:'POST', success:function(dt){
                        dt = dt.code == '100'?dt.data:[];
                        a.fieldDefaultValueName = dt[0].name;
                        b.value = a.value, _this.items.push({no: a.value, name: a.fieldDefaultValueName ? a.fieldDefaultValueName : b.getText()})
                        _this._initSelectPane();
                    }});
                //}
                // if(a.value){
                //     b.value = a.value, _this.items.push({no: a.value, name: a.fieldDefaultValueName ? a.fieldDefaultValueName : b.getText()})
                //     _this._initSelectPane();
                // }
            }else{
                //b.value = "", b.items.push({no: "", name: "" })
                //b._initSelectPane();
            }
        }, _initSelectPane: function () {
            var b = this, c = this.options;
            this.selectMap = {}, YS.Utils.forEach(this.items, function (a, c) {
                b.selectMap[c.no] = c
            }), b._createSelectList(), c.editable ? this._createSelectPane() : this._bindEditEvent()
        }, _bindEditEvent: function () {
            var a = this, b = this.options;
            this.$selectBtn.unbind("click"), this.$selectBtn.bind("click", function () {
                if (a.isEnabled()) {
                    YS.Utils.applyFunc(a, b.onBeforeEdit, [], !1);
                    var c = new YS.ConfirmDialog({
                        title: b.title,
                        height: 600,
                        width: 800,
                        contentWidget: {
                            rowSize: [500],
                            colSize: [800],
                            items: [[{
                                fieldId: b.fieldId,
                                type: b.type,
                                editable: !0,
                                fieldLimit: b.fieldLimit,
                                limitWidget: b.limitWidget,
                                items: a.items,
                                value: a.value
                            }]]
                        },
                        onOk: function () {
                            var d = c.getWidgetByName(b.fieldId);
                            return a.value = d.getValue(), a.items = d.getItems(), a._initSelectPane(), YS.Utils.applyFunc(a, b.onStopEdit, [], !1), !1
                        }
                    });
                    c.show()
                }
            })
        }, _createSelectList: function () {
            var b = this, c = this.options;
            this.$selectList ? this.$selectList.empty() : this.$selectList = a('<ul class="select-list" />').appendTo(this.element);
            this.$selectBtn = $("<i />").addClass("btn-icon").appendTo(this.$selectList);
            if (this.value) {
                var d = b.selectMap[this.value];
                b._createSelectItem(d)
            }// else c.editable || this.$selectList.append(a('<div class="select-empty"/>').text(c.msg))
        }, _setSelectItem: function (a) {
            this.$selectList.empty(), this._createSelectItem(a), this.value = a.no, this.selectMap[a.no] = a
        }, _clearSelectItem: function () {
            this.$selectList.empty(), this.value = null
        }, _createSelectItem: function (b) {
            var c = this.options, d = this;
            if (b) {
                var e = a('<li class="select-item"/>').append(a("<span class='member-name'/>").text(b.name)).appendTo(this.$selectList).attr("id", b.no).data("item", b);
                c.editable && a('<span class="remove-btn"/>').click(function () {
                    d._clearSelectItem(), d.refresh()
                }).appendTo(e)
            }
        }, _createSelectPane: function () {
            if (!this.$selectPane) {
                this.element.empty();
                var b = this.options, c = this, d = a('<table style="width:100%;height:100%" />').appendTo(this.element);
                this.$searchPane = a('<thead><tr class="name-list-nav" style="height:44px"><th colspan="3"></th><th><form class="jsSearchForm"><div class="name-search-box"><input type="text" id="searchInput" name="keyword" placeholder="输入部门/姓名"/><i class="jsSearchBtn icon-search"></i></div></form></th></tr></thead>').appendTo(d);
                a('<tbody><tr><td width="30%" colspan="2"><div class="left-tree" style="height: '+(b.height-84)+'px"></div></td><td class="person-list" width="70%" colspan="2"></td></tr></tbody>').appendTo(d);
                this.$memberMenu = $('<ul id="orgTree" class="ztree"></ul>').appendTo(a('.left-tree'));
                this.$selectPane = a('<div id="personMsgList" class="select-menu list-htable" style="height: '+(b.height-84)+'px"></div>').appendTo(a('.person-list'));
                var south = $('<tr class="ipt-box" style="height:40px"><td colspan="4" class="selected"></td></tr>').appendTo(d);
                this.$selectList = a('<div class="selected-box" />').appendTo(south.find('.selected'));
                this._createMemberMenu(), this._createMemberList(), this._bindMemberEvent()
                a('.jsSearchBtn').bind('click',function(){
                    var key = a('#searchInput').val();
                    $.trim(key)&&c._createSearchList(key);
                });
                a("#searchInput").keydown(function (b) {
                    if(13 === b.keyCode){
                        $.trim(a(this).val())&&c._createSearchList(a(this).val());
                        return false
                    }
                })
            }
        }, _isRelyLimitEmpty: function () {
            var a = this.options;
            return YS.Utils.isObjectEmpty(a.fieldLimit) && !YS.Utils.isObjectEmpty(a.limitWidget)
        }, _initLimitMap: function (a) {
            var b = this.options, c = this, d = {};
            YS.Utils.forEach(a, function (a, b) {
                d[b._id] = b
            }), this.limitMap = {}, YS.Utils.forEach(b.fieldLimit, function (a, b) {
                var e = d[b];
                e && e.departmentId && (c.limitMap[e.departmentId] = !0)
            })
        }, _createMemberMenu: function () {
            var b = this, c = this.options, node = null;
            if (!this._isRelyLimitEmpty()){
                var _url = getFlowConf().flowPath + '/common/ajaxListOrgTree';
                $.ajax({
                    url: _url,
                    data: {},
                    async: true,
                    dataType: 'JSON',
                    success: function (d) {
                        b.memberTree = new YS.Tree({
                            renderEl: a("<div/>").appendTo(b.$memberMenu),
                            Nodes: d.data,
                            setting: {
                                view: {expandSpeed: 100},
                                data: {simpleData: {fieldEnable: true, idKey: "id", pIdKey: "pId", rootPId: 0}, key: {name: 'text', title: 'text'}},
                                callback: {
                                    onNodeCreated: function (e, f) {
                                        f.isParent && !f.open && f.level < 1 && this.expandNode(f, !0)
                                    }, onClick: function (g, h) {
                                        if (h.text != c.rootText) {
                                            b.currentCompany = h.companyId, b.currentDepartment = h.id
                                        }else{
                                            b.currentCompany = null, b.currentDepartment = null
                                        }
                                        b._createMemberList()
                                    }
                                }
                            }
                        });
                        try{
                            b.currentCompany = b.currentCompany?b.currentCompany:(baseForm.applyCompanyId?baseForm.applyCompanyId:'');
                            b.currentDepartment = b.currentDepartment?b.currentDepartment:(baseForm.applyCompanyId?baseForm.applyDeptId:'');
                        }catch(e){}

                        if (b.currentCompany && b.currentDepartment) {
                            node = b.memberTree.getNodeByParam("id", b.currentDepartment, null);
                        } else {
                            node = b.memberTree.getNodeByParam("text", c.rootText, null);
                        }
                        b.memberTree.selectNode(node);
                        b.memberTree.expandNode(node, true);
                    }
                });
            }
        }, _createMemberList: function (b) {
            var c = this, d = this.options;
            this.$memberList ? this.$memberList.show() : this.$memberList = a('<ul class="select-member"/>').appendTo(this.$selectPane), this._isRelyLimitEmpty() || (c.memberList = [], b ? (c.$memberList.empty(), this._createMemberItem(b))
                :this._loadMemberListData({deptId: c._getDepartmentId(),companyId: c._getCompanyId()}))
        },
        _loadMemberListData:function(params){
            var c = this, d = this.options;
            $.ajax({
                url: getFlowConf().flowPath + '/common/ajaxListPersonForFormItem',
                data: params,
                dataType:"json",
                success: function (dt) {
                    c.$memberList.empty();
                    if(dt.code == '100'){
                        (dt.data&&dt.data.length>0)?(YS.Utils.forEach(dt.data, function (e, f) {
                            f['no']=f.userId,f['name']=f.userName;
                            c._createMemberItem(f)
                        })):c._createEmptyItem();
                    }else{
                        YS.Msg.toast({
                            type: "error",
                            msg: dt.msg
                        });
                    }
                },error:function(){
                    YS.Msg.toast({
                        type: "error",
                        msg: '网络异常，请稍后重试！'
                    });
                }
            });
        },
        _createEmptyItem:function(){
            var d = a("<li style='text-align: center;' />").append(a("<span class='member-name' />").text('暂无数据！')).appendTo(this.$memberList);
        },
        _createMemberItem: function (b) {//<i class="icon icon-woman"></i>
            // 拼接性别.append(a("<span class='icon icon-woman member-sex' />"))
            var d = a("<li/>").append(a("<span class='member-name' />").text(b.userName)).append(a("<span class='member-no' />").text(b.userId)).append(a("<span class='member-dept' />").text(b.deptName)).append(a('<div class="select-btn x-radio"/>').append(a('<i class="icon-blank"/>'))).appendTo(this.$memberList).data("user", b);
            this.value === b.userId && d.addClass("select")
        }, _bindMemberEvent: function () {
            var b = this;
            this.options;
            this.$memberList.bind("click", function (c) {
                var d = a(c.target).closest("li"), e = d.children(".select-btn");
                if (d.length > 0 && e.length > 0)if (d.hasClass("select"))d.removeClass("select"), b._clearSelectItem(); else {
                    a(".select", b.$memberList).removeClass("select"), d.addClass("select");
                    var f = d.data("user");
                    b._setSelectItem(f)
                }
            })
        }, _createCurrentUserList: function () {
            var b = this, c = this.options;
            if (this.$selectPane.children().hide(), this.$currentUserList ? this.$currentUserList.empty().show() : this.$currentUserList = a('<ul class="select-dynamic"/>').appendTo(this.$selectPane), !this._isRelyLimitEmpty() && YS.STATIC.user) {
                var d = {
                    no: YS.STATIC.user._id,
                    name: YS.STATIC.user.nickname
                }, e = a("<li/>").append(a("<span/>").text(d.name)).append(a('<div class="select-btn x-radio"/>').append(a('<i class="icon-blank"/>'))).appendTo(b.$currentUserList).data("user", d).click(function () {
                    var c = e.children(".select-btn");
                    if (c.hasClass("select"))c.removeClass("select"), b._clearSelectItem(); else {
                        a(".select", b.$currentUserList).removeClass("select"), c.addClass("select");
                        var d = e.data("user");
                        b._setSelectItem(d)
                    }
                });
                b.value === d.no ? e.children(".select-btn").addClass("select") : (e.children(".select-btn").addClass("select"), b._setSelectItem(item))
            }
        }, _createDynamicList: function () {
            var b = this;
        }, _createSearchList: function (b) {
            if (!this._isRelyLimitEmpty()) {
                this._loadMemberListData({keyWord: b});
            }
        }, _getDepartmentId: function () {
            try{
                return this.currentDepartment?this.currentDepartment:(baseForm&&baseForm.applyDeptId?baseForm.applyDeptId:'');
            }catch(e){
                return '';
            }
        }, _getCompanyId: function(){
            try{
                return this.currentCompany?this.currentCompany:(baseForm&&baseForm.applyCompanyId?baseForm.applyCompanyId:'');
            }catch(e){
                return '';
            }
        }, getItems: function () {
            var b = [];
            return a(".select-item", this.$selectList).each(function (c, d) {
                b.push(a(d).data("item"))
            }), b
        }, setValue: function (a) {
            this.value = a, this.options.value = a, this._initData()
        }, getValue: function () {
            return this.value
        }, getText: function () {
            var a = this.value;
            if(!isNaN(a)){
                return a && $('#'+a)[0] ? $('#'+a).text() : ""
            }else{
                return ""
            }
        }, _refreshUserList: function (b) {
            var c = this;
            a("li", b).each(function (b, d) {
                var e = a(d).data("user");
                e && (c.value === e.no ? a(d).children(".select-btn").addClass("select") : a(d).children(".select-btn").removeClass("select"))
            })
        }, refresh: function () {
            this.$memberList && this._refreshUserList(this.$memberList), this.$dynamicList && this._refreshUserList(this.$dynamicList), this.$currentUserList && this._refreshUserList(this.$currentUserList)
        }, checkValidate: function () {
            if (YS.STATIC.FTOKEN)return this.setInvalidateType("fieldRegexl"), !1;
            var a = this.options;
            return !YS.Utils.isEmpty(this.getValue()) || a.fieldIsnull
        }, rebuild: function (a) {
            this.value = a, this._initData(), this.refresh()
        }, getOptions: function () {
            var b = this.options;
            return a.extend(YS.User.superclass.getOptions.apply(this, arguments), {
                fieldLimit: b.fieldLimit,
                fieldType: b.fieldType,
                fieldLength: b.fieldLength
                // ,assignmentUrl: b.assignmentUrl
            })
        }
    }), a.shortcut("user", YS.User)
}(jQuery), function (a) {
    YS.UserMsg = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.UserMsg.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_user",
                title: "选择人员",
                msg: "点击设置成员",
                rootText: "YASHA",
                width: 200,
                height: 32,
                fieldType: "varchar",
                fieldLength: 128,
                assignmentUrl: getFlowConf().flowPath+"/common/ajaxListPersonByNos",
                value: null,
                fieldIsnull: !0,
                editable: !1,
                count: 100,
                linkWidgets: [],
                dynamicType: "select",
                onStopEdit: null,
                onBeforeEdit: null
            })
        }, _init: function () {
            YS.UserMsg.superclass._init.apply(this, arguments), this._initSelectPane()
        }, _initData: function () {
            var a = this.options, b = this, _this = this;
            this.items = [];
            if(a.value){
                if(a.value && !a.fieldDefaultValueName){
                    $.ajax({async:true, data:{nos:a.value}, url:a.assignmentUrl, type:'POST', success:function(dt){
                        dt = dt.data;
                        a.fieldDefaultValueName = dt[0].name;
                        b.value = a.value, _this.items.push({no: a.value, name: a.fieldDefaultValueName ? a.fieldDefaultValueName : b.getText()})
                        _this._initSelectPane();
                    }});
                }
                if(a.value){
                    b.value = a.value, _this.items.push({no: a.value, name: a.fieldDefaultValueName ? a.fieldDefaultValueName : b.getText()})
                    _this._initSelectPane();
                }
            }
        }, _initSelectPane: function () {
            var b = this, c = this.options;
            this.selectMap = {}, YS.Utils.forEach(this.items, function (a, c) {
                b.selectMap[c.no] = c
            }), b._createSelectList(), c.editable ? this._createSelectPane() : this._bindEditEvent()
        }, _bindEditEvent: function () {
            var a = this, b = this.options;
            this.$selectBtn.unbind("click"), this.$selectBtn.bind("click", function () {
                if (a.isEnabled()) {
                    YS.Utils.applyFunc(a, b.onBeforeEdit, [], !1);
                    var c = new YS.ConfirmDialog({
                        title: b.title,
                        height: 600,
                        width: 800,
                        contentWidget: {
                            rowSize: [500],
                            colSize: [800],
                            items: [[{
                                fieldId: b.fieldId,
                                type: b.type,
                                editable: !0,
                                fieldLimit: b.fieldLimit,
                                limitWidget: b.limitWidget,
                                items: a.items,
                                value: a.value
                            }]]
                        },
                        onOk: function () {
                            var d = c.getWidgetByName(b.fieldId);
                            a.value = d.getValue(), a.items = d.getItems(), a._initSelectPane(), YS.Utils.applyFunc(a, b.onStopEdit, [], !1);
                            b.linkWidgets.length>0 && $.ajax({
                                url: getFlowConf().flowPath + '/common/getMorePersonInfo?no='+a.value,
                                dataType: "JSON",
                                success: function(data){
                                    if(data.code == 100){
                                        var detail = data.data;
                                        //亚厦职级字段在流程中心为levelCode,在数据库是positionName，现取值是从positionName取值
                                        detail.levelCode = detail.positionName;
                                        $.each(b.linkWidgets, function(i, widget){
                                            widget.setValue(detail[widget.options.fieldName] || "");
                                        });
                                    }
                                },
                                error: function (data) {
                                    // YS.Msg.toast({
                                    //     type: "warning",
                                    //     msg: data.msg?data.msg:"操作失败"
                                    // })
                                }
                            });
                            return false;
                        }
                    });
                    c.show()
                }
            });
		},
        _createSelectList: function () {
			var b = this, c = this.options;
			this.$selectList ? this.$selectList.empty() : this.$selectList = a('<ul class="select-list" onmouseover="this.title=this.textContent|| this.innerText" />').appendTo(this.element);
			this.$selectBtn = $("<i />").addClass("btn-icon").appendTo(this.$selectList);
			if (this.value) {
				var d = b.selectMap[this.value];
				b._createSelectItem(d)
			}// else c.editable || this.$selectList.append(a('<div class="select-empty"/>').text(c.msg))
		},
        _setSelectItem: function (a) {
			this.$selectList.empty(), this._createSelectItem(a), this.value = a.no, this.selectMap[a.no] = a
		},
        _clearSelectItem: function () {
			this.$selectList.empty(), this.value = null
		},
        _createSelectItem: function (b) {
			var c = this.options, d = this;
			if (b) {
				var e = a('<li class="select-item"/>').append(a("<span/>").text(b.name)).appendTo(this.$selectList).attr("id", b.no).data("item", b);
				c.editable && a('<span class="remove-btn"/>').click(function () {
					d._clearSelectItem(), d.refresh()
				}).appendTo(e)
			}
		},
        getWidgetByName: function(a){
			var b = this, c = this.options, d = b.element.closest("ul").find("li.widget-view"), h;
			$.each(d, function(e, f){
				var g = $(f).data("widget");
				if(g && g.options.fieldName == a){
					h = g;return;
				}
			});
			return h
		},
        _createSelectPane: function () {
            if (!this.$selectPane) {
                this.element.empty();
                var b = this.options, c = this, d = a('<table style="width:100%;height:100%" />').appendTo(this.element);
                this.$searchPane = a('<thead><tr class="name-list-nav" style="height:44px"><th colspan="3"></th><th><form class="jsSearchForm"><div class="name-search-box"><input type="text" id="searchInput" name="keyword" placeholder="输入部门/姓名"/><i class="jsSearchBtn icon-search"></i></div></form></th></tr></thead>').appendTo(d);
                a('<tbody><tr><td width="30%" colspan="2"><div class="left-tree" style="height: '+(b.height-84)+'px"></div></td><td class="person-list" width="70%" colspan="2"></td></tr></tbody>').appendTo(d);
                this.$memberMenu = $('<ul id="orgTree" class="ztree"></ul>').appendTo(a('.left-tree'));
                this.$selectPane = a('<div id="personMsgList" class="select-menu list-htable" style="height: '+(b.height-84)+'px"></div>').appendTo(a('.person-list'));
                var south = $('<tr class="ipt-box" style="height:40px"><td colspan="4" class="selected"></td></tr>').appendTo(d);
                this.$selectList = a('<div class="selected-box" />').appendTo(south.find('.selected'));
                this._createMemberMenu(), this._createMemberList(), this._bindMemberEvent()
                a('.jsSearchBtn').bind('click',function(){
                    var key = a('#searchInput').val();
                    $.trim(key)&&c._createSearchList(key);
                });
                a("#searchInput").keydown(function (b) {
                    if(13 === b.keyCode){
                        $.trim(a(this).val())&&c._createSearchList(a(this).val());
                        return false
                    }
                })
            }

        },
        _isRelyLimitEmpty: function () {
            var a = this.options;
            return YS.Utils.isObjectEmpty(a.fieldLimit) && !YS.Utils.isObjectEmpty(a.limitWidget)
        },
        _initLimitMap: function (a) {
            var b = this.options, c = this, d = {};
            YS.Utils.forEach(a, function (a, b) {
                d[b._id] = b
            }), this.limitMap = {}, YS.Utils.forEach(b.fieldLimit, function (a, b) {
                var e = d[b];
                e && e.departmentId && (c.limitMap[e.departmentId] = !0)
            })
        },
        _createMemberItem: function (b) {
            var d = a("<li/>").append(a("<span/>").text(b.name)).append(a('<div class="select-btn x-radio"/>').append(a('<i class="icon-blank"/>'))).appendTo(this.$memberList).data("user", b);
            this.value === b.no && d.children(".select-btn").addClass("select")
        },
        _createCurrentUserList: function () {
            var b = this, c = this.options;
            if (this.$selectPane.children().hide(), this.$currentUserList ? this.$currentUserList.empty().show() : this.$currentUserList = a('<ul class="select-dynamic"/>').appendTo(this.$selectPane), !this._isRelyLimitEmpty() && YS.STATIC.user) {
                var d = {
                    no: YS.STATIC.user._id,
                    name: YS.STATIC.user.nickname
                }, e = a("<li/>").append(a("<span/>").text(d.name)).append(a('<div class="select-btn x-radio"/>').append(a('<i class="icon-blank"/>'))).appendTo(b.$currentUserList).data("user", d).click(function () {
                    var c = e.children(".select-btn");
                    if (c.hasClass("select"))c.removeClass("select"), b._clearSelectItem(); else {
                        a(".select", b.$currentUserList).removeClass("select"), c.addClass("select");
                        var d = e.data("user");
                        b._setSelectItem(d)
                    }
                });
                b.value === d.no ? e.children(".select-btn").addClass("select") : (e.children(".select-btn").addClass("select"), b._setSelectItem(item))
            }
        },
        _createDynamicList: function () {
            var b = this;
        }, _getDepartmentId: function () {
            return this.currentDepartment
        }, _getCompanyId: function(){
            return this.currentCompany
        },
        _createMemberMenu: function () {
            var b = this, c = this.options, node = null;
            if (!this._isRelyLimitEmpty()){
                var _url = getFlowConf().flowPath + '/common/ajaxListOrgTree';
                $.ajax({
                    url: _url,
                    data: {},
                    async: true,
                    dataType: 'JSON',
                    success: function (d) {
                        b.memberTree = new YS.Tree({
                            renderEl: a("<div/>").appendTo(b.$memberMenu),
                            Nodes: d.data,
                            setting: {
                                view: {expandSpeed: 100},
                                data: {simpleData: {fieldEnable: true, idKey: "id", pIdKey: "pId", rootPId: 0}, key: {name: 'text', title: 'text'}},
                                callback: {
                                    onNodeCreated: function (e, f) {
                                        f.isParent && !f.open && f.level < 1 && this.expandNode(f, !0)
                                    }, onClick: function (g, h) {
                                        if (h.text != c.rootText) {
                                            b.currentCompany = h.companyId, b.currentDepartment = h.id
                                        }else{
                                            b.currentCompany = null, b.currentDepartment = null
                                        }
                                        b._createMemberList()
                                    }
                                }
                            }
                        });
                        try{
                            b.currentCompany = b.currentCompany?b.currentCompany:(baseForm.applyCompanyId?baseForm.applyCompanyId:'');
                            b.currentDepartment = b.currentDepartment?b.currentDepartment:(baseForm.applyCompanyId?baseForm.applyDeptId:'');
                        }catch(e){

                        }
                        if (b.currentCompany && b.currentDepartment) {
                            node = b.memberTree.getNodeByParam("id", b.currentDepartment, null);
                        } else {
                            node = b.memberTree.getNodeByParam("text", c.rootText, null);
                        }
                        b.memberTree.selectNode(node);
                        b.memberTree.expandNode(node, true);
                    }
                });
            }
        },
        _createMemberList: function (b) {
            var c = this, d = this.options;
            this.$memberList ? this.$memberList.show() : this.$memberList = a('<ul class="select-member"/>').appendTo(this.$selectPane), this._isRelyLimitEmpty() || (c.memberList = [], b ? (c.$memberList.empty(), this._createMemberItem(b))
                : this._loadMemberListData({deptId: c._getDepartmentId(),companyId: c._getCompanyId()}))
        },
        _createEmptyItem:function(){
            var d = a("<li style='text-align: center;' />").append(a("<span class='member-name' />").text('暂无数据！')).appendTo(this.$memberList);
        },
        _createMemberItem: function (b) {//<i class="icon icon-woman"></i>
            // 拼接性别.append(a("<span class='icon icon-woman member-sex' />"))
            var d = a("<li/>").append(a("<span class='member-name' />").text(b.name)).append(a("<span class='member-no' />").text(b.no)).append(a("<span class='member-dept' />").text(b.deptName)).append(a('<div class="select-btn x-radio"/>').append(a('<i class="icon-blank"/>'))).appendTo(this.$memberList).data("user", b);
            this.value === b.no && d.addClass("select")
        }, _bindMemberEvent: function () {
            var b = this;
            this.options;
            this.$memberList.bind("click", function (c) {
                var d = a(c.target).closest("li"), e = d.children(".select-btn");
                if (d.length > 0 && e.length > 0)if (d.hasClass("select"))d.removeClass("select"), b._clearSelectItem(); else {
                    a(".select", b.$memberList).removeClass("select"), d.addClass("select");
                    var f = d.data("user");
                    b._setSelectItem(f)
                }
            })
        },
        _createCurrentUserList: function () {
            var b = this, c = this.options;
            if (this.$selectPane.children().hide(), this.$currentUserList ? this.$currentUserList.empty().show() : this.$currentUserList = a('<ul class="select-dynamic"/>').appendTo(this.$selectPane), !this._isRelyLimitEmpty() && YS.STATIC.user) {
                var d = {
                    no: YS.STATIC.user._id,
                    name: YS.STATIC.user.nickname
                }, e = a("<li/>").append(a("<span/>").text(d.name)).append(a('<div class="select-btn x-radio"/>').append(a('<i class="icon-blank"/>'))).appendTo(b.$currentUserList).data("user", d).click(function () {
                    var c = e.children(".select-btn");
                    if (c.hasClass("select"))c.removeClass("select"), b._clearSelectItem(); else {
                        a(".select", b.$currentUserList).removeClass("select"), c.addClass("select");
                        var d = e.data("user");
                        b._setSelectItem(d)
                    }
                });
                b.value === d.no ? e.children(".select-btn").addClass("select") : (e.children(".select-btn").addClass("select"), b._setSelectItem(item))
            }
        },
        _createDynamicList: function () {
            var b = this;
        },
        _createSearchList: function (b) {
            if (!this._isRelyLimitEmpty()) {
                this._loadMemberListData({keyWord: b});
            }
        },
        _loadMemberListData:function(params){
            var c = this, d = this.options;
            $.ajax({
                url: getFlowConf().flowPath + '/common/ajaxListPersonForFormItem',
                data: params,
                dataType:"json",
                success: function (dt) {
                    c.$memberList.empty();
                    if(dt.code == '100'){
                        (dt.data&&dt.data.length>0)?(YS.Utils.forEach(dt.data, function (e, f) {
                            f['no']=f.userId,f['name']=f.userName;
                            c._createMemberItem(f)
                        })):c._createEmptyItem();
                    }else{
                        YS.Msg.toast({
                            type: "error",
                            msg: dt.msg
                        });
                    }
                },error:function(){
                    YS.Msg.toast({
                        type: "error",
                        msg: '网络异常，请稍后重试！'
                    });
                }
            });
        },
        _getDepartmentId: function () {
            try{
                return this.currentDepartment?this.currentDepartment:(baseForm.applyDeptId?baseForm.applyDeptId:'');
            }catch(e){
                return '';
            }
        }, _getCompanyId: function(){
            try{
                return this.currentCompany?this.currentCompany:(baseForm.applyCompanyId?baseForm.applyCompanyId:'');
            }catch(e){
                return '';
            }
        }, getItems: function () {
            var b = [];
            return a(".select-item", this.$selectList).each(function (c, d) {
                b.push(a(d).data("item"))
            }), b
        },
        setValue: function (a) {
            this.value = a, this.options.value = a, this._initData()
        },
        getValue: function () {
            return this.value
        },
        getText: function () {
            var a = this.value;
            if(!isNaN(a)){
                return a && $('#'+a)[0] ? $('#'+a).text() : ""
            }else{
                return ""
            }
        }, _refreshUserList: function (b) {
            var c = this;
            a("li", b).each(function (b, d) {
                var e = a(d).data("user");
                e && (c.value === e.no ? a(d).children(".select-btn").addClass("select") : a(d).children(".select-btn").removeClass("select"))
            })
        },
        refresh: function () {
            this.$memberList && this._refreshUserList(this.$memberList), this.$dynamicList && this._refreshUserList(this.$dynamicList), this.$currentUserList && this._refreshUserList(this.$currentUserList)
        },
        checkValidate: function () {
            if (YS.STATIC.FTOKEN)return this.setInvalidateType("fieldRegexl"), !1;
            var a = this.options;
            return !YS.Utils.isEmpty(this.getValue()) || a.fieldIsnull
        },
        rebuild: function (a) {
            this.value = a, this._initData(), this.refresh()
        },
        getOptions: function () {
            var b = this.options;
            return a.extend(YS.UserMsg.superclass.getOptions.apply(this, arguments), {
                fieldLimit: b.fieldLimit,
                linkWidgets: b.linkWidgets,
                fieldType: b.fieldType,
                fieldLength: b.fieldLength
                // ,assignmentUrl: b.assignmentUrl
            })
        }
	}), a.shortcut("usermsg", YS.UserMsg)
}(jQuery),function(a) {
    YS.ProjectMsg = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.ProjectMsg.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_user fui_proj",
                title: "项目信息",
                msg: "项目信息",
                width: 200,
                height: 32,
                fieldType: "varchar",
                fieldLength: 128,
                ajaxurl: "",
                value: null,
                fieldIsnull: !0,
                editable: !1,
                count: 100,
                linkWidgets: [],
                onStopEdit: null,
                onBeforeEdit: null,
                itemLinkeds: [],
                items: [],
                fields: [{name:"isFormShow",text:"表单可见性"}],
                currentItem: ""
            })
        },
        _init: function () {
            YS.ProjectMsg.superclass._init.apply(this, arguments), this._initData(),this._initSelectPane();
        },
        _initData: function () {
            var a = this.options, b = this, _this = this;
            this.items = [];
            if(a.value){
                if(a.value && !a.fieldDefaultValueName){
                    $.ajax({
                        type:'GET',
                        data:{projectId:a.value},
                        url:getFlowConf().flowPath + '/common/getMoreProjectInfo',
                        dataType:'json',
                        success:function(dt){
                            if(dt.code == 100){
                                a.fieldDefaultValueName = dt.data.code;
                                b.value = a.value, _this.items.push({id: dt.data.id,proCode: a.fieldDefaultValueName ? a.fieldDefaultValueName : null})
                                _this._initSelectPane();
                            }
                        },
                        error:function(dt){
                            YS.Msg.toast({
                                type: "warning",
                                msg: dt.msg?data.msg:"操作失败"
                            })
                        }
                    });
                }
                if(a.value){
                    b.value = a.value, b.items.push({id: a.value, proCode: a.fieldDefaultValueName ? a.fieldDefaultValueName : b.getText()})
                    b._initSelectPane();
                }
            }
        },
        _initSelectPane: function () {
            var b = this, c = this.options;
            this.selectMap = {}, YS.Utils.forEach(this.items, function (a, c) {
                b.selectMap[c.id] = c
            }), b._createSelectList(), this._bindEditEvent();

        },
        _bindEditEvent: function () {
            var a = this, b = this.options;
            this.$selectBtn.unbind("click"), this.$selectBtn.bind("click", function () {
                if (a.isEnabled()) {
                    YS.Utils.applyFunc(a, b.onBeforeEdit, [], !1);
                    var c = new YS.ConfirmDialog({
                        title: "项目选择",
                        height: 530,
                        width: 700,
                        contentWidget: {
                            // rowSize: [30,320,50],
                            rowSize: [30,300],
                            colSize: [490,80],
                            hgap: 8,
                            vgap: 49,
                            padding:10,
                            items: [
                                [   {
                                    type: "text",
                                    text: "",
                                    placeholder:"",
                                    waterMark: "请输入项目编码或项目名称",
                                    value:"",
                                    width: 490,
                                    onAfterEdit: function () {
                                        // var i = c.getWidgetByName('textPane').getText();
                                        // var tb = c.getWidgetByName('projectbistable');
                                        // tb._initTableData(i,1,10,true);
                                    },
                                    height:32,
                                    fieldId: "textPane",
                                     },
                                    {
                                        type: "button",
                                        fieldId: "bistable",
                                        onClick: function () {
                                            var i = c.getWidgetByName('textPane').getText();
                                            var tb = c.getWidgetByName('projectbistable');
                                            tb._initTableData(i,1,10,true);
                                        },
                                        text: "查询",
                                        style: "blue",
                                        width: 80,
                                        height: 32
                                    }],
                                [{
                                    type: "projectbistable",
                                    width: "100%",
                                    visiableWidgetName: b.fieldName,
                                    labelName:b.labelName,
                                    conpanyName: "nuqiang",
                                    ajaxurl: b.ajaxurl,
                                    fieldId: "projectbistable",
                                    hasCheck: !0
                                }]
                            ]
                        },
                        onOk: function () {
                            // var d = c.getWidgetByName("projectbistable");
                            // d.fields && (a.fields = d.fields);
                            // return a.value = d.getValue(), a._initSelectPane(), YS.Utils.applyFunc(a, b.onStopEdit, [], !1), !1

                            var d = c.getWidgetByName("projectbistable");
                            var projetInfo = d.getValue();
                            projetInfo.proCode=projetInfo.code;
                            if(projetInfo){
                                a.value = projetInfo.id,a._setSelectItem(projetInfo), a.items = d.getItems(),a._initSelectPane(), YS.Utils.applyFunc(a, b.onStopEdit, [], !1);
                                b.linkWidgets.length>0 && $.ajax({
                                    type: "GET",
                                    data: {projectId:projetInfo.id},
                                    dataType: "json",
                                    url: getFlowConf().flowPath + '/common/getMoreProjectInfo',
                                    success: function(data){
                                        if(data.code == 100){

                                            if(data.data.company == "0001K310000000000ABV"){
                                                data.data.zscode = data.data.code;
                                                data.data.zsprojectName = data.data.projectName;
                                                data.data.zsprojectNature = data.data.projectNature;
                                                data.data.zsdepartment = data.data.department;
                                                data.data.zsmainManager = data.data.mainManager;
                                                data.data.zsvicePromanager = data.data.vicePromanager;
                                                data.data.zssecuritor = data.data.securitor;
                                                data.data.zsbuildPerson = data.data.buildPerson;
                                                data.data.zsmaterial = data.data.material;
                                                data.data.zsproductor = data.data.productor;
                                                data.data.zsworker = data.data.worker;
                                                data.data.zsqualitor = data.data.qualitor;
                                                data.data.zsdator = data.data.dator;
                                                data.data.zsmaterialManager = data.data.materialManager;
                                                data.data.zsmanagerCentertwo = data.data.managerCentertwo;
                                                data.data.zsworkCentermanager = data.data.workCentermanager;
                                                data.data.zssupplierManager = data.data.supplierManager; //dsadsa
                                                data.data.zsproLeader = data.data.proLeader;
                                                data.data.zsfinanceController = data.data.financeController;
                                                data.data.zsfinaceManager = data.data.finaceManager;
                                                data.data.zsaccountor = data.data.accountor;
                                                data.data.zsaccountManager = data.data.accountManager;
                                                data.data.zswareHouse = data.data.wareHouse;
                                                data.data.zsmtrlPerson = data.data.mtrlPerson;
                                                data.data.zsplanner = data.data.planner;
                                                data.data.zsdeepeningDesigner = data.data.deepeningDesigner;
                                                data.data.zstechnicalDirector = data.data.technicalDirector;
                                                data.data.zsplanDept = data.data.planDept;
                                                data.data.zsplanningManager = data.data.planningManager;

                                            }else if(data.data.company == "0001K310000000000F91"){
                                                data.data.mqcode = data.data.code;
                                                data.data.mqprojectName = data.data.projectName;
                                                data.data.mqprojectNature = data.data.projectNature;
                                                data.data.mqdepartment = data.data.department;
                                                data.data.mqsecuritor = data.data.securitor;
                                                data.data.mqmaterial = data.data.material;
                                                data.data.mqproductor = data.data.productor;
                                                data.data.mqmainManager = data.data.mainManager;
                                                data.data.mqworker = data.data.worker;
                                                data.data.mqqualitor = data.data.qualitor;
                                                data.data.mqdator = data.data.dator;
                                                data.data.mqdesigner = data.data.designer;
                                                data.data.mqmainDesigner = data.data.mainDesigner;
                                                data.data.mqaccountor = data.data.accountor;
                                                data.data.mqdesignerManager = data.data.designerManager;
                                                data.data.mqfinalist = data.data.finalist;
                                                data.data.mqtechnicalDirector = data.data.technicalDirector;
                                                data.data.mqplanner = data.data.planner;
                                                data.data.mqprocessingSupervisor = data.data.processingSupervisor;
                                                data.data.mqpurchaseManage = data.data.purchaseManage;
                                                data.data.mqsettlementOfficer = data.data.settlementOfficer;
                                                data.data.mqhrCommissioner = data.data.hrCommissioner;
                                                data.data.mqworkCentermanager = data.data.workCentermanager;
                                                data.data.mqcoordinator = data.data.coordinator;
                                            }
                                            var detail = data.data;
                                            $.each(b.linkWidgets, function(i, widget){
                                                var name = widget.options.fieldName;
                                                if(name){name=name.slice(2)+"Name" };
                                                widget.options.fieldDefaultValueName = detail[name] || "";
                                                widget.setValue(detail[widget.options.fieldName] || "");
                                            });
                                        }
                                    },
                                    error: function (data) {
                                        YS.Msg.toast({
                                            type: "warning",
                                            msg: data.msg?data.msg:"操作失败"
                                        })
                                    }
                                });
                            }

                            return false;
                        }
                    });
                    c.show()
                }
            });
        },
        _createSelectList: function () {
            var b = this, c = this.options;
            this.$selectList ? this.$selectList.empty() : this.$selectList = a('<ul class="select-list" onmouseover="this.title=this.textContent|| this.innerText" />').appendTo(this.element);
            this.$selectBtn = $("<i />").addClass("btn-icon").appendTo(this.$selectList);
            if (this.value) {
                var d = b.selectMap[this.value];
                b._createSelectItem(d)
            }// else c.editable || this.$selectList.append(a('<div class="select-empty"/>').text(c.msg))
        },
        _setSelectItem: function (a) {
            this.$selectList.empty(), this._createSelectItem(a), this.value = a.id, this.selectMap[a.id] = a
        },
        _clearSelectItem: function () {
            this.$selectList.empty(), this.value = null
        },
        _createSelectItem: function (b) {
            var c = this.options, d = this;
            if (b) {
                var e = a('<li class="select-item"/>').append(a("<span/>").text(b.proCode)).appendTo(this.$selectList).attr("id", b.id).data("item", b);
                c.editable && a('<span class="remove-btn"/>').click(function () {
                    d._clearSelectItem(), d.refresh()
                }).appendTo(e)
            }
        },
        getWidgetByName: function(a){
            var b = this, c = this.options, d = b.element.closest("ul").find("li.widget-view"), h;
            $.each(d, function(e, f){
                var g = $(f).data("widget");
                if(g && g.options.fieldName == a){
                    h = g;return;
                }
            });
            return h
        },
        getItems: function () {
            var b = [];
            return a(".select-item", this.$selectList).each(function (c, d) {
                b.push(a(d).data("item"))
            }), b
        },
        setValue: function (a) {
            this.value = a, this._initData()
        },
        getValue: function () {
            return this.value
        },
        getText: function () {
            var a = this.value;
            return a && $('#'+a)[0] ? $('#'+a).text() : ""
        },
        refresh: function () {
            this.$memberList && this._refreshUserList(this.$memberList)
        },
        checkValidate: function () {
            if (YS.STATIC.FTOKEN)return this.setInvalidateType("fieldRegexl"), !1;
            var a = this.options;
            return !YS.Utils.isEmpty(this.getValue()) || a.fieldIsnull
        },
        rebuild: function (a) {
            this.value = a, this._initData(), this.refresh()
        },
        getOptions: function () {
            var b = this.options;
            return a.extend(YS.ProjectMsg.superclass.getOptions.apply(this, arguments), {
                fieldType: b.fieldType,
                fieldLength: b.fieldLength,
                linkWidgets: b.linkWidgets
            })
        },
        getItems: function () {
            var b = [];
            return a(".select-item", this.$selectList).each(function (c, d) {
                b.push(a(d).data("item"))
            }), b
        },
        setValue: function (a) {
            this.value = a, this.options.value = a, this._initData()
        },
        getValue: function () {
            return this.value
        },
        getText: function () {
            var a = this.value;
            return a && $('#'+a)[0] ? $('#'+a).text() : ""
        },
        refresh: function () {
            this.$memberList && this._refreshUserList(this.$memberList), this.$dynamicList && this._refreshUserList(this.$dynamicList), this.$currentUserList && this._refreshUserList(this.$currentUserList)
        },
        checkValidate: function () {
            if (YS.STATIC.FTOKEN)return this.setInvalidateType("fieldRegexl"), !1;
            var a = this.options;
            return !YS.Utils.isEmpty(this.getValue()) || a.fieldIsnull
        },
        rebuild: function (a) {
            this.value = a, this._initData(), this.refresh()
        },
        getOptions: function () {
            var b = this.options;
            return a.extend(YS.ProjectMsg.superclass.getOptions.apply(this, arguments), {
                fieldLimit: b.fieldLimit,
                fieldType: b.fieldType,
                fieldLength: b.fieldLength
            })
        }
    }), a.shortcut("projectmsg", YS.ProjectMsg)
}(jQuery), function (e) {
    YS.Pagination = YS.extend(YS.Widget, {
        _defaultConfig: function() {
            return e.extend(YS.Button.superclass._defaultConfig.apply(), {
                baseCls: "x-pagination",
                limit: 10,
                count: 1,
                curPage: 1,
                maxCount: 0,
                hasMore: !1,
                onChangePage: null,
                hasTurnLast: !1
            })
        },
        _init: function() {
            YS.Pagination.superclass._init.apply(this, arguments);
            var t = this, i = this.options;
            this.curPage = i.curPage;
            var a = Math.ceil(i.count / i.limit) || 1
                , s = e('<div class="page-turn"/>').appendTo(this.element);
            t.$pre = e('<button class="page-btn pre" />').append('<i class="icon-angleleft" />').appendTo(s),
                t.$next = e('<button class="page-btn next" />').append('<i class="icon-angleright" />').appendTo(s);
            //选择pageSize开始
            var selectDiv = e('<div class="page-select-box" />').appendTo(this.element);
            // e('<span class="page-total"/>').text("每页10条,当前").appendTo(selectDiv);
            e('<span class="page-total"/>').text("每页").appendTo(selectDiv);
            var selectDom = e('<select class="page-select" />').appendTo(selectDiv);
            for(var j = 10;j<41;j+=10){
                if(j==i.limit){
                    e('<option value='+ j +' selected />').text(j).appendTo(selectDom);
                }else{
                    e('<option value='+ j +' />').text(j).appendTo(selectDom);
                }
            }
            e('<span class="page-total"/>').text("条,当前").appendTo(selectDiv);
            selectDom.bind("change", function(a) {
                var pageSize = Number($(selectDom).val())
                t._setLimit(pageSize);
            })
            //选择pageSize结束
            var n = e('<div class="page-jump" />').appendTo(this.element);
            t.$pageInput = new YS.Number({
                renderEl: e('<div class="page-input" />').keyup(function(t) {
                    (t.keyCode || t.which) === YS.Keys.ENTER && e(this).children(".x-input-focus").blur()
                }).appendTo(n),
                value: this.curPage,
                width: 30,
                onStopEdit: function(e) {
                    if (e) {
                        var s = this.getValue();
                        s < 1 || s > a ? this.setState(YS.States.ERROR) : (t.curPage = s,
                            YS.Utils.applyFunc(t, i.onChangePage, [t.curPage, i.limit], !1))
                    }
                }
            });
            var o = a;
            i.maxCount && i.count > i.maxCount && (o = Math.ceil(i.maxCount / i.limit) + "+"),
                e('<span class="total"/>').text(" / " + o + "页，  共" + i.count +"条").appendTo(n),
            i.hasTurnLast && (t.$first = e('<button class="page-btn first" />').append('<i class="icon-firstpage" />').prependTo(s),
                t.$last = e('<button class="page-btn last" />').append('<i class="icon-lastpage" />').appendTo(s)),
                t._checkTurnPage(),
                this._bindEvents()
        },
        _setLimit: function(val) {
            var t=this,i = this.options;
             i.limit = val;
             this.refresh();
             YS.Utils.applyFunc(t, i.onChangePage, [t.curPage, i.limit], !1);
        //

        },
        _getLimit: function() {
            var t=this,i = this.options;
            return i.limit
        },refresh: function () {
            this.element[0].innerHTML = "";
            this._init();
        },
        _bindEvents: function() {
            var t = this
                , i = this.options;
            e(this.element).unbind(".pagination"),
                e(this.element).bind("click.pagination", function(a) {
                    var s = a.target
                        , n = a.type
                        , o = e(s).closest(".page-btn");
                    if (o.length && "click" === n) {
                        if (o.hasClass("disabled"))
                            return;
                        o.hasClass("next") ? t.curPage += 1 : o.hasClass("pre") ? t.curPage -= 1 : o.hasClass("first") ? t.curPage = 1 : o.hasClass("last") && (t.curPage = Math.ceil(i.count / i.limit) || 1),
                            t.$pageInput.setValue(t.curPage),
                            t._checkTurnPage(),
                            YS.Utils.applyFunc(t, i.onChangePage, [t.curPage, i.limit], !1)
                    }

                })
        },
        _checkTurnPage: function() {
            var t = this
                , i = this.options
                , a = Math.ceil(i.count / i.limit) || 1;
            e(".page-btn", this.element).removeClass("disabled"),
            1 === t.curPage && (t.$pre.addClass("disabled"),
            t.$first && t.$first.addClass("disabled")),
            t.curPage >= a && !i.hasMore && (t.$next.addClass("disabled"),
            t.$last && t.$last.addClass("disabled"))
        }
    }), e.shortcut("pagination", YS.Pagination)
}(jQuery),function (a) {
    YS.ProjectTable = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.ProjectTable.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_project_tab",
                value: null,
                fieldIsnull: !0,
                onStopEdit: null,
                onBeforeEdit: null,
                itemLinkeds: [],
                // fields: [{name:"isTableShow",text:"列表可见性"},{name:"isFormShow",text:"表单可见性"}],
                fields: [{name:"isFormShow",text:"表单可见性"}],
            })
        },
        _init: function () {
            YS.ProjectTable.superclass._init.apply(this, arguments)
                ,this.idx = 0, this.valueMap = {}, this._createWidgetPane(),this.codeMap=[],this.nameMap=[],this.textMap=[];
        },
        _createWidgetPane: function () {
            var t = a('<div class="widget-pane"></div>').appendTo(this.element);
            this._createWidgetList(t)
        },
        _createWidgetList: function (t) {
            var i = this, a = this.options;
            this.$widgetList ? this.$widgetList.empty() : this._createWidgetsTableHead(t);
            YS.Utils.forEach(a.linkWidgets, function (e, t) {
                i._createWidget(t)
            })
        },
        _createWidgetsTableHead: function(t){
            var _a= this, b = this.options;
            var d = a('<table class="x-table x-table-bordered x-table-striped t-main t-table"/>').appendTo($('<div style="height:364px;overflow:auto;border:1px solid #e5e5e5" />').appendTo(t));
            var f = a('<thead class="x-block-head" />').appendTo(d);
            var c = a('<tr class="t-row th-row" />').appendTo(f);
            var th='';

            a('<th field="labelName" class="t-cell th-cell" />').text("字段说明").appendTo(c);
            $.each(b.fields, function(f, g){
                // <input class="checkAllTrue" type="checkbox">全选<input class="checkAllFalse" type="checkbox">全不选
                // var dom = '<p>'+ g.text +'</p>'+ ' <input class="checkAllTrue" type="checkbox"><span>全选</span>'
                // th = a('<th field="'+g.name+'" class="t-cell th-cell" />').html(dom).appendTo(c);
                var ipt = a('<input class="checkAllTrue" type="checkbox">').on('click', function(){
                    if(this.checked){
                        d.find('.t-body tr td:last-child').addClass("select").find("input").prop("checked", true);
                        _a.updateValue(t,true)
                    }else{
                        d.find('.t-body tr td:last-child').addClass("select").find("input").prop("checked", false);
                        _a.updateValue(t,false)
                    }

                });
                a('<th field="'+g.name+'" class="t-cell th-cell" />').append(a('<p/>').text(g.text)).append(ipt).appendTo(c);

            });
            this.$widgetList = $('<tbody class="t-body" />').appendTo(d);
        },
        _createWidget: function (t) {
            var _a = this, b = this.options;
            if(t.istitle){
                var i = a('<tr class="t-row tb-row tt-row"/>').append(a('<td class="t-cell td-cell " colspan="2" field="labelName"/>').text(t.text)).appendTo(this.$widgetList).data("name", t.value);
            }else{
                var i = a('<tr class="t-row tb-row"/>').append(a('<td class="t-cell td-cell" field="labelName"/>').text(t.text)).appendTo(this.$widgetList).data("name", t.value);
            }

            $.each(b.fields, function(c, d){
                // if(t.istitle){
                //     var f = a('<td class="t-cell td-cell"> ').attr("field",d.name).appendTo(i);
                // }else{
                //     var f = a('<td class="t-cell td-cell">').attr("field",d.name).append(a('<input type="checkbox">')).appendTo(i);
                // }
                if(!t.istitle){
                    var f = a('<td class="t-cell td-cell">').attr("field",d.name).append(a('<input type="checkbox">')).appendTo(i);
                    // if(t.isTableShow){
                    //     f.addClass("select").find("input").attr("checked",true);
                    // };
                    if(t.isFormShow||t.selected){
                        f.addClass("select").find("input").attr("checked",true);

                    };
                    f.on("click", function(i,index){
                        var _this = $(this), attr = $(this).attr("field"), n = $(this).find("input");
                        _this.hasClass("select") ? (_this.removeClass("select"), n.attr("checked",!1), _a.updateValue(t,false)) : (_this.addClass("select"), n.attr("checked",!0), _a.updateValue(t,true))

                    });
                }
            });
        },
        updateValue: function (t) {
            var i = [], _this = this;
            a("tr", this.$widgetList).each(function (index, tr) {
                var b = {}, n = a(tr).data("name"), c = a(tr).find("td"), isLink = false;
                if( a(tr).find("input:checked")[0]){
                    // $.each(c, function(d, f){
                    //     var atr = a(f).attr("field"), ck = a(f).find("input");
                    //     ck[0] && ck.attr("checked") && (b[a(f).attr("field")] = 1);
                    // });
                    _this.options.linkWidgets[index].isFormShow=true;
                }else{
                    _this.options.linkWidgets[index].isFormShow=false;
                }
                // if( a(tr).find("input:checked")[1]){
                //     _this.options.linkWidgets[index].isTableShow=true;
                // }else{
                //     _this.options.linkWidgets[index].isTableShow=false;
                // }
                $.isEmptyObject(b) || (b["toFieldId"] = n, b.value = a.idx, i.push(b));
            });
            // this.valueMap[this.idx] = i;
        },
        getCode: function () {
            _this = this;
            $.each(_this.options.linkWidgets,function(index, val){
                if(!val.istitle && val.isFormShow){
                    _this.codeMap.push({code:val.code,name:val.name,isCode:val.isCode,isPerson:val.isPerson});
                }
            });
            return _this.codeMap
        },
        getName: function () {
            _this = this;
            $.each(_this.options.linkWidgets,function(index, val){
                if(!val.istitle && val.isFormShow){
                    _this.nameMap.push(val.code);
                }
            });
            return _this.nameMap
        },
        getText: function () {
            _this = this;
            $.each(_this.options.linkWidgets,function(index, val){
                if(!val.istitle && val.isFormShow){
                    _this.textMap.push(val.text);
                }
            });
            return _this.textMap
        }
        // lalla  结束

    }), a.shortcut("projecttable", YS.ProjectTable)
}(jQuery), function (a) {
    YS.UserGroup = YS.extend(YS.User, {
        _defaultConfig: function () {
            return a.extend(YS.UserGroup.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_user_group ",
                title: "成员列表",
                msg: "点击设置成员",
                assignmentUrl: getFlowConf().flowPath+"/common/ajaxListPersonByNos",
                width: 200,
                height: 32,
                value: "",
                onStopEdit: null
            })
        }, _init: function () {
            this.value = "", YS.UserGroup.superclass._init.apply(this, arguments)
        }, _initData: function () {
            var a = this.options, b = this, c = a.value ? a.value.split(",") : [];
            this.items = [];
            if(a.value){
                if(a.value && !a.fieldDefaultValueName){
                    $.ajax({async:true, data:{nos:a.value}, url:a.assignmentUrl, type:'GET', success:function(dt){
                        dt=dt.data;
                        //a.fieldDefaultValueName = nms.join(',');
                        //var name = a.fieldDefaultValueName ? a.fieldDefaultValueName : b.getText();
                        b.value = a.value, $.each(c,function(d, e){
                            b.items.push({no: e, name: dt[d].name});
                        });
                        b._initSelectPane();
                    }});
                }
                if(a.value){
                    var name = a.fieldDefaultValueName ? a.fieldDefaultValueName : b.getText();
                    b.value = a.value, $.each(c,function(d, e){
                        b.items.push({no: e, name: name.split(",")[d]});
                    });
                    b._initSelectPane();
                }
            }
        }, _createSelectList: function () {
            var b = this, c = this.options, d = this.value ? this.value.split(","): [];
            this.$selectList ? this.$selectList.empty() : this.$selectList = a('<ul class="select-list"/>').appendTo(this.element);
            this.$selectList.mouseover(function(){
                var title = "", _this = $(this);
                a.each(_this.children('li'),function(idx, _li){
                    title += idx == 0 ? $(_li).text() : ('  ' + $(_li).text());
                });
                this.title = title;
            });
            this.$selectBtn = $("<i />").addClass("btn-icon").appendTo(this.$selectList);
            this.value && YS.Utils.forEach(d, function (a, c) {
                var e = b.selectMap[c];
                b._createSelectItem(e)
            });// : c.editable || this.$selectList.append(a('<div class="select-empty"/>').text(c.msg))
        }, _addSelectItem: function (a) {
            this.options;
            this._createSelectItem(a), this.value = this.getValue(), this.selectMap[a.no] = a
        }, _removeSelectItem: function (b) {
            this.options;
            a("#" + b.no, this.$selectList).remove(), this.value = this.getValue()
        }, _createSelectItem: function (b) {
            var c = this.options, d = this;
            if (b) {
                var e = a('<li class="select-item"/>').append(a("<span/>").text(b.name)).appendTo(this.$selectList).attr("id", b.no).data("item", b);
                c.editable && a('<span class="remove-btn"/>').click(function () {
                    d._removeSelectItem(b), d.refresh()
                }).appendTo(e)
            }
        }, _createMemberItem: function (b) {
            var c = {
                no: b.no,
                name: b.name
            }, d = a("<li/>").append(a("<span class='member-name'/>").text(c.name)).append(a("<i class='member-no' />").text(c.no)).append(a("<i class='member-dept' />").text(b.deptName)).append(a('<div class="select-btn"/>').append(a('<input type="checkbox"/>'))).appendTo(this.$memberList).data("user", c);
            this.value.indexOf(c.no) > -1 && d.children(".select-btn").addClass("select")
        }, _bindMemberEvent: function () {
            var b = this;
            this.options;
            this.$memberList.bind("click", function (c) {
                var d = a(c.target).closest("li"), e = d.children(".select-btn");
                if (d.length > 0 && e.length > 0) {
                    var f = d.data("user");
                    if(d.hasClass("select") || b.element.find('#'+f.no)[0]){
                        d.removeClass("select"), d.find('input').attr("checked",false), b._removeSelectItem(f)
                    }else{
                        d.addClass("select"), d.find("input").attr("checked",true), b._addSelectItem(f);
                    }
                }
            })
        }, _createCurrentUserList: function () {
        }, _createDynamicList: function () {
            var b = this;
        }, getItems: function () {
            var b = [];
            return a(".select-item", this.$selectList).each(function (c, d) {
                b.push(a(d).data("item"))
            }), b
        }, checkValidate: function () {
            if (YS.STATIC.FTOKEN)return this.setInvalidateType("fieldRegexl"), !1;
            var a = this.options;
            return !(!a.fieldIsnull && 0 === this.getValue().length)
        }, setValue: function (a) {
            this.value = a ? a : "", this.options.value = this.value, this._initData()
        }, getValue: function () {
            var b = (this.options, this.value);
            return this.$selectList && (b = "", a(".select-item", this.$selectList).each(function (c, d) {
                b += (c==0 ? a(d).attr("id") : (","+a(d).attr("id")));
            })), b
        }, getText: function () {
            var a = this, b = "", e = this.value ? this.value.split(",") : [];
            return YS.Utils.forEach(e, function (c, d) {
                if(d.indexOf("#") == -1 && $('#'+d)[0]){
                    b += (c==0 ? $('#'+d).text() : (","+$('#'+d).text()));
                }
            }), b
        }, getNullValue: function () {
            return ""
        }, _refreshUserList: function (b) {
            var c = this;
            a("li", b).each(function (b, d) {
                var e = a(d).data("user");
                e && (c.value.indexOf(e.no) > -1 ? a(d).children(".select-btn").addClass("select") : a(d).children(".select-btn").removeClass("select"))
            })
        }
    }), a.shortcut("usergroup", YS.UserGroup)
}(jQuery), function (a) {
    YS.Dept = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.Dept.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_dept",
                title: "部门列表",
                msg: "点击选择部门",
                width: 200,
                height: 32,
                value: null,
                fieldIsnull: !0,
                fieldType: "varchar",
                fieldLength: 128,
                assignmentUrl: getFlowConf().flowPath+"/common/ajaxListDeptByIds",
                editable: !1,
                count: 100,
                fieldLimit: [],
                dynamicType: "select",
                onStopEdit: null
            })
        }, _init: function () {
            YS.Dept.superclass._init.apply(this, arguments), this._initSelectPane()
        }, _initData: function () {
            var a = this.options, b = this, _this = this;
            this.items = [];
            if(a.value && !a.fieldDefaultValueName){
                var companyUrl = getFlowConf().flowPath+"/common/ajaxListCompanyByIds"
                $.ajax({async:true, data:{ids:a.value}, url:a.type=="company"?companyUrl:a.assignmentUrl, type:'POST', success:function(dt){
                    dt = dt.data;
                    if(dt&& dt[0]){
                        a.fieldDefaultValueName = a.type=="company"?dt[0].cname:dt[0].name;;
                        b.value = a.value, _this.items.push({id: a.value, text: a.fieldDefaultValueName ? a.fieldDefaultValueName : b.getText()})
                        _this._initSelectPane();
                    }
                }});
            }else{
                if(a.value){
                    b.value = a.value, this.items.push({id: a.value, text: a.fieldDefaultValueName ? a.fieldDefaultValueName : b.getText()})
                    this._initSelectPane();
                }
            }
        }, _initSelectPane: function () {
            var b = this, c = this.options;
            this.selectMap = {}, YS.Utils.forEach(b.items, function (a, c) {
                b.selectMap[c.id] = c
            }), b._createSelectList(), c.editable ? (this._createSelectPane(), this._bindSelectEvent()) : this._bindEditEvent()
        }, _bindEditEvent: function () {
            var a = this, b = this.options;
            this.$selectBtn.unbind("click"), this.$selectBtn.bind("click", function () {
                if (a.isEnabled()) {
                    var c = new YS.ConfirmDialog({
                        title: b.title,
                        height: 550,
                        width: 590,
                        contentWidget: {
                            rowSize: [440],
                            colSize: [590],
                            items: [[{
                                fieldId: b.fieldId,
                                type: b.type,
                                editable: !0,
                                fieldLimit: b.fieldLimit,
                                rely: b.rely,
                                items: a.items,
                                value: a.value
                            }]]
                        },
                        onOk: function () {
                            var d = c.getWidgetByName(b.fieldId);
                            return a.value = d.getValue(), a.fieldDefaultValue = d.getValue(), a.items = d.getItems(), a._initSelectPane(), YS.Utils.applyFunc(a, b.onStopEdit, [], !1), !1
                        }
                    });
                    c.show()
                }
            })
        }, _createSelectList: function () {
            var b = this, c = this.options;
            this.$selectList ? this.$selectList.empty() : this.$selectList = a('<ul class="select-list" onmouseover="this.title=this.textContent|| this.innerText"/>').appendTo(this.element);
            this.$selectBtn = $("<i />").addClass("btn-icon").appendTo(this.$selectList);
            if (this.value) {
                var d = b.selectMap[this.value];
                b._createSelectItem(d)
            }// else c.editable || this.$selectList.append(a('<div class="select-empty"/>').text(c.msg))
        }, _bindSelectEvent: function () {
            var b = this;
            this.$selectList.unbind("click"), this.$selectList.bind("click", function (c) {
                var d = a(c.target).closest(".select-item"), e = d.data("item");
                if (e) {
                    var f = a(c.target).closest(".remove-btn");
                    f.length > 0 && b._removeSelectItem(e)
                }
            })
        }, _addSelectItem: function (a) {
            this.$selectList.empty(), this._createSelectItem(a), this.value = a.id, this.selectMap[a.id] = a
        }, _removeSelectItem: function () {
            this.$selectList.empty(), this.value = null
        }, _createSelectItem: function (b) {
            var c = this.options;
            if (b) {
                var d = a('<li class="active"/>').append(a("<span/>").text(b.text)).appendTo(this.$selectList).attr("id", b.id).data("item", b);
            }
        }, _createSelectPane: function () {
            if (!this.$selectPane) {
                this.element.empty();
                var b = this.options, c = this, d = a('<table class="list-htable"><thead><tr><th class="search-org" colspan="3"></th></tr></thead><tbody><tr><td width="220"><div class="tree-box" style="height:'+(b.height-48)+'px;"></div></td><td width="120" class="opts-box"></td><td width="240"><div class="sel-list-box" style="height:'+(b.height-48)+'px;"></div></td></tr></tbody></table>').appendTo(this.element);
                this.$selectPane = a('<ul class="ztree"/>').appendTo(this.element.find('.tree-box'));
                this.$selectList = a('<ul class="selected-list jsChoseSel"></ul>').appendTo(this.element.find('.sel-list-box'));
                this.$searchBox = a('<div class="name-search-box"></div>').appendTo(this.element.find('.search-org'));
                this.$searchInput = a('<input type="text" placeholder="输入部门"/>').appendTo(this.$searchBox).on('keyup',function(e){
                    e.keyCode == 13 && c._searchDeptItem($(this).val());
                })
                this.$searchIcon = a('<i class="jsSearchBtn icon-search" />').appendTo(this.$searchBox).on('click',function(){
                    $.trim(c.$searchInput.val())&&c._searchDeptItem(c.$searchInput.val());
                });
                this._createDepartmentList();
                a('<a class="ys-btn ys-btn-default" href="javascript:;">添加</a>').appendTo(this.element.find('.opts-box')).click(function(){
                    var node = c.departmentTree.getSelectedNodes();
                    if(node[0]){
                        c._doSelectItem(node[0]);
                    }
                });
                a('<a class="ys-btn ys-btn-default jsRemoveSel" href="javascript:;">移除</a>').appendTo(this.element.find('.opts-box')).click(function(){
                    var node = a('.jsChoseSel .active');
                    if(node[0]){
                        if(node.next('li')[0]){
                            node.next('li').addClass('active');
                        }else if(node.prev('li')[0]){
                            node.prev('li').addClass('active');
                        }
                        c._removeSelectItem(node.data('item'));
                    }
                });
                a('.jsChoseSel li')[0]&&a('.jsChoseSel li').die().live('click',function(){
                    $(this).addClass('active').siblings().removeClass('active');
                })
            }
        }, _searchDeptItem: function(a){
            var b = this.options, c = this, d = this.departmentTree, e = d.transformToArray(d.getNodes()), f = [];
            if(!a || a == ""){
                d.showNodes(e);
            }else{
                e.length > 0 && $.each(e,function(g, h){
                    (h.text.toLowerCase().indexOf(a.toLowerCase()) != -1) && (f.push(h), h.added = !0);
                });
                f.length > 0 && $.each(f,function(i,j){
                    //j.children && delete j.children;
                    f = c._findParents(j,f)
                });
                d.hideNodes(e);
                d.showNodes(f);
                d.expandAll(!0);
                $.each(f,function(i,j){
                    delete j.added;
                });
            }
        }, _findParents: function(a,b){
            var c = a.getParentNode(), d = this, e = this.departmentTree;
            (c && !c.added) && (c.added = !0,b.push(c), d._findParents(c,b));
            return b;
        }, _isRelyLimitEmpty: function () {
            var a = this.options;
            return YS.Utils.isObjectEmpty(a.fieldLimit) && !YS.Utils.isObjectEmpty(a.rely)
        }, _initLimitMap: function (a) {
            var b = this.options, c = this;
            if (!YS.Utils.isObjectEmpty(b.fieldLimit)) {
                var d = {};
                YS.Utils.forEach(a, function (a, b) {
                    d[b.id] = b
                }), this.limitMap = {}, YS.Utils.forEach(b.fieldLimit, function (a, b) {
                    var e = d[b];
                    e && e.id && (c.limitMap[e.id] = !0)
                }), YS.Utils.forEach(a, function (a, b) {
                    c.limitMap[b.id] || YS.Utils.forEach(b.path, function (a, d) {
                        c.limitMap[d] && (c.limitMap[b.id] = !0)
                    })
                })
            }
        }, _doSelectItem: function (a) {
            var c = this.options;
            if(c.type!='company'&&a.type==1){
                // alert('请选择部门！');
                YS.Msg.toast({
                    type: "warning",
                    msg:"请选择部门"
                })
                return;
            }
            //if (this._checkLimit(a)) {
            var b = {text: a.text, id: a.id};
            this._addSelectItem(b)
            //}
        }, _createDepartmentList: function () {
            var b = this, c = this.options;
            var _url = getFlowConf().flowPath + (c.type == "company" ? '/common/ajaxListCompanyTree' : '/common/ajaxListOrgTree');
            $.ajax({
                url: _url,
                data: {},
                async: true,
                dataType: 'JSON',
                success: function (c) {
                    c = c.data;
                    b.departments = a.extend(!0, [], c);
                    b._initLimitMap(c);
                    b.departmentTree = new YS.Tree({
                        renderEl: a("<div/>").appendTo(b.$selectPane),
                        Nodes: c,
                        setting: {
                            view: {expandSpeed: 100},
                            data: {simpleData: {fieldEnable: true, idKey: "id", pIdKey: "pId", rootPId: 0}, key: {name: 'text', title: 'text'}},
                            callback: {
                                beforeNodeCreate: function (a) {
                                    b._checkLimit(a) || (a.nocheck = !0), a.checked = a.id === b.value
                                }, onNodeCreated: function (a, c) {
                                    c.isParent && !c.open && c.level < 1 && this.expandNode(c, !0), c.id == b.currentDepartment && this.selectNode(c)
                                }, onDblClick: function(a,c){
                                    b._doSelectItem(c)
                                }
                            }
                        }
                    })
                }
            });
        }, _checkLimit: function (a) {
            var b = this.options;
            return !!a && (!!YS.Utils.isObjectEmpty(b.fieldLimit) || this.limitMap[a.id])
        }, _createDepartmentItem: function (b) {
            var c = this, d = a("<li class='active'/>").append(a("<span/>").text(b.text)).data("item", b).click(function () {
                var a = d.children(".select-btn");
                if (a.hasClass("select"))a.removeClass("select"), c._removeSelectItem(); else {
                    a.addClass("select");
                    var b = d.data("item");
                    c._addSelectItem(b)
                }
            });
            return this.value === b.id && d.children(".select-btn").addClass("select"), d
        }, _createCurrentDepartmentList: function () {
            var b = this;
            this._isRelyLimitEmpty() || (this.$selectPane.children().hide(), this.$currentDepartmentList ? this.$currentDepartmentList.empty().show() : this.$currentDepartmentList = a('<ul class="department-list"/>').appendTo(this.$selectPane), this.currentDepartments ? YS.Utils.forEach(this.currentDepartments, function (a, c) {
                b.$currentDepartmentList.append(b._createDepartmentItem(c))
            }) : $.ajax({
                url: "/data/member/current_departments",
                success: function (a) {
                    b.currentDepartments = a.departmentList, b._createCurrentDepartmentList()
                }
            }))
        }, _createDynamicList: function () {
            var b = this;
        }, _createSearchList: function (b) {
            var c = this;
            if (!this._isRelyLimitEmpty()) {
                this.$selectPane.children().hide();
                var d = [], e = a('<div class="select-search"/>').appendTo(this.$selectPane), f = new RegExp(b);
                YS.Utils.forEach(this.departments, function (a, b) {
                    f.test(b.text) && d.push(b)
                }), e.append(a('<div class="search-title"/>').text("部门")), d.length <= 0 ? e.append(a('<span class="search-empty"/>').text("暂无相关部门")) : (this.$searchList = a('<ul class="department-list"/>').appendTo(e), YS.Utils.forEach(d, function (a, b) {
                    c._checkLimit(b) && c.$searchList.append(c._createDepartmentItem(b))
                }))
            }
        }, getItems: function () {
            var b = [];
            return a("li", this.$selectList).each(function (c, d) {
                b.push(a(d).data("item"))
            }), b
        }, setValue: function (a) {
            this.value = a,this.options.value = a, this._initData()
        }, getValue: function () {
            return this.value
        }, getText: function () {
            if(this.value && this.value.indexOf("#")==-1){
                return this.value && $("li#"+this.value)[0] ? $("li#"+this.value).text() : ""
            }else{
                return ""
            }
        }, _refreshDepartmentList: function (b) {
            var c = this;
            a("li", b).each(function (b, d) {
                var e = a(d).data("item");
                e && (c.value === e.id ? a(d).children(".select-btn").addClass("select") : a(d).children(".select-btn").removeClass("select"))
            })
        }, refresh: function () {
        	this.departmentTree && this.departmentTree.refresh(), this.$dynamicList && this._refreshDepartmentList(this.$dynamicList), this.$currentDepartmentList && this._refreshDepartmentList(this.$currentDepartmentList), this.$searchList && this._refreshDepartmentList(this.$searchList)
        }, checkValidate: function () {
            if (YS.STATIC.FTOKEN)return this.setInvalidateType("fieldRegexl"), !1;
            var a = this.options;
            return !YS.Utils.isEmpty(this.getValue()) || a.fieldIsnull
        }, rebuild: function (a) {
            this.value = a, this._initData(), this.refresh()
        }, getOptions: function () {
            var b = this.options;
            return a.extend(YS.Dept.superclass.getOptions.apply(this, arguments), {
                fieldLimit: b.fieldLimit,
                fieldType: b.fieldType,
                fieldLength: b.fieldLength
                // ,assignmentUrl: b.assignmentUrl
            })
        }
    }), a.shortcut("dept,company", YS.Dept)
}(jQuery), function (a) {
    YS.DeptGroup = YS.extend(YS.Dept, {
        _defaultConfig: function () {
            return a.extend(YS.DeptGroup.superclass._defaultConfig.apply(this, arguments), {
                assignmentUrl: getFlowConf().flowPath+"/common/ajaxListDeptByIds",
                baseCls: "fui_dept fui_dept_group", width: 200, height: 32, value: ""
            })
        }, _init: function () {
            YS.DeptGroup.superclass._init.apply(this, arguments)
        }, _initData: function () {
            // 加载多选的数据  部门多选
            var a = this.options, b = this,_this = this;
            this.items = [],this.selectMap = {};
            if(a.value){
                if(a.value && !a.fieldDefaultValueName){
                    $.ajax({async:true, data:{ids:a.value}, url:a.assignmentUrl, type:'POST',
                        success:function(dt){
                        dt = dt.data;
                        var c = a.value.split(","), d = a.fieldDefaultValueName ? a.fieldDefaultValueName.split(",") : b.getText().split(",");
                        $.each(c,function(e, f){
                            b.items.push({id: f, text: dt[e].name});
                        })
                        b.value = a.value;
                        b._initSelectPane();
                    }});
                }else{
                    if(a.value){
                        var c = a.value.split(","), d = a.fieldDefaultValueName ? a.fieldDefaultValueName.split(",") : b.getText().split(",");
                        $.each(c,function(e, f){
                            b.items.push({id: f, text: d[e]});
                        })
                        b.value = a.value;
                        b._initSelectPane();
                    }
                }

            }
        }, _createSelectList: function () {
            var b = this, c = this.options, d = this.value ? this.value.split(","): [];
            this.$selectList ? this.$selectList.empty() : this.$selectList = a('<ul class="select-list"/>').appendTo(this.element);
            this.$selectList.mouseover(function(){
                var title = "", _this = $(this);
                a.each(_this.children('li'),function(idx, _li){
                    title += idx == 0 ? $(_li).text() : ('  ' + $(_li).text());
                });
                this.title = title;
            });
            this.$selectBtn = $("<i />").addClass("btn-icon").appendTo(this.$selectList);
            this.value && $.each(d, function (a, c) {
                var e = b.selectMap[c];
                b._createSelectItem(e)
            }); //: c.editable || this.$selectList.append(a('<div class="select-empty"/>').text(c.msg))
        }, _addSelectItem: function (a) {
            this._createSelectItem(a), this.value = this.getValue(), this.selectMap[a.id] = a
        }, _createSelectItem: function (b) {
            var c = this.options;
            if (b) {
                if(this.$selectList.find('.active')[0]){this.$selectList.find('.active').removeClass('active');}
                var d = a('<li class="active" />').append(a("<span/>").text(b.text)).appendTo(this.$selectList).attr("id", b.id).data("item", b);
            }
        }, _removeSelectItem: function (b) {
            a("#" + b.id, this.$selectList).remove(), this.value = this.getValue()
        }, _doSelectItem: function (a) {

            if(a.type == 1){
                // alert('请选择部门！');
                YS.Msg.toast({
                    type: "warning",
                    msg:"请选择部门"
                })
                return;
            }
            //if (this._checkLimit(a)) {
            var b = {text: a.text, id: a.id};
            this.value.indexOf(b.id) == -1 && this._addSelectItem(b)
            //}
        }, _checkLimit: function (a) {
            var b = this.options;
            return !!a && (!!YS.Utils.isObjectEmpty(b.fieldLimit) || this.limitMap[a.id])
        }, _createDepartmentList: function () {
            var b = this, c = this.options;
            var _url = getFlowConf().flowPath + (c.type == "company" ? '/common/ajaxListCompanyTree' : '/common/ajaxListOrgTree');
            $.ajax({
                url: _url,
                data: {},
                async: true,
                dataType: 'JSON',
                success: function (c) {
                    c = c.data;
                    b.departments = a.extend(!0, [], c);
                    b._initLimitMap(c);
                    b.departmentTree = new YS.Tree({
                        renderEl: a("<div/>").appendTo(b.$selectPane),
                        Nodes: c,
                        setting: {
                            view: {expandSpeed: 100},
                            data: {simpleData: {fieldEnable: true, idKey: "id", pIdKey: "pId", rootPId: 0}, key: {name: 'text', title: 'text'}},
                            callback: {
                                beforeNodeCreate: function (a) {
                                    b._checkLimit(a) || (a.nocheck = !0), a.checked = a.id === b.value
                                }, onNodeCreated: function (a, c) {
                                    c.isParent && !c.open && c.level < 1 && this.expandNode(c, !0), c.id == b.currentDepartment && this.selectNode(c)
                                }, onDblClick: function(a,c){
                                    b._doSelectItem(c)
                                }
                            }
                        }
                    })
                }
            });
        }, _createDepartmentItem: function (b) {
            var c = this, d = a("<li/>").append(a('<i class="icon-department"/>')).append(a("<span/>").text(b.text)).append(a('<div class="select-btn x-check"/>').append(a('<i class="icon-blank"/>'))).data("item", b).click(function () {
                var a = d.children(".select-btn");
                if (a.hasClass("select"))a.removeClass("select"), c._removeSelectItem(d.data("item")); else {
                    a.addClass("select");
                    var b = d.data("item");
                    c._addSelectItem(b)
                }
            });
            return this.value.indexOf(b.id) > -1 && d.children(".select-btn").addClass("select"), d
        }, getItems: function () {
            var b = [];
            return a("li", this.$selectList).each(function (c, d) {
                b.push(a(d).data("item"))
            }), b
        }, checkValidate: function () {
            if (YS.STATIC.FTOKEN)return this.setInvalidateType("fieldRegexl"), !1;
            var a = this.options;
            return !(!a.fieldIsnull && !this.getValue())
        }, setValue: function (a) {
            this.value = a ? a : "",this.options.value = this.value, this._initData()
        }, getValue: function () {
            var b = this.value;
            return this.$selectList && (b = "", a("li", this.$selectList).each(function (c, d) {
                b += (c==0 ? a(d).attr("id") : (","+a(d).attr("id")));
            })), b
        }, getText: function () {
            var a = this, b = "", c = this.value.split(",");
            YS.Utils.forEach(c, function (d, e) {
                if(e.indexOf("#")==-1 && $("li#"+e)[0]){
                    b += (d==0?$("li#"+e).text(): (","+$("li#"+e).text()))
                }
            })
            return b
        }, getNullValue: function () {
            return ""
        }, _refreshDepartmentList: function (b) {
            var c = this;
            a("li", b).each(function (b, d) {
                var e = a(d).data("item");
                e && (c.value.indexOf(e.id) > -1 ? a(d).children(".select-btn").addClass("select") : a(d).children(".select-btn").removeClass("select"))
            })
        }
    }), a.shortcut("deptgroup,companygroup", YS.DeptGroup)
}(jQuery), function (a) {
    YS.DeptAdmin = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.DeptAdmin.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_dept",
                title: "部门列表",
                rootText: "YASHA",
                width: 200,
                height: 32,
                value: null,
                fieldIsnull: !0,
                fieldType: "varchar",
                fieldLength: 128,
                assignmentUrl: getFlowConf().flowPath+"/common/ajaxListDeptByIds",
                editable: !1,
                count: 100,
                fieldLimit: [],
                linkWidgets: [],
                dynamicType: "select",
                onStopEdit: null
            })
        }, _init: function () {
            YS.DeptAdmin.superclass._init.apply(this, arguments), this._initSelectPane()
        }, _initData: function () {
            var a = this.options, b = this, _this = this;
            this.items = [];
            if(a.value && !a.fieldDefaultValueName){
                var companyUrl = getFlowConf().flowPath+"/common/ajaxListCompanyByIds"
                $.ajax({async:true, data:{ids:a.value}, url:a.type=="company"?companyUrl:a.assignmentUrl, type:'POST', success:function(dt){
                    dt = dt.data;
                    if(dt&& dt[0]){
                        a.fieldDefaultValueName = a.type=="company"?dt[0].cname:dt[0].name;
                        b.value = a.value, _this.items.push({id: a.value, text: a.fieldDefaultValueName ? a.fieldDefaultValueName : b.getText()})
                        _this._initSelectPane();
                    }
                }});
            }else{
                if(a.value){
                    b.value = a.value, this.items.push({id: a.value, text: a.fieldDefaultValueName ? a.fieldDefaultValueName : b.getText()})
                    this._initSelectPane();
                }
            }
        }, _initSelectPane: function () {
            var b = this, c = this.options;
            this.selectMap = {}, YS.Utils.forEach(b.items, function (a, c) {
                b.selectMap[c.id] = c
            }), b._createSelectList(), c.editable ? (this._createSelectPane(), this._bindSelectEvent()) : this._bindEditEvent()
        }, _bindEditEvent: function () {
            var a = this, b = this.options;
            this.$selectBtn.unbind("click"), this.$selectBtn.bind("click", function () {
                if (a.isEnabled()) {
                    var c = new YS.ConfirmDialog({
                        title: b.title,
                        height: 550,
                        width: 590,
                        contentWidget: {
                            rowSize: [440],
                            colSize: [590],
                            items: [[{
                                fieldId: b.fieldId,
                                type: b.type,
                                linkWidgets: b.linkWidgets,
                                editable: !0,
                                fieldLimit: b.fieldLimit,
                                rely: b.rely,
                                items: a.items,
                                value: a.value
                            }]]
                        },
                        onOk: function () {
                            var d = c.getWidgetByName(b.fieldId);
                            a.setValue(d.getValue());
                            return a.value = d.getValue(), a.fieldDefaultValue = d.getValue(), a.items = d.getItems(), a._initSelectPane(), YS.Utils.applyFunc(a, b.onStopEdit, [], !1), !1
                        }
                    });
                    c.show()
                }
            })
        }, _createSelectList: function () {
            var b = this, c = this.options;
            this.$selectList ? this.$selectList.empty() : this.$selectList = $('<ul class="select-list"/>').appendTo(this.element);
            this.$selectBtn = $("<i />").addClass("btn-icon").appendTo(this.$selectList);
            if (this.value) {
                var d = b.selectMap[this.value];
                b._createSelectItem(d)
            }
        }, _bindSelectEvent: function () {
            var b = this;
            this.$selectList.unbind("click"), this.$selectList.bind("click", function (c) {
                var d = $(c.target).closest(".select-item"), e = d.data("item");
                if (e) {
                    var f = $(c.target).closest(".remove-btn");
                    f.length > 0 && b._removeSelectItem(e)
                }
            })
        }, _addSelectItem: function (a) {
            this.$selectList.empty(), this._createSelectItem(a), this.value = a.id, this.selectMap[a.id] = a
        }, _removeSelectItem: function () {
            this.$selectList.empty(), this.value = null
        }, _createSelectItem: function (b) {
            var c = this.options;
            if (b) {
                var d = $('<li class="active"/>').append($("<span/>").text(b.text)).appendTo(this.$selectList).attr("id", b.id).data("item", b);
            }
        }, _createSelectPane: function () {
            if (!this.$selectPane) {
                this.element.empty();
                var b = this.options, c = this, d = $('<table class="list-htable"><thead><tr><th class="search-org" colspan="3"></th></tr></thead><tbody><tr><td width="220"><div class="tree-box" style="height:'+(b.height-48)+'px;"></div></td><td width="120" class="opts-box"></td><td width="240"><div class="sel-list-box" style="height:'+(b.height-48)+'px;"></div></td></tr></tbody></table>').appendTo(this.element);
                this.$selectPane = $('<ul class="ztree"/>').appendTo(this.element.find('.tree-box'));
                this.$selectList = $('<ul class="selected-list jsChoseSel"></ul>').appendTo(this.element.find('.sel-list-box'));
                this.$searchBox = $('<div class="name-search-box"></div>').appendTo(this.element.find('.search-org'));
                this.$searchInput = $('<input type="text" placeholder="输入部门"/>').appendTo(this.$searchBox).on('keyup',function(e){
                    e.keyCode == 13 && c._searchDeptItem($(this).val());
                })
                this.$searchIcon = $('<i class="jsSearchBtn icon-search" />').appendTo(this.$searchBox).on('click',function(){
                    $.trim(c.$searchInput.val())&&c._searchDeptItem(c.$searchInput.val());
                });
                this._createDepartmentList();
                $('<a class="ys-btn ys-btn-default" href="javascript:;">添加</a>').appendTo(this.element.find('.opts-box')).click(function(){
                    var node = c.departmentTree.getSelectedNodes();
                    if(node[0]){
                        c._doSelectItem(node[0]);
                    }
                });
                $('<a class="ys-btn ys-btn-default jsRemoveSel" href="javascript:;">移除</a>').appendTo(this.element.find('.opts-box')).click(function(){
                    var node = $('.jsChoseSel .active');
                    if(node[0]){
                        if(node.next('li')[0]){
                            node.next('li').addClass('active');
                        }else if(node.prev('li')[0]){
                            node.prev('li').addClass('active');
                        }
                        c._removeSelectItem(node.data('item'));
                    }
                });
                $('.jsChoseSel li')[0]&&$('.jsChoseSel li').die().live('click',function(){
                    $(this).addClass('active').siblings().removeClass('active');
                })
            }
        }, _searchDeptItem: function(a){
            var b = this.options, c = this, d = this.departmentTree, e = d.transformToArray(d.getNodes()), f = [];
            if(!a || a == ""){
                d.showNodes(e);
            }else{
                e.length > 0 && $.each(e,function(g, h){
                    (h.text.toLowerCase().indexOf(a.toLowerCase()) != -1) && (f.push(h), h.added = !0);
                });
                f.length > 0 && $.each(f,function(i,j){
                    //j.children && delete j.children;
                    f = c._findParents(j,f)
                });
                d.hideNodes(e);
                d.showNodes(f);
                d.expandAll(!0);
                $.each(f,function(i,j){
                    delete j.added;
                });
            }
        }, _findParents: function(a,b){
            var c = a.getParentNode(), d = this, e = this.departmentTree;
            (c && !c.added) && (c.added = !0,b.push(c), d._findParents(c,b));
            return b;
        }, _isRelyLimitEmpty: function () {
            var a = this.options;
            return YS.Utils.isObjectEmpty(a.fieldLimit) && !YS.Utils.isObjectEmpty(a.rely)
        }, _initLimitMap: function (a) {
            var b = this.options, c = this;
            if (!YS.Utils.isObjectEmpty(b.fieldLimit)) {
                var d = {};
                YS.Utils.forEach(a, function (a, b) {
                    d[b.id] = b
                }), this.limitMap = {}, YS.Utils.forEach(b.fieldLimit, function (a, b) {
                    var e = d[b];
                    e && e.id && (c.limitMap[e.id] = !0)
                }), YS.Utils.forEach(a, function (a, b) {
                    c.limitMap[b.id] || YS.Utils.forEach(b.path, function (a, d) {
                        c.limitMap[d] && (c.limitMap[b.id] = !0)
                    })
                })
            }
        }, _doSelectItem: function (a) {
            var b = {text: a.text, id: a.id}, c = this.options, d = this;
            if(c.type!='company'&&a.type==1){
                // alert('请选择部门！');
                YS.Msg.toast({
                    type: "warning",
                    msg:"请选择部门"
                })
                return;
            }
            d._addSelectItem(b)
            /*$.ajax({
                url: getFlowConf().flowPath + '/common/getDeptHeader?deptId='+b.id,
                dataType: 'JSON',
                success: function(msg){
                    if(msg.code==100 && msg.data[0]){
                    	var deptMsg = msg.data[0];
                        deptMsg.dept_deptHeaderCode = deptMsg.deptHeaderCode;
                        deptMsg.dept_deptHeaderName = deptMsg.deptHeaderName;
                        deptMsg.dept_areaOneCode = deptMsg.areaOneCode;
                        deptMsg.dept_areaOneName = deptMsg.areaOneName;
                        deptMsg.dept_areaDeputyCode = deptMsg.areaDeputyCode;
                        deptMsg.dept_areaDeputyName = deptMsg.areaDeputyName;
                        deptMsg.dept_areaHeaderCode = deptMsg.areaHeaderCode;
                        deptMsg.dept_areaHeaderName = deptMsg.areaHeaderName;
                        deptMsg.dept_centerdeputyHeaderCode = deptMsg.centerdeputyHeaderCode;
                        deptMsg.dept_centerdeputyHeaderName = deptMsg.centerdeputyHeaderName;
                        deptMsg.dept_centerHeaderCode = deptMsg.centerHeaderCode;
                        deptMsg.dept_centerHeaderName = deptMsg.centerHeaderName;
                        deptMsg.dept_companyHeaderCode = deptMsg.companyHeaderCode;
                        deptMsg.dept_companyHeaderName = deptMsg.companyHeaderName;
                    	c.linkWidgets.length>0 && $.each(c.linkWidgets, function(i, widget){
                            var name = widget.options.fieldName;
                            if(name){name=name.replace('Code', 'Name'); };
                            widget.options.fieldDefaultValueName = deptMsg[name] || "";
                            widget.setValue(deptMsg[widget.options.fieldName] || "");
                    	});
                    }
                    d._addSelectItem(b);
                }
            })*/
        }, _createDepartmentList: function () {
            var b = this, c = this.options;
            var _url = getFlowConf().flowPath + (c.type == "company" ? '/common/ajaxListCompanyTree' : '/common/ajaxListOrgTree');
            $.ajax({
                url: _url,
                data: {},
                async: true,
                dataType: 'JSON',
                success: function (c) {
                    c = c.data;
                    b.departments = a.extend(!0, [], c);
                    b._initLimitMap(c);
                    b.departmentTree = new YS.Tree({
                        renderEl: a("<div/>").appendTo(b.$selectPane),
                        Nodes: c,
                        setting: {
                            view: {expandSpeed: 100},
                            data: {simpleData: {fieldEnable: true, idKey: "id", pIdKey: "pId", rootPId: 0}, key: {name: 'text', title: 'text'}},
                            callback: {
                                beforeNodeCreate: function (a) {
                                    b._checkLimit(a) || (a.nocheck = !0), a.checked = a.id === b.value
                                }, onNodeCreated: function (a, c) {
                                    c.isParent && !c.open && c.level < 1 && this.expandNode(c, !0), c.id == b.currentDepartment && this.selectNode(c)
                                }, onDblClick: function(a,c){
                                    b._doSelectItem(c)
                                }
                            }
                        }
                    })
                }
            });
        }, _checkLimit: function (a) {
            var b = this.options;
            return !!a && (!!YS.Utils.isObjectEmpty(b.fieldLimit) || this.limitMap[a.id])
        }, _createDepartmentItem: function (b) {
            var c = this, d = $("<li class='active'/>").append($("<span/>").text(b.text)).data("item", b).click(function () {
                var a = d.children(".select-btn");
                if (a.hasClass("select"))a.removeClass("select"), c._removeSelectItem(); else {
                    a.addClass("select");
                    var b = d.data("item");
                    c._addSelectItem(b)
                }
            });
            return this.value === b.id && d.children(".select-btn").addClass("select"), d
        }, _createCurrentDepartmentList: function () {
            var b = this;
            this._isRelyLimitEmpty() || (this.$selectPane.children().hide(), this.$currentDepartmentList ? this.$currentDepartmentList.empty().show() : this.$currentDepartmentList = $('<ul class="department-list"/>').appendTo(this.$selectPane), this.currentDepartments ? YS.Utils.forEach(this.currentDepartments, function (a, c) {
                b.$currentDepartmentList.append(b._createDepartmentItem(c))
            }) : $.ajax({
                url: "/data/member/current_departments",
                success: function (a) {
                    b.currentDepartments = a.departmentList, b._createCurrentDepartmentList()
                }
            }))
        }, _createDynamicList: function () {
            var b = this;
        }, _createSearchList: function (b) {
            var c = this;
            if (!this._isRelyLimitEmpty()) {
                this.$selectPane.children().hide();
                var d = [], e = $('<div class="select-search"/>').appendTo(this.$selectPane), f = new RegExp(b);
                YS.Utils.forEach(this.departments, function (a, b) {
                    f.test(b.text) && d.push(b)
                }), e.append($('<div class="search-title"/>').text("部门")), d.length <= 0 ? e.append($('<span class="search-empty"/>').text("暂无相关部门")) : (this.$searchList = $('<ul class="department-list"/>').appendTo(e), YS.Utils.forEach(d, function (a, b) {
                    c._checkLimit(b) && c.$searchList.append(c._createDepartmentItem(b))
                }))
            }
        }, getItems: function () {
            var b = [];
            return $("li", this.$selectList).each(function (c, d) {
                b.push($(d).data("item"))
            }), b
        }, setValue: function (a) {
            var c = this.options, d = this;


            $.ajax({
                url: getFlowConf().flowPath + '/common/getDeptHeader?deptId='+a,
                dataType: 'JSON',
                success: function(msg){
                	if(msg.code==100 && msg.data[0]){
                    	var deptMsg = msg.data[0];
                        deptMsg.dept_deptHeaderCode = deptMsg.deptHeaderCode;
                        deptMsg.dept_deptHeaderName = deptMsg.deptHeaderName;
                        deptMsg.dept_areaOneCode = deptMsg.areaOneCode;
                        deptMsg.dept_areaOneName = deptMsg.areaOneName;
                        deptMsg.dept_areaDeputyCode = deptMsg.areaDeputyCode;
                        deptMsg.dept_areaDeputyName = deptMsg.areaDeputyName;
                        deptMsg.dept_areaHeaderCode = deptMsg.areaHeaderCode;
                        deptMsg.dept_areaHeaderName = deptMsg.areaHeaderName;
                        deptMsg.dept_centerdeputyHeaderCode = deptMsg.centerdeputyHeaderCode;
                        deptMsg.dept_centerdeputyHeaderName = deptMsg.centerdeputyHeaderName;
                        deptMsg.dept_centerHeaderCode = deptMsg.centerHeaderCode;
                        deptMsg.dept_centerHeaderName = deptMsg.centerHeaderName;
                        deptMsg.dept_companyHeaderCode = deptMsg.companyHeaderCode;
                        deptMsg.dept_companyHeaderName = deptMsg.companyHeaderName;
                    	c.linkWidgets.length>0 && $.each(c.linkWidgets, function(i, wd){
                    		wd.setValue(deptMsg[wd.options.fieldName]);
                    	});
                    }d.value = a, d._initData()
                }
            });
        }, getValue: function () {
            return this.value
        }, getText: function () {
            if(this.value && this.value.indexOf("#")==-1){
                return $("li#"+this.value)[0] ? $("li#"+this.value).text() : ""
            }else{
                return ""
            }
        }, _refreshDepartmentList: function (b) {
            var c = this;
            $("li", b).each(function (b, d) {
                var e = $(d).data("item");
                e && (c.value === e.id ? $(d).children(".select-btn").addClass("select") : $(d).children(".select-btn").removeClass("select"))
            })
        }, refresh: function () {
        	this.departmentTree && this.departmentTree.refresh(), this.$dynamicList && this._refreshDepartmentList(this.$dynamicList), this.$currentDepartmentList && this._refreshDepartmentList(this.$currentDepartmentList), this.$searchList && this._refreshDepartmentList(this.$searchList)
        }, checkValidate: function () {
            if (YS.STATIC.FTOKEN)return this.setInvalidateType("fieldRegexl"), !1;
            var a = this.options;
            return !YS.Utils.isEmpty(this.getValue()) || a.fieldIsnull
        }, rebuild: function (a) {
            this.value = a, this._initData(), this.refresh()
        }, getOptions: function (t) {
            var i = this.options;
            return a.extend(YS.DeptAdmin.superclass.getOptions.apply(this, arguments), {
                noRepeat: i.noRepeat,
                linkWidgets: i.linkWidgets,
                value: "save" === t ? this._parseDefaultValue(i.value) : i.value,
                fieldLimit: i.fieldLimit,
                fieldType: i.fieldType,
                fieldLength: i.fieldLength
                // ,assignmentUrl: i.assignmentUrl
            })
        }, _parseDefaultValue: function (e) {
            var t = e;
            return e && e.id && (t = e.id), t
        }
    }), a.shortcut("deptadmin", YS.DeptAdmin)
}(jQuery), function (a) {
    YS.BisTable = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.BisTable.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_bis",
                title: "选择底表",
                msg: "选择底表",
                width: 200,
                height: 32,
                fieldType: "varchar",
                fieldLength: 128,
                ajaxurl: "",
                value: null,
                fieldIsnull: !0,
                editable: !1,
                count: 100,
                linkWidgets: [],
                onStopEdit: null,
                onBeforeEdit: null
            })
        }, _init: function () {
            YS.BisTable.superclass._init.apply(this, arguments), this._initSelectPane()
        }, _initData: function () {
            var a = this, b = this.options;
            if(b.ajaxurl){
                $.ajax({
                    url: getFlowConf().flowPath + "/oa/form/business_table_field/ajaxList.do?sessionId=" + _jsSessionId,
                    dataType: 'json',
                    data:{"businessTableId": b.ajaxurl},
                    success: function(dt){
                        a.items = dt.rows;
                    }
                });
            }
        }, _initSelectPane: function () {
            var b = this, c = this.options;
            this.selectMap = {}, YS.Utils.forEach(this.items, function (a, c) {
                b.selectMap[c.id] = c
            }), b._createSelectList(), c.editable ? this._createSelectPane() : this._bindEditEvent()
        }, _bindEditEvent: function () {
            var a = this, b = this.options;
            this.$selectBtn.unbind("click"), this.$selectBtn.bind("click", function () {
                if (a.isEnabled()) {
                    YS.Utils.applyFunc(a, b.onBeforeEdit, [], !1);
                    var c = new YS.ConfirmDialog({
                        title: b.title,
                        height: 400,
                        width: 500,
                        contentWidget: {
                            rowSize: [350],
                            colSize: [480],
                            items: [[{
                                type: "bistablepane",
                                width: "100%",
                                visiableWidgetName: b.fieldName,
                                ajaxurl: b.ajaxurl,
                                fieldId: "bisItemSelectPane",
                                hasCheck: !0
                            }]]
                        },
                        onOk: function () {
                            var d = c.getWidgetByName("bisItemSelectPane");
                            d.fields && (a.fields = d.fields);
                            return a.value = d.getValue(), a._initSelectPane(), YS.Utils.applyFunc(a, b.onStopEdit, [], !1), !1
                        }
                    });
                    c.show()
                }
            })
        }, _createSelectList: function () {
            var b = this, c = this.options;
            this.$selectList ? this.$selectList.empty() : this.$selectList = a('<ul class="select-list" />').appendTo(this.element);
            this.$selectBtn = $("<i />").addClass("btn-icon").appendTo(this.$selectList);
            if (this.value) {
                b._createSelectItem(this.value)
            }
        }, _setSelectItem: function (a) {
            this.$selectList.empty(), this._createSelectItem(a), this.value = a.no, this.selectMap[a.no] = a
        }, _clearSelectItem: function () {
            this.$selectList.empty(), this.value = null
        }, _createSelectItem: function (b) {
            var c = this.options, d = this, e = c.linkWidgets;
            if (b) {
                b[c.fieldName] && a("<span/>").text(b[c.fieldName]).appendTo(d.$selectList).attr("id", b.id);
                $.each(e, function(f, g){
                    b[g.options.fieldName] && g.setValue(b[g.options.fieldName]);
                });
            }
        }, getWidgetByName: function(a){
            var b = this, c = this.options, d = b.element.closest("ul").find("li.widget-view"), h;
            $.each(d, function(e, f){
                var g = $(f).data("widget");
                if(g && g.options.fieldName == a){
                    h = g;return;
                }
            });
            return h
        }, _createSelectPane: function () {

        }, _isRelyLimitEmpty: function () {
            var a = this.options;
            return YS.Utils.isObjectEmpty(a.fieldLimit) && !YS.Utils.isObjectEmpty(a.limitWidget)
        }, _initLimitMap: function (a) {
            var b = this.options, c = this, d = {};
            YS.Utils.forEach(a, function (a, b) {
                d[b._id] = b
            }), this.limitMap = {}, YS.Utils.forEach(b.fieldLimit, function (a, b) {
                var e = d[b];
                e && e.departmentId && (c.limitMap[e.departmentId] = !0)
            })
        }, _createMemberMenu: function () {
            var b = this, c = this.options, node = null;
        }, _createMemberItem: function (b) {
            var d = a("<li/>").append(a("<span/>").text(b.name)).append(a('<div class="select-btn x-radio"/>').append(a('<i class="icon-blank"/>'))).appendTo(this.$memberList).data("user", b);
            this.value === b.no && d.children(".select-btn").addClass("select")
        }, _createCurrentUserList: function () {
            var b = this, c = this.options;
            if (this.$selectPane.children().hide(), this.$currentUserList ? this.$currentUserList.empty().show() : this.$currentUserList = a('<ul class="select-dynamic"/>').appendTo(this.$selectPane), !this._isRelyLimitEmpty() && YS.STATIC.user) {
                var d = {
                    no: YS.STATIC.user._id,
                    name: YS.STATIC.user.nickname
                }, e = a("<li/>").append(a("<span/>").text(d.name)).append(a('<div class="select-btn x-radio"/>').append(a('<i class="icon-blank"/>'))).appendTo(b.$currentUserList).data("user", d).click(function () {
                    var c = e.children(".select-btn");
                    if (c.hasClass("select"))c.removeClass("select"), b._clearSelectItem(); else {
                        a(".select", b.$currentUserList).removeClass("select"), c.addClass("select");
                        var d = e.data("user");
                        b._setSelectItem(d)
                    }
                });
                b.value === d.no ? e.children(".select-btn").addClass("select") : (e.children(".select-btn").addClass("select"), b._setSelectItem(item))
            }
        }, _createDynamicList: function () {
            var b = this;
        }, _getDepartmentId: function () {
            return this.currentDepartment
        }, _getCompanyId: function(){
            return this.currentCompany
        }, getItems: function () {
            var b = [];
            return a(".select-item", this.$selectList).each(function (c, d) {
                b.push(a(d).data("item"))
            }), b
        }, setValue: function (a) {
            this.value = a, this._initData()
        }, getValue: function () {
            return this.value
        }, getText: function () {
            var a = this.value;
            return a && $('#'+a)[0] ? $('#'+a).text() : ""
        }, _refreshUserList: function (b) {
            var c = this;
            a("li", b).each(function (b, d) {
                var e = a(d).data("user");
                e && (c.value === e.no ? a(d).children(".select-btn").addClass("select") : a(d).children(".select-btn").removeClass("select"))
            })
        }, refresh: function () {
            this.$memberList && this._refreshUserList(this.$memberList)
        }, checkValidate: function () {
            if (YS.STATIC.FTOKEN)return this.setInvalidateType("fieldRegexl"), !1;
            var a = this.options;
            return !YS.Utils.isEmpty(this.getValue()) || a.fieldIsnull
        }, rebuild: function (a) {
            this.value = a, this._initData(), this.refresh()
        }, getOptions: function () {
            var b = this.options;
            return a.extend(YS.BisTable.superclass.getOptions.apply(this, arguments), {
                fieldType: b.fieldType,
                fieldLength: b.fieldLength,
                linkWidgets: b.linkWidgets
            })
        }
    }), a.shortcut("bistable", YS.BisTable)
}(jQuery), function (a) {
    YS.LinkQuery = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.LinkQuery.superclass._defaultConfig.apply(), {
                baseCls: "fui_link_query",
                fieldIsnull: !0,
                linkFields: [],
                linkFilter: [],
                linkForm: null,
                layoutSize: {}
            })
        }, _init: function () {
            YS.LinkQuery.superclass._init.apply(this, arguments);
            var b = this.options, c = this;
            this.widgetsMap = {}, this.typeMap = {}, YS.Utils.forEach(b.linkFields, function (d, e) {
                var f = a('<div class="link-field"/>').appendTo(c.element);
                c._formatSubFormItems(e);
                var g = {}, h = c._formatWidgetType(e.type);
                b.fieldPid  ? (f.addClass("sub-link"), g.width = 150) : (f.append(a('<div class="fl-label"/>').text(e.text)), b.layoutSize && b.layoutSize[h] && a.extend(g, b.layoutSize[h])), c.widgetsMap[e.name] = YS.createWidget(a.extend(g, {
                    renderEl: a("<div/>").appendTo(f),
                    fieldId: e.name,
                    type: h,
                    items: e.items,
                    format: e.format,
                    fieldEnabled: !1
                })), c.typeMap[e.name] = e.type
            })
        }, _formatSubFormItems: function (a) {
            if ("subform" === a.type) {
                var b = this;
                YS.Utils.forEach(a.items, function (a, c) {
                    !$.isEmptyObject(c) && (c.type = b._formatWidgetType(c.type))
                })
            }
        }, _formatWidgetType: function (a) {
            switch (a) {
                case"combo":
                case"combocheck":
                case"radiogroup":
                case"checkboxgroup":
                case"address":
                    return "text";
                default:
                    return a
            }
        }, _formatWidgetData: function (a, b) {
            switch (a) {
                case"address":
                    return YS.Utils.address2Str(b, "", "pcda");
                default:
                    return b
            }
        }, getOptions: function () {
            var b = this.options;
            return a.extend(YS.LinkQuery.superclass.getOptions.apply(this, arguments), {
                linkFilter: b.linkFilter,
                linkFields: b.linkFields,
                linkForm: b.linkForm,
                refAppId: b.refAppId
            })
        }, reload: function (a) {
            var b = this.options, c = this, d = [];
            YS.Utils.forEach(b.linkFields, function (a, b) {
                d.push(b.name)
            });
        }, doResize: function (a) {
            var b = this.options;
            if (b.fieldPid) {
                var c = 154 * b.linkFields.length;
                this.element.css({width: c})
            }
        }, supportLayout: function () {
            var a = this.options, b = !0;
            return YS.Utils.forEach(a.linkFields, function (a, c) {
                if ("subform" === c.type)return b = !1, !1
            }), b
        }
    }), a.shortcut("linkquery", YS.LinkQuery)
}(jQuery), function (a) {
    YS.LinkData = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.LinkData.superclass._defaultConfig.apply(), {
                baseCls: "fui_link_data",
                fieldIsnull: !0,
                linkFields: [],
                linkKey: null,
                linkFilter: [],
                linkForm: null,
                itemsPerPage: 20,
                layoutSize: {},
                onBeforeLinkData: null
            })
        }, _init: function () {
            YS.LinkData.superclass._init.apply(this, arguments);
            var b = this.options, c = this;
            this._createSelectBtn(), this.widgetsMap = {}, this.typeMap = {}, YS.Utils.forEach(b.linkFields, function (d, e) {
                var f = a('<div class="link-field"/>').appendTo(c.element);
                c._formatSubFormItems(e);
                var g = {}, h = c._formatWidgetType(e.type);
                b.fieldPid  ? (f.addClass("sub-link"), g.width = 150) : (f.append(a('<div class="fl-label"/>').text(e.text)), b.layoutSize && b.layoutSize[h] && a.extend(g, b.layoutSize[h])),c.widgetsMap[e.name] = YS.createWidget(a.extend(g, {
                    renderEl: a("<div/>").appendTo(f),
                    fieldId: e.name,
                    type: h,
                    items: e.items,
                    fieldFormat: e.fieldFormat,
                    fieldEnable: !1
                })), c.typeMap[e.name] = e.type
            })
        }, _setWidgetsValue: function (a) {
            var b = this;
            YS.Utils.forEach(this.widgetsMap, function (c, d) {
                var e = b._formatWidgetData(b.typeMap[c], a[c]);
                d.setValue(e)
            })
        }, _formatSubFormItems: function (a) {
            if ("subform" === a.type) {
                var b = this;
                YS.Utils.forEach(a.items, function (a, c) {
                    c && (c.type = b._formatWidgetType(c.type))
                })
            }
        }, _formatWidgetType: function (a) {
            switch (a) {
                case"combo":
                case"combocheck":
                case"radiogroup":
                case"checkboxgroup":
                case"address":
                    return "text";
                default:
                    return a
            }
        }, _formatWidgetData: function (a, b) {
            switch (a) {
                case"address":
                    return YS.Utils.address2Str(b, "", "pcda");
                default:
                    return b
            }
        }, _createSelectBtn: function () {
            var b = this.options, c = this;
            b.fieldPid ? a('<div class="data-select"/>').append(a('<i class="icon-data-picker"/>')).appendTo(this.element).click(function (a) {
                c.isEnabled() && YS.Utils.applyFunc(c, b.onBeforeLinkData, [b.linkFilter], !1)
            }) : new YS.Button({
                text: "选择数据",
                width: 240,
                style: "white",
                renderEl: a("<div/>").appendTo(this.element),
                onClick: function () {
                    c.isEnabled() && YS.Utils.applyFunc(c, b.onBeforeLinkData, [b.linkFilter], !1)
                }
            })
        }, _createDataList: function (b) {
            var c = this;
            this.datalist && this.datalist.remove(), this.items = b, this.datalist = a('<ul class="data-list"/>').appendTo(this.element), this.datalist.append(a('<li class="data-item data-clear"/>').text("清空")), b.length <= 0 ? this.datalist.append(a('<div class="empty-list"/>').text("没有符合条件的数据")) : YS.Utils.forEach(b, function (a, b) {
                c._createDataItem(b)
            }), this._bindListEvent()
        }, _createDataItem: function (b) {
            var c = this.options, d = this, e = [];
            YS.Utils.forEach(c.linkFields, function (a, c) {
                var f = d._formatData(c.type, b[c.name], c.fieldFormat);
                f && e.push(f)
            });
            var f = e.join(","), g = a('<li class="data-item" title=' + f + "/>").text(f).appendTo(this.datalist).data("data", b);
            this.value && this.value.id === b._id && g.addClass("select")
        }, _bindListEvent: function () {
            var b = this, c = this.options;
            a(document).bind("mousedown.data-list", function (c) {
                var d = c.target, e = a(d).closest(b.datalist);
                0 === e.length && b._hideDataList()
            }), this.datalist.click(function (d) {
                var e = d.target, f = a(e).closest(".data-item");
                if (f && f.length > 0) {
                    if (f.hasClass("data-clear"))b.value = {}, YS.Utils.forEach(b.widgetsMap, function (a, b) {
                        b.setValue(null)
                    }); else {
                        var g = f.data("data");
                        b.value = {id: g._id, key: g[c.linkKey]}, b._setWidgetsValue(g)
                    }
                    YS.Utils.applyFunc(b, c.onStopEdit, [], !1), b._hideDataList()
                }
                return !1
            }), this.datalist.scroll(function () {
                this.scrollTop + a(this).height() > this.scrollHeight - 5 && b.loadMore()
            })
        }, _hideDataList: function () {
            a(document).unbind("mousedown.data-list"), this.datalist.detach()
        }, _formatData: function (a, b, c) {
            if (YS.Utils.isObjectEmpty(b))return "";
            var d = b.toString();
            switch (a) {
                case"address":
                    d = YS.Utils.address2Str(b, "", "pcda");
                    break;
                case"datetime":
                    d = YS.Utils.date2Str(new Date(b), c || "yyyy-MM-dd");
                    break;
                case"subform":
                    d = "";
                    break;
                case"user":
                case"usergroup":
                    d = this.nameMap ? this.nameMap[b] : b
            }
            return d
        }, checkValidate: function () {
            return this.options.fieldIsnull || !YS.Utils.isObjectEmpty(this.value)
        }, setValue: function (a) {
            var b = this.options, c = this;
            this.value = a, !YS.Utils.isObjectEmpty(a) && a.hasOwnProperty("id") && $.ajax({
                url: "/data/read_link",
                data: {formId: a.entryId || b.linkForm, linkId: a.id},
                success: function (a) {
                    c._setWidgetsValue(a.data)
                }
            })
        }, getValue: function () {
            var b = this.options;
            return this.value && this.value.id ? a.extend({entryId: b.linkForm}, this.value) : {}
        }, getText: function () {
            var a = {};
            return YS.Utils.forEach(this.widgetsMap, function (b, c) {
                a[b] = c.getText()
            }), a
        }, getLinkValue: function () {
            return this.value && this.value.key
        }, getLinkType: function () {
            return this.options.linkType
        }, getOptions: function () {
            var b = this.options;
            return a.extend(YS.LinkData.superclass.getOptions.apply(this, arguments), {
                linkFilter: b.linkFilter,
                linkFields: b.linkFields,
                linkForm: b.linkForm,
                linkKey: b.linkKey,
                linkType: b.linkType
            })
        }, getNullValue: function () {
            return {}
        }, _loadData: function (b) {
            var c = this.options, d = this;
            this.loading = !0, $.ajax({
                url: "/data/filter",
                data: {
                    multi: !0,
                    formId: c.linkForm,
                    fields: this.fields,
                    filter: this.filter,
                    fieldLimit: c.itemsPerPage,
                    skip: this.skip
                },
                success: function (e) {
                    var f = [];
                    YS.Utils.isObjectEmpty(e.result) || (f = e.result), YS.Utils.isObjectEmpty(e.nameMap) || (d.nameMap = a.extend(d.nameMap, e.nameMap)), f.length < c.itemsPerPage && (d.hasMore = !1), b ? d._createDataList(f) : YS.Utils.forEach(f, function (a, b) {
                        d._createDataItem(b)
                    })
                }
            })
        }, loadMore: function () {
            !this.loading && this.hasMore && this._loadData()
        }, reload: function (a) {
            var b = this.options, c = [];
            YS.Utils.forEach(b.linkFields, function (a, b) {
                c.push({type: b.type, name: b.name})
            }), b.linkKey && c.push({
                type: b.linkType,
                name: b.linkKey
            }), !b.linkForm || c.length <= 0 || (this.filter = a, this.fields = c, this.nameMap = {}, this.skip = 0, this.hasMore = !0, this._loadData(!0))
        }, doResize: function (a) {
            var b = this.options;
            if (b.fieldPid ) {
                var c = 154 * b.linkFields.length + 40;
                this.element.css({width: c})
            }
        }, supportLayout: function () {
            var a = this.options, b = !0;
            return YS.Utils.forEach(a.linkFields, function (a, c) {
                if ("subform" === c.type)return b = !1, !1
            }), b
        }
    }), a.shortcut("linkdata", YS.LinkData)
}(jQuery), function (a) {
    YS.Block = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.Block.superclass._defaultConfig.apply(), {
                title: "",
                visible4Title: !0,
                cls4FullScreen: "block-fullscreen",
                hasHeader: !0,
                hasBorder: !0,
                height4Head: 35,
                height: 230,
                width: 200,
                forms: [],
                filterFields: null,
                linkWidgets: null,
                allowDataLoad: !0,
                onAfterHeadCreate: null,
                scalable: !1
            })
        }, _init: function () {
            YS.Block.superclass._init.apply(this, arguments);
            var a = this.options;
            this.element.addClass("x-block-bg"), a.hasBorder || this.element.addClass("no-border"), a.hasHeader && this._onCreateHead(), this._onCreateBody()
        }, _onCreateHead: function () {
            var b = this.options;
            if (b.height4Head) {
                this.$head = a('<div class="x-block-head"/>').height(b.height4Head).css({"line-height": b.height4Head + "px"}).appendTo(this.element);
                var c = a('<div class="x-block-head-title"/>').appendTo(this.$head);
                b.visible4Title && c.text(b.title)
            }
            return YS.Utils.applyFunc(this, b.onAfterHeadCreate, [this.$head], !1), this.$head
        }, createHeadTools: function () {
            var b = this, c = this.options;
            if (this.$head.children("a").remove(), c.scalable) {
                var d = a("<a />").append('<i class="icon-enlarge">').append(a("<span />").text("全屏"));
                b.element.hasClass(c.cls4FullScreen) && (d = a("<a />").append('<i class="icon-shrink">').append(a("<span />").text("缩小"))), d.appendTo(this.$head).click(function () {
                    b.doFullScreen() ? (d.children("i").removeClass().addClass("icon-shrink"), d.children("span").text("缩小")) : (d.children("i").removeClass().addClass("icon-enlarge"), d.children("span").text("全屏"))
                })
            }
        }, _onCreateBody: function () {
            return this.$body = a('<div class="x-block-body"/>').appendTo(this.element), this._resizeBody(), this._initContent(this.$body), this.$body
        }, _resizeBody: function () {
            var a = this.options, b = {};
            if (YS.Utils.isNumber(a.width)) {
                var c = a.width;
                a.hasBorder && (c -= 2), b.width = c
            } else a.width && (b.width = a.width);
            if (YS.Utils.isNumber(a.height)) {
                var d = a.height;
                a.hasBorder && (d -= 2), a.hasHeader && (d -= a.height4Head), b.height = d, this.$body.addClass("fixed-height")
            } else !height ? (this.$body.removeClass("fixed-height"), b.height = "auto") : (this.$body.removeClass("fixed-height"), b.height = a.height);
            this.$body.css(b)
        }, _initContent: function (a) {
        }, isAllowDataLoad: function () {
            return this.options.allowDataLoad
        }, setAllowDataLoad: function (a) {
            this.options.allowDataLoad = !!a
        }, loadingAjax: function (a, b, c) {
            var d = this;
            if (this.isAllowDataLoad() && !this.isLoading) {
                this.isLoading = !0;
                var e = this.createLoadingMask();
                YS.Utils.dataAjax(a, function (a, c) {
                    return YS.Utils.applyFunc(d, b, [a, c], !1)
                }, function (a, b) {
                    return YS.Utils.applyFunc(d, c, [a, b], !1)
                }, function () {
                    e.remove(), d.isLoading = !1
                })
            }
        }, createLoadingMask: function () {
            return YS.Utils.createMask(this.element, {hasLoader: !0, isLight: !0})
        }, _makeGroups: function (b) {
            var c = [], d = function (b, d) {
                b.forEach(function (b) {
                    var e = a.extend({}, d), f = d.tag || d.name;
                    e.groupName = f + "_" + b, e.groupBy = b, c.push(e)
                })
            };
            return YS.Utils.forEach(b, function (a, b) {
                switch (b.type) {
                    case"datetime":
                        var e = b.dateType || "year";
                        d(e.split("&"), b);
                        break;
                    case"address":
                        var f = b.addressType || "province";
                        d(f.split("&"), b);
                        break;
                    default:
                        c.push(b)
                }
            }), c
        }, reload: function (a) {
        }, rebuild: function () {
            this.$body.remove(), this._onCreateBody()
        }, getOptions: function () {
            var b = this.options;
            return a.extend(YS.Block.superclass.getOptions.apply(this, arguments), {
                title: b.title,
                linkWidgets: b.linkWidgets,
                forms: b.forms,
                filterFields: b.filterFields
            })
        }, _getWidgetNameByTag: function (a) {
            var b = this.options, c = a;
            return YS.Utils.forEach([].concat(b.xFields, b.yFields), function (b, d) {
                if (d.tag && d.tag === a)return c = d.name, !1
            }), c
        }, _getLinkFilterParams: function (a) {
            var b = this.options, c = this, d = {};
            return YS.Utils.forEach(a, function (a, e) {
                var f = c._getWidgetNameByTag(a);
                if (b.relations.hasOwnProperty(f)) {
                    var g = b.relations[f];
                    YS.Utils.forEach(g, function (a, b) {
                        d.hasOwnProperty(a) || (d[a] = {}), d[a][b] = e
                    })
                } else {
                    var h = b.forms[0];
                    d.hasOwnProperty(h) || (d[h] = {}), d[h][f] = e
                }
            }), d
        }, getFilterData: function (a) {
            var b = this.options, c = {}, d = null;
            if (b.forms && b.forms.length > 1 && b.relations) {
                d = {};
                for (var e in b.relations)for (var f in b.relations[e])d[b.relations[e][f]] = e
            }
            return this._pushCurrentFilter(b.filterFields, c, d), this._pushCurrentFilter(YS.Utils.applyFunc(this, b.onDataFilter, [], null), c, d), this._pushCurrentFilter(a, c, d), c
        }, _pushCurrentFilter: function (a, b, c) {
            var d = this.options;
            a && YS.Utils.forEach(d.forms, function (d, e) {
                if (a[e])if (b[e] || (b[e] = []), c) {
                    var f = {};
                    for (var g in a[e])c[g] ? f[c[g]] = a[e][g] : f[g] = a[e][g];
                    b[e].push(f)
                } else b[e].push(a[e])
            })
        }, hasContentInited: function () {
            return this.contentInited
        }, doResize: function (a) {
            YS.Block.superclass.doResize.apply(this, arguments), this._resizeBody()
        }, doFullScreen: function () {
            var a = this.options;
            return this.element.hasClass(a.cls4FullScreen) ? (this.element.removeClass(a.cls4FullScreen), this.doResize({
                width: YS.Utils.isEmpty(this.originStyle.w) ? "auto" : this.originStyle.w,
                height: YS.Utils.isEmpty(this.originStyle.h) ? "auto" : this.originStyle.h
            }), !1) : (this.originStyle = {
                w: this.element.outerWidth(),
                h: a.height
            }, this.element.addClass(a.cls4FullScreen), this.doResize({
                width: document.body.clientWidth,
                height: document.body.clientHeight
            }), !0)
        }
    })
}(jQuery), function (a) {
    YS.Table = YS.extend(YS.Block, {
        _defaultConfig: function () {
            return a.extend(YS.Table.superclass._defaultConfig.apply(), {
                baseCls: "fui_table",
                tableHead: null,
                tableRowHead: null,
                tableData: [],
                hasMenu: !1,
                isHeadSticky: !1,
                isRowHeadSticky: !1,
                onScroll: null,
                onAfterTableCreate: null,
                onCheckValid: null,
                exportable: !0,
                scalable: !0,
                tableClass: "x-table"
            })
        }, _initContent: function (b) {
            YS.Table.superclass._initContent.apply(this, arguments);
            var c = this.options;
            this.$wrapper = a('<div class="fui_table-wrapper"/>').appendTo(b), c.hasMenu && (this.$wrapper.addClass("has-menu"), this.$menu = a('<div class="fui-table-menu"/>').appendTo(b)), this._removeTable()
        }, createHeadTools: function () {
            YS.Table.superclass.createHeadTools.apply(this, arguments);
            var b = this, c = this.options;
            c.exportable && a("<a/>").append('<i class="icon-export">').append(a("<span/>").text("导出Excel")).appendTo(this.$head).click(function () {
                b.doExcelExport()
            })
        }, createTable: function () {
            var b = this, c = this.options;
            if (this.$tableScroller = a('<div class="table-scroller"/>').scroll(function () {
                    b._scrollStickyHead()
                }).appendTo(this.$wrapper), this.$table = a('<table cellpadding="0" cellspacing="0" class="' + c.tableClass + ' x-table-bordered x-table-striped t-main"/>').appendTo(this.$tableScroller), c.tableHead && c.tableHead.length > 0) {
                var d = a('<thead class="t-head"/>').appendTo(this.$table);
                YS.Utils.forEach(c.tableHead, function (c, e) {
                    var f = a('<tr class="t-row th-row"/>').appendTo(d);
                    YS.Utils.forEach(e, function (a, c) {
                        b._createCell(c, {tag: "th", cls: "th-cell"}).appendTo(f)
                    })
                })
            }
            this.$tableBody = a('<tbody class="t-body"/>').appendTo(this.$table), this._appendTableData(), this._setEvent(), this._createStickyHead(), YS.Utils.applyFunc(this, c.onAfterTableCreate, [], !1)
        }, _appendTableData: function () {
            var b = this, c = this.options;
            YS.Utils.forEach(c.tableData, function (d, e) {
                var f = d % 2 === 0 ? "odd" : "even", g = a('<tr class="t-row tb-row"/>').addClass(f).appendTo(b.$tableBody);
                b._bindRowData(b.$tableBody, g, d), c.tableRowHead && c.tableRowHead.length > 0 && c.tableRowHead.forEach(function (a) {
                    var c = a[d];
                    c && b._createCell(c, {tag: "th", cls: "rh-cell"}).appendTo(g)
                }), YS.Utils.forEach(e, function (a, c) {
                    b._formatCell(c), c.row = d, c.col = a, b._createCell(c, {tag: "td", cls: "td-cell"}).appendTo(g)
                })
            })
        }, _bindRowData: function (a, b, c) {
        }, _formatCell: function (a) {
        }, _createCell: function (b, c) {
            var d = c || {tag: "td"};
            d.cls && b.cls && (b.cls = d.cls + " " + b.cls);
            var e = a.extend(d, b.text || b.html || !YS.Utils.isString(b) ? b : {text: b}), f = a("<" + e.tag + ' class="t-cell"/>');
            switch (f.attr({
                row: e.row,
                col: e.col
            }), e.hasOwnProperty("html") ? f.html(e.html) : f.text(e.text), e.align) {
                case"center":
                    f.addClass("h-center");
                    break;
                case"right":
                    f.addClass("h-right")
            }
            if (e.data)for (var g in e.data)e.data.hasOwnProperty(g) && f.data(g, e.data[g]);
            return e.cls && f.addClass(e.cls), e.colspan && f.attr("colspan", e.colspan), e.rowspan && f.attr("rowspan", e.rowspan), e.width && f.width(e.width), e.height && f.width(e.height), f
        }, _createStickyHead: function () {
            var b = this, c = this.options;
            c.isHeadSticky === !0 && (this.$stickyHead = a('<table cellpadding="0" cellspacing="0" class="' + c.tableClass + ' x-table-bordered x-table-striped"/>').append(this.$table.children(".t-head").clone(!0)).outerWidth(this.$table.outerWidth()), this.$stickyHead.find(".t-head .th-cell").each(function (c, d) {
                var e = b.$table.find(".t-head .th-cell").eq(c);
                a(d).outerWidth(e.outerWidth())
            }), a('<div class="table-sticky-head"/>').css({width: this.$tableScroller[0].clientWidth}).append(this.$stickyHead).appendTo(this.$wrapper)), c.isRowHeadSticky === !0 && (this.$stickyRowHead = a('<table cellpadding="0" cellspacing="0" class="' + c.tableClass + ' x-table-bordered x-table-striped"/>').append(this.$table.children(".t-head, .t-body").clone(!0)), this.$stickyRowHead.find(".t-head .th-cell").each(function (c, d) {
                var e = b.$table.find(".t-head .th-cell").eq(c);
                a(d).outerHeight(e.outerHeight()).outerWidth(e.outerWidth())
            }), this.$stickyRowHead.find(".t-row .rh-cell").each(function (c, d) {
                var e = b.$table.find(".t-row .rh-cell").eq(c);
                a(d).outerHeight(e.outerHeight())
            }), this.$stickyRowHead.children(".t-head").children("tr.t-row").each(function (b, c) {
                a(c).children(".th-cell").not(".group-head").remove()
            }), this.$stickyRowHead.find(".t-body .td-cell").remove(), a('<div class="table-sticky-row-head"/>').css({height: this.$tableScroller[0].clientHeight}).append(this.$stickyRowHead).appendTo(this.$wrapper)), c.isHeadSticky === !0 && c.isRowHeadSticky === !0 && (this.$stickyIntersect = a('<table cellpadding="0" cellspacing="0" class="' + c.tableClass + ' x-table-bordered x-table-striped"/>').append(this.$stickyRowHead.children(".t-head").clone(!0)), a('<div class="table-sticky-intersect"/>').append(this.$stickyIntersect).appendTo(this.$wrapper))
        }, rebuildStickyHead: function () {
            this.element.find(".table-sticky-head, .table-sticky-row-head, .table-sticky-intersect").remove(), this._createStickyHead()
        }, _scrollStickyHead: function () {
            var a = this.options, b = this.$tableScroller.scrollTop(), c = this.$tableScroller.scrollLeft();
            YS.Utils.applyFunc(this, a.onScroll, [c, b], !1) === !1 && (this.$stickyHead && this.$stickyHead.css({"margin-left": -c}), this.$stickyRowHead && this.$stickyRowHead.css({"margin-top": -b}))
        }, _setEvent: function () {
        }, _removeTable: function () {
            this.$wrapper.children().remove(), this.$menu && this.$menu.children().remove()
        }, reload: function (a) {
            YS.Table.superclass.reload.apply(this, arguments), this._removeTable()
        }, refresh: function () {
            this.options.tableRowHead = [], this._removeTable(), this.createTable()
        }, doResize: function (a) {
            this.options;
            YS.Table.superclass.doResize.apply(this, arguments), this.$table && (this.$stickyHead && this.$stickyHead.parent().remove(), this.$stickyRowHead && this.$stickyRowHead.parent().remove(), this.$stickyIntersect && this.$stickyIntersect.parent().remove(), this._createStickyHead(), this._scrollStickyHead())
        }, getOptions: function () {
            var b = this.options;
            return a.extend(YS.Table.superclass.getOptions.apply(this, arguments), {exportable: b.exportable})
        }
    }), a.shortcut("table", YS.Table)
}(jQuery), function (a) {
    YS.BisTablePane = YS.extend(YS.Table, {
        _defaultConfig: function () {
            return a.extend(YS.BisTablePane.superclass._defaultConfig.apply(), {
                itemEditable: !1,
                itemRemovable: !1,
                hasHeader: !1,
                hasCheck: !0,
                ajaxurl: null,
                visiableWidgetName: null,
                isHeadSticky: !1,
                isRowHeadSticky: !1,
                tableRowHead: []
            })
        }, _initContent: function(){
            YS.BisTablePane.superclass._initContent.apply(this, arguments), this.page = 0, this.count = 0, this._initBisTable()
        }, _initBisTable: function(){
            var b = this, c = this.options;
            this._loadData(function () {
                b.createTable();
            });
        }, createTable: function () {
            var b = this, c = this.options;
            if (b.fields = [],this.$tableScroller = a('<div class="table-scroller"/>').scroll(function () {
                    b._scrollStickyHead()
                }).appendTo(this.$wrapper), this.$table = a('<table cellpadding="0" cellspacing="0" class="' + c.tableClass + ' x-table-bordered x-table-striped t-main"/>').appendTo(this.$tableScroller), c.tableHead && c.tableHead.length > 0) {
                var d = a('<thead class="x-block-head"/>').appendTo(this.$table);
                var f = a('<tr class="t-row th-row"/>').appendTo(d);
                /*a('<th field="businessTableId" class="t-cell th-cell hide" />').appendTo(f);
                 a('<th field="id" class="t-cell th-cell hide" />').appendTo(f);*/
                c.hasCheck && a('<th class="cell-check t-cell th-cell" />').appendTo(f);
                YS.Utils.forEach(c.tableHead, function (c, e) {
                    b._createHeadCell(e).appendTo(f)
                });
            }
            this.$tableBody = a('<tbody class="t-body"/>').appendTo(this.$table), this._appendTableData(), this._setEvent(), this._createStickyHead(), YS.Utils.applyFunc(this, c.onAfterTableCreate, [], !1)
        }, _createHeadCell: function(a){
            var b = this, c = this.options, d = $('<th class="t-cell th-cell" />');
            d.text(a.businessTableFieldName).attr("field",a.businessTableField), b.fields.push(a.businessTableField);
            (c.visiableWidgetName && a.businessTableField != c.visiableWidgetName) && d.addClass("hide");
            return d
        }, _createCell: function(b){
            var d = this.options, c = a('<td class="t-cell td-cell"/>');
            (d.visiableWidgetName && b.field != d.visiableWidgetName) && c.addClass("hide");
            switch (c.attr({
                row: b.row,
                col: b.col
            }), c.text(b.text), b.align) {
                case"center":
                    c.addClass("h-center");
                    break;
                case"right":
                    c.addClass("h-right");
            }
            return b.cls && c.addClass(b.cls), b.colspan && c.attr("colspan", b.colspan), b.rowspan && c.attr("rowspan", b.rowspan), b.width && c.width(b.width), b.height && c.width(b.height), c
        }, appendData: function () {
            var a = this.options;
            a.tableRowHead = [], this._extendTableHead(), this._appendTableData(), (a.isHeadSticky || a.isRowHeadSticky) && this.rebuildStickyHead()
        }, getSortedFieldIdx: function (a) {
            var b = -1;
            return YS.Utils.forEach(this.sort, function (c, d) {
                if (d)return d[a] ? (b = c, !1) : void 0
            }), b
        }, _loadData: function(callback){
            var b = this, c = this.options;
            if(c.ajaxurl){
                $.ajax({
                    url: getFlowConf().flowPath + "/oa/form/business_table_field/getItemByInfoId.do?sessionId=" + _jsSessionId,
                    dataType: 'json',
                    data:{"businessTableId": c.ajaxurl},
                    success: function(data){
                        c.tableHead = data;
                        $.ajax({
                            url: getFlowConf().flowPath + "/oa/form/business_table_field/ajaxList.do?sessionId=" + _jsSessionId,
                            dataType: 'json',
                            data:{"businessTableId": c.ajaxurl},
                            success: function(dt){
                                c.tableData = dt.rows;
                                callback && callback(dt);
                            }
                        });
                    }
                });
            }
        }, _getFieldTargetName: function (a) {
            return a ? a.tag || a.name : ""
        }, _appendTableData: function () {
            var b = this, c = this.options;
            YS.Utils.forEach(c.tableData, function (d, e) {
                var f = d % 2 === 0 ? "odd" : "even", g = a('<tr class="t-row tb-row"/>').addClass(f).appendTo(b.$tableBody).data("rowdata", e).bind("click",function(){
                    b.$table.find(".select-row").removeClass("select-row").find(".cell-check input").attr("checked",false);
                    $(this).addClass("select-row").find(".cell-check input").attr("checked",true);
                });
                c.hasCheck && a('<td class="cell-check t-cell td-cell" />').append('<input type="checkbox">').appendTo(g);
                b._bindRowData(b.$tableBody, g, d, e), YS.Utils.forEach(b.fields, function (a, c) {
                    var cell = {row: d, col: a, field: c, text: e[c]};
                    b._createCell(cell).appendTo(g)
                });
            })
        }, _bindRowData: function (a, b, c, d) {
            if (this.dataMap && this.dataMap.length > c) {
                var e = this.dataMap[c];
                b.data("idx", e), b.data("rowdata", d);
            }
        }, _extendTableHead: function () {
            var b = this.options;
            if (b.hasCheck) {
                var c = a('<div class="x-check table-op-btn"><i class="icon-blank"/></div>').click(function () {
                    c.toggleClass("select")
                });
                b.tableHead[0].unshift({
                    rowspan: this.headRowCount,
                    cls: "table-op-btn-cell group-head",
                    html: c
                }), this.cols.unshift({field: "_removeCheck"}), this.removeCheckList = [], b.tableRowHead.push(this.removeCheckList)
            }
        }, _createTableData: function () {
            var a = this, b = this.options;
            b.tableData = [], this.dataMap = [], YS.Utils.forEach(a.data, function (c, d) {
                for (var e = [], f = a._calculateDataRowCount(d), g = 0; g < f; g++)e.push([]);
                YS.Utils.forEach(a.cols, function (b, c) {
                    var g = a._createCellData(d, c, !1), h = a.fieldTypeMap[c.field];
                    switch (h) {
                        default:
                            g.rowspan = f, e[0].push(g)
                    }
                }), d && YS.Utils.forEach(e, function (b, d) {
                    a.dataMap.push(c)
                }), b.tableData = b.tableData.concat(e)
            })
        }, _calculateDataRowCount: function (a) {
            var b = this, c = [1];
            for (YS.Utils.forEach(a, function (a, d) {
                d && "subform" === b.fieldTypeMap[a] && c.push(d.length || 1)
            }); c.length >= 2;)c.push(Math.max(c.pop(), c.pop()));
            return c[0]
        }, _createCellData: function (b, c, d) {
            var e, f;
            if (!b)return {text: ""};
            switch (d ? (e = b[c.subField], f = this.fieldTypeMap[c.field + "." + c.subField]) : (e = b[c.field], f = this.fieldTypeMap[c.field]), f) {
            }
            return {text: ""}
        }, getValue: function(){
            var b = this, c = this.options, d = b.$tableBody.find("tr.tb-row");
            $.each(d, function(e, f){
                if($(f).hasClass("select-row")){
                    c.value = $(f).data("rowdata"); return;
                }
            });
            return c.value
        }
    }), a.shortcut("bistablepane", YS.BisTablePane)
}(jQuery),function (a) {
    YS.ProjectBisTable = YS.extend(YS.Table, {
        _defaultConfig: function () {
            return a.extend(YS.ProjectBisTable.superclass._defaultConfig.apply(), {
                itemEditable: !1,
                baseCls: "project_bis_table",
                itemRemovable: !1,
                hasHeader: !1,
                hasCheck: !0,
                hasPagination:!1,
                initStatue:false,
                ajaxurl: null,
                labelName:null,
                visiableWidgetName: null,
                isHeadSticky: !1,
                isRowHeadSticky: !1,
                tableRowHead: []
            })
        }, _initContent: function(){
            YS.ProjectBisTable.superclass._initContent.apply(this, arguments), this.page = 1,this.pageSize = 10,this._initTableData(null,1,this.pageSize,true);
        },_initTableData:function(text,page,pageSize,bool){
            this.keyWord  = text
            var b = this, c = this.options;
            if(this.options.labelName == "装饰项目编码"){
             var procompany = "0001K310000000000ABV"
            }else if(this.options.labelName == "幕墙项目编码"){
                var procompany = "0001K310000000000F91"
            }
            var data = {
                company:procompany,
                keyword :text?text:null,
                pageIndex:page?page:1,
                pageSize:pageSize?pageSize:10,
            };
            $.ajax({
                type: "GET",
                url: getFlowConf().flowPath + "/common/ajaxListProjectInfo",
                data: data,
                dataType: "json",
                success: function (dt) {
                    if(dt.code == 100){
                        b.count = dt.data.total;
                        c.tableData=dt.data.data;
                        b._initBisTable(bool)
                    }
                },
                error: function (dt) {
                    YS.Msg.toast({
                        type: "warning",
                        msg: dt.msg?data.msg:"操作失败"
                    })
                    c.tableData=[];
                    b._initBisTable();
                }
            })
            this.initStatue = true;

        },
        _initBisTable: function(bool){
            var b = this, c = this.options;
            b.createTable(bool);
            if(bool){
                b._createPagination()
            }

        }, createTable: function () {
            var b = this, c = this.options;
            var head= [
                {id: "8a8a94aa64a635b50164a63684630005",cellWidth:89, businessTableId: "8a8a94aa6044334501604d4231050054", businessTableField: "code", businessTableFieldName: "项目编号", isShow: 0},
                {id: "8a8a94aa64a635b50164a63684640006",cellWidth:435, businessTableId: "8a8a94aa6044334501604d4231050054", businessTableField: "projectName", businessTableFieldName: "项目名称", isShow: 0},
                {id: "8a8a94aa64a635b50164a63684650007",cellWidth:59, businessTableId: "8a8a94aa6044334501604d4231050054", businessTableField: "projectNature", businessTableFieldName: "项目类型", isShow: 0},
                {id: "8a8a94aa64a635b50164a63684660008",cellWidth:72, businessTableId: "8a8a94aa6044334501604d4231050054", businessTableField: "mainManager", businessTableFieldName: "项目经理", isShow: 0}
            ];
            c.tableHead = head;
            // this.$content.empty()
            this.$wrapper[0].innerHTML = '';
            if (b.fields = [],this.$tableScroller = a('<div class="table-scroller"/>').scroll(function () {
                    b._scrollStickyHead()
                }).appendTo(this.$wrapper), this.$table = a('<table cellpadding="0" cellspacing="0" class="' + c.tableClass + ' x-table-bordered x-table-striped t-project t-main"/>').appendTo(this.$tableScroller), c.tableHead && c.tableHead.length > 0) {
                var d = a('<thead class="x-block-head x-table-head" style="position: fixed;width:680px;top: 95px;left:10px;height: 42px;border-left: 1px solid #e2e2e2;border-top: 1px solid #e2e2e2; border-bottom: 1px solid #e2e2e2;"/>').appendTo(this.$table);
                var f = a('<tr class="t-row th-row"/>').appendTo(d);
                /*a('<th field="businessTableId" class="t-cell th-cell hide" />').appendTo(f);
                 a('<th field="id" class="t-cell th-cell hide" />').appendTo(f);*/
                c.hasCheck && a('<th class="cell-check t-cell th-cell" style="width:24px" />').appendTo(f);
                YS.Utils.forEach(c.tableHead, function (c, e) {
                    b._createHeadCell(e).appendTo(f)
                });
            }
            this.$tableBody = a('<tbody class="t-body" />').appendTo(this.$table), this._appendTableData(), this._createStickyHead(), YS.Utils.applyFunc(this, c.onAfterTableCreate, [], !1)
        },_createPagination: function() {
            var t = this, i = this.options;
            t.hasPagination?t.element[0].lastElementChild.remove():null;
            new YS.Pagination({
                renderEl: a("<div />").appendTo(this.element),
                count: this.count,
                // count: 1000,
                limit: this.pageSize,
                curPage: 1,
                onChangePage: function(e, i) {
                    t.page = e - 1,t._initTableData(t.keyWord,e,i,false);
                }
            });
            t.hasPagination = true;
        },_createHeadCell: function(a){
            var b = this, c = this.options, d = $('<th class="t-cell th-cell" style="width:'+ a.cellWidth +'px"/>');
            d.text(a.businessTableFieldName).attr("field",a.businessTableField), b.fields.push(a.businessTableField);
            (c.visiableWidgetName && a.businessTableField != c.visiableWidgetName);
            return d
        }, _createCell: function(b){
            var d = this.options, c = a('<td class="t-cell td-cell" style="width:'+ b.cellWidth +'px;word-break:break-all;"/>');
            (d.visiableWidgetName && b.field != d.visiableWidgetName) ;
            switch (c.attr({
                row: b.row,
                col: b.col
            }), c.text(b.text), b.align) {
                case"center":
                    c.addClass("h-center");
                    break;
                case"right":
                    c.addClass("h-right");
            }
            return b.cls && c.addClass(b.cls), b.colspan && c.attr("colspan", b.colspan), b.rowspan && c.attr("rowspan", b.rowspan), b.width && c.width(b.width), b.height && c.width(b.height), c
        }, appendData: function () {
            var a = this.options;
            a.tableRowHead = [], this._extendTableHead(), this._appendTableData(), (a.isHeadSticky || a.isRowHeadSticky) && this.rebuildStickyHead()
        }, getSortedFieldIdx: function (a) {
            var b = -1;
            return YS.Utils.forEach(this.sort, function (c, d) {
                if (d)return d[a] ? (b = c, !1) : void 0
            }), b
        },_appendTableData: function () {
            var b = this, c = this.options;
            YS.Utils.forEach(c.tableData, function (d, e) {
                var f = d % 2 === 0 ? "odd" : "even", g = a('<tr class="t-row tb-row"/>').addClass(f).appendTo(b.$tableBody).data("rowdata", e).bind("click",function(){
                    b.$table.find(".select-row").removeClass("select-row").find(".cell-check input").attr("checked",false);
                    $(this).addClass("select-row").find(".cell-check input").attr("checked",true);
                });
                c.hasCheck && a('<td class="cell-check t-cell td-cell" style="width:23px" />').append('<input type="checkbox">').appendTo(g);
                b._bindRowData(b.$tableBody, g, d, e), YS.Utils.forEach(b.fields, function (a, c) {
                    switch (a){
                        case 0:var dataWidth=89;break;
                        case 1:var dataWidth=435;break;
                        case 2:var dataWidth=59;break;
                        case 3:var dataWidth="auto";break;
                        default:;break;
                    }
                    var cell = {row: d, col: a, field: c, text: e[c],cellWidth:dataWidth};
                    b._createCell(cell).appendTo(g)
                });
            })
        }, _bindRowData: function (a, b, c, d) {
            if (this.dataMap && this.dataMap.length > c) {
                var e = this.dataMap[c];
                b.data("idx", e), b.data("rowdata", d);
            }
        }, _extendTableHead: function () {
            var b = this.options;
            if (b.hasCheck) {
                var c = a('<div class="x-check table-op-btn"><i class="icon-blank"/></div>').click(function () {
                    c.toggleClass("select")
                });
                b.tableHead[0].unshift({
                    rowspan: this.headRowCount,
                    cls: "table-op-btn-cell group-head",
                    html: c
                }), this.cols.unshift({field: "_removeCheck"}), this.removeCheckList = [], b.tableRowHead.push(this.removeCheckList)
            }
        }, _createTableData: function () {
            var a = this, b = this.options;
            b.tableData = [], this.dataMap = [], YS.Utils.forEach(a.data, function (c, d) {
                for (var e = [], f = a._calculateDataRowCount(d), g = 0; g < f; g++)e.push([]);
                YS.Utils.forEach(a.cols, function (b, c) {
                    var g = a._createCellData(d, c, !1), h = a.fieldTypeMap[c.field];
                    switch (h) {
                        default:
                            g.rowspan = f, e[0].push(g)
                    }
                }), d && YS.Utils.forEach(e, function (b, d) {
                    a.dataMap.push(c)
                }), b.tableData = b.tableData.concat(e)
            })
        }, _calculateDataRowCount: function (a) {
            var b = this, c = [1];
            for (YS.Utils.forEach(a, function (a, d) {
                d && "subform" === b.fieldTypeMap[a] && c.push(d.length || 1)
            }); c.length >= 2;)c.push(Math.max(c.pop(), c.pop()));
            return c[0]
        }, _createCellData: function (b, c, d) {
            var e, f;
            if (!b)return {text: ""};
            switch (d ? (e = b[c.subField], f = this.fieldTypeMap[c.field + "." + c.subField]) : (e = b[c.field], f = this.fieldTypeMap[c.field]), f) {
            }
            return {text: ""}
        }, getValue: function(){
            var b = this, c = this.options, d = b.$tableBody.find("tr.tb-row");
            $.each(d, function(e, f){
                if($(f).hasClass("select-row")){
                    c.value = $(f).data("rowdata"); return;
                }
            });
            return c.value
        },
        getItems: function () {
            var b = [];
            return a(".select-item", this.$selectList).each(function (c, d) {
                b.push(a(d).data("item"))
            }), b
        }, reload: function (b) {
           this.options = a.extend(this.options, b), a(".widget-wrapper", this.element).remove(), a(".footer", this.element).remove(), this._initMain(), this.doResize()
        },
    }), a.shortcut("projectbistable", YS.ProjectBisTable)
}(jQuery), function (a) {
    YS.TableContainer = YS.extend(YS.Container, {
        _defaultConfig: function () {
            return a.extend(YS.TableContainer.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "x-layout-table",
                rowSize: [],
                colSize: [],
                hgap: 0,
                vgap: 0,
                items: [],
                padding: 0
            })
        }, _init: function () {
            YS.TableContainer.superclass._init.apply(this, arguments), this.$rows = [];
            var b = this.options;
            b.padding && this.element.css({padding: b.padding});
            for (var c = 0, d = b.rowSize.length; c < d; c++) {
                for (var e = a('<div class="x-layout-table-row"/>').appendTo(this.element), f = 0, g = b.colSize.length; f < g; f++) {
                    var h = b.items[c][f];
                    if (h) {
                        var i = a('<div class="x-layout-table-item"/>').appendTo(e);
                        h.type ? this._addWidget(a.extend(h, {
                            width: h.width ? h.width : b.colSize[f],
                            height: h.height ? h.height : b.rowSize[c],
                            renderEl: i
                        })) : i.css({
                            width: b.colSize[f],
                            height: b.rowSize[c]
                        }).append(h), f > 0 && i.css({"margin-left": b.hgap})
                    }
                }
                c > 0 && e.css({"margin-top": b.vgap}), this.$rows.push(e)
            }
        }, getRowAt: function (a) {
            return this.$rows[a]
        }, setRowVisible: function (a, b) {
            for (var c = 0, d = a.length; c < d; c++)b ? this.$rows[a[c]].show() : this.$rows[a[c]].hide()
        }
    }), a.shortcut("tablecontainer", YS.TableContainer)
}(jQuery), function (a) {
    YS.CheckBox = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.CheckBox.superclass._defaultConfig.apply(), {
                baseCls: "x-check",
                isSelected: !1,
                onStateChange: null
            })
        }, _init: function () {
            YS.CheckBox.superclass._init.apply(this, arguments);
            var b = this.options, c = this, d = a('<input type="checkbox"/>').appendTo(this.element);
            b.fieldEnable || d.attr("disabled",!0), this.$text = a("<span/>").appendTo(this.element), this.element.click(function () {
                c.isEnabled() && c.setSelected(!b.isSelected) && YS.Utils.applyFunc(c, b.onStateChange, [b.isSelected], !1)
            })
        }, _initDefaultValue: function () {
            var a = this.options;
            YS.Utils.isEmpty(a.text) || this.setText(a.text), a.value && this.setValue(a.value)
        }, setSelected: function (a) {
            return this.options.isSelected !== a && (this.options.isSelected = a, a ? this.element.addClass("select").find('input').attr('checked',!0) : this.element.removeClass("select").find('input').attr('checked',!1), !0)
        }, isSelected: function () {
            return this.options.isSelected
        }, setValue: function (a) {
            a ? this.setSelected(!0) : this.setSelected(!1)
        }, getValue: function () {
            return this.isSelected()
        }, setText: function (a) {
            this.$text.text(a)
        }, getText: function () {
            return this.$text.text()
        }
    }), a.shortcut("checkbox", YS.CheckBox)
}(jQuery), function (a) {
    YS.Button = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.Button.superclass._defaultConfig.apply(), {
                baseCls: "x-btn",
                iconCls: null,
                style: "blue"
            })
        }, _init: function () {
            YS.Button.superclass._init.apply(this, arguments);
            var b = this.options, c = this;
            b.iconCls && a("<i/>").addClass(b.iconCls).appendTo(this.element), this.$text = a("<span/>").appendTo(this.element), b.style && this.element.addClass("style-" + b.style), b.hoverCls && this.element.hover(function () {
                c.isEnabled() && a(this).addClass(b.hoverCls)
            }, function () {
                c.isEnabled() && a(this).removeClass(b.hoverCls)
            }), this.element.click(function (a) {
                c.isEnabled() && YS.Utils.applyFunc(c, b.onClick, [a], !1)
            })
        }, doResize: function (a) {
            YS.Button.superclass.doResize.apply(this, arguments);
            var b = this.options;
            YS.Utils.isEmpty(b.height) || this.element.css("line-height", b.height + "px")
        }, setValue: function (a) {
            YS.Button.superclass.setValue.apply(this, arguments), a == null && (a = ""), this.$text.text(a)
        }, setText: function (a) {
            YS.Button.superclass.setText.apply(this, arguments), a == null && (a = ""), this.$text.text(a)
        }
    }), a.shortcut("button", YS.Button)
}(jQuery), function (a) {
    YS.Label = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.Label.superclass._defaultConfig.apply(), {baseCls: "x-label", text: "", onClick: null})
        }, _init: function () {
            YS.Label.superclass._init.apply(this, arguments);
            var b = this, c = this.options;
            this.$label = a("<span/>").appendTo(this.element), c.onClick && this.$label.addClass("link").click(function () {
                YS.Utils.applyFunc(b, c.onClick, [b.$label], !1)
            })
        }, setText: function (a) {
            a = a == null ? "" : a, this.$label.text(a)
        }, setValue: function (a) {
            this.setText(a)
        }
    }), a.shortcut("label", YS.Label)
}(jQuery), function (a) {
    YS.ComboTree = YS.extend(YS.Trigger, {
        _defaultConfig: function () {
            return a.extend(YS.ComboTree.superclass._defaultConfig.apply(), {
                baseCls: "fui_combotree",
                triggerIcon: "icon-ui-combo",
                triggerList: "combotree-list",
                textField: "text",
                pIdField: "pId",
                delimiter: ",",
                parentEnable: !0,
                items: null,
                onAfterNodeClick: null,
            })
        }, _init: function () {
            YS.ComboTree.superclass._init.apply(this, arguments), this.value = [], this.text = [], this.options.async || this._createTreeView()
        }, _onTriggerClick: function (b) {
            if (this.isEnabled()) {
                var c = this;
                this._showTreeView(), a(document).bind("mousedown.treeview", function (b) {
                    var d = b.target, e = a(d).closest(c.treeView);
                    0 === e.length && c._hideTreeView()
                })
            }
        }, _createTreeView: function () {
            var b = this.options, c = this;
            this.treeView = a('<div class="x-dropdown x-dropdown-list"/>').addClass(b.triggerList), this.tree = new YS.Tree({
                renderEl: this.treeView,
                Nodes: b.items,
                setting: {
                    treeId: b.treeId,
                    data: {simpleData: {fieldEnable: true, idKey: "id", pIdKey: b.pIdField, rootPId: 0}, key: {name: b.textField, title: b.textField}},
                    callback: {
                        onClick: function (a, d) {
                            if(!b.parentEnable){
                                d.isParent ? this.onSwitchNode(a, d) : (c._setValueByNode(d), YS.Utils.applyFunc(c, b.onAfterNodeClick, [d], !1), c._hideTreeView())
                            }else{
                                c._setValueByNode(d), YS.Utils.applyFunc(c, b.onAfterNodeClick, [d], !1), c._hideTreeView()
                            }
                        }
                    }
                }
            })
        }, _setValueByNode: function (a) {
            var c = this, d = this.options;
            if (a) {
                c.value = [a.code?a.code:a.id], c.text = [a[d.textField]];
                for (var b = a.getParentNode(); b;)c.value.unshift(b.id), c.text.unshift(b[d.textField]), b = b.getParentNode()
            }
            c.editComp && c.editComp.val(c.text.join(d.delimiter))
        }, _hideTreeView: function () {
            this.treeView && (a(document).unbind("mousedown.treeview"), this.treeView.detach())
        }, _showTreeView: function () {
            null == this.treeView && this._createTreeView(), this.treeView.appendTo("body").css(this._calTriggerViewPos()).show()
        }, setValue: function (b) {
            var c = this, d = a.makeArray(b), e = this.tree.getNodes();
            this.value = [], this.text = [], YS.Utils.forEach(d, function (a, b) {
                var f = !1;
                if (YS.Utils.forEach(e, function (g, h) {
                        if(h.code){
                            if (h.code === b)return c.value.push(h.code), c.text.push(h[d.textField]), f = !0, e = h.children, a === d.length - 1 && c.tree.selectNode(h), !1
                        }else{
                            if (h.id === b)return c.value.push(h.id), c.text.push(h[d.textField]), f = !0, e = h.children, a === d.length - 1 && c.tree.selectNode(h), !1
                        }
                    }), !f)return !1
            }), this.editComp && this.editComp.val(this.text.join(this.options.delimiter))
        }, getValue: function () {
            return this.value
        }, getText: function () {
            return this[d.textField]
        }
    }), a.shortcut("combotree", YS.ComboTree)
}(jQuery), function (a) {
    YS.Dialog = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.Dialog.superclass._defaultConfig.apply(), {
                renderEl: a("<div/>").appendTo("body"),
                baseCls: "x-dialog",
                title: "",
                animation: 300,
                style4Header: null,
                hasCloseBtn: !0,
                contentWidget: {},
                autoClose: !0,
                onAfterHeaderCreate: null,
                onContentCreate: null,
                onClose: null
            })
        }, _init: function () {
            YS.Dialog.superclass._init.apply(this, arguments);
            var b = this.options, c = this;
            this.$mask = a('<div class="x-window-mask light modal fadeout scrollable"/>').css({"z-index": YS.STATIC.zIndex++}).appendTo("body"), this.element.appendTo(this.$mask), b.autoClose && this.$mask.click(function (b) {
                a(b.target).hasClass("x-window-mask") && c.close()
            });
            var d = a('<div class="dialog-header"/>').append(a('<span class="title"/>').text(b.title)).appendTo(this.element);
            b.style4Header && d.addClass(b.style4Header), b.hasCloseBtn && a('<i class="icon-close-large"/>').click(function () {
                c.close()
            }).appendTo(d), YS.Utils.applyFunc(this, b.onAfterHeaderCreate, [d], !1), this.$content = a('<div class="dialog-body"/>').appendTo(this.element), this._createContent(this.$content),this.initDialogPosition()
        }, _createContent: function (b) {
            var c = this.options;
            YS.Utils.applyFunc(this, c.onContentCreate, [b], !1) === !1 && (this.container = YS.createWidget(a.extend({
                type: "tablecontainer",
                renderEl: a("<div/>").appendTo(b)
            }, c.contentWidget)))
        }, initDialogPosition: function () {
            var scrollTop = 0;
            try{
                 scrollTop = parent.getScrollTopHeight();
            }catch(e){}
            var iframeHeight = this.element.parent().height();
            if(scrollTop && iframeHeight > 650 && iframeHeight-scrollTop >= 650){
                if(scrollTop<100){
                    this.element.css("margin-top",scrollTop);
                }else{
                    this.element.css("margin-top",scrollTop-60);
                }
            }else if(scrollTop && iframeHeight > 650  && iframeHeight-scrollTop < 650){
                if(scrollTop<100){
                    this.element.css("margin-top",scrollTop);
                }else{
                    this.element.css("margin-top",iframeHeight-620);
                }
            }else{
                this.element.css("margin-top",20);
            }

        },getWidgetByName: function (a) {
            return this.container ? this.container.getWidgetByName(a) : null
        }, show: function () {
            var a = this;
            setTimeout(function () {
                a.$mask.addClass("fadein").removeClass("fadeout")
            }, 0)
        }, close: function () {
            var a = this.options, b = this;
            this.$mask.addClass("fadeout").removeClass("fadein"), setTimeout(function () {
                b.element.remove(), b.$mask.remove(), YS.Utils.applyFunc(b, a.onClose, [], !1)
            }, a.animation)
        }, rebuildContent: function (b) {
            this.options = a.extend(this.options, b), this.$content.empty(), this._createContent(this.$content), this.doResize()
        }
    }), a.shortcut("dialog", YS.Dialog)
}(jQuery), function (a) {
    YS.ConfirmDialog = YS.extend(YS.Dialog, {
        _defaultConfig: function () {
            return a.extend(YS.ConfirmDialog.superclass._defaultConfig.apply(), {
                text4Ok: "确定",
                text4Cancel: "取消",
                btnPosition: "right",
                autoClose: !1,
                onOk: null,
                onCancel: null
            })
        }, _init: function () {
            YS.ConfirmDialog.superclass._init.apply(this, arguments), this._createButtonGroup()
        }, _createButtonGroup: function () {
            var b = this, c = this.options, d = YS.Utils.isEmpty(c.contentWidget.padding) ? 15 : c.contentWidget.padding, e = a('<div class="dialog-btn-row"/>').css({bottom: d}).appendTo(this.$content), f = a('<div class="dialog-btn ok-btn"/>'), g = a('<div class="dialog-btn cancel-btn"/>');
            "right" === c.btnPosition ? (e.css({right: d}), g.css({"margin-left": d})) : "left" === c.btnPosition && (e.css({left: d}), f.css({"margin-right": d})), c.text4Ok && (this.btnOk = new YS.Button({
                renderEl: f.appendTo(e),
                fieldId: "confirmBtnOK",
                text: c.text4Ok,
                style: "green",
                onClick: function () {
                    YS.Utils.applyFunc(b, c.onOk, [], !1) === !1 && b.close()
                }
            })), c.text4Cancel && (this.btnCancel = new YS.Button({
                renderEl: g.appendTo(e),
                fieldId: "confirmBtnCancel",
                text: c.text4Cancel,
                style: "white",
                onClick: function () {
                    YS.Utils.applyFunc(b, c.onCancel, [], !1) === !1 && b.close()
                }
            }))
        }, getOkBtn: function () {
            return this.btnOk
        }, getCancelBtn: function () {
            return this.btnCancel
        }, rebuildContent: function (a) {
            YS.ConfirmDialog.superclass.rebuildContent.apply(this, arguments), this._createButtonGroup()
        }
    }), a.shortcut("confirmdialog", YS.ConfirmDialog)
}(jQuery), function (a) {
    YS.Form = YS.extend(YS.Widget, {
        LAYOUT_SIZES: {
            normal: {text: {width: 870},number: {width: 870},datetime: {width: 870},radiogroup:{width: 870},checkboxgroup:{width:870},
                combo: {width: 870},
                combocheck: {width: 870},textarea: {width: 870}, address: {width: 870},
                user: {width: 870},
                usergroup: {width: 870},
                dept: {width: 870},
                deptgroup: {width: 870},
                company: {width: 870},
                companygroup: {width: 870},
                deptadmin: {width: 870},
                usermsg: {width: 870},
                projectmsg: {width: 870},
                bistable: {width: 870}
            },
            "grid-2": {address: {width: 870}},
            "grid-3": {
            	"2/3": {
            		text: {width: 535},
                    number: {width: 535},datetime: {width: 535},
                    combo: {width: 535},
                    combocheck: {width: 535},radiogroup:{width: 535},checkboxgroup:{width:535},
                    textarea: {width: 535},
                    user: {width: 535},
                    usergroup: {width: 535},
                    dept: {width: 535},
                    deptgroup: {width: 535},
                    company: {width: 535},
                    companygroup: {width: 535},
                    deptadmin: {width: 535},
                    usermsg: {width: 535},
                    projectmsg: {width: 535},
                    bistable: {width: 535}
            	}
            }
        }, _defaultConfig: function () {
            return a.extend(YS.Form.superclass._defaultConfig.apply(), {
                baseCls: "fui-form",
                title: "",
                dataId: null,
                onAfterItemCreate: null,
                onAfterSubmit: null,
                onSuccess: null,
                onAfterCancel: null,
                layout: "normal",
                submitRule: YS.InvisibleSubmitRules.KEEP,
                width: 1020,
                extParam: null,
                submitUrl: "/data/create",
                submitData: null,
                submitText: null,
                validators: null,
                cancelText: null,
                ignoreValidate: !1,
                widgetOptAuth: null,
                editValue: {},
                buttonPosition: "left",
                hasFooter: !0,
                hasHeader: !0,
                itemLinkWidgets: [],
                onCreateMoreBtn: null
            })
        }, _init: function () {
            YS.Form.superclass._init.apply(this, arguments);
            this._initMain()
        }, _initMain: function () {
            var b = this, c = this.options, o = c.items[c.items.length-1];
            c.hasHeader && (this.$header ? this.$header.children("span").text(title) : this.$header = a('<div class="header"/>').append(a("<span/>").text(title)).appendTo(this.element)),c.onAfterCancel && a('<i class="icon-close-large form-exit-icon">').click(function () {
                YS.Utils.applyFunc(b, c.onAfterCancel, [], !1)
            }).appendTo(this.$header), this.$wrapper = a('<div class="widget-wrapper">').appendTo(this.element);
            var d = a("<ul/>").appendTo(this.$wrapper), e = "normal-layout";
            o && "normal" != o.fieldLayout && (e = "grid-layout", c.layout = o.fieldLayout), this.element.addClass(e), this.rely = new YS.RelyProcessor(c.items);
            this.widgetsMap = {}, this.visibleWidgetsMap = {}, c.items && (c.resultWidgets = {}, c.widgetOptAuth = c.widgetOptAuth || {}, YS.Utils.forEach(c.items, function (a, j) {
                if(j.value){
                    j.fieldDefaultValue = j.value, c.editValue[j.fieldId] = j.value
                }else if(j.fieldDefaultValue){
                    c.editValue[j.fieldId] = j.fieldDefaultValue
                }
                // if(j.fieldName=="gender" && j.fieldPid){j.type=="text" && (j.type="combo"),j.items=[{code:"1",text:"男"},{code:"2",text:"女"}]};
                j.linkWidgets && (j.linkWidgets = []);
                // if(j.fieldName=="gender" && j.fieldPid){j.type=="text" && (j.type="combo"),j.items=[{code:"1",text:"男"},{code:"2",text:"女"}]}
                var e = j.fieldLineWidth || 12, f = b._createItem(a, j, d), g = f.data("widget");
                "normal" != o.fieldLayout && f.addClass("x-grid-col-" + e), b._hasContactWidgets(j) && b._initContactWidgets(j)
            })), YS.Utils.forEach(this.widgetsMap, function (a, c) {
                YS.Utils.forEach(c, function (a, c) {
                    b.visibleWidgetsMap[c] ? b._setWidgetVisible(c, !0) : b._setWidgetVisible(c, !1)
                })
            }), this._initFooter(),this._setLinkQuery();
            YS.Utils.forEach(c.editValue, function (a, c) {
                var d = b.getWidgetByName(a);
                d && (d.setValue(c,function(){
                    d.effectItemLinkWidgets && d.effectItemLinkWidgets()
                }));
            });
            this._isEditMode() || YS.Utils.forEach(this.rely.getDefaultRely(), function (a, c) {
                b._fireWidgetRelyEvent(c, null)
            })
        }, _initFooter: function () {
            var b = this, c = this.options;
            if (c.hasFooter) {
                this.$footer = a('<div style="display:none" class="footer"/>').appendTo(this.element);
                var d = c.flow && c.flow.comment;
                if (d && d.fieldEnable) {
                    this.$footer.addClass("comment-footer");
                    var e = a('<div class="comment-pane"/>').appendTo(this.$footer).append(a("<span/>").text("审批意见"));
                    d.required && e.prepend(a('<span class="label-notnull"/>').text("*")), this.flowComment = new YS.TextArea({
                        renderEl: a('<div class="comment-content"/>').appendTo(e),
                        fieldIsnull: !d.required,
                        width: "auto",
                        height: 50,
                        onStopEdit: function () {
                            c.submitData.comment = this.getValue()
                        }
                    })
                }
                var f = a('<div class="btn-pane"/>').addClass(c.buttonPosition).appendTo(this.$footer);
                c.submitText && new YS.Button({
                    renderEl: a('<div class="ok-btn"/>').appendTo(f),
                    text: c.submitText,
                    width: 120,
                    style: "green",
                    onClick: function () {
                        b.doVerifyAndSubmit()
                    }
                }), c.cancelText && new YS.Button({
                    renderEl: a('<div class="cancel-btn"/>').appendTo(f),
                    text: c.cancelText,
                    style: "white",
                    width: 120,
                    onClick: function () {
                        YS.STATIC.DATAID = null, YS.Utils.applyFunc(b, c.onAfterCancel, [!1], !0)
                    }
                }), c.submitText && c.cancelText ? f.addClass("float") : c.submitText && f.addClass("single"), YS.Utils.applyFunc(this, c.onCreateMoreBtn, [f], !1)
            }
        }, _hasContactWidgets: function (a) {
            return a && ("combo" === a.type || "radiogroup" === a.type)
        }, _isEditMode: function () {
            return "edit" === this.options.mode
        }, _isPreviewMode: function () {
            return "preview" === this.options.mode
        }, _initContactWidgets: function (a) {
            var b = !1, c = [], d = this;
            a.itemLinkeds && $.each(a.itemLinkeds, function(e, f){
            	b = !0, c.indexOf(f) < 0 && c.push(f);
            	a.value && f.value == a.value && (d.visibleWidgetsMap[f] = !0);
            });
            if (b) {
                this.widgetsMap[a.fieldId] = c;
                var e = this.getWidgetByName(a.fieldId);
                e.options.onAfterItemSelect = function (a, b) {
                	var maps = d.widgetsMap[this.options.fieldId];
                    d._showContactWidgets(maps), d._disValiContactWidgets(maps), b && YS.Utils.forEach(maps, function (a, g) {
                        if(g.value == b.code){
                        	g.isHide && d._setWidgetVisible(g.toFieldId, !1);
                        	g.isNull && d._setWidgetValidate(g.toFieldId, !0);
                        }
                    })
                }
            }
        }, _showContactWidgets: function (a) {
            var b = this;
            YS.Utils.forEach(a, function (a, c) {
                c.isHide && b._setWidgetVisible(c.toFieldId, !0)
            });
        }, _disValiContactWidgets: function(a){
        	var b = this;
            YS.Utils.forEach(a, function (a, c) {
                c.isNull && b._setWidgetValidate(c.toFieldId, !1)
            });
        }, _setWidgetVisible: function (a, b) {
            var c = this.getWidgetByName(a);
            if (c) {
                c.setVisible(b);
                var d = c.element.closest(".widget-view");
                b ? d.removeClass("hide") : d.addClass("hide")
            }
        }, _setWidgetValidate: function(a, b){
        	var c = this.getWidgetByName(a);
            if (c) {
            	c.options.fieldIsnull = !b;
                c.rebuild();
                var d = c.element.closest(".widget-view");
                b ? d.find(".fl-label").prepend('<span class="label-notnull">*</span>') : d.find(".label-notnull").remove();
            }
        }, _getWidgetOptAuth: function (a) {
            var b = this.options;
            return b.ignoreOptAuth ? {
                ignoreOptAuth: !0,
                fieldIsshow: !0,
                fieldEnable: !0
            } : b.flow || !(b.authGroupId == null) ? b.widgetOptAuth[a.fieldId] || {
                    fieldIsshow: !1,
                    fieldEnable: !1
                } : {}
        }, _getWidgetConfig: function (b) {
            var c = this, d = {
                onStopEdit: function () {
                    c._fireWidgetRelyEvent(this, null)
                }, onBeforeInit: function () {
                    var a = this.options.formula;
                    a && !c._isEditMode() && (this.options.value = c._calFormula(a, {}))
                }
            };
            switch (b) {
                case"combo":
                case"combocheck":
                    a.extend(d, {
                        onBeforeAsync: function () {
                            var a = this.options.async.data;
                            a && (a.filter = c._iterAddFilter(this))
                        }
                    });
                    break;
                case"linkdata":
                    a.extend(d, {
                        onBeforeLinkData: function (b) {
                            var d = this.element, e = this.options.linkForm;
                            if (e) {
                                var f = [], g = {};
                                YS.Utils.forEach(b, function (b, e) {
                                    var g = -1;
                                    c._isSubformWidget(e.rely) && (g = a(d).closest(".subform-line").index());
                                    var h = c.getWidgetByName(e.rely, g);
                                    if (h) {
                                        var i = h.getLinkValue();
                                        YS.Utils.isObjectEmpty(i) || f.push(c._createDataFilter(h, i, e.link))
                                    }
                                }), g[e] = f, this.reload(g)
                            }
                        }
                    });
                    break;
                case"subform":
                    a.extend(d, {
                        onBeforeWidgetCreate: function (b) {
                            a.extend(b, c._getWidgetConfig(b.type))
                        }, onAfterWidgetCreate: function (a) {
                            c._addLinkQuery(a)
                        }
                    });
                    break;
                case"user":
                case"usergroup":
                    a.extend(d, {
                        onBeforeEdit: function () {
                            var a = this.options;
                            if (a.limitWidget) {
                                var b = c.getWidgetByName(a.limitWidget);
                                if (b) {
                                    var d = b.getLinkValue();
                                    $.isArray(d) ? a.fieldLimit = d : a.fieldLimit = [d]
                                }
                            }
                        }
                    });
                    break;
            }
            return d
        }, _createItem: function (b, c, d) {
            var e = this.options, f = a('<li class="widget-view"/>').addClass("fui_"+c.type).appendTo(d), g = a('<div class="fl-label"/>').appendTo(f).append(a('<span class="label-title"/>').text(c.labelName));
            YS.Utils.isEmpty(c.fieldContent) || "<br>" === c.fieldContent || a('<div class="fl-description separator"/>').append(c.fieldContent).appendTo(f);
            if(!c.fieldIsnull){
                var h = a.extend({renderEl: a("<div/>").appendTo(a('<div class="fl-widget fl-must"/>').appendTo(f))}, this._getWidgetConfig(c.type), c, this._getWidgetOptAuth(c));
            }else{
                var h = a.extend({renderEl: a("<div/>").appendTo(a('<div class="fl-widget"/>').appendTo(f))}, this._getWidgetConfig(c.type), c, this._getWidgetOptAuth(c));
            }
            h = this._doLayoutResize(h, c.fieldLineWidth);
            var i = YS.createWidget(h);
            return this.rely.addDefaultRely(i), i.options.fieldIsnull || a('<span class="label-notnull"/>').text("*").prependTo(g), e.resultWidgets[h.fieldId] = i, f.data("widget", i), YS.Utils.applyFunc(this, e.onAfterItemCreate, [b, c, f], !1), i.isVisible() || f.addClass("hide"), f
        }, _doLayoutResize: function (b, c) {
            var d = this.options;
            this.LAYOUT_SIZES[d.layout] && this.LAYOUT_SIZES[d.layout][b.type] && a.extend(b, this.LAYOUT_SIZES[d.layout][b.type]);
            ("normal" != d.layout) && 12 == c && ("linkdata" === b.type ? a.extend(b, {layoutSize: this.LAYOUT_SIZES["normal"]}) : a.extend(b, this.LAYOUT_SIZES["normal"][b.type]));
            "grid-3" === d.layout && 8 == c && a.extend(b, this.LAYOUT_SIZES[d.layout]["2/3"][b.type]);
            return b
        }, _fireWidgetRelyEvent: function (a, b) {
            this.rely.fireRely(a, b, this)
        }, _iterAddFilter: function (b, c) {
            var d = this;
            if (b) {
                var e = b.options.rely;
                if (e && (c || (c = {}), !c[b.options.fieldId])) {
                    c[b.options.fieldId] = !0;
                    var f = {};
                    return e.data && e.ref && YS.Utils.forEach(e.widgets, function (g, h) {
                        if (c[h])return !1;
                        var i = -1;
                        d._isSubformWidget(h) && b.options.fieldPid  && (i = a(b.element).closest(".subform-line").index());
                        var j = d.getWidgetByName(h, i);
                        if (!j)return !1;
                        var k = j.getLinkValue(), l = d._createDataFilter(j, k, e.ref.field);
                        return f[e.ref.formId] = [l], a.extend(!0, f, d._iterAddFilter(j, c)), !1
                    }), f
                }
            }
        }, _createDataFilter: function (a, b, c) {
            var d = {};
            if (a && "datetime" === a.getLinkType()) {
                var e = {}, f = new Date(b);
                f.setHours(0, 0, 0, 0), e.min = f.getTime();
                var g = new Date(b);
                g.setHours(23, 59, 59, 999), e.max = g.getTime(), d[c] = {widgetType: "datelimit", widgetValue: e}
            } else {
                var h = b;
                $.isArray(b) || (h = [b]), d[c] = {widgetType: "combocheck", widgetValue: h}
            }
            return d
        }, dealRely: function (a, b, c, d) {
            var e = this, f = null, g = b.options.formula;
            b.options.fieldPid  && (f = b.element.closest(".subform-line").index());
            if (g) {
                //公式所用字段
                var h = e._getFormulaWidgets(g), i = {};
                i[a] = d, YS.Utils.forEach(h, function (a, b) {
                    var c = e.getWidgetByName(b, f);
                    if ($.isArray(c)) {
                        var d = [];
                        $.each(c, function (a, b) {
                            d.push(b.getLinkValue())
                        }), i[b] = d
                    } else c && (i[b] = c.getLinkValue())
                });
                var j = e._calFormula(g, i);
                b.setValue(j), e._fireWidgetRelyEvent(b, c)
            }
            if (g.ref && g.data) {
                var k = g.data;
                switch (b.getWidgetType()) {
                    case"combo":
                    case"combocheck":
                        b.options.async && (b.items = null), b.rebuild(), e._fireWidgetRelyEvent(b, c);
                        break;
                    case"dept":
                    case"deptgroup":
                        k.filter = e._iterAddFilter(b), $.ajax({
                            url: "/data/distinct",
                            data: k,
                            success: function (a) {
                                b.options.fieldLimit = a.items, e._fireWidgetRelyEvent(b, c)
                            }
                        });
                        break;
                    default:
                        k.filter = e._iterAddFilter(b), $.ajax({
                            url: "/data/link",
                            data: k,
                            success: function (a) {
                                b.setValue(a.result), e._fireWidgetRelyEvent(b, c)
                            }
                        })
                }
            }
            e._getLinkQueryData(b)
        }, _addLinkQuery: function (a) {
            a && "linkquery" === a.options.type && (this.linkQueryWidgets || (this.linkQueryWidgets = []), this.linkQueryWidgets.push(a))
        }, _setLinkQuery: function () {
            var a = this, b = this.options;
            $.each(b.resultWidgets, function (c, d) {
                var e = d.options;
                if(e.fieldPid){
                    b.resultWidgets[e.fieldPid].options["linkWidgets"].push(d);
                }
                if(e.itemLinkeds && e.itemLinkeds.length>0){
                	var f = [];
                	$.each(e.itemLinkeds, function(g, h){
                		if(b.resultWidgets[h.toFieldId]){
                			f.push(b.resultWidgets[h.toFieldId]);
                		}
                	});
                	e.linkWidgets = f;
                }
            });
        }, _getLinkQueryData: function (b) {
            var c = this;
            if ("linkquery" === b.options.type) {
                var d = b.options.fieldId, e = null;
                b.options.fieldPid  && (d = [b.options.fieldPid, d].join("."), e = a(b.element).closest(".subform-line").index()), this.rely.setStateMap(d, this.rely.RELY_END), this.rely.setAsyncMap(d, this.rely.RELY_END);
                var f = {}, g = [], h = b.options.linkForm;
                if (h) {
                    var i = !0;
                    YS.Utils.forEach(b.options.linkFilter, function (a, b) {
                        var d = c.getWidgetByName(b.rely, e);
                        if (d) {
                            var f = d.getLinkValue();
                            return YS.Utils.isObjectEmpty(f) ? (i = !1, !1) : void g.push(c._createDataFilter(d, f, b.link))
                        }
                    }), i && (f[h] = g, b.reload(f))
                }
            }
        }, _getSubformWidget: function (a) {
            var b = this.options, e = a;
            $.each(b.items, function(c, d){
                if(d.type == "subform"){
                    $.each(d.items, function(f, g){
                        g.fieldId == a && (e = d.fieldId)
                    })
                }
            })
            return e
        }, _isSubformWidget: function (a) {
            var b = this.options, e = !1;
            $.each(b.items, function(c, d){
                if(d.type == "subform"){
                    d.items&&$.each(d.items, function(f, g){
                        g.fieldId == a && (e = !0)
                    })
                }
            })
            return e
        }, _calFormula: function (a, b) {
            var c = this, d = a.split(/(\$[0-9a-zA-Z\._#@]+)/g), e = [];
            YS.Utils.forEach(d, function (a, d) {
                if (YS.Utils.startWith(d, "$_field_") || YS.Utils.startWith(d, "$ext")) {
                    var f = d.replace("$", "").split("#"), g = f[0], h = f[1];
                    if (YS.Utils.isEmpty(h)) {
                        var i;
                        if (b)i = b[g]; else {
                            var j = c.getWidgetByName(g);
                            j && (i = j.getLinkValue() || '')
                        }
                        var k = i ? (JSON.stringify(i) + "") : "0";
                        !isNaN(i) && i < 0 && (k = "(" + k + ")"), e.push(k)
                    } else e.push('"' + d + '"')
                } else e.push(d)
            });
            var f;
            try {
                f = YS.Utils.evalFormula(e.join(""))
            } catch (a) {
                f = ""
            }
            return f
        }, _getFormulaWidgets: function(a){
            var c = this, d = a.split(/(\$[0-9a-zA-Z\._#@]+)/g), e = [];
            $.each(d, function (a, d) {
                if (YS.Utils.startWith(d, "$_field_") || YS.Utils.startWith(d, "$ext")) {
                    var f = d.replace("$", "").split("#"), g = f[0], h = f[1];
                    if (YS.Utils.isEmpty(h)) {
                        var j = c.getWidgetByFieldId(g);
                        j && e.push(j.fieldId);
                    }
                }
            });
            return e;
        }, getWidgetByFieldId: function(a){
            var b = this, c = this.options, d = {};
            $.each(c.items, function(e, f){
                if(f.type == "subform"){
                    $.each(f.items, function(g, h){
                        if(h.fieldId == a){
                            d = h;return;
                        }
                    })
                }else if(f.fieldId == a){
                    d = f;
                    return;
                }
            });
            return d;
        }, getWidgetByName: function (a, b) {
            var c = this.options;
            if (YS.Utils.isEmpty(a) || !c.resultWidgets)return null;
            var d;
            if (this._isSubformWidget(a)) {
                var e = c.resultWidgets[this._getSubformWidget(a)];
                e && (d = e.getWidgetByName(a, b))
            } else d = c.resultWidgets[a];
            return d
        }, doSubmit: function () {
            var b = this, c = this.options;
            if (!this.ajaxLoading) {
                this.ajaxLoading = !0;
                var d = YS.Utils.createMask(this.element, {
                    hasLoader: !0,
                    isLight: !0
                }), e = a.extend({values: this.getValue()}, c.submitData);
                a.extend(e, {
                    formId: c.entryId,
                    checkRepeat: this.checkRepeat
                }), c.extParam && a.extend(e.values, {
                    ext: {
                        data: c.extParam,
                        widgetType: "text"
                    }
                }), $.ajax({
                    url: c.submitUrl,
                    data: e,
                    success: function (a, d) {
                        YS.STATIC.DATAID = null, YS.Utils.applyFunc(b, c.onSuccess, [a, e.flowAction], !1) === !1 && YS.Msg.toast({
                            type: "success",
                            msg: "提交成功"
                        })
                    },
                    error: function(){
                        var d = a.responseJSON || {}, e = d.msg || "提交失败";
                        4002 === d.code ? (YS.Msg.toast({
                            type: "warning",
                            msg: e
                        }), d.meta && YS.Utils.forEach(d.meta.repeatFields, function (a, c) {
                            var d = b.getWidgetByName(c);
                            d && b.setErrorState(d, "此项为重复值")
                        })) : YS.Msg.toast({type: "error", msg: e})
                    }
                })
            }
        }, doVerify: function () {
            var a = this, b = this.options, c = {result: !0};
            if (this.rely.checkAsyncState() || (c.result = !1, c.fieldErrMsg = "表单数据计算中，请稍后再试"), b.ignoreValidate)return c;
            var d = b.resultWidgets;
            for (var e in d) {
                var f = d[e];
                f && f.isVisible() && (this.clearErrorState(f), f.checkValidate() || (c.result = !1, this.setErrorState(f)))
            }
            return c.result && YS.Utils.forEach(b.validators, function (b, d) {
                var e = a._calFormula(d.formula);
                if (!e)return c.result = !1, c.fieldErrMsg = d.remind, !1
            }), c.result && this.flowComment && "save" !== b.submitData.flowAction && (c.result = this.flowComment.checkValidate(), c.result || (c.fieldErrMsg = "审批意见为必填项")), c
        }, setErrorState: function (b, c) {
            var d = b.element.closest("li");
            if (d.addClass("error"), d.children(".error-info").length <= 0) {
                var e = "此项为必填项";
                c && (e = c), "fieldRegexl" === b.getInvalidateType() && (e = "此项格式不正确"), d.append(a('<div class="error-info"/>').text(e))
            }
        }, clearErrorState: function (a) {
            a.setInvalidateType("blank");
            var b = a.element.closest("li");
            b.removeClass("error"), b.children(".error-info").remove()
        }, doVerifyAndSubmit: function () {
            var a = this.doVerify();
            a.result ? this.doSubmit() : YS.Msg.toast({type: "warning", msg: a.fieldErrMsg ? a.fieldErrMsg : "存在不符合规范的值"})
        }, getValue: function () {
            var a = this.options, b = this, c = {}, d = a.resultWidgets;
            this.checkRepeat = [];
            for (var e in d) {
                var f = d[e];
                if (f && YS.Utils.isValueWidget(f.getWidgetType())) {
                    var g = f.getValue();
                    if (!YS.Utils.isEmpty(g)) {
                        var h = {};
                        h[f.options.fieldId] = g, b.checkRepeat.push(h)
                    }
                    c[e] = {data: g, fieldIsshow: f.isVisible()}
                }
            }
            return c.version = this.options.version, c
        }, doResize: function (a) {
            YS.Form.superclass.doResize.apply(this, arguments);
            var b = this.options;
            b.height && (this.element.addClass("form-modal"), b.hasHeader && (this.$menu ? this.$wrapper.css({top: this.$header.outerHeight() + this.$menu.outerHeight(), height: this.element.height() - this.$menu.outerHeight()}) : this.$wrapper.css({top: this.$header.outerHeight(), height: this.element.height() - this.$header.outerHeight()})), b.hasFooter && this.$wrapper.css({bottom: this.$footer.outerHeight()}))
        }, reload: function (b) {
            this.options = a.extend(this.options, b), a(".widget-wrapper", this.element).remove(), a(".footer", this.element).remove(), this._initMain(), this.doResize()
        }
    }), a.shortcut("form", YS.Form)
}(jQuery), function (a) {
    YS.FormData = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.FormData.superclass._defaultConfig.apply(), {
                baseCls: "fui-form-data",
                title: "",
                width: 780,
                header: null,
                hasHeader: !0,
                layout: null,
                data: null,
                comments: null,
                isPrint: !1,
                hasPrintBtn: !1,
                hasEditBtn: !1,
                hasDeleteBtn: !1,
                hasRecoverBtn: !1,
                hasSwitchBtn: !1,
                dataIndex: 1,
                dataCount: 10,
                onEditData: null,
                onDeleteData: null,
                onRecoverData: null,
                onSwitchData: null,
                onClose: null,
                height: null,
                subItemWidth: 146,
                ignoreVisible: !0,
                hasCustomPrint: !1,
                authGroupId: null
            })
        }, _init: function () {
            YS.FormData.superclass._init.apply(this, arguments), this.$wrapper = a('<div class="widget-wrapper">').appendTo(this.element), this._createHeader(), this._createEditPane(), this._createPrintTitle(), this._createDataWrapper()
        }, _createHeader: function () {
            var b = this, c = this.options;
            if (c.hasHeader) {
                var d = a('<div class="preview-title-pane"/>').prependTo(this.element);
                c.isPrint || d.addClass("mini").append('<div class="preview-title">' + c.title + "</div>"), c.onClose && a('<i class="icon-close-large form-data-exit-icon">').click(function () {
                    YS.Utils.applyFunc(b, c.onClose, [b.stateChanged], !1)
                }).prependTo(d)
            }
        }, _createPrintTitle: function () {
            var b = this.options;
            !YS.Utils.isEmpty(b.title) && b.isPrint && this.element.prepend(a('<div class="print-title"/>').text(b.title))
        }, _createDataWrapper: function () {
            var b = this.options, c = this, d = a("<ul/>").appendTo(a('<div class="data-wrapper"/>').appendTo(this.$wrapper));
            this.concatMap = {}, YS.Utils.forEach(b.header, function (e, f) {
                var g = f.tag || f.name, h = b.data[g], i = f.text;
                if (b.ignoreVisible || c._dealWidgetVisible(f, h)) {
                    var j = a('<li class="widget-data-view"/>').appendTo(d);
                    c._createItem(f, i, h, j, !0)
                }
            })
        }, _dealWidgetVisible: function (a, b) {
            var c = this, d = {};
            return YS.Utils.forEach(a.items, function (a, e) {
                e.widgetsMap && (d[e.value] = !0, e.value == b || e.isOther && b && !d[b] ? YS.Utils.forEach(e.widgetsMap, function (a, b) {
                    c.concatMap[b] = !0
                }) : YS.Utils.forEach(e.widgetsMap, function (a, b) {
                    c.concatMap[b] || (c.concatMap[b] = !1)
                }))
            }), this.concatMap[a.name] === !0 || a.fieldIsshow !== !1 && this.concatMap[a.name] !== !1
        }, _isEditable: function () {
            var a = this.options, b = a.hasEditBtn || a.hasDeleteBtn;
            if (a.data && a.data._id) {
                var c = a.data._id;
                return false
            }
            return !1
        }, _createEditPane: function () {
            var b = this, c = this.options;
            if (this._isEditable() || c.hasPrintBtn || c.hasRecoverBtn || c.hasSwitchBtn) {
                var d = a('<div class="preview-edit-pane"/>').appendTo(this.$wrapper);
                if (this.$editPane = a('<div class="edit-pane"/>').appendTo(d), this._isEditable() && c.hasDeleteBtn && a('<a class="delete-btn"/>').append(a('<i class="icon-trasho">')).append(a("<span/>").text("删除")).click(function () {
                        YS.Utils.applyFunc(b, c.onDeleteData, [], !1)
                    }).appendTo(this.$editPane), this._isEditable() && c.hasEditBtn && a('<a class="edit-btn"/>').append(a('<i class="icon-flow-edit">')).append(a("<span/>").text("编辑")).click(function () {
                        YS.Utils.applyFunc(b, c.onEditData, [], !1)
                    }).appendTo(this.$editPane), c.hasRecoverBtn) {
                    0 === d.length && (d = a('<div class="preview-edit-pane"/>').appendTo(this.$wrapper));
                    var e = a('<div class="edit-pane"/>').appendTo(d);
                    e.append('<a class="style-red"><i class="icon-trasho style-red"></i><span>彻底删除</span></a>'), e.append('<a ><i class="icon-recover"></i><span>恢复</span></a>'), a("a", e).on("click", function (d) {
                        var e = !a(d.currentTarget).hasClass("style-red");
                        YS.Utils.applyFunc(b, c.onRecoverData, [c.data._id, e], !1)
                    })
                }
                c.hasSwitchBtn && this._initSwitchBtn(d)
            }
        }, _initSwitchBtn: function (b) {
            var c = this, d = this.options;
            this.dataIndex = d.dataIndex;
            var e = a('<div class="switch-pane"><div class="switch-btn prev"><i class="icon-angleleft"/></div><div class="switch-num">' + d.dataIndex + "/" + d.dataCount + '</div><div class="switch-btn next"><i class="icon-angleright"/></div></div>').appendTo(b);
            d.dataIndex <= 1 && a(".prev", e).addClass("disabled"), d.dataIndex >= d.dataCount && a(".next", e).addClass("disabled"), a(".switch-btn", e).hover(function (b) {
                var c = a(b.target).closest(".switch-btn");
                if (!c.hasClass("disabled")) {
                    var d = c.hasClass("prev"), e = "查看下一条数据，快捷键“→”";
                    d && (e = "查看上一条数据，快捷键“←”"), YS.UI.showPopover({
                        position: "bottomLeft",
                        anchor: c,
                        content: a("<span/>").text(e),
                        type: "dark"
                    })
                }
            }, function () {
                YS.UI.closePopover()
            }), e.click(function (b) {
                var d = a(b.target).closest(".switch-btn");
                if (d.length) {
                    var e = d.hasClass("prev"), f = e ? c.dataIndex - 1 : c.dataIndex + 1;
                    c._switchData(f)
                }
            }), a(document).one("keydown.ctrl_left keydown.meta_left", function () {
                c._switchData(c.dataIndex - 1, !0)
            }), a(document).one("keydown.ctrl_right keydown.meta_right", function () {
                c._switchData(c.dataIndex + 1, !0)
            }), a(document).one("keydown.left", function () {
                c._switchData(c.dataIndex - 1, !1)
            }), a(document).one("keydown.right", function () {
                c._switchData(c.dataIndex + 1, !1)
            })
        }, _showSwitchTip: function (b, c) {
            var d = this.options;
            a(".x-window-mask", this.element).remove();
            var e = YS.Utils.createMask(this.element), f = c ? "编辑" : "查看", g = "";
            return b <= 0 ? g = "已经是本页第一条数据" : b > d.dataCount && (g = "已经是本页最后一条数据"), YS.Utils.isEmpty(g) ? this.dataIndex < b ? a('<div class="switch-tip"><span>' + f + '下一条</span><i class="next icon-arrow-right"/></div>').appendTo(e) : a('<div class="switch-tip"><i class="prev icon-arrow-left"/><span>' + f + "上一条</span></div>").appendTo(e) : a('<div class="switch-tip widen"><span>' + g + "</span></div>").appendTo(e), e
        }, _switchData: function (a, b) {
            var c = this, d = this.options;
            YS.UI.closePopover();
            var e = this._showSwitchTip(a, b);
            c.switchinterval && clearTimeout(c.switchinterval), c.switchinterval = setTimeout(function () {
                e.fadeOut(300, function () {
                    YS.Utils.applyFunc(c, d.onSwitchData, [a, b], !1)
                })
            }, 500), a < 1 || a > d.dataCount || (this.dataIndex = a)
        }, _getPrintData: function () {
            var b = this, c = this.options, d = {};
            YS.Utils.forEach(c.fields, function (a, b) {
                b.tag && b.name && (d[b.tag] = b.name)
            });
            var e = {};
            YS.Utils.forEach(c.header, function (a, c) {
                b._dealPrintField(c, e, d)
            });
            var f = {};
            return YS.Utils.forEach(c.data, function (c, g) {
                d[c] && (c = d[c]), a.extend(f, b._dealPrintData(c, g, e))
            }), f
        }, _dealPrintField: function (a, b, c) {
            var d = this, e = a.name;
            switch (a.tag && (e = c[a.tag]), b[e] = a, a.type) {
                case"subform":
                    YS.Utils.forEach(a.items, function (a, c) {
                        d._dealPrintField(c, b)
                    });
                    break;
                case"linkdata":
                    YS.Utils.forEach(a.linkFields, function (a, c) {
                        d._dealPrintField(c, b)
                    })
            }
        }, _dealPrintData: function (a, b, c) {
            var d = this, e = {};
            if (!c[a])return e;
            var f = c[a].type;
            switch (f) {
                case"subform":
                    var g = {};
                    YS.Utils.forEach(b, function (b, e) {
                        YS.Utils.forEach(e, function (b, e) {
                            c[b] && YS.Utils.forEach(d._dealPrintData(b, e, c), function (b, c) {
                                var d = [a, b].join(".");
                                g[d] ? g[d].push(c) : g[d] = [c]
                            })
                        })
                    }), YS.Utils.forEach(g, function (a, b) {
                        e[a] = b
                    });
                    break;
                case"linkdata":
                    YS.Utils.forEach(c[a].linkFields, function (f, g) {
                        var h = g.name;
                        c[h] && YS.Utils.forEach(d._dealPrintData(h, b[h], c), function (b, c) {
                            e[[a, b].join("->")] = c
                        })
                    });
                    break;
                default:
                    e[a] = d._formatData(c[a], b)
            }
            return e
        }, _getLinkData: function (b, c, d) {
            if (b.linkForm && c && c.id) {
                this.options.isPrint && d && d(c);
                var e = this;
                this.nameMap || (this.nameMap = {});
                var f = {formId: c.entryId || b.linkForm, linkId: c.id};
                $.ajax({
                    url: "/data/read_link",
                    data: f,
                    success: function (b) {
                        a.extend(e.nameMap, b.nameMap), a.extend(c, b.data), d && d(c)
                    }
                })
            }
        }, _formatData: function (a, b) {
            if (!a)return b;
            var c = a.cellFmt && a.cellFmt.data || a.fieldFormat;
            switch (a.type) {
                case"datetime":
                    c = c || "yyyy-MM-dd", c && b && (b = YS.Utils.date2Str(new Date(b), c));
                    break;
                case"address":
                    c = c ? c : "pcda", b = YS.Utils.address2Str(b, "", c);
                    break;
                case"number":
                case"formula":
                    c && (b = YS.Utils.num2Str(b, c));
                    break;
                default:
                    b = b == null ? "" : b
            }
            return b
        }, _dealWidgetData: function (b, c, d) {
            var e = this, f = this.options, g = a('<div class="widget-data"/>').appendTo(d);
            switch (c = this._formatData(b, c), b.type) {
                case"upload":
                    new YS.FileUpload({mode: f.isPrint ? "print" : "preview", renderEl: g, files: c, fieldEnable: !1});
                    break;
                case"subform":
                    var h = [];
                    if (f.isPrint) {
                        YS.Utils.forEach(b.items, function (a, b) {
                            YS.Utils.isValueWidget(b.type) && ("linkdata" === b.type ? YS.Utils.forEach(b.linkFields, function (a, b) {
                                h.push(b)
                            }) : h.push(b))
                        });
                        var i = YS.Utils.chunkArray(h, 7);
                        YS.Utils.forEach(i, function (a, b) {
                            e._createSubformItem(b, c, g)
                        })
                    } else YS.Utils.forEach(b.items, function (a, b) {
                        YS.Utils.isValueWidget(b.type) && h.push(b)
                    }), this._createSubformItem(h, c, g);
                    break;
                case"combocheck":
                case"checkboxgroup":
                    var j = a("<ul/>").appendTo(g);
                    YS.Utils.forEach(c, function (b, c) {
                        j.append(a("<li/>").text(c))
                    });
                    break;
                case"textarea":
                    c && g.append(a("<pre/>").text(c));
                    break;
                case"text":
                    if (c = c == null ? "" : c, b.fieldRegexl && new RegExp(b.fieldRegexl).test(c)) {
                        var k = YS.CONST.TEXT_TYPE_REGEXP;
                        if (b.fieldRegexl === k.email) {
                            a("<a/>").attr("href", "mailto:" + c).text(c).appendTo(g);
                            break;
                        }
                    }
                    g.text(c);
                    break;
                case"chargers":
                    var l = {}, m = {};
                    YS.Utils.forEach(c, function (a, b) {
                        b.flowName && (l[b.flowName] || (l[b.flowName] = !0), m[b.userNickname] || (m[b.userNickname] = !0))
                    });
                    var n = [];
                    "node" === b.show ? YS.Utils.forEach(l, function (a) {
                        n.push(a)
                    }) : YS.Utils.forEach(m, function (a) {
                        n.push(a)
                    }), g.text(n);
                    break;
                default:
                    c = c == null ? "" : c, g.text(c)
            }
        }, _dealLinkField: function (b, c) {
            var d = this;
            if (!this.options.isPrint) {
                var e = c[b.name];
                switch (b.type) {
                    case"subform":
                        YS.Utils.forEach(b.items, function (b, c) {
                            a.extend(c, YS.Utils.getFieldAttr(c))
                        });
                        break;
                    case"user":
                        c[b.name] = this.nameMap[e];
                        break;
                    case"usergroup":
                        YS.Utils.forEach(e, function (a, b) {
                            e[a] = d.nameMap[b]
                        })
                }
            }
        }, _isItemValid: function (a) {
            switch (a.type) {
                case"formula":
                case"flowState":
                case"chargers":
                    return !0;
                default:
                    return YS.Utils.isValueWidget(a.type) || a.isJoined || /_join_/.test(a.name)
            }
        }, _createItem: function (b, c, d, e, f) {
            var g = this;
            this.options;
            if (this._isItemValid(b)) {
                if (d && "linkdata" === b.type) {
                    var h = a("<ul/>").appendTo(e);
                    return this._getLinkData(b, d, function (c) {
                        YS.Utils.forEach(b.linkFields, function (b, d) {
                            var e = a("<li/>").appendTo(h);
                            g._dealLinkField(d, c), g._createItem(d, d.text, c[d.name], e, !0)
                        })
                    }), e
                }
                if ("chargers" === b.type && !b.show) {
                    var i = a("<ul/>").appendTo(e);
                    return g._createItem(a.extend({show: "node"}, b), "当前节点", d, a("<li/>").appendTo(i), !0), g._createItem(a.extend({show: "user"}, b), "当前负责人", d, a("<li/>").appendTo(i), !0), e
                }
                return c && a('<div class="widget-label"/>').appendTo(e).append(a('<span class="label-title"/>').text(c)), d == null && !f || this._dealWidgetData(b, d, e), e
            }
        }, _createSubformItem: function (b, c, d) {
            var e = this, f = (this.options, a('<table class="widget-subform"/>').appendTo(d)), g = a("<tr/>").appendTo(a('<thead class="widget-label"/>').appendTo(f));
            YS.Utils.forEach(b, function (b, c) {
                if (c.visible !== !1)if ("linkdata" === c.type)YS.Utils.forEach(c.linkFields, function (b, c) {
                    var d = a('<td class="widget-item"/>').appendTo(g);
                    e._createItem(c, c.text, null, d)
                }); else {
                    var d = a('<td class="widget-item"/>').appendTo(g);
                    e._createItem(c, c.text, null, d)
                }
            });
            var h = a('<tbody class="widget-data"/>').appendTo(f);
            YS.Utils.forEach(c, function (c, d) {
                var f = a("<tr/>").appendTo(h);
                YS.Utils.forEach(b, function (b, c) {
                    if (c.visible !== !1)if ("linkdata" === c.type) {
                        var g = {};
                        YS.Utils.forEach(c.linkFields, function (b, c) {
                            g[c.name] = a('<td class="widget-item"/>').appendTo(f)
                        }), e._getLinkData(c, d[c.name], function (b) {
                            a.extend(d, b), YS.Utils.forEach(c.linkFields, function (a, c) {
                                e._dealWidgetData(c, b[c.name], g[c.name])
                            })
                        })
                    } else {
                        var h = a('<td class="widget-item"/>').appendTo(f);
                        e._dealWidgetData(c, d[c.name], h)
                    }
                })
            })
        }, doResize: function () {
            YS.FormData.superclass.doResize.apply(this, arguments);
            var a = this.options;
            YS.Utils.isEmpty(a.height) && this.$wrapper.addClass("relative-height")
        }
    }), a.shortcut("formdata", YS.FormData)
}(jQuery), function (a) {
    YS.DateLimit = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.DateLimit.superclass._defaultConfig.apply(), {
                baseCls: "fui_date_limit",
                fieldFormat: "yyyy-MM-dd",
                wrap: !1,
                width4date: 150
            })
        }, _init: function () {
            YS.DateLimit.superclass._init.apply(this, arguments);
            var b = this.options, c = this;
            this.startDate = YS.createWidget({
                type: "datetime",
                renderEl: a('<div class="limit-item"/>').appendTo(this.element),
                fieldFormat: b.fieldFormat,
                onStopEdit: function () {
                    YS.Utils.applyFunc(c, b.onStopEdit, arguments, !1)
                },
                value: null,
                width: b.width4date
            }), this.endDate = YS.createWidget({
                type: "datetime",
                renderEl: a('<div class="limit-item"/>').appendTo(this.element),
                fieldFormat: b.fieldFormat,
                onStopEdit: function () {
                    YS.Utils.applyFunc(c, b.onStopEdit, arguments, !1)
                },
                value: null,
                width: b.width4date
            }), b.wrap ? (a('<div class="limit-wrap"/>').append(a('<div class="limit-item item-title"/>').text("起始日期")).append(this.startDate.element).appendTo(this.element), a('<div class="limit-wrap"/>').append(a('<div class="limit-item item-title"/>').text("结束日期")).append(this.endDate.element).appendTo(this.element)) : a('<div class="limit-item limit-to"/>').text("~").insertBefore(this.endDate.element)
        }, setValue: function (a) {
            a ? (a.max == null ? this.endDate.setValue(null) : this.endDate.setValue(a.max), a.min == null ? this.startDate.setValue(null) : this.startDate.setValue(a.min)) : (this.endDate.setValue(null), this.startDate.setValue(null))
        }, getValue: function () {
            var a = this.startDate.getValue(), b = this.endDate.getValue(), c = {};
            if (!(a == null)) {
                var d = new Date(a);
                d.setHours(0, 0, 0, 0), c.min = d.getTime()
            }
            if (!(b == null)) {
                var e = new Date(b);
                e.setHours(23, 59, 59, 999), c.max = e.getTime()
            }
            return c
        }
    }), a.shortcut("datelimit", YS.DateLimit)
}(jQuery), function (a) {
    YS.NumberLimit = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.NumberLimit.superclass._defaultConfig.apply(), {
                baseCls: "fui_number_limit",
                width4number: 150
            })
        }, _init: function () {
            YS.NumberLimit.superclass._init.apply(this, arguments);
            var b = this.options, c = this;
            this.minNumber = YS.createWidget({
                type: "number",
                renderEl: a('<div class="limit-item"/>').appendTo(this.element),
                allowDecimals: !0,
                onStopEdit: function (a, d) {
                    YS.Utils.applyFunc(c, b.onStopEdit, [a, d], !1)
                },
                width: b.width4number
            }), a('<div class="limit-item limit-to"/>').text("~").appendTo(this.element), this.maxNumber = YS.createWidget({
                type: "number",
                renderEl: a('<div class="limit-item"/>').appendTo(this.element),
                allowDecimals: !0,
                onStopEdit: function (a, d) {
                    YS.Utils.applyFunc(c, b.onStopEdit, [a, d], !1)
                },
                width: b.width4number
            })
        }, checkValidate: function () {
            return this.maxNumber.checkValidate() && this.minNumber.checkValidate()
        }, setValue: function (a) {
            a ? (a.max == null ? this.maxNumber.setValue(null) : this.maxNumber.setValue(a.max), a.min == null ? this.minNumber.setValue(null) : this.minNumber.setValue(a.min)) : (this.maxNumber.setValue(null), this.minNumber.setValue(null))
        }, getValue: function () {
            var a = this.maxNumber.getValue(), b = this.minNumber.getValue(), c = {};
            return b == null || (c.min = b), a == null || (c.max = a), c
        }
    }), a.shortcut("numberlimit", YS.NumberLimit)
}(jQuery), function ($) {
    YS.DomTree = YS.extend(YS.Widget, {
        setting: {
            treeId: "tree",
            treeObj: null,
            view: {
                addDiyDom: null,
                autoCancelSelected: !0,
                dblClickExpand: !1,
                expandSpeed: "fast",
                fontCss: {},
                nameIsHTML: !1,
                selectedMulti: !1,
                showIcon: !1,
                showLine: !1,
                showTitle: !0,
                txtSelectedEnable: !1
            },
            data: {
                key: {children: "children", name: "name", title: "", url: "url", checked: "checked"},
                simpleData: {fieldEnable: !1, idKey: "id", pIdKey: "pId", rootPId: null},
                keep: {parent: !1, leaf: !1}
            },
            async: {
                fieldEnable: !1,
                contentType: "application/x-www-form-urlencoded",
                type: "post",
                dataType: "text",
                url: "",
                autoParam: [],
                otherParam: [],
                dataFilter: null
            },
            callback: {
                beforeAsync: null,
                beforeNodeCreate: null,
                beforeClick: null,
                beforeDblClick: null,
                beforeRightClick: null,
                beforeMouseDown: null,
                beforeMouseUp: null,
                beforeExpand: null,
                beforeCollapse: null,
                beforeRemove: null,
                beforeCheck: null,
                onAsyncError: null,
                onAsyncSuccess: null,
                onNodeCreated: null,
                onClick: null,
                onDblClick: null,
                onRightClick: null,
                onMouseDown: null,
                onMouseUp: null,
                onExpand: null,
                onCollapse: null,
                onRemove: null,
                onCheck: null
            },
            consts: {
                className: {BUTTON: "button", LEVEL: "level", ICO_LOADING: "ico_loading", SWITCH: "switch"},
                event: {
                    NODECREATED: "tree_nodeCreated",
                    CLICK: "tree_click",
                    EXPAND: "tree_expand",
                    COLLAPSE: "tree_collapse",
                    ASYNC_SUCCESS: "tree_async_success",
                    ASYNC_ERROR: "tree_async_error",
                    CHECK: "tree_check"
                },
                id: {A: "_a", ICON: "_ico", SPAN: "_span", SWITCH: "_switch", UL: "_ul", CHECK: "_check"},
                line: {
                    ROOT: "root",
                    ROOTS: "roots",
                    CENTER: "center",
                    BOTTOM: "bottom",
                    NOLINE: "noline",
                    LINE: "line"
                },
                folder: {OPEN: "open", CLOSE: "close", DOCU: "docu"},
                node: {CURSELECTED: "curSelectedNode"},
                checkbox: {
                    STYLE: "x-check",
                    DEFAULT: "x-tree-check",
                    DISABLED: "disable",
                    FALSE: "",
                    TRUE: "select",
                    FULL: "full",
                    PART: "part",
                    FOCUS: "focus"
                },
                radio: {STYLE: "radio", TYPE_ALL: "all", TYPE_LEVEL: "level"}
            },
            check: {
                fieldEnable: !1,
                autoCheckTrigger: !1,
                chkStyle: "x-check",
                nocheckInherit: !1,
                chkDisabledInherit: !1,
                radioType: "level",
                chkboxType: {Y: "ps", N: "ps"}
            }
        }, getDOMBySelector: function (a, b, c) {
            return b && "string" != typeof b && (c = b, b = ""), "string" == typeof a ? $(a, c ? c.treeObj.get(0).ownerDocument : null) : $("#" + a.tId + b, c ? c.treeObj : null)
        }, makeUlLineClass: function (a, b) {
            return a.view.showLine && !b.isLastNode ? a.consts.line.LINE : ""
        }, makeUlHtml: function (a, b, c, d) {
            c.push("<ul id='", b.tId, a.consts.id.UL, "' class='", a.consts.className.LEVEL, b.level, " ", this.makeUlLineClass(a, b), "' style='display:", b.open ? "block" : "none", "'>"), c.push(d), c.push("</ul>")
        }, appendParentULDom: function (a, b) {
            var c = [], d = this.getDOMBySelector(b, a);
            !d.get(0) && b.parentTId && (this.appendParentULDom(a, b.getParentNode()), d = this.getDOMBySelector(b, a));
            var e = this.getDOMBySelector(b, a.consts.id.UL, a);
            e.get(0) && e.remove();
            var f = a.data.key.children, g = this.appendNodes(a, b.level + 1, b[f], b, !1, !0);
            this.makeUlHtml(a, b, c, g.join("")), d.append(c.join(""))
        }, makeNodeIcoStyle: function (a, b) {
            var c = [];
            if (!b.isAjaxing) {
                var d = b.isParent && b.iconOpen && b.iconClose ? b.open ? b.iconOpen : b.iconClose : b.icon;
                d && c.push("background:url(", d, ") 0 0 no-repeat;"), a.view.showIcon !== !1 && YS.Utils.applyFunc(this, a.view.showIcon, [b], !0) || c.push("width:0px;height:0px;")
            }
            return c.join("")
        }, makeNodeLineClass: function (a, b) {
            var c = [], d = a.consts;
            return a.view.showLine ? 0 === b.level && b.isFirstNode && b.isLastNode ? c.push(d.line.ROOT) : 0 === b.level && b.isFirstNode ? c.push(d.line.ROOTS) : b.isLastNode ? c.push(d.line.BOTTOM) : c.push(d.line.CENTER) : c.push(d.line.NOLINE), b.isParent ? c.push(b.open ? a.consts.folder.OPEN : a.consts.folder.CLOSE) : c.push(d.folder.DOCU), this.makeNodeLineClassEx(a, b) + c.join("_")
        }, makeNodeLineClassEx: function (a, b) {
            return a.consts.className.BUTTON + " " + a.consts.className.LEVEL + b.level + " " + a.consts.className.SWITCH + " x-iconfont "
        }, setNodeLineIcos: function (a, b) {
            if (b) {
                var c = this.getDOMBySelector(b, a.consts.id.SWITCH, a), d = this.getDOMBySelector(b, a.consts.id.UL, a), e = this.getDOMBySelector(b, a.consts.id.ICON, a), f = this.makeUlLineClass(a, b);
                0 === f.length ? d.removeClass(a.consts.line.LINE) : d.addClass(f), c.attr("class", this.makeNodeLineClass(a, b)), b.isParent ? c.removeAttr("disabled") : c.attr("disabled", "disabled"), e.removeAttr("style"), e.attr("style", this.makeNodeIcoStyle(a, b)), e.attr("class", this.makeNodeIcoClass(a, b))
            }
        }, cancelPreSelectedNode: function (a, b) {
            for (var c = this.root.curSelectedList, d = 0, e = c.length - 1; e >= d; e--)if ((!b || b === c[e]) && (this.getDOMBySelector(c[e], a.consts.id.A, a).removeClass(a.consts.node.CURSELECTED), b)) {
                this.removeSelectedNode(a, b);
                break
            }
            b || (this.root.curSelectedList = [])
        }, getNodeMainDom: function (a) {
            return $(a).parent("li").get(0) || $(a).parentsUntil("li").parent().get(0)
        }, $$: function(a, b, c) {
            if (!!b && typeof b != "string") {
                c = b;
                b = "";
            }
            if (typeof a == "string") {
                return $(a, c ? c.treeObj.get(0).ownerDocument : null);
            } else {
                return $("#" + a.tId + b, c ? c.treeObj : null);
            }
        }, getMDom: function (a, b, c) {
            if (!b)return null;
            for (; b && b.id !== a.treeId;) {
                for (var d = 0, e = c.length; b.tagName && d < e; d++)if (b.tagName == c[d].tagName && null !== b.getAttribute(c[d].attrName))return b;
                b = b.parentNode
            }
            return null
        }, getNodeName: function (a, b) {
            var c = a.data.key.name;
            return "" + b[c]
        }, getNodeTitle: function (a, b) {
            var c = "" === a.data.key.title ? a.data.key.name : a.data.key.title;
            return "" + b[c]
        }, makeDOMNodeIcon: function (a, b, c) {
            var d = this.getNodeName(b, c), e = b.view.nameIsHTML ? d : d.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
            a.push("<i id='", c.tId, b.consts.id.ICON, "' title='' treeNode", b.consts.id.ICON, " class='", this.makeNodeIcoClass(b, c), "' style='", this.makeNodeIcoStyle(b, c), "'></i><span id='", c.tId, b.consts.id.SPAN, "'>", e, "</span>")
        }, makeDOMNodeLine: function (a, b, c) {
            a.push("<i id='", c.tId, b.consts.id.SWITCH, "' title='' class='", this.makeNodeLineClass(b, c), "' treeNode", b.consts.id.SWITCH, "></i>")
        }, makeDOMNodeMainAfter: function (a, b, c) {
            a.push("</li>")
        }, makeDOMNodeMainBefore: function (a, b, c) {
            a.push("<li id='", c.tId, "' class='", b.consts.className.LEVEL, c.level, "' tabindex='0' hidefocus='true' treenode>")
        }, makeDOMNodeNameAfter: function (a, b, c) {
            a.push("</a>")
        }, makeDOMNodeNameBefore: function (a, b, c) {
            var d = this.getNodeTitle(b, c), e = this.makeNodeUrl(b, c), f = this.makeNodeFontCss(b, c), g = [];
            for (var h in f)g.push(h, ":", f[h], ";");
            a.push("<a id='", c.tId, b.consts.id.A, "' class='", b.consts.className.LEVEL, c.level, "' treeNode", b.consts.id.A, ' onclick="', c.click || "", '" ', null != e && e.length > 0 ? "href='" + e + "'" : "", " target='", this.makeNodeTarget(c), "' style='", g.join(""), "'"), YS.Utils.applyFunc(this, b.view.showTitle, [c], b.view.showTitle) && d && a.push("title='", d.replace(/'/g, "&#39;").replace(/</g, "&lt;").replace(/>/g, "&gt;"), "'"), a.push(">")
        }, makeNodeFontCss: function (a, b) {
            var c = YS.Utils.applyFunc(this, a.view.fontCss, [b], a.view.fontCss);
            return c && "function" != typeof c ? c : {}
        }, makeNodeIcoClass: function (a, b) {
            var c = ["ico"];
            return b.isAjaxing || (c[0] = (b.iconSkin ? b.iconSkin + "_" : "") + c[0], b.isParent ? c.push(b.open ? a.consts.folder.OPEN : a.consts.folder.CLOSE) : c.push(a.consts.folder.DOCU)), a.consts.className.BUTTON + " " + c.join("_") + " x-iconfont"
        }, makeNodeTarget: function (a) {
            return a.target || "_blank"
        }, makeNodeUrl: function (a, b) {
            var c = a.data.key.url;
            return b[c] ? b[c] : null
        }, setFirstNode: function (a, b) {
            var c = a.data.key.children, d = b[c].length;
            d > 0 && (b[c][0].isFirstNode = !0)
        }, setLastNode: function (a, b) {
            var c = a.data.key.children, d = b[c].length;
            d > 0 && (b[c][d - 1].isLastNode = !0)
        }, removeNode: function (a, b) {
            var c = a.data.key.children, d = b.parentTId ? b.getParentNode() : null;
            if (b.isFirstNode = !1, b.isLastNode = !1, b.getPreNode = function () {
                    return null
                }, b.getNextNode = function () {
                    return null
                }, this.getNodeCache(b.tId)) {
                this.removeNodeCache(a, b), this.removeSelectedNode(a, b);
                for (var e = 0, f = d[c].length; e < f; e++)if (d[c][e].tId == b.tId) {
                    d[c].splice(e, 1);
                    break
                }
                var g = this.getDOMBySelector(b, "");
                g && g.length > 0 && g.remove()
            }
        }, replaceIcoClass: function (a, b, c) {
            if (b && !a.isAjaxing) {
                var d = b.attr("class");
                if (void 0 != d) {
                    var e = d.split("_"), f = this.options.setting;
                    switch (c) {
                        case f.consts.folder.OPEN:
                        case f.consts.folder.CLOSE:
                        case f.consts.folder.DOCU:
                            e[e.length - 1] = c
                    }
                    b.attr("class", e.join("_") + " x-iconfont")
                }
            }
        }, replaceSwitchClass: function (a, b, c) {
            if (b) {
                var d = b.attr("class");
                if (void 0 != d) {
                    var e = d.split("_"), f = this.options.setting;
                    switch (c) {
                        case f.consts.line.ROOT:
                        case f.consts.line.ROOTS:
                        case f.consts.line.CENTER:
                        case f.consts.line.BOTTOM:
                        case f.consts.line.NOLINE:
                            e[0] = this.makeNodeLineClassEx(a) + c;
                            break;
                        case f.consts.folder.OPEN:
                        case f.consts.folder.CLOSE:
                        case f.consts.folder.DOCU:
                            e[1] = c
                    }
                    b.attr("class", e.join("_")), c !== f.consts.folder.DOCU ? b.removeAttr("disabled") : b.attr("disabled", "disabled")
                }
            }
        }, selectNode: function (a, b) {
            var c = this.options.setting;
            b || this.cancelPreSelectedNode(c), this.getDOMBySelector(a, c.consts.id.A, c).addClass(c.consts.node.CURSELECTED), this.addSelectedNode(c, a)
        }, setNodeFontCss: function (a, b) {
            var c = this.getDOMBySelector(b, a.consts.id.A, a), d = this.makeNodeFontCss(a, b);
            d && c.css(d)
        }, setNodeName: function (a, b) {
            var c = this.getNodeTitle(a, b), d = this.getDOMBySelector(b, a.consts.id.SPAN, a);
            if (d.empty(), a.view.nameIsHTML ? d.html(this.getNodeName(a, b)) : d.text(this.getNodeName(a, b)), YS.Utils.applyFunc(this, a.view.showTitle, [b], a.view.showTitle)) {
                var e = this.getDOMBySelector(b, a.consts.id.A, a);
                e.attr("title", c ? c : "")
            }
        }, setNodeTarget: function (a, b) {
            var c = this.getDOMBySelector(b, a.consts.id.A, a);
            c.attr("target", this.makeNodeTarget(b))
        }, setNodeUrl: function (a, b) {
            var c = this.getDOMBySelector(b, a.consts.id.A, a), d = this.makeNodeUrl(a, b);
            null == d || 0 === d.length ? c.removeAttr("href") : c.attr("href", d)
        }, switchNode: function (a, b) {
            if (b.open || !this.canAsync(a, b))this.expandCollapseNode(a, b, !b.open); else if (a.async.fieldEnable) {
                if (!this.asyncNode(a, b))return void this.expandCollapseNode(a, b, !b.open)
            } else b && this.expandCollapseNode(a, b, !b.open)
        }
    }), YS.EventTree = YS.extend(YS.DomTree, {
        bindTree: function (a) {
            var b = this.element, c = this;
            a.view.txtSelectedEnable || b.bind("selectstart", function (a) {
                var b = a.originalEvent.srcElement.nodeName.toLowerCase();
                return "input" === b || "textarea" === b
            }).css({"-mo-user-select": "-mo-none"});
            var d = function (a) {
                var b = c.doProxy(a), d = !0;
                return b && (b.nodeEventCallback && (d = b.nodeEventCallback.apply(c, [a, b.node]) && d), b.treeEventCallback && (d = b.treeEventCallback.apply(c, [a, b.node]) && d)), d
            };
            b.bind("click", d).bind("dblclick", d).bind("mouseover", d).bind("mouseout", d).bind("mousedown", d).bind("mouseup", d).bind("contextmenu", d)
        }, doProxy: function (a) {
            var b = a.target, c = this.options.setting, d = "", e = null, f = "", g = "", h = null, i = null, j = null;
            if ("mousedown" == a.type ? g = "mousedown" : "mouseup" == a.type ? g = "mouseup" : "contextmenu" == a.type ? g = "contextmenu" : "click" == a.type ? "I" != b.tagName && "SPAN" != b.tagName || null === b.getAttribute("treeNode" + c.consts.id.SWITCH) ? (j = this.getMDom(c, b, [{
                    tagName: "A",
                    attrName: "treeNode" + c.consts.id.A
                }]), j && (d = this.getNodeMainDom(j).id, f = "clickNode")) : (d = this.getNodeMainDom(b).id, f = "switchNode") : "dblclick" == a.type && (g = "dblclick", j = this.getMDom(c, b, [{
                        tagName: "A",
                        attrName: "treeNode" + c.consts.id.A
                    }]), j && (d = this.getNodeMainDom(j).id, f = "switchNode")), g.length > 0 && 0 === d.length && (j = this.getMDom(c, b, [{
                    tagName: "A",
                    attrName: "treeNode" + c.consts.id.A
                }]), j && (d = this.getNodeMainDom(j).id)), d.length > 0)switch (e = this.getNodeCache(d), f) {
                case"switchNode":
                    e.isParent && ("click" == a.type || "dblclick" == a.type && YS.Utils.applyFunc(this, c.view.dblClickExpand, [e], c.view.dblClickExpand)) ? h = this.onSwitchNode : f = "";
                    break;
                case"clickNode":
                    h = this.onClickNode
            }
            switch (g) {
                case"mousedown":
                    i = this.onTreeMousedown;
                    break;
                case"mouseup":
                    i = this.onTreeMouseup;
                    break;
                case"dblclick":
                    i = this.onTreeDblclick;
                    break;
                case"contextmenu":
                    i = this.onTreeContextmenu
            }
            var k = {node: e, nodeEventType: f, nodeEventCallback: h, treeEventType: g, treeEventCallback: i};
            return k
        }, bindEvent: function (a) {
            var b = this.element, c = a.consts.event, d = this;
            b.bind(c.NODECREATED, function (b, c) {
                YS.Utils.applyFunc(d, a.callback.onNodeCreated, [b, c])
            }), b.bind(c.CLICK, function (b, c, e, f) {
                YS.Utils.applyFunc(d, a.callback.onClick, [c, e, f])
            }), b.bind(c.EXPAND, function (b, c) {
                YS.Utils.applyFunc(d, a.callback.onExpand, [b, c])
            }), b.bind(c.COLLAPSE, function (b, c) {
                YS.Utils.applyFunc(d, a.callback.onCollapse, [b, c])
            }), b.bind(c.ASYNC_SUCCESS, function (b, c, e) {
                YS.Utils.applyFunc(d, a.callback.onAsyncSuccess, [b, c, e])
            }), b.bind(c.ASYNC_ERROR, function (b, c, e, f, g) {
                YS.Utils.applyFunc(d, a.callback.onAsyncError, [b, c, e, f, g])
            })
        }, unbindTree: function () {
            var a = this.element, b = this.options.setting.consts.event;
            a.unbind("click").unbind("dblclick").unbind("mouseover").unbind("mouseout").unbind("mousedown").unbind("mouseup").unbind("contextmenu").unbind(b.NODECREATED).unbind(b.CLICK).unbind(b.EXPAND).unbind(b.COLLAPSE).unbind(b.ASYNC_SUCCESS).unbind(b.ASYNC_ERROR).unbind(b.CHECK)
        }, onSwitchNode: function (a, b) {
            var c = this.options.setting;
            if (b.open) {
                if (YS.Utils.applyFunc(this, c.callback.beforeCollapse, [b], !0) === !1)return !0
            } else if (YS.Utils.applyFunc(this, c.callback.beforeExpand, [b], !0) === !1)return !0;
            return this.root.expandTriggerFlag = !0, this.switchNode(c, b), !0
        }, onClickNode: function (a, b) {
            var c = this.options.setting, d = c.view.autoCancelSelected && (a.ctrlKey || a.metaKey) && this.isSelectedNode(c, b) ? 0 : c.view.autoCancelSelected && (a.ctrlKey || a.metaKey) && c.view.selectedMulti ? 2 : 1;
            return YS.Utils.applyFunc(this, c.callback.beforeClick, [b, d], !0) === !1 || (0 === d ? this.cancelPreSelectedNode(c, b) : this.selectNode(b, 2 === d), c.treeObj.trigger(c.consts.event.CLICK, [a, b, d]), !0)
        }, onTreeMousedown: function (a, b) {
            var c = this.options.setting;
            return YS.Utils.applyFunc(this, c.callback.beforeMouseDown, [b], !0) && YS.Utils.applyFunc(this, c.callback.onMouseDown, [a, b]), !0
        }, onTreeMouseup: function (a, b) {
            var c = this.options.setting;
            return YS.Utils.applyFunc(this, c.callback.beforeMouseUp, [b], !0) && YS.Utils.applyFunc(this, c.callback.onMouseUp, [a, b]), !0
        }, onTreeDblclick: function (a, b) {
            var c = this.options.setting;
            return YS.Utils.applyFunc(this, c.callback.beforeDblClick, [b], !0) && YS.Utils.applyFunc(this, c.callback.onDblClick, [a, b]), !0
        }, onTreeContextmenu: function (a, b) {
            var c = this.options.setting;
            return YS.Utils.applyFunc(this, c.callback.beforeRightClick, [b], !0) && YS.Utils.applyFunc(this, c.callback.onRightClick, [a, b]), "function" != typeof c.callback.onRightClick
        }, createNodeCallback: function (a) {
            if (a.callback.onNodeCreated || a.view.addDiyDom)for (var b = this.root; b.createdNodes.length > 0;) {
                var c = b.createdNodes.shift();
                YS.Utils.applyFunc(this, a.view.addDiyDom, [c]), a.callback.onNodeCreated && a.treeObj.trigger(a.consts.event.NODECREATED, [c])
            }
        }, getAfterA: function (a, b, c) {
            this.afterA && this.afterA.apply(this, arguments)
        }, getBeforeA: function (a, b, c) {
            this.beforeA && this.beforeA.apply(this, arguments)
        }, getInnerAfterA: function (a, b, c) {
            this.innerAfterA && this.innerAfterA.apply(this, arguments)
        }, getInnerBeforeA: function (a, b, c) {
            this.innerBeforeA && this.innerBeforeA.apply(this, arguments)
        }
    }), YS.DataTree = YS.extend(YS.EventTree, {
        addNodeCache: function (a, b) {
            this.cache.nodes[this.getNodeCacheId(b.tId)] = b
        }, addNodesData: function (a, b, c) {
            var d = a.data.key.children;
            b[d] || (b[d] = []), b[d].length > 0 && (b[d][b[d].length - 1].isLastNode = !1, this.setNodeLineIcos(a, b[d][b[d].length - 1])), b.isParent = !0, b[d] = b[d].concat(c)
        }, addSelectedNode: function (a, b) {
            var c = this.root;
            this.isSelectedNode(a, b) || c.curSelectedList.push(b)
        }, addCreatedNode: function (a, b) {
            (a.callback.onNodeCreated || a.view.addDiyDom) && this.root.createdNodes.push(b)
        }, getNodeCacheId: function (a) {
            return a.substring(a.lastIndexOf("_") + 1)
        }, getNodeCache: function (a) {
            if (!a)return null;
            var b = this.cache.nodes[this.getNodeCacheId(a)];
            return b ? b : null
        }, canAsync: function (a, b) {
            var c = a.data.key.children;
            return a.async.fieldEnable && b && b.isParent && !(b.Async || b[c] && b[c].length > 0)
        }, asyncNode: function (setting, node, isSilent, callback) {
            var i, l, self = this;
            if (node && !node.isParent)return YS.Utils.applyFunc(this, callback), !1;
            if (node && node.isAjaxing)return !1;
            if (YS.Utils.applyFunc(this, setting.callback.beforeasyncNode, [node], !0) === !1)return YS.Utils.applyFunc(this, callback), !1;
            if (node) {
                node.isAjaxing = !0;
                var icoObj = this.getDOMBySelector(node, setting.consts.id.ICON, setting);
                icoObj.attr({
                    style: "",
                    class: setting.consts.className.BUTTON + " " + setting.consts.className.ICO_LOADING + " x-iconfont"
                })
            }
            var tmpParam = {};
            for (i = 0, l = setting.async.autoParam.length; node && i < l; i++) {
                var pKey = setting.async.autoParam[i].split("="), spKey = pKey;
                pKey.length > 1 && (spKey = pKey[1], pKey = pKey[0]), tmpParam[spKey] = node[pKey]
            }
            if ($.isArray(setting.async.otherParam))for (i = 0, l = setting.async.otherParam.length; i < l; i += 2)tmpParam[setting.async.otherParam[i]] = setting.async.otherParam[i + 1]; else for (var p in setting.async.otherParam)tmpParam[p] = setting.async.otherParam[p];
            var _tmpV = this.root._ver;
            return YS.Utils.ajax({
                url: YS.Utils.applyFunc(this, setting.async.url, [node], setting.async.url),
                data: tmpParam
            }, function (msg) {
                if (_tmpV == self.root._ver) {
                    var newNodes = [];
                    try {
                        newNodes = msg && 0 !== msg.length ? "string" == typeof msg ? eval("(" + msg + ")") : msg : []
                    } catch (a) {
                        newNodes = msg
                    }
                    node && (node.isAjaxing = null, node.Async = !0), self.setNodeLineIcos(setting, node), newNodes && "" !== newNodes ? (newNodes = YS.Utils.applyFunc(this, setting.async.dataFilter, [node, newNodes], newNodes), self.addNodes(setting, node, newNodes ? newNodes.slice(0) : [], !!isSilent)) : self.addNodes(setting, node, [], !!isSilent),
                        setting.treeObj.trigger(setting.consts.event.ASYNC_SUCCESS, [node, msg]), YS.Utils.applyFunc(this, callback)
                }
            }, function (a, b, c) {
                _tmpV == self.root._ver && (node && (node.isAjaxing = null), self.setNodeLineIcos(setting, node), setting.treeObj.trigger(setting.consts.event.ASYNC_ERROR, [node, a, b, c]))
            }), !0
        }, fixPIdKeyValue: function (a, b) {
            a.data.simpleData.fieldEnable && (b[a.data.simpleData.pIdKey] = b.parentTId ? b.getParentNode()[a.data.simpleData.idKey] : a.data.simpleData.rootPId)
        }, getNextNode: function (a, b) {
            if (!b)return null;
            for (var c = a.data.key.children, d = b.parentTId ? b.getParentNode() : this.root, e = 0, f = d[c].length - 1; e <= f; e++)if (d[c][e] === b)return e == f ? null : d[c][e + 1];
            return null
        }, getNodeByParam: function (a, b, c, d) {
            var _this = this;
            if (!b || !c)return null;
            for (var e = a.data.key.children, f = 0, g = b.length; f < g; f++) {
                if (b[f][c] == d)return b[f];
                var h = _this.getNodeByParam(c, d, b[f]);
                if (h)return h
            }
            return null
        }, getNodesByParam: function (a, b, c, d) {
            if (!b || !c)return [];
            for (var e = a.data.key.children, f = [], g = 0, h = b.length; g < h; g++)b[g][c] == d && f.push(b[g]), f = f.concat(this.getNodesByParam(a, b[g][e], c, d));
            return f
        }, getNodes: function () {
            return this.root[this.options.setting.data.key.children]
        }, getNodesByParamFuy: function (a, b, c, d) {
            if (!b || !c)return [];
            var e = a.data.key.children, f = [];
            d = d.toLowerCase();
            for (var g = 0, h = b.length; g < h; g++)"string" == typeof b[g][c] && b[g][c].toLowerCase().indexOf(d) > -1 && f.push(b[g]), f = f.concat(this.getNodesByParamFuy(a, b[g][e], c, d));
            return f
        }, getNodesByFilter: function (a, b, c, d, e) {
            if (!b)return d ? null : [];
            for (var f = a.data.key.children, g = d ? null : [], h = 0, i = b.length; h < i; h++) {
                if (YS.Utils.applyFunc(this, c, [b[h], e], !1)) {
                    if (d)return b[h];
                    g.push(b[h])
                }
                var j = this.getNodesByFilter(a, b[h][f], c, d, e);
                if (d && j)return j;
                g = d ? j : g.concat(j)
            }
            return g
        }, getPreNode: function (a, b) {
            if (!b)return null;
            for (var c = a.data.key.children, d = b.parentTId ? b.getParentNode() : this.root, e = 0, f = d[c].length; e < f; e++)if (d[c][e] === b)return 0 === e ? null : d[c][e - 1];
            return null
        }, isSelectedNode: function (a, b) {
            for (var c = this.root, d = 0, e = c.curSelectedList.length; d < e; d++)if (b === c.curSelectedList[d])return !0;
            return !1
        }, removeNodeCache: function (a, b) {
            var c = a.data.key.children;
            if (b[c])for (var d = 0, e = b[c].length; d < e; d++)arguments.callee(a, b[c][d]);
            this.cache.nodes[this.getNodeCacheId(b.tId)] = null
        }, removeSelectedNode: function (a, b) {
            for (var c = this.root, d = 0, e = c.curSelectedList.length; d < e; d++)b !== c.curSelectedList[d] && this.getNodeCache(c.curSelectedList[d].tId) || (c.curSelectedList.splice(d, 1), d--, e--)
        }, expandAll: function (a) {
            return a = !!a, this.expandCollapseSonNode(this.options.setting, null, a, !0), a
        }, expandNode: function (a, b, c, d, e) {
            var f = this.options.setting;
            return a && a.isParent ? (b !== !0 && b !== !1 && (b = !a.open), e = !!e, e && b && YS.Utils.applyFunc(this, f.callback.beforeExpand, [a], !0) === !1 ? null : e && !b && YS.Utils.applyFunc(this, f.callback.beforeCollapse, [a], !0) === !1 ? null : (b && a.parentTId && this.expandCollapseParentNode(f, a.getParentNode(), b, !1), b !== a.open || c ? (this.root.expandTriggerFlag = e, !this.canAsync(f, a) && c ? this.expandCollapseSonNode(f, a, b, !0, function () {
            }) : (a.open = !b, this.switchNode(this.options.setting, a)), b) : null)) : null
        }, getNodeByTId: function (a) {
            return this.getNodeCache(a)
        }, getNodeIndex: function (a) {
            if (!a)return null;
            for (var b = this.options.setting.data.key.children, c = a.parentTId ? a.getParentNode() : this.root, d = 0, e = c[b].length; d < e; d++)if (c[b][d] == a)return d;
            return -1
        }, getSelectedNodes: function () {
            for (var a = [], b = this.root.curSelectedList, c = 0, d = b.length; c < d; c++)a.push(b[c]);
            return a
        }, reAsyncChildNodes: function (a, b, c) {
            if (this.options.setting.async.fieldEnable) {
                var d = !a, e = this.options.setting;
                if (d && (a = this.root), "refresh" == b) {
                    for (var f = this.options.setting.data.key.children, g = 0, h = a[f] ? a[f].length : 0; g < h; g++)this.removeNodeCache(e, a[f][g]);
                    if (this.removeSelectedNode(e), a[f] = [], d)this.options.setting.treeObj.empty(); else {
                        var i = this.getDOMBySelector(a, e.consts.id.UL, e);
                        i.empty()
                    }
                }
                this.asyncNode(this.options.setting, d ? null : a, !!c)
            }
        }, refresh: function () {
            this.options.setting.treeObj.empty();
            var a = this.root, b = this.options.setting, c = a[b.data.key.children];
            this.initRoot(b), a[b.data.key.children] = c, this.initCache(), this.createNodes(b, 0, a[b.data.key.children])
        }, updateNode: function (a, b) {
            if (a) {
                var c = this.options.setting, d = this.getDOMBySelector(a, c);
                d.get(0) && (this.setNodeName(c, a), this.setNodeTarget(c, a), this.setNodeUrl(c, a), this.setNodeLineIcos(c, a), this.setNodeFontCss(c, a))
            }
        }, transformToArrayFormat: function (a, b) {
            if (!b)return [];
            var c = a.data.key.children, d = [];
            if ($.isArray(b))for (var e = 0, f = b.length; e < f; e++)d.push(b[e]), b[e][c] && (d = d.concat(this.transformToArrayFormat(a, b[e][c]))); else d.push(b), b[c] && (d = d.concat(this.transformToArrayFormat(a, b[c])));
            return d
        }, transformToTreeFormat: function (a, b) {
            var c, d, e = a.data.simpleData.idKey, f = a.data.simpleData.pIdKey, g = a.data.key.children;
            if (!e || "" == e || !b)return [];
            if ($.isArray(b)) {
                var h = [], i = [];
                for (c = 0, d = b.length; c < d; c++)i[b[c][e]] = b[c];
                for (c = 0, d = b.length; c < d; c++)i[b[c][f]] && b[c][e] != b[c][f] ? (i[b[c][f]][g] || (i[b[c][f]][g] = []), i[b[c][f]][g].push(b[c])) : h.push(b[c]);
                return h
            }
            return [b]
        }
    }), YS.BaseTree = YS.extend(YS.DataTree, {
        _defaultConfig: function () {
            return $.extend(YS.BaseTree.superclass._defaultConfig.apply(), {baseCls: "fui_tree"})
        }, _init: function () {
            YS.BaseTree.superclass._init.apply(this, arguments);
            var a = this.options;
            a.setting = this._doSettingConfig(), this._createRoot(a.setting);
            var b = a.setting;
            this.root = this.initRoot(b);
            var c = b.data.key.children, d = [];
            a.Nodes && (d = $.isArray(a.Nodes) ? a.Nodes.slice(0) : [a.Nodes].slice(0)), a.setting.data.simpleData.fieldEnable ? this.root[c] = this.transformToTreeFormat(b, d) : this.root[c] = d, this.initCache(), this.bindTree(b), this.bindEvent(b), this.root[c] && this.root[c].length > 0 ? this.createNodes(b, 0, this.root[c]) : b.async.fieldEnable && b.async.url && "" !== b.async.url && this.asyncNode(b)
        }, _doSettingConfig: function () {
            var a = this.options;
            return a.setting = $.extend(!0, {}, this.setting, a.setting), a.setting
        }, _createRoot: function (a) {
            var b = $('<ul id="' + a.treeId + '" class="tree"/>').appendTo(this.element);
            a.treeObj = b
        }, initRoot: function (a) {
            var b = a ? this.root : null;
            return b || (b = {}), b[a.data.key.children] = [], b.expandTriggerFlag = !1, b.curSelectedList = [], b.noSelection = !0, b.createdNodes = [], b.radioCheckedList = [], b.Id = 0, b._ver = (new Date).getTime(), b
        }, initCache: function () {
            this.cache = this.cache || {}, this.cache.nodes = [], this.cache.doms = []
        }, initNode: function (a, b, c, d, e, f, g) {
            if (c) {
                var h = this.root, i = a.data.key.children, j = this;
                c.level = b, c.tId = a.treeId + "_" + ++h.Id, c.parentTId = d ? d.tId : null, c.open = "string" == typeof c.open ? "true" == c.open.toLowerCase() : !!c.open, c[i] && c[i].length > 0 ? (c.isParent = !0, c.Async = !0) : (c.isParent = "string" == typeof c.isParent ? "true" == c.isParent.toLowerCase() : !!c.isParent, c.open = !(!c.isParent || a.async.fieldEnable) && c.open, c.Async = !c.isParent), c.isFirstNode = e, c.isLastNode = f, c.getParentNode = function () {
                    return j.getNodeCache(c.parentTId)
                }, c.getPreNode = function () {
                    return j.getPreNode(a, c)
                }, c.getNextNode = function () {
                    return j.getNextNode(a, c)
                }, c.isAjaxing = !1, this.fixPIdKeyValue(a, c)
            }
        }, initHideForExCheck: function(a, b) {
            var c = this;
            if (b.isHidden && a.check && a.check.enable) {
                if(typeof b._nocheck == "undefined") {
                    b._nocheck = !!b.nocheck
                    b.nocheck = true;
                }
                b.check_Child_State = -1;
                if (c.repairParentChkClassWithSelf) {
                    c.repairParentChkClassWithSelf(a, b);
                }
            }
        }, initShowForExCheck: function(a, n) {
            var c = this;
            if (!n.isHidden && a.check && a.check.enable) {
                if(typeof n._nocheck != "undefined") {
                    n.nocheck = n._nocheck;
                    delete n._nocheck;
                }
                if (c.setChkClass) {
                    var checkObj = $$(n, consts.id.CHECK, a);
                    c.setChkClass(a, checkObj, n);
                }
                if (c.repairParentChkClassWithSelf) {
                    c.repairParentChkClassWithSelf(a, n);
                }
            }
        }, addNodes: function (a, b, c, d) {
            if (!a.data.keep.leaf || !b || b.isParent)if ($.isArray(c) || (c = [c]), a.data.simpleData.fieldEnable && (c = this.transformToTreeFormat(a, c)), b) {
                var e = this.getDOMBySlelector(b, a.consts.id.SWITCH, a), f = this.getDOMBySelector(b, a.consts.id.ICON, a), g = this.getDOMBySelector(b, a.consts.id.UL, a);
                b.open || (this.replaceSwitchClass(b, e, a.consts.folder.CLOSE), this.replaceIcoClass(b, f, a.consts.folder.CLOSE), b.open = !1, g.css({display: "none"})), this.addNodesData(a, b, c), this.createNodes(a, b.level + 1, c, b), d || this.expandCollapseParentNode(a, b, !0)
            } else this.addNodesData(a, this.root, c), this.createNodes(a, 0, c, null)
        }, appendNodes: function (a, b, c, d, e, f) {
            if (!c)return [];
            for (var g = [], h = a.data.key.children, i = 0, j = c.length; i < j; i++) {
                var k = c[i];
                if (YS.Utils.applyFunc(this, a.callback.beforeNodeCreate, [k], !0), e) {
                    var l = d ? d : this.root, m = l[h], n = m.length == c.length && 0 === i, o = i == c.length - 1;
                    this.initNode(a, b, k, d, n, o, f), this.addNodeCache(a, k)
                }
                var p = [];
                k[h] && k[h].length > 0 && (p = this.appendNodes(a, b + 1, k[h], k, e, f && k.open)), f && (this.makeDOMNodeMainBefore(g, a, k), this.getBeforeA(a, k, g), this.makeDOMNodeNameBefore(g, a, k), this.makeDOMNodeLine(g, a, k), this.getInnerBeforeA(a, k, g), this.makeDOMNodeIcon(g, a, k), this.getInnerAfterA(a, k, g), this.makeDOMNodeNameAfter(g, a, k), this.getAfterA(a, k, g), k.isParent && k.open && this.makeUlHtml(a, k, g, p.join("")), this.makeDOMNodeMainAfter(g, a, k), this.addCreatedNode(a, k))
            }
            return g
        }, createNodes: function (a, b, c, d) {
            if (c && 0 !== c.length) {
                var e = this.root, f = a.data.key.children, g = !d || d.open || !!this.getDOMBySelector(d[f][0], a).get(0);
                e.createdNodes = [];
                var h = this.appendNodes(a, b, c, d, !0, g);
                if (d) {
                    var i = this.getDOMBySelector(d, a.consts.id.UL, a);
                    i.get(0) && i.append(h.join(""))
                } else a.treeObj.append(h.join(""));
                this.createNodeCallback(a)
            }
        }, expandCollapseNode: function (a, b, c, d, e) {
            var f = this.root, g = a.data.key.children;
            if (!b)return void YS.Utils.applyFunc(this, e, []);
            if (f.expandTriggerFlag) {
                var h = e;
                e = function () {
                    h && h(), b.open ? a.treeObj.trigger(a.consts.event.EXPAND, [b]) : a.treeObj.trigger(a.consts.event.COLLAPSE, [b])
                }, f.expandTriggerFlag = !1
            }
            if (!b.open && b.isParent && (!this.getDOMBySelector(b, a.consts.id.UL, a).get(0) || b[g] && b[g].length > 0 && !this.getDOMBySelector(b[g][0], a).get(0)) && (this.appendParentULDom(a, b), this.createNodeCallback(a)), b.open == c)return void YS.Utils.applyFunc(this, e, []);
            var i = this.getDOMBySelector(b, a.consts.id.UL, a), j = this.getDOMBySelector(b, a.consts.id.SWITCH, a), k = this.getDOMBySelector(b, a.consts.id.ICON, a);
            b.isParent ? (b.open = !b.open, b.iconOpen && b.iconClose && k.attr("style", this.makeNodeIcoStyle(a, b)), b.open ? (this.replaceSwitchClass(b, j, a.consts.folder.OPEN), this.replaceIcoClass(b, k, a.consts.folder.OPEN), d === !1 || "" == a.view.expandSpeed ? (i.show(), YS.Utils.applyFunc(this, e, [])) : b[g] && b[g].length > 0 ? i.slideDown(a.view.expandSpeed, e) : (i.show(), YS.Utils.applyFunc(this, e, []))) : (this.replaceSwitchClass(b, j, a.consts.folder.CLOSE), this.replaceIcoClass(b, k, a.consts.folder.CLOSE), d !== !1 && "" != a.view.expandSpeed && b[g] && b[g].length > 0 ? i.slideUp(a.view.expandSpeed, e) : (i.hide(), YS.Utils.applyFunc(this, e, [])))) : YS.Utils.applyFunc(this, e, [])
        }, expandCollapseParentNode: function (a, b, c, d, e) {
            if (b) {
                if (!b.parentTId)return void this.expandCollapseNode(a, b, c, d, e);
                this.expandCollapseNode(a, b, c, d), b.parentTId && this.expandCollapseParentNode(a, b.getParentNode(), c, d, e)
            }
        }, expandCollapseSonNode: function (a, b, c, d, e) {
            if (!!b && !!b.isHidden) {
                return;
            }
            var f = a.data.key.children, g = b ? b[f] : this.root[f], h = !b && d, i = this.root.expandTriggerFlag;
            if (this.root.expandTriggerFlag = !1, g)for (var j = 0, k = g.length; j < k; j++)g[j] && this.expandCollapseSonNode(a, g[j], c, h);
            this.root.expandTriggerFlag = i, this.expandCollapseNode(a, b, c, d, e)
        }, destroy: function (a) {
            a && (this.initCache(), this.initRoot(a), this.unbindTree(a), a.treeObj.closest('.ztree').empty(), delete a)
        }, getNodeByParam : function(a, b, c) {
            if (!a) return null;
            var d = this.options.setting;
            return YS.BaseTree.superclass.getNodeByParam.apply(this,[d, c?c[d.data.key.children]:this.getNodes(d), a, b]);
        }, clearOldFirstNode: function(a, b) {
            var c = this, n = b.getNextNode();
            while(!!n){
                if (n.isFirstNode) {n.isFirstNode = !1;c.setNodeLineIcos(a, n);break;}
                if (n.isLastNode) {break;}
                n = n.getNextNode();
            }
        }, clearOldLastNode: function(a, b, c) {
            var n = b.getPreNode();
            while(!!n){
                if (n.isLastNode) {
                    n.isLastNode = !1;
                    if (c) {this.setNodeLineIcos(a, n);}
                    break;
                }
                if (n.isFirstNode) {break;}
                n = n.getPreNode();
            }
        }, makeDOMNodeMainBefore: function(a, b, c) {
            a.push("<li ", (c.isHidden ? "style='display:none;' " : ""), "id='", c.tId, "' class='", b.consts.className.LEVEL, c.level,"' tabindex='0' hidefocus='!0' treenode>");
        }, setFirstNode: function(a, b) {
            var c = this, d = a.data.key.children, e = b[d].length;
            if (e > 0 && !b[d][0].isHidden) {
                b[d][0].isFirstNode = !0;
            } else if (e > 0) {
                c.setFirstNodeForHide(a, b[d]);
            }
        }, setLastNode: function(a, b) {
            var c = this, d = a.data.key.children, e = b[d].length;
            if (e > 0 && !b[d][0].isHidden) {
                b[d][e - 1].isLastNode = !0;
            } else if (e > 0) {
                c.setLastNodeForHide(a, b[d]);
            }
        }, setFirstNodeForHide: function(a, b) {
            var c = this, n, i, j;
            for (i=0, j=b.length; i<j; i++) {
                n = b[i];
                if(n.isFirstNode){ break;}
                if (!n.isHidden && !n.isFirstNode) {
                    n.isFirstNode = !0;
                    c.setNodeLineIcos(a, n);
                    break;
                } else {
                    n = null;
                }
            }
            return n;
        }, setFirstNodeForShow: function(a, b) {
            var c = this, d, e, n, i, j;
            for(i=0, j=b.length; i<j; i++) {
                n = b[i];
                if (!d && !n.isHidden && n.isFirstNode) {
                    d = n;
                    break;
                } else if (!d && !n.isHidden && !n.isFirstNode) {
                    n.isFirstNode = !0, d = n, c.setNodeLineIcos(a, n);
                } else if (d && n.isFirstNode) {
                    n.isFirstNode = !1, e = n, c.setNodeLineIcos(a, n);
                    break;
                } else {
                    n = null;
                }
            }
            return {"new": d, "old": e};
        }, setLastNodeForHide: function(a, b) {
            var c = this, n, i;
            for (i=b.length-1; i>=0; i--) {
                n = b[i];
                if(n.isLastNode){ break;}
                if (!n.isHidden && !n.isLastNode) {
                    n.isLastNode = !0,c.setNodeLineIcos(a, n);
                    break;
                } else {
                    n = null;
                }
            }
            return n;
        }, setLastNodeForShow: function(a, b) {
            var c = this, n, i, j, d, e;
            for (i=b.length-1; i>=0; i--) {
                n = b[i];
                if (!d && !n.isHidden && n.isLastNode) {
                    d = n;
                    break;
                } else if (!d && !n.isHidden && !n.isLastNode) {
                    n.isLastNode = !0;
                    d = n;
                    c.setNodeLineIcos(a, n);
                } else if (d && n.isLastNode) {
                    n.isLastNode = !1;
                    e = n;
                    c.setNodeLineIcos(a, n);
                    break;
                } else {
                    n = null;
                }
            }
            return {"new": d, "old":e};
        }
    })
}(jQuery), function (a) {
    YS.Tree = YS.extend(YS.BaseTree, {
        initRoot: function (a) {
            var b = YS.Tree.superclass.initRoot.apply(this, arguments);
            return b.radioCheckedList = [], b
        }, bindEvent: function (a) {
            YS.Tree.superclass.bindEvent.apply(this, arguments);
            var b = this.element, c = a.consts.event, d = this;
            b.bind(c.CHECK, function (b, c, e) {
                YS.Utils.applyFunc(d, a.callback.onCheck, [c ? c : b, e])
            })
        }, unbindTree: function (a) {
            YS.Tree.superclass.unbindTree.apply(this, arguments);
            var b = this.element, c = this.options.setting.consts.event;
            b.unbind(c.CHECK)
        }, doProxy: function (a) {
            var b = a.target.parentNode, c = this.options.setting, d = "", e = null, f = "", g = "", h = null, i = null;
            if (c.check.fieldEnable && ("mouseover" == a.type ? "SPAN" == b.tagName && null !== b.getAttribute("treeNode" + c.consts.id.CHECK) && (d = this.getNodeMainDom(b).id, f = "mouseoverCheck") : "mouseout" == a.type ? "SPAN" == b.tagName && null !== b.getAttribute("treeNode" + c.consts.id.CHECK) && (d = this.getNodeMainDom(b).id, f = "mouseoutCheck") : "click" == a.type && "SPAN" == b.tagName && null !== b.getAttribute("treeNode" + c.consts.id.CHECK) && (d = this.getNodeMainDom(b).id, f = "checkNode")), d.length > 0)switch (e = this.getNodeCache(d), f) {
                case"checkNode":
                    h = this.onCheckNode;
                    break;
                case"mouseoverCheck":
                    h = this.onMouseoverCheck;
                    break;
                case"mouseoutCheck":
                    h = this.onMouseoutCheck
            }
            return "" !== f ? {
                node: e,
                nodeEventType: f,
                nodeEventCallback: h,
                treeEventType: g,
                treeEventCallback: i
            } : YS.Tree.superclass.doProxy.apply(this, arguments)
        }, initNode: function (a, b, c, d, e, f, g) {
            if (YS.Tree.superclass.initNode.apply(this, arguments), c) {
                var h = a.data.key.checked;
                "string" == typeof c[h] && (c[h] = "true" == c[h].toLowerCase()), c[h] = !!c[h], c.checkedOld = c[h], "string" == typeof c.nocheck && (c.nocheck = "true" == c.nocheck.toLowerCase()), c.nocheck = !!c.nocheck || a.check.nocheckInherit && d && !!d.nocheck, "string" == typeof c.chkDisabled && (c.chkDisabled = "true" == c.chkDisabled.toLowerCase()), c.chkDisabled = !!c.chkDisabled || a.check.chkDisabledInherit && d && !!d.chkDisabled, "string" == typeof c.halfCheck && (c.halfCheck = "true" == c.halfCheck.toLowerCase()), c.halfCheck = !!c.halfCheck, c.check_Child_State = -1, c.check_Focus = !1, c.getCheckStatus = function () {
                    return this.getCheckStatus(a, c)
                }, a.check.chkStyle == a.consts.radio.STYLE && a.check.radioType == a.consts.radio.TYPE_ALL && c[h] && this.root.radioCheckedList.push(c)
            }
        }, destroy: function(){
            var a = this.options.setting;
            YS.Tree.superclass.destroy.apply(this, [a]);
        }, makeDOMNodeLine: function (a, b, c) {
            YS.Tree.superclass.makeDOMNodeLine.apply(this, arguments), b.check.fieldEnable && (this.makeChkFlag(b, c), a.push("<span ID='", c.tId, b.consts.id.CHECK, "' class='", this.makeChkClass(b, c), "' treeNode", b.consts.id.CHECK, c.nocheck === !0 ? " style='display:none;'" : "", "><i class='x-iconfont'></i></span>"))
        }, getRadioCheckedList: function (a) {
            for (var b = this.root.radioCheckedList, c = 0, d = b.length; c < d; c++)this.getNodeCache(a, b[c].tId) || (b.splice(c, 1), c--, d--);
            return b
        }, getCheckStatus: function (a, b) {
            if (!a.check.fieldEnable || b.nocheck || b.chkDisabled)return null;
            var c = a.data.key.checked;
            return {
                checked: b[c],
                half: b.halfCheck ? b.halfCheck : a.check.chkStyle == a.consts.radio.STYLE ? 2 === b.check_Child_State : b[c] ? b.check_Child_State > -1 && b.check_Child_State < 2 : b.check_Child_State > 0
            }
        }, getTreeCheckedNodes: function (a, b, c, d) {
            if (!!b && b.length > 0) {
                var p = nodes[0].getParentNode();
                if(!!p && !!p.isHidden) return [];
            }
            var e = a.data.key.children, f = a.data.key.checked, g = c && a.check.chkStyle == a.consts.radio.STYLE && a.check.radioType == a.consts.radio.TYPE_ALL;
            d = d ? d : [];
            for (var h = 0, i = b.length; h < i && (b[h].nocheck === !0 || b[h].chkDisabled === !0 || b[h][f] != c || (d.push(b[h]), !g)) && (this.getTreeCheckedNodes(a, b[h][e], c, d), !(g && d.length > 0)); h++);
            return d
        }, getTreeChangeCheckedNodes: function (a, b, c) {
            if (!!b && b.length > 0) {
                var p = b[0].getParentNode();
                if (!!p && !!p.isHidden) {
                    return [];
                }
            }
            var d = a.data.key.children, e = a.data.key.checked;
            c = c ? c : [];
            for (var f = 0, g = b.length; f < g; f++)b[f].nocheck !== !0 && b[f].chkDisabled !== !0 && b[f][e] != b[f].checkedOld && c.push(b[f]), this.getTreeChangeCheckedNodes(a, b[f][d], c);
            return c
        }, initNode: function(a, b, c, d, e, f, g) {
            var h = (d) ? d: this.root, i = h[a.data.key.children], j = a.view;
            this.tmpHideFirstNode = this.setFirstNodeForHide(a, i);
            this.tmpHideLastNode = this.setLastNodeForHide(a, i);
            if (g) {
                this.setNodeLineIcos(a, this.tmpHideFirstNode);
                this.setNodeLineIcos(a, this.tmpHideLastNode);
            }
            e = (this.tmpHideFirstNode === c);
            f = (this.tmpHideLastNode === c);
            YS.Tree.superclass.initNode.apply(this, arguments);
            if (g && f) {
                this.clearOldLastNode(a, c, g);
            }
        }, makeChkFlag: function (a, b) {
            if(!!b && !!b.isHidden) return;
            if (b) {
                var c = a.data.key.children, d = a.data.key.checked, e = -1;
                if (b[c])for (var f = 0, g = b[c].length; f < g; f++) {
                    var h = b[c][f], i = -1;
                    if (a.check.chkStyle == a.consts.radio.STYLE) {
                        if (i = h.nocheck === !0 || h.chkDisabled === !0 ? h.check_Child_State : h.halfCheck === !0 ? 2 : h[d] ? 2 : h.check_Child_State > 0 ? 2 : 0, 2 === i) {
                            e = 2;
                            break;
                        }
                        0 === i && (e = 0)
                    } else if (a.check.chkStyle == a.consts.checkbox.STYLE) {
                        if (i = h.nocheck === !0 || h.chkDisabled === !0 ? h.check_Child_State : h.halfCheck === !0 ? 1 : h[d] ? h.check_Child_State === -1 || 2 === h.check_Child_State ? 2 : 1 : h.check_Child_State > 0 ? 1 : 0, 1 === i) {
                            e = 1;
                            break;
                        }
                        if (2 === i && e > -1 && f > 0 && i !== e) {
                            e = 1;
                            break;
                        }
                        if (2 === e && i > -1 && i < 2) {
                            e = 1;
                            break;
                        }
                        i > -1 && (e = i)
                    }
                }
                b.check_Child_State = e
            }
        }, checkNode: function (a, b, c, d) {
            if(!!a && !!a.isHidden){return;}
            var e = this.options.setting, f = e.data.key.checked;
            if (a.chkDisabled !== !0 && (b !== !0 && b !== !1 && (b = !a[f]), d = !!d, (a[f] !== b || c) && (!d || YS.Utils.applyFunc(this, e.callback.beforeCheck, [a], !0) !== !1) && e.check.fieldEnable && a.nocheck !== !0)) {
                a[f] = b;
                var g = this.getDOMBySelector(a, e.consts.id.CHECK, e);
                (c || e.check.chkStyle === e.consts.radio.STYLE) && this.checkNodeRelation(e, a), this.setChkClass(e, g, a), this.repairParentChkClassWithSelf(e, a), d && e.treeObj.trigger(e.consts.event.CHECK, [null, a])
            }
        }, checkAllNodes: function (a) {
            this.repairAllChk(this.options.setting, !!a)
        }, transformToArray: function(a){
            var b = this.options.setting;
            return this.transformToArrayFormat(b,a);
        }, getCheckedNodes: function (a) {
            var b = this.options.setting.data.key.children;
            return a = a !== !1, this.getTreeCheckedNodes(this.options.setting, this.root[b], a)
        }, getChangeCheckedNodes: function () {
            var a = this.options.setting.data.key.children;
            return this.getTreeChangeCheckedNodes(this.options.setting, this.root[a])
        }, setChkDisabled: function (a, b, c, d) {
            b = !!b, c = !!c, d = !!d, this.repairSonChkDisabled(this.options.setting, a, b, d), this.repairParentChkDisabled(this.options.setting, a.getParentNode(), b, c)
        }, onCheckNode: function (a, b) {
            if (b.chkDisabled === !0)return !1;
            var c = this.options.setting, d = c.data.key.checked;
            if (YS.Utils.applyFunc(this, c.callback.beforeCheck, [b], !0) === !1)return !0;
            b[d] = !b[d], this.checkNodeRelation(c, b);
            var e = this.getDOMBySelector(b, c.consts.id.CHECK, c);
            return this.setChkClass(c, e, b), this.repairParentChkClassWithSelf(c, b), c.treeObj.trigger(c.consts.event.CHECK, [a, b]), !0
        }, onMouseoverCheck: function (a, b) {
            if (b.chkDisabled === !0)return !1;
            var c = this.options.setting, d = this.getDOMBySelector(b, c.consts.id.CHECK, c);
            return b.check_Focus = !0, this.setChkClass(c, d, b), !0
        }, onMouseoutCheck: function (a, b) {
            if (b.chkDisabled === !0)return !1;
            var c = this.options.setting, d = this.getDOMBySelector(b, c.consts.id.CHECK, c);
            return b.check_Focus = !1, this.setChkClass(c, d, b), !0
        }, checkNodeRelation: function (a, b) {
            var c, d, e, f = a.data.key.children, g = a.data.key.checked, h = a.consts.radio;
            if (a.check.chkStyle == h.STYLE) {
                var i = this.getRadioCheckedList(a);
                if (b[g])if (a.check.radioType == h.TYPE_ALL) {
                    for (d = i.length - 1; d >= 0; d--)c = i[d], c[g] = !1, i.splice(d, 1), this.setChkClass(a, this.getDOMBySelector(c, a.consts.id.CHECK, a), c), c.parentTId != b.parentTId && this.repairParentChkClassWithSelf(a, c);
                    i.push(b)
                } else {
                    var j = b.parentTId ? b.getParentNode() : this.root;
                    for (d = 0, e = j[f].length; d < e; d++)c = j[f][d], c[g] && c != b && (c[g] = !1, this.setChkClass(a, this.getDOMBySelector(c, a.consts.id.CHECK, a), c))
                } else if (a.check.radioType == h.TYPE_ALL)for (d = 0, e = i.length; d < e; d++)if (b == i[d]) {
                    i.splice(d, 1);
                    break;
                }
            } else b[g] && (!b[f] || 0 === b[f].length || a.check.chkboxType.Y.indexOf("s") > -1) && this.setSonNodeCheckBox(a, b, !0), b[g] || b[f] && 0 !== b[f].length && !(a.check.chkboxType.N.indexOf("s") > -1) || this.setSonNodeCheckBox(a, b, !1), b[g] && a.check.chkboxType.Y.indexOf("p") > -1 && this.setParentNodeCheckBox(a, b, !0), !b[g] && a.check.chkboxType.N.indexOf("p") > -1 && this.setParentNodeCheckBox(a, b, !1)
        }, makeChkClass: function (a, b) {
            var c = a.data.key.checked, d = a.consts.checkbox, e = a.consts.radio, f = "";
            f = b.chkDisabled === !0 ? d.DISABLED : b.halfCheck ? d.PART : a.check.chkStyle == e.STYLE ? b.check_Child_State < 1 ? d.FULL : d.PART : b[c] ? 2 === b.check_Child_State || b.check_Child_State === -1 ? d.FULL : d.PART : b.check_Child_State < 1 ? d.FULL : d.PART;
            var g = a.check.chkStyle + " " + (b[c] ? d.TRUE : d.FALSE) + " " + f;
            return g = b.check_Focus && b.chkDisabled !== !0 ? g + "_" + d.FOCUS : g, a.consts.className.BUTTON + " " + d.DEFAULT + " " + g
        }, repairAllChk: function (a, b) {
            if (a.check.fieldEnable && a.check.chkStyle === a.consts.checkbox.STYLE)for (var c = a.data.key.checked, d = a.data.key.children, e = this.root, f = 0, g = e[d].length; f < g; f++) {
                var h = e[d][f];
                h.nocheck !== !0 && h.chkDisabled !== !0 && (h[c] = b), this.setSonNodeCheckBox(a, h, b)
            }
        }, repairChkClass: function (a, b) {
            if (b && (this.makeChkFlag(a, b), b.nocheck !== !0)) {
                var c = this.getDOMBySelector(b, a.consts.id.CHECK, a);
                this.setChkClass(a, c, b)
            }
        }, repairParentChkClass: function (a, b) {
            if (b && b.parentTId) {
                var c = b.getParentNode();
                this.repairChkClass(a, c), this.repairParentChkClass(a, c)
            }
        }, repairParentChkClassWithSelf: function (a, b) {
            if (!!b && !!b.isHidden) {
                return;
            }
            if (b) {
                var c = a.data.key.children;
                b[c] && b[c].length > 0 ? this.repairParentChkClass(a, b[c][0]) : this.repairParentChkClass(a, b)
            }
        }, repairSonChkDisabled: function (a, b, c, d) {
            if (b) {
                var e = a.data.key.children;
                if (b.chkDisabled != c && (b.chkDisabled = c), this.repairChkClass(a, b), b[e] && d)for (var f = 0, g = b[e].length; f < g; f++) {
                    var h = b[e][f];
                    this.repairSonChkDisabled(a, h, c, d)
                }
            }
        }, repairParentChkDisabled: function (a, b, c, d) {
            b && (b.chkDisabled != c && d && (b.chkDisabled = c), this.repairChkClass(a, b), this.repairParentChkDisabled(a, b.getParentNode(), c, d))
        }, setChkClass: function (a, b, c) {
            b && (c.nocheck === !0 ? b.hide() : b.show(), b.removeClass(), b.addClass(this.makeChkClass(a, c)))
        }, setParentNodeCheckBox: function (a, b, c, d) {
            var e = a.data.key.children, f = a.data.key.checked, g = this.getDOMBySelector(b, a.consts.id.CHECK, a);
            if (d || (d = b), this.makeChkFlag(a, b), b.nocheck !== !0 && b.chkDisabled !== !0 && (b[f] = c, this.setChkClass(a, g, b), a.check.autoCheckTrigger && b != d && a.treeObj.trigger(a.consts.event.CHECK, [null, b])), b.parentTId) {
                var h = !0;
                if (!c)for (var i = b.getParentNode()[e], j = 0, k = i.length; j < k; j++)if (i[j].nocheck !== !0 && i[j].chkDisabled !== !0 && i[j][f] || (i[j].nocheck === !0 || i[j].chkDisabled === !0) && i[j].check_Child_State > 0) {
                    h = !1;
                    break;
                }
                h && this.setParentNodeCheckBox(a, b.getParentNode(), c, d)
            }
        }, setSonNodeCheckBox: function (a, b, c, d) {
            if (!!b && !!b.isHidden) {
                return;
            }
            if (b) {
                var e = a.data.key.children, f = a.data.key.checked, g = this.getDOMBySelector(b, a.consts.id.CHECK, a);
                d || (d = b);
                var h = !1;
                if (b[e])for (var i = 0, j = b[e].length; i < j && b.chkDisabled !== !0; i++) {
                    var k = b[e][i];
                    this.setSonNodeCheckBox(a, k, c, d), k.chkDisabled === !0 && (h = !0)
                }
                b != this.root && b.chkDisabled !== !0 && (h && b.nocheck !== !0 && this.makeChkFlag(a, b), b.nocheck !== !0 && b.chkDisabled !== !0 ? (b[f] = c, h || (b.check_Child_State = b[e] && b[e].length > 0 ? c ? 2 : 0 : -1)) : b.check_Child_State = -1, this.setChkClass(a, g, b), a.check.autoCheckTrigger && b != d && b.nocheck !== !0 && b.chkDisabled !== !0 && a.treeObj.trigger(a.consts.event.CHECK, [null, b]))
            }
        }, updateNode: function (a, b) {
            YS.Tree.superclass.updateNode.apply(this, arguments);
            var c = this.options.setting;
            if (a && c.check.fieldEnable) {
                var d = this.getDOMBySelector(a, c);
                if (d.get(0)) {
                    var e = this.getDOMBySelector(a, c.consts.id.CHECK, c);
                    b !== !0 && c.check.chkStyle !== c.consts.radio.STYLE || this.checkNodeRelation(c, a), this.setChkClass(c, e, a), this.repairParentChkClassWithSelf(c, a)
                }
            }
        }, createNodes: function (a, b, c, d) {
            YS.Tree.superclass.createNodes.apply(this, arguments), c && this.repairParentChkClassWithSelf(a, d)
        }, removeNode: function (a, b) {
            var c = b.getParentNode();
            YS.Tree.superclass.removeNode.apply(this, arguments), b && c && (this.repairChkClass(a, c), this.repairParentChkClass(a, c))
        }, appendNodes: function (a, b, c, d, e, f) {
            var g = YS.Tree.superclass.appendNodes.apply(this, arguments);
            return d && this.makeChkFlag(a, d), g
        }, hideNodes: function(b, c){
            var a = this.options.setting;
            if(!b || b.length == 0){ return;}
            var d = {}, e = this, i, j;
            for (i=0, j=b.length; i<j; i++) {
                var n = b[i];
                if ((n.isFirstNode || n.isLastNode) && !d[n.parentTId]) {
                    d[n.parentTId] = (n.getParentNode() === null) ? e.root : n.getParentNode();
                }
                e.hideNode(n, c);
            }
            for (var k in d) {
                var f = d[k][a.data.key.children];
                f && (e.setFirstNodeForHide(a, f),e.setLastNodeForHide(a, f));
            }
        }, hideNode: function(b, c){
            var a = this.options.setting;
            if(!b) return;
            b.isHidden = !0, b.isFirstNode = !1, b.isLastNode = !1;
            this.initHideForExCheck(a, b);
            this.cancelPreSelectedNode(a, b);
            this.$$(b, a).hide();
        }, showNode: function(b, c) {
            if(!b) return;
            var a = this.options.setting;
            b.isHidden = !1;
            //this.initShowForExCheck(a, b);
            this.$$(b, a).show();
        }, showNodes: function(b, c) {
            var a = this.options.setting;
            if(!b || b.length == 0){ return;}
            var d = this, e = {}, i, j;
            for (i=0, j=b.length; i<j; i++) {
                var n = b[i];
                if (!e[n.parentTId]) {
                    var pn = n.getParentNode();
                    e[n.parentTId] = (pn === null) ? d.root : n.getParentNode();
                }
                d.showNode(n, c);
            }
            for (var tId in e) {
                var f = e[tId][a.data.key.children];
                f && (d.setFirstNodeForShow(a, f),d.setLastNodeForShow(a, f));
            }
        }
    }), a.shortcut("tree", YS.Tree)
}(jQuery), function (a) {
    YS.Segment = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.Segment.superclass._defaultConfig.apply(), {
                baseCls: "fui_segment",
                onAfterItemSelect: null,
                items: []
            })
        }, _init: function () {
            YS.Segment.superclass._init.apply(this, arguments);
            for (var b = this.options, c = 0, d = b.items.length; c < d; c++) {
                var e = b.items[c], f = a('<div class="fui_segment_item"/>').data("item", e).append(a("<span/>").text(e.text)).appendTo(this.element);
                e.iconCls && f.prepend(a("<i/>").addClass(e.iconCls)), 0 === c && f.addClass("fui_segment_item-first"), c === d - 1 && f.addClass("fui_segment_item-last")
            }
            this._bindEvts(), b.text ? this.setText(b.text) : b.value && this.setValue(b.value)
        }, _bindEvts: function () {
            var b = this, c = this.options, d = function (d) {
                if (b.isEnabled()) {
                    var e = a(d.target).closest(".fui_segment_item");
                    if (e && e.length > 0) {
                        var f = d.type;
                        "click" === f && (a(".selected", b.element).removeClass("selected"), b._setItemSelected(e), YS.Utils.applyFunc(b, c.onAfterItemSelect, null, !1))
                    }
                }
            };
            this.element.unbind(), this.element.bind("click", d).bind("mouseout", d)
        }, _setItemSelected: function (a) {
            var b = this.options;
            if (a[0] && !a.hasClass("selected")) {
                a.addClass("selected");
                var c = a.data("item");
                b.value = c.value, b.text = c.text
            }
        }, checkValidate: function () {
            return !(!this.options.fieldIsnull && YS.Utils.isEmpty(this.getValue()))
        }, getValue: function () {
            return this.options.value
        }, getText: function () {
            return this.options.text
        }, setValue: function (b) {
            var c = this.options, d = this;
            a(".selected", d.element).removeClass("selected"), b == null && (c.value = null, c.text = null), c.items && a.each(c.items, function (a, c) {
                if (b == c.value) {
                    var e = d.element.children().eq(a);
                    d._setItemSelected(e)
                }
            })
        }, setText: function (b) {
            var c = this.options, d = this;
            a(".selected", d.element).removeClass("selected"), b == null && (c.value = null, c.text = null), c.items && a.each(c.items, function (a, c) {
                if (b == c.text) {
                    var e = d.element.children().eq(a);
                    d._setItemSelected(e)
                }
            })
        }
    }), a.shortcut("segment", YS.Segment)
}(jQuery), function (a) {
    YS.Progress = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.Progress.superclass._defaultConfig.apply(), {
                baseCls: "fui_progress",
                width: 200,
                valueMin: 0,
                valueMax: 100,
                valueNow: 0,
                style: "info",
                message: "",
                isAnimate: !0,
                isStriped: !0
            })
        }, _init: function () {
            YS.Progress.superclass._init.apply(this, arguments);
            var b = this.options;
            this.$bar = a('<div class="progress-bar" />').addClass("progress-bar-" + b.style).appendTo(this.element), b.isAnimate && this.$bar.addClass("active"), b.isStriped && this.$bar.addClass("progress-bar-striped"), this.$message = a('<span class="progress-message" />').css({"line-height": b.height + "px"}).appendTo(this.element), this.setProgress(), this.setMessage()
        }, setProgress: function (a) {
            var b = this.options;
            a == null || (b.valueNow = a);
            var c = parseInt((b.valueNow - b.valueMin) / (b.valueMax - b.valueMin) * 100);
            c > 60 ? this.$message.addClass("bright") : c <= 60 && this.$message.removeClass("bright"), 100 === c && b.isAnimate && this.$bar.removeClass("active"), this.$bar.css({width: c + "%"})
        }, setMessage: function (a) {
            var b = this.options;
            YS.Utils.isBlank(a) || (b.message = a), this.$message.text(b.message)
        }
    }), a.shortcut("progress", YS.Progress)
}(jQuery), function (a) {
    YS.FilePreview = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.FilePreview.superclass._defaultConfig.apply(), {
                renderEl: a("<div/>").appendTo("body"),
                baseCls: "fui_file_preview",
                autoClose: !0,
                files: [],
                scale: .1,
                currentItem: 0,
                duration: 150
            })
        }, _init: function () {
            YS.FilePreview.superclass._init.apply(this, arguments);
            var b = this.options, c = this;
            this.element.addClass("x-window-mask modal dark").css({"z-index": YS.STATIC.zIndex++}), b.autoClose && this.element.click(function (b) {
                a(b.target).hasClass("x-window-mask") && c.destroy()
            }), this.$fileWrapper = a("<div/>").appendTo(this.element), this._createNaviBtns(), b.files && (this.totalPage = b.files.length, b.files.map(function (b) {
                a('<div class="file-item"/>').appendTo(c.$fileWrapper)
            }), this._viewFileAt(b.currentItem))
        }, _viewFileAt: function (b) {
            var c = this.options, d = this;
            this.currentPage = b, this.$pageIndex && this.$pageIndex.text(b + 1 + " / " + this.totalPage);
            var temp = eval(c.files[b]);
            var e = temp.path?temp.path:temp[0].path;
            var name = temp.name?temp.name:temp[0].name;
            if (e)if (this.$fileWrapper.children(".file-item").hide(), this.$currentView = this.$fileWrapper.children(".file-item").eq(b), this.$currentView.show(), this.$currentView.children() && 0 !== this.$currentView.children().length)d._bindDownloadEvent(d.$download, d.$currentView.data("url"), e); else {
                var f = a.extend({down: !0}, {path:e});
                if (e.downloadURL ? (d._bindDownloadEvent(d.$download, url, e), d.$currentView.data("url", e)) : YS.Utils.getFileDownloadURL(f, function (a) {
                        d._bindDownloadEvent(d.$download, a, name), d.$currentView.data("url", a)
                    }), e && YS.Utils.isImage(e))e ? a('<img style="max-width:100%;max-height:100%" />').attr("src", getFlowConf().filePath+e).appendTo(d.$currentView) : YS.Utils.getFileDownloadURL(a.extend({
                    thumb: {
                        mode: 2,
                        width: 1200,
                        height: 1200
                    }
                }, e), function (b) {
                    var c, e, f, g, h = !1;
                    a("<img/>").attr("src", b).on("mousedown", function (b) {
                        h = !0, c = b.pageX, e = b.pageY, f = parseInt(a(b.currentTarget).css("left").replace("px", "")), g = parseInt(a(b.currentTarget).css("top").replace("px", ""))
                    }).on("mousemove", function (b) {
                        if (h) {
                            var d = a(b.currentTarget);
                            document.onmousemove = function (a) {
                                var b = a.pageX - c, h = a.pageY - e;
                                d.css({top: h + g, left: b + f}), a.preventDefault()
                            }
                        }
                    }).on("mouseup", function (a) {
                        h = !1, document.onmousemove = function (a) {
                            return a.preventDefault(), !1
                        }
                    }).on("wheel", function (b) {
                        b.originalEvent.deltaY > 0 ? d._scaleImg(a(b.currentTarget), !1, .02, 0) : d._scaleImg(a(b.currentTarget), !0, .02, 0)
                    }).appendTo(d.$currentView)
                }); else {
                    var g = a('<div class="file-detail-wrapper"/>').appendTo(d.$currentView), h = name || "";
                    a('<div class="file-ico"/>').append(a('<i class="icon-file"/>')).append(a('<span class="file-type"/>').text(h.split(".").pop())).appendTo(g);
                    var m = a('<div class="fui-upload-preview f-preview"/>').text(h).attr("fileUrl",e).attr("fileName",h).appendTo(g);
                    a('<span class="icon icon-search-white" />').appendTo(a('<div class="preview-cover" />').appendTo(m));
                }
            }
        }, _createNaviBtns: function () {
            var b = this, c = this.options;
            a('<i class="icon-close-normal file-nav close">').click(function () {
                b.destroy()
            }).appendTo(this.element), this.$download = a('<a target="_self" class="file-nav download"/>').append(a('<i class="icon-download">')).appendTo(this.element), this.options.files.length > 1 && (this.$pageIndex = a('<span class="file-counter"/>').appendTo(this.element), a('<i class="icon-angleright file-nav next"/>').click(function () {
                b._viewFileAt((b.currentPage + 1) % b.totalPage)
            }).appendTo(this.element), a('<i class="icon-angleleft file-nav prev"/>').click(function () {
                b._viewFileAt((b.totalPage + b.currentPage - 1) % b.totalPage)
            }).appendTo(this.element)), a('<i class="icon-enlargement file-nav enlargement">').on("click", function () {
                var a = b.$currentView.children("img");
                a.css({"max-width":"none","max-height":"none"});
                a.length > 0 && b._scaleImg(a, !0, c.scale, c.duration)
            }).appendTo(this.element), a('<i class="icon-narrow file-nav narrow">').on("click", function () {
                var a = b.$currentView.children("img");
                a.css({"max-width":"none","max-height":"none"});
                a.length > 0 && b._scaleImg(a, !1, c.scale, c.duration)
            }).appendTo(this.element)
        }, _scaleImg: function (a, b, c, d) {
            var e = (this.options, parseInt(a.css("width").replace("px", ""))), f = parseInt(a.css("height").replace("px", ""));
            b ? a.animate({width: e * (1 + c), height: f * (1 + c)}, d) : a.animate({
                width: e * (1 - c),
                height: f * (1 - c)
            }, d)
        }, _bindDownloadEvent: function (a, b, c) {
            var href = a.attr('href', getFlowConf().flowPath + '/common/download?path='+encodeURI(b)+'&name='+encodeURI(c));
            // a.click(function () {
            //     YS.Utils.fileDownload(b, c)
            // })
        }
    }), a.shortcut("filepreview", YS.FilePreview)
}(jQuery), function (a) {
    YS.InputGroup = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.InputGroup.superclass._defaultConfig.apply(), {
                baseCls: "fui-input-group",
                prevEl: null,
                inputEl: {type: "text"},
                nextEl: null,
                height: 30
            })
        }, _init: function () {
            YS.InputGroup.superclass._init.apply(this, arguments);
            var b = this.options;
            if (b.prevEl) {
                var c = a('<div class="addon" />').appendTo(this.element);
                YS.createWidget(a.extend({}, b.prevEl, {renderEl: c, customCls: "mask"}))
            }
            var d = a('<div class="addon" />').appendTo(this.element);
            if (this.inputEl = YS.createWidget(a.extend({}, b.inputEl, {renderEl: d, height: b.height})), b.nextEl) {
                var e = a('<div class="addon" />').appendTo(this.element);
                YS.createWidget(a.extend({}, b.nextEl, {renderEl: e, customCls: "mask"}))
            }
        }, getValue: function () {
            return this.inputEl.getValue()
        }, setValue: function (a) {
            this.inputEl.setValue(a)
        }, checkValidate: function () {
            return this.inputEl.checkValidate()
        }, showErrorMsg: function (a) {
            this.inputEl.showErrorMsg(a)
        }
    }), a.shortcut("inputgroup", YS.InputGroup)
}(jQuery), function (a) {
    YS.DeptSelect = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.DeptSelect.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_dept_select",
                width: 240,
                height: 30,
                value: {items: []},
                hasSelectEmpty: !0,
                dynamicType: "select",
                emptyId: "0",
                fieldLimit: {},
                onStopEdit: null,
                edge: {width: 300, height: 300}
            })
        }, _init: function () {
            YS.DeptSelect.superclass._init.apply(this, arguments)
        }, _initData: function () {
            var a = this;
            if (YS.Utils.isObjectEmpty(this.value) && (this.value = {items: []}), YS.Utils.isObjectEmpty(this.value.items))return this.items = [], void this._initSelectPane();
            var b = YS.Utils.createMask(this.element, {isLight: !0, hasLoader: !0});
            YS.Utils.ajax({
                url: "/corp/list_member_name",
                data: {isDepartmentOnly: !0, members: this.value.items}
            }, function (c) {
                var d = [];
                YS.Utils.forEach(c.departments, function (a, b) {
                    d.push({_id: b._id, name: b.name})
                }), a.items = d, a._initSelectPane(), b.remove()
            })
        }, _initSelectPane: function () {
            var a = this.options, b = this;
            if (this.value.hasEmpty && this.items.unshift({_id: a.emptyId, name: "未填写"}), this.value.hasCurrentDept) {
                if ("set" !== a.dynamicType)return $.ajax({
                    url: "/data/member/current_departments",
                    success: function (a) {
                        var c = [];
                        YS.Utils.forEach(a.departmentList, function (a, b) {
                            c.push({_id: b._id, name: b.name})
                        }), b.items = c.concat(b.items), b._createSelectList(), b._bindEditEvent(), b.value = b.getValue()
                    }
                });
                this.items.unshift({_id: YS.CONST.DEPT_ID.CURRENT, name: "当前用户所处部门"})
            }
            this._createSelectList(), this._bindEditEvent()
        }, _bindEditEvent: function () {
            var b = this;
            this.$selectList.unbind("click"), this.$selectList.bind("click", function (c) {
                var d = a(c.target).closest(".remove-btn");
                if (d.length > 0) {
                    var e = a(c.target).closest(".select-item"), f = e.data("item");
                    f && b._removeSelectItem(f)
                }
                b.$selectPane ? b._showSelectPane() : (b.$selectPane = a('<div class="dept-select-pane x-dropdown"/>').appendTo("body"),
                    b._createSelectPane(), b._showSelectPane()), b.$input.children("input").focus()
            }), this.$input.unbind("keydown"), this.$input.bind("keydown", function (a) {
                if (YS.Utils.isEmpty(b.$input.children("input").val())) {
                    switch (a.keyCode) {
                        case 37:
                            var c = b.$input.prev(".select-item");
                            c.length > 0 && b.$input.insertBefore(c);
                            break;
                        case 39:
                            var d = b.$input.next(".select-item");
                            d.length > 0 && b.$input.insertAfter(d);
                            break;
                        case 8:
                            var e = b.$input.prev(".select-item");
                            e.length > 0 && b._removeSelectItem(e.data("item"))
                    }
                    b.$input.children("input").focus()
                }
            }), this.$input.unbind("keyup"), this.$input.bind("keyup", function () {
                var a = b.$input.children("input").val();
                b._createSelectPane(a)
            })
        }, _createSelectPane: function (b) {
            var c = this;
            this.$selectPane.children(".select-search").remove(), this._createDynamicList(), YS.Utils.isEmpty(b) ? this.departmentTree ? this.departmentTree.setVisible(!0) : $.ajax({url: "/data/member/departments", success: function (b) {
                c.departments = a.extend(!0, [], b.departments), c.departments[0] && !c.departments[0]._id && c.departments.shift(), c._createDepartmentList()
            }}) : (this.departmentTree && this.departmentTree.setVisible(!1), this._createSearchList(b))
        }, _calSelectPanePos: function () {
            var a = {"z-Index": YS.STATIC.zIndex++}, b = this.element.offset(), c = this.options.edge, d = document.body.clientWidth - b.left;
            d < c.width ? (a.right = d - this.element.outerWidth(), a.left = "auto") : (a.right = "auto", a.left = b.left);
            var e = document.body.clientHeight + document.body.scrollTop - b.top - this.element.outerHeight();
            return e < c.height ? (a.top = "auto", a.bottom = document.body.clientHeight - b.top) : (a.top = b.top + this.element.outerHeight(), a.bottom = "auto"), a
        }, _showSelectPane: function () {
            var b = this;
            this.$selectPane.is(":visible") || (this.$selectPane.css(this._calSelectPanePos()), this.$selectPane.slideDown("fast"), a(document).bind("mousedown.hide", function (c) {
                a(c.target).closest(".dept-select-pane,.fx_dept_select").length > 0 || b._hideSelectPane()
            }))
        }, _hideSelectPane: function () {
            var b = this.options;
            this.$input.children("input").val(""), this.$selectPane.slideUp("fast"), a(document).unbind("mousedown.hide"), YS.Utils.applyFunc(this, b.onStopEdit, [], !1)
        }, _createSelectList: function () {
            var b = this;
            this.$selectList ? this.$selectList.empty() : this.$selectList = a('<ul class="select-list"/>').appendTo(this.element), this.$input = a('<li class="select-input"/>').append('<input placeholder="搜索"/>').appendTo(this.$selectList), YS.Utils.forEach(this.items, function (a, c) {
                b._createSelectItem(c)
            })
        }, _addSelectItem: function (a) {
            this._createSelectItem(a), this.value = this.getValue(), this.refresh()
        }, _removeSelectItem: function (b) {
            a("#" + b._id, this.$selectList).remove(), this.value = this.getValue(), this.refresh()
        }, _createSelectItem: function (b) {
            if (b) {
                if (a("#" + b._id, this.$selectList).length > 0)return;
                a('<li class="select-item"><i class="select-icon icon-department"/><span>' + b.name + '</span><span class="remove-btn"><i class="icon-close-large"/></span></li>').attr("id", b._id).data("item", b).insertBefore(this.$input)
            }
        }, _doSelectItem: function (a) {
            if (this._checkLimit(a)) {
                var b = {name: a.name, _id: a._id};
                this.value.items.indexOf(b._id) > -1 ? this._removeSelectItem(b) : this._addSelectItem(b)
            }
        }, _createDepartmentList: function () {
            var b = this;
        }, _createDepartmentItem: function (b) {
            var c = this, d = a("<li/>").append(a("<span/>").text(b.name)).append(a('<div class="select-btn x-check"/>').append(a('<i class="icon-blank"/>'))).data("item", b).click(function () {
                var a = d.children(".select-btn");
                if (a.hasClass("select"))a.removeClass("select"), c._removeSelectItem(d.data("item")); else {
                    a.addClass("select");
                    var b = d.data("item");
                    c._addSelectItem(b)
                }
            });
            return this._checkSelectState(b) && d.children(".select-btn").addClass("select"), d
        }, _checkSelectState: function (a) {
            var b = this.options;
            switch (a._id) {
                case b.emptyId:
                    return this.value.hasEmpty;
                case YS.CONST.DEPT_ID.CURRENT:
                    return this.value.hasCurrentDept;
                default:
                    return this.value.items.indexOf(a._id) > -1
            }
        }, _createDynamicList: function () {
            var b = this;
        }, _createSearchList: function (b) {
            var c = this, d = [], e = a('<div class="select-search"/>').appendTo(this.$selectPane), f = new RegExp(b);
            YS.Utils.forEach(this.departments, function (a, b) {
                f.test(b.name) && d.push(b)
            }), d.length <= 0 ? e.append(a('<div class="search-empty"/>').text("暂无相关部门")) : (this.$searchList = a('<ul class="department-list"/>').appendTo(e), YS.Utils.forEach(d, function (a, b) {
                c._checkLimit(b) && c.$searchList.append(c._createDepartmentItem(b))
            }))
        }, _checkLimit: function () {
            return !0
        }, getItems: function () {
            var b = [];
            return a(".select-item", this.$selectList).each(function (c, d) {
                b.push(a(d).data("item"))
            }), b
        }, setValue: function (a) {
            this.value = a, this._initData()
        }, getValue: function () {
            var b = this.options, c = {items: []};
            return this.$selectList ? a(".select-item", this.$selectList).each(function (a, d) {
                switch (d.id) {
                    case b.emptyId:
                        c.hasEmpty = !0;
                        break;
                    case YS.CONST.DEPT_ID.CURRENT:
                        c.hasCurrentDept = !0;
                        break;
                    default:
                        c.items.push(d.id)
                }
            }) : c = this.value, c
        }, _refreshDepartmentList: function (b) {
            var c = this;
            a("li", b).each(function (b, d) {
                var e = a(d).data("item");
                e && (c._checkSelectState(e) ? a(d).children(".select-btn").addClass("select") : a(d).children(".select-btn").removeClass("select"))
            })
        }, refresh: function () {
            this.departmentTree && this.departmentTree.refresh(), this.$dynamicList && this._refreshDepartmentList(this.$dynamicList), this.$searchList && this._refreshDepartmentList(this.$searchList)
        }, rebuild: function (a) {
            this.value = a, this._initData(), this.refresh()
        }
    }), a.shortcut("deptselect", YS.DeptSelect)
}(jQuery), function (a) {
    YS.Msg = {
        bubble: function (b) {
            var c = a.extend({
                anchor: null,
                msg: "",
                minWidth: null,
                contentWidget: null,
                contentHTML: null,
                contentPadding: 10,
                onContentCreate: null,
                onCancel: null,
                onOk: null,
                type: "info",
                width4Btn: 100,
                text4Cancel: "取消",
                text4Ok: "确定",
                dockPosition: "left",
                edge: 150,
                onShow: null,
                onClose: null,
                animation: !0,
                scrollObj: null,
                hAdjust: 0
            }, b);
            if (c.anchor) {
                var d = a('<div class="x-msg-bubble"/>').addClass(c.type);
                c.animation && d.addClass("animation"), c.minWidth && d.css({"min-width": c.minWidth});
                var e, f = a('<div class="content"/>').css({padding: c.contentPadding}).appendTo(d);
                YS.Utils.isEmpty(c.msg) ? c.contentWidget ? (c.contentWidget.renderEl = a("<div/>").appendTo(f), e = YS.createWidget(c.contentWidget)) : c.contentHTML && c.contentHTML.appendTo(f) : a("<span/>").text(c.msg).appendTo(f);
                var g = !1;
                if (c.text4Cancel && (g = !0, new YS.Button({
                        renderEl: a("<div/>").appendTo(d),
                        customCls: "navi-btn-cancel",
                        style: "white",
                        text: c.text4Cancel,
                        width: c.width4Btn,
                        onClick: function (a) {
                            YS.Utils.applyFunc(this, c.onCancel, [e, a], !0) !== !1 && o()
                        }
                    })), c.text4Ok) {
                    g = !0;
                    var h = "green";
                    "error" === c.type && (h = "red"), new YS.Button({
                        renderEl: a("<div/>").appendTo(d),
                        customCls: "navi-btn-ok",
                        style: h,
                        text: c.text4Ok,
                        width: c.width4Btn,
                        onClick: function (a) {
                            YS.Utils.applyFunc(this, c.onOk, [e, a], !0) !== !1 && o()
                        }
                    })
                }
                g && f.css({"padding-bottom": c.contentPadding + 50});
                var i = a('<div class="triangle-up"/>').appendTo(d), j = c.anchor.offset(), k = j.top + c.anchor.height() + 8, l = {"z-index": YS.STATIC.zIndex++}, m = Math.min(c.edge, document.body.clientHeight / 2);
                document.body.clientHeight + document.body.scrollTop - k <= m ? (l.top = "auto", l.bottom = document.body.clientHeight - j.top + 8, d.addClass("dock-bottom")) : (l.top = k, l.bottom = "auto", d.addClass("dock-top"));
                var n = c.hAdjust || 0;
                switch (c.dockPosition) {
                    case"left":
                        d.addClass("dock-left"), l.left = j.left + c.anchor.width() / 2 - 8 - n, i.css({left: n});
                        break;
                    case"right":
                        d.addClass("dock-right"), l.right = document.body.clientWidth - j.left - c.anchor.width() / 2 - 8 - n, i.css({right: n})
                }
                var o = function () {
                    YS.Utils.applyFunc(this, c.onClose, arguments, !1) === !1 && (d.removeClass("active"), a(document).unbind("mousedown.bubble"), c.scrollObj && a(c.scrollObj).unbind("scroll.bubble"), setTimeout(function () {
                        d.remove()
                    }, 500))
                };
                return d.css(l).appendTo("body"), setTimeout(function () {
                    d.addClass("active"), YS.Utils.applyFunc(this, c.onShow, [e], !1);
                    var b = function (b) {
                        var c = a(b.target).closest(".x-msg-bubble,.x-dropdown");
                        0 === c.length && o()
                    };
                    a(document).bind("mousedown.bubble", b), c.scrollObj && a(c.scrollObj).bind("scroll.bubble", b)
                }, 0), {close: o}
            }
        }, toast: function (b) {
            var c = a.extend({
                dockPosition: "topcenter",
                msg: "",
                type: "info",
                onShow: null,
                onClose: null,
                timeout: 300,
                duration: 3e3
            }, b);
            if (!(a(".x-msg-toast").length > 0 || YS.Utils.isEmpty(c.msg))) {
                var d = a('<div class="x-msg-toast"/>').addClass(c.dockPosition).appendTo("body"), e = a('<div class="content"/>').addClass(c.type).appendTo(d), f = a('<div class="toast-icon"/>').append(a('<i class="icon-toast-type"/>')).appendTo(e);
                a("<div/>").text(c.msg).appendTo(e), f.css("line-height", d.height() + "px"), d.fadeIn(c.timeout, function () {
                    var a = setTimeout(function () {
                        d.fadeOut(c.timeout, function () {
                            d.remove()
                        })
                    }, c.duration);
                    d.click(function () {
                        clearTimeout(a), d.fadeOut(c.timeout, function () {
                            d.remove()
                        })
                    })
                })
            }
        }, alert: function (b) {
            var c = a.extend({
                title: "",
                msg: "",
                type: "warning",
                content: null,
                text4Ok: "确定",
                text4Cancel: "取消",
                width4Btn: 100,
                onOk: null,
                onCancel: null,
                enable4Ok: !0,
                enable4Cancel: !0
            }, b);
            if (!(a(".x-msg-alert").length > 0)) {
                var d = function () {
                    e.fadeOut(function () {
                        e.remove()
                    }), f.removeClass("showAlert"), f.addClass("hideAlert"), f.remove()
                }, e = a('<div class="x-window-mask modal light" tabIndex="-1"/>').css({"z-index": YS.STATIC.zIndex++}).appendTo("body"), f = a('<div class="x-msg-alert"/>').appendTo("body"), g = a('<div class="icon"/>').append(a('<i class="icon-toast-type"/>')).appendTo(f);
                g.addClass(c.type), c.title && f.append(a('<div class="title" />').text(c.title)), c.msg && f.append(a('<div class="text" />').text(c.msg)), c.content && f.append(c.content);
                var h, i, j = a('<div class="btn-container"/>').appendTo(f);
                if (c.text4Cancel && (i = new YS.Button({
                        renderEl: a("<div/>").appendTo(j.addClass("double")),
                        customCls: "navi-btn-cancel",
                        style: "white",
                        text: c.text4Cancel,
                        width: c.width4Btn,
                        fieldEnable: c.enable4Cancel,
                        onClick: function () {
                            YS.Utils.applyFunc(this, c.onCancel, [], !0) !== !1 && d()
                        }
                    })), c.text4Ok) {
                    var k = "blue";
                    "error" !== c.type && "warning" !== c.type || (k = "red"), h = new YS.Button({
                        renderEl: a("<div/>").appendTo(j),
                        customCls: "navi-btn-ok",
                        style: k,
                        text: c.text4Ok,
                        width: c.width4Btn,
                        fieldEnable: c.enable4Ok,
                        onClick: function () {
                            YS.Utils.applyFunc(this, c.onOk, [], !0) !== !1 && d()
                        }
                    })
                }
                return f.addClass("showAlert"), e.fadeIn(), f.show(), {okBtn: h, cancelBtn: i}
            }
        }, broadcast: function (b) {
            var c = a.extend({msg: "", url: "", text4Ok: "", onOk: null, onClose: null}, b), d = this;
            if (!(a(".x-msg-broadcast").length > 0 || YS.Utils.isEmpty(c.msg))) {
                a("html").addClass("broadcast-html");
                var e = a('<div class="x-msg-broadcast"/>').prependTo("body");
                setTimeout(function () {
                    e.addClass("translate-in"), a("html").addClass("translate-in")
                });
                var f = a('<a class="broadcast-content"/>').text(c.msg).appendTo(e);
                c.url && f.attr("href", c.url), c.text4Ok && a('<a class="broadcast-btn"/>').text(c.text4Ok).on("click", function () {
                    YS.Utils.applyFunc(this, b.onOk, [], !1)
                }).appendTo(e), a('<i class="icon-close-large"/>').on("click", function () {
                    d.closeBroadcast(), YS.Utils.applyFunc(this, b.onClose, [], !1)
                }).appendTo(e)
            }
        }, closeBroadcast: function () {
            var b = a(".x-msg-broadcast");
            b.length > 0 && (b.removeClass("translate-in"), a("html").removeClass("translate-in"), setTimeout(function () {
                a("html").removeClass("broadcast-html"), b.remove()
            }, 218))
        }
    }
}(jQuery), function (a) {
    YS.MenuTree = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.MenuTree.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fs-menutree",
                nodes: [],
                indent: 0,
                onNodeClick: null,
                onNodeCreate: null,
                onNodeExpand: null,
                onNodeCollapse: null,
                onDisplayNodes: null
            })
        }, _init: function () {
            YS.MenuTree.superclass._init.apply(this, arguments);
            var a = this.options, b = {type: "group", child: a.nodes, level: 0};
            this.expandNode(b, null, this.element), this._bindEvts()
        }, _bindEvts: function () {
            var b = this, c = function (c) {
                var d = c.target, e = a(d).closest("a.menutree-node");
                if (e && e.length > 0) {
                    var f = c.type;
                    if ("mouseover" === f)e.addClass("fui-seb fui-fht"); else if ("mouseout" === f)e.hasClass("select") || e.removeClass("fui-seb fui-fht"); else if ("click" === f) {
                        var g = e.data("NODE");
                        b.clickNode(g, e)
                    }
                }
            };
            this.element.bind("mouseover", c).bind("mouseout", c).bind("click", c)
        }, createIconFont: function (b) {
            return a("<i/>").addClass(b).addClass("entry-icon")
        }, _onNodeCreate: function (b, c) {
            var d = this.options, e = a('<a class="menutree-node"/>').data("NODE", b).attr("data-id", b.id);
            return YS.Utils.applyFunc(this, d.onNodeCreate, [b, e, c], !1) === !1 ? "group" === b.type ? (e.addClass("fs-menu-item").attr("title", b.text).appendTo(c), this.createIconFont("icon-tree-group").appendTo(e), a('<span class="menutree-text"/>').text(b.text).appendTo(e)) : (e.addClass("fs-menu-item menutree-child").attr("title", b.text).appendTo(c), d.indent && e.css({"padding-left": (b.level - 1) * d.indent + 20}), a('<i class="tree-icon"/>').addClass("icon-tree-leaf " + b.icon).appendTo(e), a('<span class="menutree-text"/>').text(b.text).appendTo(e)) : c.remove(), e
        }, clickNode: function (a, b) {
            var c = this.options, d = b.parent("li");
            YS.Utils.applyFunc(this, c.onNodeClick, [a, b, d], !1) === !1 && (this.selectNode(b), "group" === a.type && (a.isexpand ? this.collapseNode(a, b, d) : this.expandNode(a, b, d)))
        }, selectNode: function (b) {
            a(".fs-menu-item.select", this.element).removeClass("select fui-seb fui-fht"), b.addClass("select fui-seb fui-fht")
        }, expandNode: function (b, c, d) {
            var e = this, f = this.options;
            b.level;
            if (YS.Utils.applyFunc(this, f.onNodeExpand, [b, c, d], !1) === !1 && "group" === b.type) {
                if (b.isLoaded)d.children("ul").slideDown("fast"); else {
                    var g = a("<ul/>").appendTo(d);
                    YS.Utils.forEach(b.child, function (c, d) {
                        d.level = b.level + 1, d.parent = b;
                        var f = a("<li/>").appendTo(g), h = e._onNodeCreate(d, f);
                        d.isexpand && e.expandNode(d, h, f)
                    }), b.isLoaded = !0
                }
                d.addClass("group-open")
            }
            b.isexpand = !0
        }, collapseNode: function (a, b, c) {
            var d = this.options;
            YS.Utils.applyFunc(this, d.onNodeCollapse, [a, b, c], !1) === !1 && (c.children("ul").slideUp("fast"), c.removeClass("group-open")), a.isexpand = !1
        }, loadNode: function (b, c) {
            var d = this, e = this.options, f = a('a[data-id="' + b + '"]', this.element);
            0 === f.length && YS.Utils.forEach(e.nodes, function (c, e) {
                "group" === e.type && YS.Utils.forEach(e.child, function (c, g) {
                    if (g.id === b) {
                        var h = a('a[data-id="' + e.id + '"]', d.element);
                        return d.expandNode(h.data("NODE"), h, h.closest("li")), f = a('a[data-id="' + b + '"]', d.element), !1
                    }
                })
            }), this.selectNode(f);
            var g = f.data("NODE");
            return YS.Utils.applyFunc(d, c, [g, f], !1), f
        }
    })
}(jQuery), function (a) {
    YS.Platform = YS.extend(YS.Widget, {
        CONSTS: {},
        NAV: {MESSAGE: 1, ACCOUNT: 2, FAVORITE: 3},
        _defaultConfig: function () {
            return a.extend(YS.Platform.superclass._defaultConfig.apply(), {
                data: [],
                resultWidgets: {},
                subWidgetMap: {},
                baseCls: "fui_platform",
                onMenuSelect: null
            })
        },
        _init: function () {
            YS.Platform.superclass._init.apply(this, arguments);
            var a = this.options;
            if(a.data && a.data.length>0){
                var c = a.data;
                for(var i = 0; i<c.length; i++){
                    delete c[i].assignmentUrl;  // 影响取值方式,直接去掉此属性.
                    if(c[i].fieldPid){
                        a.subWidgetMap[c[i].fieldPid] ? a.subWidgetMap[c[i].fieldPid].push(c[i]) : (a.subWidgetMap[c[i].fieldPid] = [c[i]]);
                        c.splice(i,1);
                        i--;
                    }
                }
                $.isEmptyObject(a.subWidgetMap) || $.each(c, function(d, e){
                    if(a.subWidgetMap[e.fieldId]){
                        switch (e.type){
                            case "subform":
                                c[d].items = a.subWidgetMap[e.fieldId];break;
                            case "deptadmin":c = c.concat(a.subWidgetMap[e.fieldId]);break;
                            case "bistable":
                            case "usermsg":
                                c = c.concat(a.subWidgetMap[e.fieldId]);break;
                            case "projectmsg":
                                c = c.concat(a.subWidgetMap[e.fieldId]);break;
                        }

                    }
                });
                a.data = c.sort(function(a, b){return a.fieldOrderno-b.fieldOrderno});
            }
            this._initFrame(), this.loadContentById()
        },
        _initFrame: function () {
            this.$content = a('<div class="fs-frame-content"/>').appendTo(this.element)
        },
        _sortEntryList: function (a, b) {
            return a.sort(function (a, c) {
                var d = b[a.id] && b[a.id].seq, e = b[c.id] && b[c.id].seq;
                if (d !== e)return d - e;
                var f = b[a.id] && b[a.id].entryId, g = b[c.id] && b[c.id].entryId, h = 0;
                return f > g ? h = 1 : f < g && (h = -1), h
            }), a
        },
        loadNode: function (a, b) {
            var c = this;
            return this.treeNodes ? void this.menu.loadNode(a, function (a, d) {
                c.loadContentById(a)
            }) : void(this.selectedNode = {id: a, type: b})
        },
        loadContentById: function (b) {
            var c = this, d = this.options;
            c.layout = d.data[0] ? d.data[0].fieldLayout : "normal";
            c.$content.empty();
            c._createFormView({layout: c.layout, items: d.data});
            /*$.ajax({
             dataType:"json",url: "/dashboard/page/edit.json",
             success: function(data){
             c.$content.empty();
             c._createFormView(data);
             }
             })*/
        },
        showSuccessInfo: function (b, c, d) {
            var e = this, f = a('<div class="success-pane"/>').appendTo(b);
            a("<div/>").append(a('<i class="img-icon"/>')).appendTo(f), a('<span class="msg-title"/>').text("提交成功！").appendTo(f), YS.Utils.isEmpty(c.check_msg) || a("<div>" + c.check_msg + "</div>").appendTo(f);
            var g = a('<div class="button-pane"/>').appendTo(f);
            d && new YS.Button({
                renderEl: a('<div class="button-style"/>').appendTo(g),
                text: "继续添加",
                width: 120,
                style: "green",
                onClick: function () {
                    YS.Utils.applyFunc(e, d, [], !1)
                }
            })
        },
        _createPath: function (b) {
            for (var c = this.$path.children(".breadcrumb").empty(), d = b; d && d.level > 0;) {
                var e = a("<li/>").prependTo(c);
                a('<i class="icon-angleright">').appendTo(e), a("<a/>").text(d.text).appendTo(e), d = d.parent
            }
            var f = a("<li/>").prependTo(c);
            a('<i class="icon-home-line"/>').appendTo(f)
        },
        _createFormView: function (b) {
            var c = this;
            new YS.Form(a.extend(b, {
                renderEl: a("<div/>").appendTo(this.$content.empty()),
                width: "100%",
                hasHeader: !1,
                height: "100%",
                submitText: "提交",
                buttonPosition: "left",
                onSuccess: function (a) {
                    c.$content.empty(), c.showSuccessInfo(c.$content, a, function () {
                        c._createFormView(b)
                    })
                }
            }))
        },
        _setFormView: function (b, c, d) {
            var e = this;
            switch (b) {
                case-1:
                    e._createFormView(d);
                    break;
                default:
                    var f = c[b];
                    if (!f)return;
                    var g = YS.Store.getKey("paramFields", {
                        entryId: d.entryId,
                        groupId: b
                    }), h = YS.Store.getKey("showFields", {
                        entryId: d.entryId,
                        groupId: b
                    }), i = YS.Store.getKey("metaFields", {entryId: d.entryId, groupId: b});
            }
        }
    })
}(jQuery), function (a) {
    function b() {
        return "" === i.hash || "#" === i.hash
    }

    function c(a, b) {
        for (var c = 0; c < a.length; c += 1)if (b(a[c], c, a) === !1)return
    }

    function d(a) {
        for (var b = [], c = 0, d = a.length; c < d; c++)b = b.concat(a[c]);
        return b
    }

    function e(a, b, c) {
        if (!a.length)return c();
        var d = 0;
        !function e() {
            b(a[d], function (b) {
                b || b === !1 ? (c(b), c = function () {
                }) : (d += 1, d === a.length ? c() : e())
            })
        }()
    }

    function f(a, b, c) {
        c = a;
        for (var d in b)if (b.hasOwnProperty(d) && (c = b[d](a),
            c !== a))break;
        return c === a ? "([._a-zA-Z0-9-%()]+)" : c
    }

    function g(a, b) {
        for (var c, d = 0, e = ""; c = a.substr(d).match(/[^\w\d\- %@&]*\*[^\w\d\- %@&]*/);)d = c.index + c[0].length, c[0] = c[0].replace(/^\*/, "([_.()!\\ %@&a-zA-Z0-9-]+)"), e += a.substr(0, c.index) + c[0];
        a = e += a.substr(d);
        var g, h, i = a.match(/:([^\/]+)/gi);
        if (i) {
            h = i.length;
            for (var j = 0; j < h; j++)g = i[j], a = "::" === g.slice(0, 2) ? g.slice(1) : a.replace(g, f(g, b))
        }
        return a
    }

    function h(a, b, c, d) {
        var e, f = 0, g = 0, h = 0, c = (c || "(").toString(), d = (d || ")").toString();
        for (e = 0; e < a.length; e++) {
            var i = a[e];
            if (i.indexOf(c, f) > i.indexOf(d, f) || ~i.indexOf(c, f) && !~i.indexOf(d, f) || !~i.indexOf(c, f) && ~i.indexOf(d, f)) {
                if (g = i.indexOf(c, f), h = i.indexOf(d, f), ~g && !~h || !~g && ~h) {
                    var j = a.slice(0, (e || 1) + 1).join(b);
                    a = [j].concat(a.slice((e || 1) + 1))
                }
                f = (h > g ? h : g) + 1, e = 0
            } else f = 0
        }
        return a
    }

    var i = document.location, j = {
        hash: i.hash, fire: function () {
            window.onhashchange()
        }, init: function (a) {
            function b(a) {
                for (var b = 0, c = k.listeners.length; b < c; b++)k.listeners[b](a)
            }

            k.listeners || (k.listeners = []), window.addEventListener("hashchange", b), k.listeners.push(a)
        }, destroy: function (a) {
            if (k && k.listeners)for (var b = k.listeners, c = b.length - 1; c >= 0; c--)b[c] === a && b.splice(c, 1)
        }, setHash: function (a) {
            return i.hash = "/" === a[0] ? a : "/" + a, this
        }
    }, k = a.Router = function (a) {
        return this instanceof k ? (this.params = {}, this.routes = {}, this.methods = ["on", "once", "after", "before"], this.scope = [], this._methods = {}, this._insert = this.insert, this.insert = this.insertEx, this.historySupport = null != (null != window.history ? window.history.pushState : null), this.configure(), void this.mount(a || {})) : new k(a)
    };
    k.prototype.init = function (a) {
        var c = this;
        return this.handler = function (a) {
            var b = a && a.newURL || window.location.hash, d = b.replace(/.*#/, "");
            c.dispatch("on", "/" === d.charAt(0) ? d : "/" + d)
        }, j.init(this.handler), b() && a ? i.hash = a : b() || c.dispatch("on", "/" + i.hash.replace(/^(#\/|#|\/)/, "")), this
    }, k.prototype.explode = function () {
        var a = i.hash;
        return "/" === a.charAt(1) && (a = a.slice(1)), a.slice(1, a.length).split("/")
    }, k.prototype.setRoute = function (a, b, c) {
        var d = this.explode();
        return "number" == typeof a && "string" == typeof b ? d[a] = b : "string" == typeof c ? d.splice(a, b, s) : d = [a], j.setHash(d.join("/")), d
    }, k.prototype.insertEx = function (a, b, c, d) {
        return "once" === a && (a = "on", c = function (a) {
            var b = !1;
            return function () {
                if (!b)return b = !0, a.apply(this, arguments)
            }
        }(c)), this._insert(a, b, c, d)
    }, k.prototype.getRoute = function (a) {
        var b = a;
        if ("number" == typeof a)b = this.explode()[a]; else if ("string" == typeof a) {
            var c = this.explode();
            b = c.indexOf(a)
        } else b = this.explode();
        return b
    }, k.prototype.destroy = function () {
        return j.destroy(this.handler), this
    }, k.prototype.getPath = function () {
        var a = window.location.pathname;
        return "/" !== a.substr(0, 1) && (a = "/" + a), a
    };
    var l = /\?.*/;
    k.prototype.configure = function (a) {
        a = a || {};
        for (var b = 0; b < this.methods.length; b++)this._methods[this.methods[b]] = !0;
        return this.recurse = a.recurse || this.recurse || !1, this.async = a.async || !1, this.delimiter = a.delimiter || "/", this.strict = "undefined" == typeof a.strict || a.strict, this.notfound = a.notfound, this.resource = a.resource, this.run_in_init = !1, this.convert_hash_in_init = !1, this.every = {
            after: a.after || null,
            before: a.before || null,
            on: a.on || null
        }, this
    }, k.prototype.param = function (a, b) {
        ":" !== a[0] && (a = ":" + a);
        var c = new RegExp(a, "g");
        return this.params[a] = function (a) {
            return a.replace(c, b.source || b)
        }, this
    }, k.prototype.on = k.prototype.route = function (a, b, c) {
        var d = this;
        return c || "function" != typeof b || (c = b, b = a, a = "on"), Array.isArray(b) ? b.forEach(function (b) {
            d.on(a, b, c)
        }) : (b.source && (b = b.source.replace(/\\\//gi, "/")), Array.isArray(a) ? a.forEach(function (a) {
            d.on(a.toLowerCase(), b, c)
        }) : (b = b.split(new RegExp(this.delimiter)), b = h(b, this.delimiter), void this.insert(a, this.scope.concat(b), c)))
    }, k.prototype.path = function (a, b) {
        var c = this.scope.length;
        a.source && (a = a.source.replace(/\\\//gi, "/")), a = a.split(new RegExp(this.delimiter)), a = h(a, this.delimiter), this.scope = this.scope.concat(a), b.call(this, this), this.scope.splice(c, a.length)
    }, k.prototype.dispatch = function (a, b, c) {
        function d() {
            f.last = g.after, f.invoke(f.runlist(g), f, c)
        }

        var e, f = this, g = this.traverse(a, b.replace(l, ""), this.routes, ""), h = this._invoked;
        return this._invoked = !0, g && 0 !== g.length ? ("forward" === this.recurse && (g = g.reverse()), e = this.every && this.every.after ? [this.every.after].concat(this.last) : [this.last], e && e.length > 0 && h ? (this.async ? this.invoke(e, this, d) : (this.invoke(e, this), d()), !0) : (d(), !0)) : (this.last = [], "function" == typeof this.notfound && this.invoke([this.notfound], {
            method: a,
            path: b
        }, c), !1)
    }, k.prototype.invoke = function (a, b, d) {
        var f, g = this;
        this.async ? (f = function (c, d) {
            return Array.isArray(c) ? e(c, f, d) : void("function" == typeof c && c.apply(b, (a.captures || []).concat(d)))
        }, e(a, f, function () {
            d && d.apply(b, arguments)
        })) : (f = function (d) {
            return Array.isArray(d) ? c(d, f) : "function" == typeof d ? d.apply(b, a.captures || []) : void("string" == typeof d && g.resource && g.resource[d].apply(b, a.captures || []))
        }, c(a, f))
    }, k.prototype.traverse = function (a, b, c, d, e) {
        function f(a) {
            function b(a) {
                for (var c = [], d = 0; d < a.length; d++)c[d] = Array.isArray(a[d]) ? b(a[d]) : a[d];
                return c
            }

            function c(a) {
                for (var b = a.length - 1; b >= 0; b--)Array.isArray(a[b]) ? (c(a[b]), 0 === a[b].length && a.splice(b, 1)) : e(a[b]) || a.splice(b, 1)
            }

            if (!e)return a;
            var d = b(a);
            return d.matched = a.matched, d.captures = a.captures, d.after = a.after.filter(e), c(d), d
        }

        var g, h, i, j, k = [];
        if (b === this.delimiter && c[a])return j = [[c.before, c[a]].filter(Boolean)], j.after = [c.after].filter(Boolean), j.matched = !0, j.captures = [], f(j);
        for (var l in c)if (c.hasOwnProperty(l) && (!this._methods[l] || this._methods[l] && "object" == typeof c[l] && !Array.isArray(c[l]))) {
            if (g = h = d + this.delimiter + l, this.strict || (h += "[" + this.delimiter + "]?"), i = b.match(new RegExp("^" + h)), !i)continue;
            if (i[0] && i[0] == b && c[l][a])return j = [[c[l].before, c[l][a]].filter(Boolean)], j.after = [c[l].after].filter(Boolean), j.matched = !0, j.captures = i.slice(1), this.recurse && c === this.routes && (j.push([c.before, c.on].filter(Boolean)), j.after = j.after.concat([c.after].filter(Boolean))), f(j);
            if (j = this.traverse(a, b, c[l], g), j.matched)return j.length > 0 && (k = k.concat(j)), this.recurse && (k.push([c[l].before, c[l].on].filter(Boolean)), j.after = j.after.concat([c[l].after].filter(Boolean)), c === this.routes && (k.push([c.before, c.on].filter(Boolean)), j.after = j.after.concat([c.after].filter(Boolean)))), k.matched = !0, k.captures = j.captures, k.after = j.after, f(k)
        }
        return !1
    }, k.prototype.insert = function (a, b, c, d) {
        var e, f, h, i, j;
        if (b = b.filter(function (a) {
                return a && a.length > 0
            }), d = d || this.routes, j = b.shift(), /\:|\*/.test(j) && !/\\d|\\w/.test(j) && (j = g(j, this.params)), b.length > 0)return d[j] = d[j] || {}, this.insert(a, b, c, d[j]);
        if (j || b.length || d !== this.routes) {
            if (f = typeof d[j], h = Array.isArray(d[j]), d[j] && !h && "object" == f)switch (e = typeof d[j][a]) {
                case"function":
                    return void(d[j][a] = [d[j][a], c]);
                case"object":
                    return void d[j][a].push(c);
                case"undefined":
                    return void(d[j][a] = c)
            } else if ("undefined" == f)return i = {}, i[a] = c, void(d[j] = i);
            throw new Error("Invalid route context: " + f)
        }
        switch (e = typeof d[a]) {
            case"function":
                return void(d[a] = [d[a], c]);
            case"object":
                return void d[a].push(c);
            case"undefined":
                return void(d[a] = c)
        }
    }, k.prototype.extend = function (a) {
        function b(a) {
            d._methods[a] = !0, d[a] = function () {
                var b = 1 === arguments.length ? [a, ""] : [a];
                d.on.apply(d, b.concat(Array.prototype.slice.call(arguments)))
            }
        }

        var c, d = this, e = a.length;
        for (c = 0; c < e; c++)b(a[c])
    }, k.prototype.runlist = function (a) {
        var b = this.every && this.every.before ? [this.every.before].concat(d(a)) : d(a);
        return this.every && this.every.on && b.push(this.every.on), b.captures = a.captures, b.source = a.source, b
    }, k.prototype.mount = function (a, b) {
        function c(b, c) {
            var e = b, f = b.split(d.delimiter), g = typeof a[b], i = "" === f[0] || !d._methods[f[0]], j = i ? "on" : e;
            return i && (e = e.slice((e.match(new RegExp("^" + d.delimiter)) || [""])[0].length), f.shift()), i && "object" === g && !Array.isArray(a[b]) ? (c = c.concat(f), void d.mount(a[b], c)) : (i && (c = c.concat(e.split(d.delimiter)), c = h(c, d.delimiter)), void d.insert(j, c, a[b]))
        }

        if (a && "object" == typeof a && !Array.isArray(a)) {
            var d = this;
            b = b || [], Array.isArray(b) || (b = b.split(d.delimiter));
            for (var e in a)a.hasOwnProperty(e) && c(e, b.slice(0))
        }
    }
}("object" == typeof exports ? exports : window),function (a) {
    "function" == typeof define && define.amd ? define(["jquery"], a) : a(window.jQuery)
}(function (a) {
    Array.prototype.reduce || (Array.prototype.reduce = function (a) {
        var b, c = Object(this), d = c.length >>> 0, e = 0;
        if (2 === arguments.length)b = arguments[1]; else {
            for (; e < d && !(e in c);)e++;
            if (e >= d)throw new TypeError("Reduce of empty array with no initial value");
            b = c[e++]
        }
        for (; e < d; e++)e in c && (b = a(b, c[e], e, c));
        return b
    }), "function" != typeof Array.prototype.filter && (Array.prototype.filter = function (a) {
        for (var b = Object(this), c = b.length >>> 0, d = [], e = arguments.length >= 2 ? arguments[1] : void 0, f = 0; f < c; f++)if (f in b) {
            var g = b[f];
            a.call(e, g, f, b) && d.push(g)
        }
        return d
    });
    var b, c = "function" == typeof define && define.amd, d = function (b) {
        var c = "Comic Sans MS" === b ? "Courier New" : "Comic Sans MS", d = a("<div>").css({
            position: "absolute",
            left: "-9999px",
            top: "-9999px",
            fontSize: "200px"
        }).text("mmmmmmmmmwwwwwww").appendTo(document.body), e = d.css("fontFamily", c).width(), f = d.css("fontFamily", b + "," + c).width();
        return d.remove(), e !== f
    }, e = navigator.userAgent, f = {
        isMac: navigator.appVersion.indexOf("Mac") > -1,
        isMSIE: /MSIE|Trident/i.test(e),
        isFF: /firefox/i.test(e),
        isWebkit: /webkit/i.test(e),
        isSafari: /safari/i.test(e),
        jqueryVersion: parseFloat(a.fn.jquery),
        isSupportAmd: c,
        hasCodeMirror: c ? require.specified("CodeMirror") : !!window.CodeMirror,
        isFontInstalled: d,
        isW3CRangeSupport: !!document.createRange
    }, g = function () {
        var b = function (a) {
            return function (b) {
                return a === b
            }
        }, c = function (a, b) {
            return a === b
        }, d = function (a) {
            return function (b, c) {
                return b[a] === c[a]
            }
        }, e = function () {
            return !0
        }, f = function () {
            return !1
        }, g = function (a) {
            return function () {
                return !a.apply(a, arguments)
            }
        }, h = function (a, b) {
            return function (c) {
                return a(c) && b(c)
            }
        }, i = function (a) {
            return a
        }, j = 0, k = function (a) {
            var b = ++j + "";
            return a ? a + b : b
        }, l = function (b) {
            var c = a(document);
            return {
                top: b.top + c.scrollTop(),
                left: b.left + c.scrollLeft(),
                width: b.right - b.left,
                height: b.bottom - b.top
            }
        }, m = function (a) {
            var b = {};
            for (var c in a)a.hasOwnProperty(c) && (b[a[c]] = c);
            return b
        }, n = function (a, b) {
            return b = b || "", b + a.split(".").map(function (a) {
                return a.substring(0, 1).toUpperCase() + a.substring(1)
            }).join("")
        };
        return {
            eq: b,
            eq2: c,
            peq2: d,
            ok: e,
            fail: f,
            self: i,
            not: g,
            and: h,
            uniqueId: k,
            rect2bnd: l,
            invertObject: m,
            namespaceToCamel: n
        }
    }(), h = function () {
        var b = function (a) {
            return a[0]
        }, c = function (a) {
            return a[a.length - 1]
        }, d = function (a) {
            return a.slice(0, a.length - 1)
        }, e = function (a) {
            return a.slice(1)
        }, f = function (a, b) {
            for (var c = 0, d = a.length; c < d; c++) {
                var e = a[c];
                if (b(e))return e
            }
        }, h = function (a, b) {
            for (var c = 0, d = a.length; c < d; c++)if (!b(a[c]))return !1;
            return !0
        }, i = function (b, c) {
            return a.inArray(c, b) !== -1
        }, j = function (a, b) {
            return b = b || g.self, a.reduce(function (a, c) {
                return a + b(c)
            }, 0)
        }, k = function (a) {
            for (var b = [], c = -1, d = a.length; ++c < d;)b[c] = a[c];
            return b
        }, l = function (a, d) {
            if (!a.length)return [];
            var f = e(a);
            return f.reduce(function (a, b) {
                var e = c(a);
                return d(c(e), b) ? e[e.length] = b : a[a.length] = [b], a
            }, [[b(a)]])
        }, m = function (a) {
            for (var b = [], c = 0, d = a.length; c < d; c++)a[c] && b.push(a[c]);
            return b
        }, n = function (a) {
            for (var b = [], c = 0, d = a.length; c < d; c++)i(b, a[c]) || b.push(a[c]);
            return b
        }, o = function (a, b) {
            var c = a.indexOf(b);
            return c === -1 ? null : a[c + 1]
        }, p = function (a, b) {
            var c = a.indexOf(b);
            return c === -1 ? null : a[c - 1]
        };
        return {
            head: b,
            last: c,
            initial: d,
            tail: e,
            prev: p,
            next: o,
            find: f,
            contains: i,
            all: h,
            sum: j,
            from: k,
            clusterBy: l,
            compact: m,
            unique: n
        }
    }(), i = String.fromCharCode(160), j = "\ufeff", k = function () {
        var b = function (b) {
            return b && a(b).hasClass("note-editable")
        }, c = function (b) {
            return b && a(b).hasClass("note-control-sizing")
        }, d = function (b) {
            var c;
            if (b.hasClass("note-air-editor")) {
                var d = h.last(b.attr("id").split("-"));
                return c = function (b) {
                    return function () {
                        return a(b + d)
                    }
                }, {
                    editor: function () {
                        return b
                    }, holder: function () {
                        return b.data("holder")
                    }, editable: function () {
                        return b
                    }, popover: c("#note-popover-"), handle: c("#note-handle-"), dialog: c("#note-dialog-")
                }
            }
            return c = function (a) {
                return function () {
                    return b.find(a)
                }
            }, {
                editor: function () {
                    return b
                },
                holder: function () {
                    return b.data("holder")
                },
                dropzone: c(".note-dropzone"),
                toolbar: c(".note-toolbar"),
                editable: c(".note-editable"),
                codable: c(".note-codable"),
                statusbar: c(".note-statusbar"),
                popover: c(".note-popover"),
                handle: c(".note-handle"),
                dialog: c(".note-dialog")
            }
        }, e = function (b) {
            var c = a(b).closest(".note-editor, .note-air-editor, .note-air-layout");
            if (!c.length)return null;
            var e;
            return e = c.is(".note-editor, .note-air-editor") ? c : a("#note-editor-" + h.last(c.attr("id").split("-"))), d(e)
        }, l = function (a) {
            return a = a.toUpperCase(), function (b) {
                return b && b.nodeName.toUpperCase() === a
            }
        }, m = function (a) {
            return a && 3 === a.nodeType
        }, n = function (a) {
            return a && /^BR|^IMG|^HR/.test(a.nodeName.toUpperCase())
        }, o = function (a) {
            return !b(a) && (a && /^DIV|^P|^LI|^H[1-7]/.test(a.nodeName.toUpperCase()))
        }, p = l("LI"), q = function (a) {
            return o(a) && !p(a)
        }, r = l("TABLE"), s = function (a) {
            return !(w(a) || t(a) || o(a) || r(a) || v(a))
        }, t = function (a) {
            return a && /^UL|^OL/.test(a.nodeName.toUpperCase())
        }, u = function (a) {
            return a && /^TD|^TH/.test(a.nodeName.toUpperCase())
        }, v = l("BLOCKQUOTE"), w = function (a) {
            return u(a) || v(a) || b(a)
        }, x = l("A"), y = function (a) {
            return s(a) && !!H(a, o)
        }, z = function (a) {
            return s(a) && !H(a, o)
        }, A = l("BODY"), B = function (a, b) {
            return a.nextSibling === b || a.previousSibling === b
        }, C = function (a, b) {
            b = b || g.ok;
            var c = [];
            return a.previousSibling && b(a.previousSibling) && c.push(a.previousSibling), c.push(a), a.nextSibling && b(a.nextSibling) && c.push(a.nextSibling), c
        }, D = f.isMSIE ? "&nbsp;" : "<br>", E = function (a) {
            return m(a) ? a.nodeValue.length : a.childNodes.length
        }, F = function (a) {
            var b = E(a);
            return 0 === b || (!m(a) && 1 === b && a.innerHTML === D || !(!h.all(a.childNodes, m) || "" !== a.innerHTML))
        }, G = function (a) {
            n(a) || E(a) || (a.innerHTML = D)
        }, H = function (a, c) {
            for (; a;) {
                if (c(a))return a;
                if (b(a))break;
                a = a.parentNode
            }
            return null
        }, I = function (a, c) {
            for (a = a.parentNode; a && 1 === E(a);) {
                if (c(a))return a;
                if (b(a))break;
                a = a.parentNode
            }
            return null
        }, J = function (a, c) {
            c = c || g.fail;
            var d = [];
            return H(a, function (a) {
                return b(a) || d.push(a), c(a)
            }), d
        }, K = function (a, b) {
            var c = J(a);
            return h.last(c.filter(b))
        }, L = function (b, c) {
            for (var d = J(b), e = c; e; e = e.parentNode)if (a.inArray(e, d) > -1)return e;
            return null
        }, M = function (a, b) {
            b = b || g.fail;
            for (var c = []; a && !b(a);)c.push(a), a = a.previousSibling;
            return c
        }, N = function (a, b) {
            b = b || g.fail;
            for (var c = []; a && !b(a);)c.push(a), a = a.nextSibling;
            return c
        }, O = function (a, b) {
            var c = [];
            return b = b || g.ok, function d(e) {
                a !== e && b(e) && c.push(e);
                for (var f = 0, g = e.childNodes.length; f < g; f++)d(e.childNodes[f])
            }(a), c
        }, P = function (b, c) {
            var d = b.parentNode, e = a("<" + c + ">")[0];
            return d.insertBefore(e, b), e.appendChild(b), e
        }, Q = function (a, b) {
            var c = b.nextSibling, d = b.parentNode;
            return c ? d.insertBefore(a, c) : d.appendChild(a), a
        }, R = function (b, c) {
            return a.each(c, function (a, c) {
                b.appendChild(c)
            }), b
        }, S = function (a) {
            return 0 === a.offset
        }, T = function (a) {
            return a.offset === E(a.node)
        }, U = function (a) {
            return S(a) || T(a)
        }, V = function (a, b) {
            for (; a && a !== b;) {
                if (0 !== X(a))return !1;
                a = a.parentNode
            }
            return !0
        }, W = function (a, b) {
            for (; a && a !== b;) {
                if (X(a) !== E(a.parentNode) - 1)return !1;
                a = a.parentNode
            }
            return !0
        }, X = function (a) {
            for (var b = 0; a = a.previousSibling;)b += 1;
            return b
        }, Y = function (a) {
            return !!(a && a.childNodes && a.childNodes.length)
        }, Z = function (a, c) {
            var d, e;
            if (0 === a.offset) {
                if (b(a.node))return null;
                d = a.node.parentNode, e = X(a.node)
            } else Y(a.node) ? (d = a.node.childNodes[a.offset - 1], e = E(d)) : (d = a.node, e = c ? 0 : a.offset - 1);
            return {node: d, offset: e}
        }, $ = function (a, c) {
            var d, e;
            if (E(a.node) === a.offset) {
                if (b(a.node))return null;
                d = a.node.parentNode, e = X(a.node) + 1
            } else Y(a.node) ? (d = a.node.childNodes[a.offset], e = 0) : (d = a.node, e = c ? E(a.node) : a.offset + 1);
            return {node: d, offset: e}
        }, _ = function (a, b) {
            return a.node === b.node && a.offset === b.offset
        }, aa = function (a) {
            if (m(a.node) || !Y(a.node) || F(a.node))return !0;
            var b = a.node.childNodes[a.offset - 1], c = a.node.childNodes[a.offset];
            return !(b && !n(b) || c && !n(c))
        }, ba = function (a, b) {
            for (; a;) {
                if (b(a))return a;
                a = Z(a)
            }
            return null
        }, ca = function (a, b) {
            for (; a;) {
                if (b(a))return a;
                a = $(a)
            }
            return null
        }, da = function (a) {
            if (!m(a.node))return !1;
            var b = a.node.nodeValue.charAt(a.offset - 1);
            return b && " " !== b && b !== i
        }, ea = function (a, b, c, d) {
            for (var e = a; e && (c(e), !_(e, b));) {
                var f = d && a.node !== e.node && b.node !== e.node;
                e = $(e, f)
            }
        }, fa = function (b, c) {
            var d = J(c, g.eq(b));
            return a.map(d, X).reverse()
        }, ga = function (a, b) {
            for (var c = a, d = 0, e = b.length; d < e; d++)c = c.childNodes.length <= b[d] ? c.childNodes[c.childNodes.length - 1] : c.childNodes[b[d]];
            return c
        }, ha = function (a, b) {
            var c = b && b.isSkipPaddingBlankHTML, d = b && b.isNotSplitEdgePoint;
            if (U(a) && (m(a.node) || d)) {
                if (S(a))return a.node;
                if (T(a))return a.node.nextSibling
            }
            if (m(a.node))return a.node.splitText(a.offset);
            var e = a.node.childNodes[a.offset], f = Q(a.node.cloneNode(!1), a.node);
            return R(f, N(e)), c || (G(a.node), G(f)), f
        }, ia = function (a, b, c) {
            var d = J(b.node, g.eq(a));
            return d.length ? 1 === d.length ? ha(b, c) : d.reduce(function (a, d) {
                return a === b.node && (a = ha(b, c)), ha({node: d, offset: a ? k.position(a) : E(d)}, c)
            }) : null
        }, ja = function (a, b) {
            var c, d, e = b ? o : w, f = J(a.node, e), g = h.last(f) || a.node;
            e(g) ? (c = f[f.length - 2], d = g) : (c = g, d = c.parentNode);
            var i = c && ia(c, a, {isSkipPaddingBlankHTML: b, isNotSplitEdgePoint: b});
            return i || d !== a.node || (i = a.node.childNodes[a.offset]), {rightNode: i, container: d}
        }, ka = function (a) {
            return document.createElement(a)
        }, la = function (a) {
            return document.createTextNode(a)
        }, ma = function (a, b) {
            if (a && a.parentNode) {
                if (a.removeNode)return a.removeNode(b);
                var c = a.parentNode;
                if (!b) {
                    var d, e, f = [];
                    for (d = 0, e = a.childNodes.length; d < e; d++)f.push(a.childNodes[d]);
                    for (d = 0, e = f.length; d < e; d++)c.insertBefore(f[d], a)
                }
                c.removeChild(a)
            }
        }, na = function (a, c) {
            for (; a && !b(a) && c(a);) {
                var d = a.parentNode;
                ma(a), a = d
            }
        }, oa = function (a, b) {
            if (a.nodeName.toUpperCase() === b.toUpperCase())return a;
            var c = ka(b);
            return a.style.cssText && (c.style.cssText = a.style.cssText), R(c, h.from(a.childNodes)), Q(c, a), ma(a), c
        }, pa = l("TEXTAREA"), qa = function (a, b) {
            var c = pa(a[0]) ? a.val() : a.html();
            return b ? c.replace(/[\n\r]/g, "") : c
        }, ra = function (b, c) {
            var d = qa(b);
            if (c) {
                var e = /<(\/?)(\b(?!!)[^>\s]*)(.*?)(\s*\/?>)/g;
                d = d.replace(e, function (a, b, c) {
                    c = c.toUpperCase();
                    var d = /^DIV|^TD|^TH|^P|^LI|^H[1-7]/.test(c) && !!b, e = /^BLOCKQUOTE|^TABLE|^TBODY|^TR|^HR|^UL|^OL/.test(c);
                    return a + (d || e ? "\n" : "")
                }), d = a.trim(d)
            }
            return d
        };
        return {
            NBSP_CHAR: i,
            ZERO_WIDTH_NBSP_CHAR: j,
            blank: D,
            emptyPara: "<p>" + D + "</p>",
            makePredByNodeName: l,
            isEditable: b,
            isControlSizing: c,
            buildLayoutInfo: d,
            makeLayoutInfo: e,
            isText: m,
            isVoid: n,
            isPara: o,
            isPurePara: q,
            isInline: s,
            isBlock: g.not(s),
            isBodyInline: z,
            isBody: A,
            isParaInline: y,
            isList: t,
            isTable: r,
            isCell: u,
            isBlockquote: v,
            isBodyContainer: w,
            isAnchor: x,
            isDiv: l("DIV"),
            isLi: p,
            isBR: l("BR"),
            isSpan: l("SPAN"),
            isB: l("B"),
            isU: l("U"),
            isS: l("S"),
            isI: l("I"),
            isImg: l("IMG"),
            isTextarea: pa,
            isEmpty: F,
            isEmptyAnchor: g.and(x, F),
            isClosestSibling: B,
            withClosestSiblings: C,
            nodeLength: E,
            isLeftEdgePoint: S,
            isRightEdgePoint: T,
            isEdgePoint: U,
            isLeftEdgeOf: V,
            isRightEdgeOf: W,
            prevPoint: Z,
            nextPoint: $,
            isSamePoint: _,
            isVisiblePoint: aa,
            prevPointUntil: ba,
            nextPointUntil: ca,
            isCharPoint: da,
            walkPoint: ea,
            ancestor: H,
            singleChildAncestor: I,
            listAncestor: J,
            lastAncestor: K,
            listNext: N,
            listPrev: M,
            listDescendant: O,
            commonAncestor: L,
            wrap: P,
            insertAfter: Q,
            appendChildNodes: R,
            position: X,
            hasChildren: Y,
            makeOffsetPath: fa,
            fromOffsetPath: ga,
            splitTree: ia,
            splitPoint: ja,
            create: ka,
            createText: la,
            remove: ma,
            removeWhile: na,
            replace: oa,
            html: ra,
            value: qa
        }
    }(), l = function () {
        var b = function (a, b) {
            var c, d, e = a.parentElement(), f = document.body.createTextRange(), g = h.from(e.childNodes);
            for (c = 0; c < g.length; c++)if (!k.isText(g[c])) {
                if (f.moveToElementText(g[c]), f.compareEndPoints("StartToStart", a) >= 0)break;
                d = g[c]
            }
            if (0 !== c && k.isText(g[c - 1])) {
                var i = document.body.createTextRange(), j = null;
                i.moveToElementText(d || e), i.collapse(!d), j = d ? d.nextSibling : e.firstChild;
                var l = a.duplicate();
                l.setEndPoint("StartToStart", i);
                for (var m = l.text.replace(/[\r\n]/g, "").length; m > j.nodeValue.length && j.nextSibling;)m -= j.nodeValue.length, j = j.nextSibling;
                j.nodeValue;
                b && j.nextSibling && k.isText(j.nextSibling) && m === j.nodeValue.length && (m -= j.nodeValue.length, j = j.nextSibling), e = j, c = m
            }
            return {cont: e, offset: c}
        }, c = function (a) {
            var b = function (a, c) {
                var d, e;
                if (k.isText(a)) {
                    var f = k.listPrev(a, g.not(k.isText)), i = h.last(f).previousSibling;
                    d = i || a.parentNode, c += h.sum(h.tail(f), k.nodeLength), e = !i
                } else {
                    if (d = a.childNodes[c] || a, k.isText(d))return b(d, 0);
                    c = 0, e = !1
                }
                return {node: d, collapseToStart: e, offset: c}
            }, c = document.body.createTextRange(), d = b(a.node, a.offset);
            return c.moveToElementText(d.node), c.collapse(d.collapseToStart), c.moveStart("character", d.offset), c
        }, d = function (b, e, i, j) {
            this.sc = b, this.so = e, this.ec = i, this.eo = j;
            var l = function () {
                if (f.isW3CRangeSupport) {
                    var a = document.createRange();
                    return a.setStart(b, e), a.setEnd(i, j), a
                }
                var d = c({node: b, offset: e});
                return d.setEndPoint("EndToEnd", c({node: i, offset: j})), d
            };
            this.getPoints = function () {
                return {sc: b, so: e, ec: i, eo: j}
            }, this.getStartPoint = function () {
                return {node: b, offset: e}
            }, this.getEndPoint = function () {
                return {node: i, offset: j}
            }, this.select = function () {
                var a = l();
                if (f.isW3CRangeSupport) {
                    var b = document.getSelection();
                    b.rangeCount > 0 && b.removeAllRanges(), b.addRange(a)
                } else a.select();
                return this
            }, this.normalize = function () {
                var a = function (a) {
                    return k.isVisiblePoint(a) || (a = k.isLeftEdgePoint(a) ? k.nextPointUntil(a, k.isVisiblePoint) : k.prevPointUntil(a, k.isVisiblePoint)), a
                }, b = a(this.getStartPoint()), c = a(this.getEndPoint());
                return new d(b.node, b.offset, c.node, c.offset)
            }, this.nodes = function (a, b) {
                a = a || g.ok;
                var c = b && b.includeAncestor, d = b && b.fullyContains, e = this.getStartPoint(), f = this.getEndPoint(), i = [], j = [];
                return k.walkPoint(e, f, function (b) {
                    if (!k.isEditable(b.node)) {
                        var e;
                        d ? (k.isLeftEdgePoint(b) && j.push(b.node), k.isRightEdgePoint(b) && h.contains(j, b.node) && (e = b.node)) : e = c ? k.ancestor(b.node, a) : b.node, e && a(e) && i.push(e)
                    }
                }, !0), h.unique(i)
            }, this.commonAncestor = function () {
                return k.commonAncestor(b, i)
            }, this.expand = function (a) {
                var c = k.ancestor(b, a), f = k.ancestor(i, a);
                if (!c && !f)return new d(b, e, i, j);
                var g = this.getPoints();
                return c && (g.sc = c, g.so = 0), f && (g.ec = f, g.eo = k.nodeLength(f)), new d(g.sc, g.so, g.ec, g.eo)
            }, this.collapse = function (a) {
                return a ? new d(b, e, b, e) : new d(i, j, i, j)
            }, this.splitText = function () {
                var a = b === i, c = this.getPoints();
                return k.isText(i) && !k.isEdgePoint(this.getEndPoint()) && i.splitText(j), k.isText(b) && !k.isEdgePoint(this.getStartPoint()) && (c.sc = b.splitText(e), c.so = 0, a && (c.ec = c.sc, c.eo = j - e)), new d(c.sc, c.so, c.ec, c.eo)
            }, this.deleteContents = function () {
                if (this.isCollapsed())return this;
                var b = this.splitText(), c = b.nodes(null, {fullyContains: !0}), e = k.prevPointUntil(b.getStartPoint(), function (a) {
                    return !h.contains(c, a.node)
                }), f = [];
                return a.each(c, function (a, b) {
                    var c = b.parentNode;
                    e.node !== c && 1 === k.nodeLength(c) && f.push(c), k.remove(b, !1)
                }), a.each(f, function (a, b) {
                    k.remove(b, !1)
                }), new d(e.node, e.offset, e.node, e.offset).normalize()
            };
            var m = function (a) {
                return function () {
                    var c = k.ancestor(b, a);
                    return !!c && c === k.ancestor(i, a)
                }
            };
            this.isOnEditable = m(k.isEditable), this.isOnList = m(k.isList), this.isOnAnchor = m(k.isAnchor), this.isOnCell = m(k.isCell), this.isLeftEdgeOf = function (a) {
                if (!k.isLeftEdgePoint(this.getStartPoint()))return !1;
                var b = k.ancestor(this.sc, a);
                return b && k.isLeftEdgeOf(this.sc, b)
            }, this.isCollapsed = function () {
                return b === i && e === j
            }, this.wrapBodyInlineWithPara = function () {
                if (k.isBodyContainer(b) && k.isEmpty(b))return b.innerHTML = k.emptyPara, new d(b.firstChild, 0, b.firstChild, 0);
                if (k.isParaInline(b) || k.isPara(b))return this.normalize();
                var a;
                if (k.isInline(b)) {
                    var c = k.listAncestor(b, g.not(k.isInline));
                    a = h.last(c), k.isInline(a) || (a = c[c.length - 2] || b.childNodes[e])
                } else a = b.childNodes[e > 0 ? e - 1 : 0];
                var f = k.listPrev(a, k.isParaInline).reverse();
                if (f = f.concat(k.listNext(a.nextSibling, k.isParaInline)), f.length) {
                    var i = k.wrap(h.head(f), "p");
                    k.appendChildNodes(i, h.tail(f))
                }
                return this.normalize()
            }, this.insertNode = function (a) {
                var b = this.wrapBodyInlineWithPara().deleteContents(), c = k.splitPoint(b.getStartPoint(), k.isInline(a));
                return c.rightNode ? c.rightNode.parentNode.insertBefore(a, c.rightNode) : c.container.appendChild(a), a
            }, this.pasteHTML = function (b) {
                var c = this, d = a("<div></div>").html(b)[0], e = h.from(d.childNodes);
                return this.wrapBodyInlineWithPara().deleteContents(), a.map(e.reverse(), function (a) {
                    return c.insertNode(a)
                }).reverse()
            }, this.toString = function () {
                var a = l();
                return f.isW3CRangeSupport ? a.toString() : a.text
            }, this.getWordRange = function (a) {
                var b = this.getEndPoint();
                if (!k.isCharPoint(b))return this;
                var c = k.prevPointUntil(b, function (a) {
                    return !k.isCharPoint(a)
                });
                return a && (b = k.nextPointUntil(b, function (a) {
                    return !k.isCharPoint(a)
                })), new d(c.node, c.offset, b.node, b.offset)
            }, this.bookmark = function (a) {
                return {s: {path: k.makeOffsetPath(a, b), offset: e}, e: {path: k.makeOffsetPath(a, i), offset: j}}
            }, this.paraBookmark = function (a) {
                return {
                    s: {path: h.tail(k.makeOffsetPath(h.head(a), b)), offset: e},
                    e: {path: h.tail(k.makeOffsetPath(h.last(a), i)), offset: j}
                }
            }, this.getClientRects = function () {
                var a = l();
                return a.getClientRects()
            }
        };
        return {
            create: function (a, c, e, g) {
                if (arguments.length)2 === arguments.length && (e = a, g = c); else if (f.isW3CRangeSupport) {
                    var h = document.getSelection();
                    if (!h || 0 === h.rangeCount)return null;
                    if (k.isBody(h.anchorNode))return null;
                    var i = h.getRangeAt(0);
                    a = i.startContainer, c = i.startOffset, e = i.endContainer, g = i.endOffset
                } else {
                    var j = document.selection.createRange(), l = j.duplicate();
                    l.collapse(!1);
                    var m = j;
                    m.collapse(!0);
                    var n = b(m, !0), o = b(l, !1);
                    k.isText(n.node) && k.isLeftEdgePoint(n) && k.isTextNode(o.node) && k.isRightEdgePoint(o) && o.node.nextSibling === n.node && (n = o), a = n.cont, c = n.offset, e = o.cont, g = o.offset
                }
                return new d(a, c, e, g)
            }, createFromNode: function (a) {
                var b = a, c = 0, d = a, e = k.nodeLength(d);
                return k.isVoid(b) && (c = k.listPrev(b).length - 1, b = b.parentNode), k.isBR(d) ? (e = k.listPrev(d).length - 1, d = d.parentNode) : k.isVoid(d) && (e = k.listPrev(d).length, d = d.parentNode), this.create(b, c, d, e)
            }, createFromNodeBefore: function (a) {
                return this.createFromNode(a).collapse(!0)
            }, createFromNodeAfter: function (a) {
                return this.createFromNode(a).collapse()
            }, createFromBookmark: function (a, b) {
                var c = k.fromOffsetPath(a, b.s.path), e = b.s.offset, f = k.fromOffsetPath(a, b.e.path), g = b.e.offset;
                return new d(c, e, f, g)
            }, createFromParaBookmark: function (a, b) {
                var c = a.s.offset, e = a.e.offset, f = k.fromOffsetPath(h.head(b), a.s.path), g = k.fromOffsetPath(h.last(b), a.e.path);
                return new d(f, c, g, e)
            }
        }
    }(), m = {
        version: "0.6.7",
        options: {
            width: null,
            height: null,
            minHeight: null,
            maxHeight: null,
            focus: !1,
            tabsize: 4,
            styleWithSpan: !0,
            disableLinkTarget: !1,
            disableDragAndDrop: !1,
            disableResizeEditor: !1,
            shortcuts: !0,
            placeholder: !1,
            prettifyHtml: !0,
            iconPrefix: "iconfont icon-",
            codemirror: {mode: "text/html", htmlMode: !0, lineNumbers: !0},
            lang: "zh-CN",
            direction: null,
            toolbar: [["style", ["style"]], ["font", ["bold", "italic", "underline", "clear"]], ["fontname", ["fontname"]], ["fontsize", ["fontsize"]], ["color", ["color"]], ["para", ["ul", "ol", "paragraph"]], ["height", ["height"]], ["table", ["table"]], ["insert", ["link", "unlink", "picture", "hr"]], ["view", ["fullscreen", "codeview"]]],
            plugin: {},
            airMode: !1,
            airPopover: [["color", ["color"]], ["font", ["bold", "underline", "clear"]], ["para", ["ul", "paragraph"]], ["table", ["table"]], ["insert", ["link", "picture"]]],
            styleTags: ["p", "blockquote", "pre", "h1", "h2", "h3", "h4", "h5", "h6"],
            defaultFontName: "Helvetica Neue",
            fontNames: ["Arial", "Arial Black", "Comic Sans MS", "Courier New", "Helvetica Neue", "Helvetica", "Impact", "Lucida Grande", "Tahoma", "Times New Roman", "Verdana"],
            fontNamesIgnoreCheck: [],
            fontSizes: [12, 14, 18, 24, 36],
            colors: ["#333", "#777", "#ccc", "#178cdf", "#5cb85c", "#f0ad4e", "#d9534f"],
            lineHeights: ["1.0", "1.2", "1.4", "1.5", "1.6", "1.8", "2.0", "3.0"],
            insertTableMaxSize: {col: 0, row: 0},
            maximumImageFileSize: null,
            oninit: null,
            onfocus: null,
            onblur: null,
            onenter: null,
            onkeyup: null,
            onkeydown: null,
            onImageUpload: null,
            onImageUploadError: null,
            onMediaDelete: null,
            onToolbarClick: null,
            onsubmit: null,
            onCreateLink: function (a) {
                return a.indexOf("@") !== -1 && a.indexOf(":") === -1 ? a = "mailto:" + a : a.indexOf("://") === -1 && (a = "http://" + a), a
            },
            keyMap: {
                pc: {
                    ENTER: "insertParagraph",
                    "CTRL+Z": "undo",
                    "CTRL+Y": "redo",
                    TAB: "tab",
                    "SHIFT+TAB": "untab",
                    "CTRL+B": "bold",
                    "CTRL+I": "italic",
                    "CTRL+U": "underline",
                    "CTRL+SHIFT+S": "strikethrough",
                    "CTRL+BACKSLASH": "removeFormat",
                    "CTRL+SHIFT+L": "justifyLeft",
                    "CTRL+SHIFT+E": "justifyCenter",
                    "CTRL+SHIFT+R": "justifyRight",
                    "CTRL+SHIFT+J": "justifyFull",
                    "CTRL+SHIFT+NUM7": "insertUnorderedList",
                    "CTRL+SHIFT+NUM8": "insertOrderedList",
                    "CTRL+LEFTBRACKET": "outdent",
                    "CTRL+RIGHTBRACKET": "indent",
                    "CTRL+NUM0": "formatPara",
                    "CTRL+NUM1": "formatH1",
                    "CTRL+NUM2": "formatH2",
                    "CTRL+NUM3": "formatH3",
                    "CTRL+NUM4": "formatH4",
                    "CTRL+NUM5": "formatH5",
                    "CTRL+NUM6": "formatH6",
                    "CTRL+ENTER": "insertHorizontalRule",
                    "CTRL+K": "showLinkDialog"
                },
                mac: {
                    ENTER: "insertParagraph",
                    "CMD+Z": "undo",
                    "CMD+SHIFT+Z": "redo",
                    TAB: "tab",
                    "SHIFT+TAB": "untab",
                    "CMD+B": "bold",
                    "CMD+I": "italic",
                    "CMD+U": "underline",
                    "CMD+SHIFT+S": "strikethrough",
                    "CMD+BACKSLASH": "removeFormat",
                    "CMD+SHIFT+L": "justifyLeft",
                    "CMD+SHIFT+E": "justifyCenter",
                    "CMD+SHIFT+R": "justifyRight",
                    "CMD+SHIFT+J": "justifyFull",
                    "CMD+SHIFT+NUM7": "insertUnorderedList",
                    "CMD+SHIFT+NUM8": "insertOrderedList",
                    "CMD+LEFTBRACKET": "outdent",
                    "CMD+RIGHTBRACKET": "indent",
                    "CMD+NUM0": "formatPara",
                    "CMD+NUM1": "formatH1",
                    "CMD+NUM2": "formatH2",
                    "CMD+NUM3": "formatH3",
                    "CMD+NUM4": "formatH4",
                    "CMD+NUM5": "formatH5",
                    "CMD+NUM6": "formatH6",
                    "CMD+ENTER": "insertHorizontalRule",
                    "CMD+K": "showLinkDialog"
                }
            }
        },
        lang: {
            "zh-CN": {
                font: {
                    bold: "粗体",
                    italic: "斜体",
                    underline: "下划线",
                    clear: "清除格式",
                    height: "行高",
                    name: "字体",
                    strikethrough: "删除线",
                    size: "字号"
                },
                image: {
                    image: "图片",
                    insert: "插入图片",
                    resizeFull: "调整至 100%",
                    resizeHalf: "调整至 50%",
                    resizeQuarter: "调整至 25%",
                    floatLeft: "左浮动",
                    floatRight: "右浮动",
                    floatNone: "不浮动",
                    dragImageHere: "将图片拖至此处",
                    selectFromFiles: "从本地上传",
                    url: "图片地址"
                },
                link: {
                    link: "链接",
                    insert: "插入链接",
                    unlink: "取消链接",
                    edit: "编辑链接",
                    textToDisplay: "显示文本",
                    url: "链接地址",
                    openInNewWindow: "在新窗口打开"
                },
                unlink: {unlink: "取消链接"},
                table: {table: "表格"},
                hr: {insert: "水平线"},
                style: {
                    style: "样式",
                    normal: "普通",
                    blockquote: "引用",
                    pre: "代码",
                    h1: "标题 1",
                    h2: "标题 2",
                    h3: "标题 3",
                    h4: "标题 4",
                    h5: "标题 5",
                    h6: "标题 6"
                },
                lists: {unordered: "无序列表", ordered: "有序列表"},
                options: {help: "帮助", fullscreen: "全屏", codeview: "源代码"},
                paragraph: {
                    paragraph: "段落",
                    outdent: "减少缩进",
                    indent: "增加缩进",
                    left: "左对齐",
                    center: "居中对齐",
                    right: "右对齐",
                    justify: "两端对齐"
                },
                color: {
                    font: "字体颜色",
                    recent: "最近使用",
                    more: "更多",
                    background: "背景",
                    foreground: "前景",
                    transparent: "透明",
                    setTransparent: "透明",
                    reset: "重置",
                    resetToDefault: "默认"
                },
                shortcut: {
                    shortcuts: "快捷键",
                    close: "关闭",
                    textFormatting: "文本格式",
                    action: "动作",
                    paragraphFormatting: "段落格式",
                    documentStyle: "文档样式"
                },
                history: {undo: "撤销", redo: "重做"}
            }
        }
    }, n = function () {
        var b = function (b) {
            return a.Deferred(function (c) {
                a.extend(new FileReader, {
                    onload: function (a) {
                        var b = a.target.result;
                        c.resolve(b)
                    }, onerror: function () {
                        c.reject(this)
                    }
                }).readAsDataURL(b)
            }).promise()
        }, c = function (b, c) {
            return a.Deferred(function (d) {
                var e = a("<img>");
                e.one("load", function () {
                    e.off("error abort"), d.resolve(e)
                }).one("error abort", function () {
                    e.off("load").detach(), d.reject(e)
                }).css({display: "none"}).appendTo(document.body).attr({src: b, "data-filename": c})
            }).promise()
        };
        return {readFileAsDataURL: b, createImage: c}
    }(), o = function () {
        var a = {
            BACKSPACE: 8,
            TAB: 9,
            ENTER: 13,
            SPACE: 32,
            NUM0: 48,
            NUM1: 49,
            NUM2: 50,
            NUM3: 51,
            NUM4: 52,
            NUM5: 53,
            NUM6: 54,
            NUM7: 55,
            NUM8: 56,
            B: 66,
            E: 69,
            I: 73,
            J: 74,
            K: 75,
            L: 76,
            R: 82,
            S: 83,
            U: 85,
            Y: 89,
            Z: 90,
            SLASH: 191,
            LEFTBRACKET: 219,
            BACKSLASH: 220,
            RIGHTBRACKET: 221
        };
        return {
            isEdit: function (a) {
                return h.contains([8, 9, 13, 32], a)
            }, isMove: function (a) {
                return h.contains([37, 38, 39, 40], a)
            }, nameFromCode: g.invertObject(a), code: a
        }
    }(), p = function (a) {
        var b = [], c = -1, d = a[0], e = function () {
            var b = l.create(), c = {s: {path: [], offset: 0}, e: {path: [], offset: 0}};
            return {contents: a.html(), bookmark: b ? b.bookmark(d) : c}
        }, f = function (b) {
            null !== b.contents && a.html(b.contents), null !== b.bookmark && l.createFromBookmark(d, b.bookmark).select()
        };
        this.undo = function () {
            0 < c && (c--, f(b[c]))
        }, this.redo = function () {
            b.length - 1 > c && (c++, f(b[c]))
        }, this.recordUndo = function () {
            c++, b.length > c && (b = b.slice(0, c)), b.push(e())
        }, this.recordUndo()
    }, q = function () {
        var b = function (b, c) {
            if (f.jqueryVersion < 1.9) {
                var d = {};
                return a.each(c, function (a, c) {
                    d[c] = b.css(c)
                }), d
            }
            return b.css.call(b, c)
        };
        this.stylePara = function (b, c) {
            a.each(b.nodes(k.isPara, {includeAncestor: !0}), function (b, d) {
                a(d).css(c)
            })
        }, this.styleNodes = function (b, c) {
            b = b.splitText();
            var d = c && c.nodeName || "SPAN", e = !(!c || !c.expandClosestSibling), f = !(!c || !c.onlyPartialContains);
            if (b.isCollapsed())return [b.insertNode(k.create(d))];
            var i = k.makePredByNodeName(d), j = a.map(b.nodes(k.isText, {fullyContains: !0}), function (a) {
                return k.singleChildAncestor(a, i) || k.wrap(a, d)
            });
            if (e) {
                if (f) {
                    var l = b.nodes();
                    i = g.and(i, function (a) {
                        return h.contains(l, a)
                    })
                }
                return a.map(j, function (b) {
                    var c = k.withClosestSiblings(b, i), d = h.head(c), e = h.tail(c);
                    return a.each(e, function (a, b) {
                        k.appendChildNodes(d, b.childNodes), k.remove(b);
                    }), h.head(c)
                })
            }
            return j
        }, this.current = function (c, d) {
            var e = a(k.isText(c.sc) ? c.sc.parentNode : c.sc), f = ["color", "font-family", "font-size", "text-align", "list-style-type", "line-height"], g = b(e, f) || {};
            if (g["font-size"] = parseInt(g["font-size"], 10), g["font-bold"] = document.queryCommandState("bold") ? "bold" : "normal", g["font-italic"] = document.queryCommandState("italic") ? "italic" : "normal", g["font-underline"] = document.queryCommandState("underline") ? "underline" : "normal", g["font-strikethrough"] = document.queryCommandState("strikeThrough") ? "strikethrough" : "normal", g["font-superscript"] = document.queryCommandState("superscript") ? "superscript" : "normal", g["font-subscript"] = document.queryCommandState("subscript") ? "subscript" : "normal", c.isOnList()) {
                var h = ["circle", "disc", "disc-leading-zero", "square"], i = a.inArray(g["list-style-type"], h) > -1;
                g["list-style"] = i ? "unordered" : "ordered"
            } else g["list-style"] = "none";
            var j = k.ancestor(c.sc, k.isPara);
            if (j && j.style["line-height"])g["line-height"] = j.style.lineHeight; else {
                var l = parseInt(g["line-height"], 10) / parseInt(g["font-size"], 10);
                g["line-height"] = l.toFixed(1)
            }
            return g.image = k.isImg(d) && d, g.anchor = c.isOnAnchor() && k.ancestor(c.sc, k.isAnchor), g.ancestors = k.listAncestor(c.sc, k.isEditable), g.range = c, g
        }
    }, r = function () {
        this.insertOrderedList = function () {
            this.toggleList("OL")
        }, this.insertUnorderedList = function () {
            this.toggleList("UL")
        }, this.indent = function () {
            var b = this, c = l.create().wrapBodyInlineWithPara(), d = c.nodes(k.isPara, {includeAncestor: !0}), e = h.clusterBy(d, g.peq2("parentNode"));
            a.each(e, function (c, d) {
                var e = h.head(d);
                k.isLi(e) ? b.wrapList(d, e.parentNode.nodeName) : a.each(d, function (b, c) {
                    a(c).css("marginLeft", function (a, b) {
                        return (parseInt(b, 10) || 0) + 25
                    })
                })
            }), c.select()
        }, this.outdent = function () {
            var b = this, c = l.create().wrapBodyInlineWithPara(), d = c.nodes(k.isPara, {includeAncestor: !0}), e = h.clusterBy(d, g.peq2("parentNode"));
            a.each(e, function (c, d) {
                var e = h.head(d);
                k.isLi(e) ? b.releaseList([d]) : a.each(d, function (b, c) {
                    a(c).css("marginLeft", function (a, b) {
                        return b = parseInt(b, 10) || 0, b > 25 ? b - 25 : ""
                    })
                })
            }), c.select()
        }, this.toggleList = function (b) {
            var c = this, d = l.create().wrapBodyInlineWithPara(), e = d.nodes(k.isPara, {includeAncestor: !0}), f = d.paraBookmark(e), i = h.clusterBy(e, g.peq2("parentNode"));
            if (h.find(e, k.isPurePara)) {
                var j = [];
                a.each(i, function (a, d) {
                    j = j.concat(c.wrapList(d, b))
                }), e = j
            } else {
                var m = d.nodes(k.isList, {includeAncestor: !0}).filter(function (c) {
                    return !a.nodeName(c, b)
                });
                m.length ? a.each(m, function (a, c) {
                    k.replace(c, b)
                }) : e = this.releaseList(i, !0)
            }
            l.createFromParaBookmark(f, e).select()
        }, this.wrapList = function (b, c) {
            var d, e = h.head(b), f = h.last(b), g = k.isList(e.previousSibling) && e.previousSibling, i = k.isList(f.nextSibling) && f.nextSibling;
            if (g)d = g; else {
                var j = k.create(c || "UL");
                j.className = "note-list", d = k.insertAfter(j, f)
            }
            return b = a.map(b, function (a) {
                return k.isPurePara(a) ? k.replace(a, "LI") : a
            }), k.appendChildNodes(d, b), i && (k.appendChildNodes(d, h.from(i.childNodes)), k.remove(i)), b
        }, this.releaseList = function (b, c) {
            var d = [];
            return a.each(b, function (b, e) {
                var f = h.head(e), g = h.last(e), i = c ? k.lastAncestor(f, k.isList) : f.parentNode, j = i.childNodes.length > 1 ? k.splitTree(i, {
                    node: g.parentNode,
                    offset: k.position(g) + 1
                }, {isSkipPaddingBlankHTML: !0}) : null, l = k.splitTree(i, {
                    node: f.parentNode,
                    offset: k.position(f)
                }, {isSkipPaddingBlankHTML: !0});
                e = c ? k.listDescendant(l, k.isLi) : h.from(l.childNodes).filter(k.isLi), !c && k.isList(i.parentNode) || (e = a.map(e, function (a) {
                    return k.replace(a, "P")
                })), a.each(h.from(e).reverse(), function (a, b) {
                    k.insertAfter(b, i)
                });
                var m = h.compact([i, l, j]);
                a.each(m, function (b, c) {
                    var d = [c].concat(k.listDescendant(c, k.isList));
                    a.each(d.reverse(), function (a, b) {
                        k.nodeLength(b) || k.remove(b, !0)
                    })
                }), d = d.concat(e)
            }), d
        }
    }, s = function () {
        var b = new r;
        this.insertTab = function (a, b, c) {
            var d = k.createText(new Array(c + 1).join(k.NBSP_CHAR));
            b = b.deleteContents(), b.insertNode(d, !0), b = l.create(d, c), b.select()
        }, this.insertParagraph = function () {
            var c = l.create();
            c = c.deleteContents(), c = c.wrapBodyInlineWithPara();
            var d, e = k.ancestor(c.sc, k.isPara);
            if (e) {
                if (k.isEmpty(e) && k.isLi(e))return void b.toggleList(e.parentNode.nodeName);
                d = k.splitTree(e, c.getStartPoint());
                var f = k.listDescendant(e, k.isEmptyAnchor);
                f = f.concat(k.listDescendant(d, k.isEmptyAnchor)), a.each(f, function (a, b) {
                    k.remove(b)
                })
            } else {
                var g = c.sc.childNodes[c.so];
                d = a(k.emptyPara)[0], g ? c.sc.insertBefore(d, g) : c.sc.appendChild(d)
            }
            l.create(d, 0).normalize().select()
        }
    }, t = function () {
        this.tab = function (a, b) {
            var c = k.ancestor(a.commonAncestor(), k.isCell), d = k.ancestor(c, k.isTable), e = k.listDescendant(d, k.isCell), f = h[b ? "prev" : "next"](e, c);
            f && l.create(f, 0).select()
        }, this.createTable = function (b, c) {
            for (var d, e = [], f = 0; f < b; f++)e.push("<td>" + k.blank + "</td>");
            d = e.join("");
            for (var g, h = [], i = 0; i < c; i++)h.push("<tr>" + d + "</tr>");
            return g = h.join(""), a('<table class="table table-bordered">' + g + "</table>")[0]
        }
    }, u = "bogus", v = function (b) {
        var c = new q, d = new t, e = new s, g = new r;
        this.createRange = function (a) {
            return this.focus(a), l.create()
        }, this.saveRange = function (a, b) {
            this.focus(a), a.data("range", l.create()), b && l.create().collapse().select()
        }, this.saveNode = function (a) {
            for (var b = [], c = 0, d = a[0].childNodes.length; c < d; c++)b.push(a[0].childNodes[c]);
            a.data("childNodes", b)
        }, this.restoreRange = function (a) {
            var b = a.data("range");
            b && (b.select(), this.focus(a))
        }, this.restoreNode = function (a) {
            a.html("");
            for (var b = a.data("childNodes"), c = 0, d = b.length; c < d; c++)a[0].appendChild(b[c])
        }, this.currentStyle = function (a) {
            var b = l.create();
            return !!b && (b.isOnEditable() && c.current(b, a))
        };
        var i = function (a) {
            var c = k.makeLayoutInfo(a).holder();
            b.bindCustomEvent(c, a.data("callbacks"), "before.command")(a.html(), a)
        }, j = function (a) {
            var c = k.makeLayoutInfo(a).holder();
            b.bindCustomEvent(c, a.data("callbacks"), "change")(a.html(), a)
        };
        this.undo = function (a) {
            i(a), a.data("NoteHistory").undo(), j(a)
        }, this.redo = function (a) {
            i(a), a.data("NoteHistory").redo(), j(a)
        };
        for (var m = this, o = this.beforeCommand = function (a) {
            i(a), m.focus(a)
        }, p = this.afterCommand = function (a, b) {
            a.data("NoteHistory").recordUndo(), b || j(a)
        }, v = ["bold", "italic", "underline", "strikethrough", "unlink", "superscript", "subscript", "justifyLeft", "justifyCenter", "justifyRight", "justifyFull", "formatBlock", "removeFormat", "backColor", "foreColor", "insertHorizontalRule", "fontName"], w = 0, x = v.length; w < x; w++)this[v[w]] = function (a) {
            return function (b, c) {
                o(b), document.execCommand(a, !1, c), p(b, !0)
            }
        }(v[w]);
        this.tab = function (a, b) {
            var c = this.createRange(a);
            c.isCollapsed() && c.isOnCell() ? d.tab(c) : (o(a), e.insertTab(a, c, b.tabsize), p(a))
        }, this.untab = function (a) {
            var b = this.createRange(a);
            b.isCollapsed() && b.isOnCell() && d.tab(b, !0)
        }, this.insertParagraph = function (a) {
            o(a), e.insertParagraph(a), p(a)
        }, this.insertOrderedList = function (a) {
            o(a), g.insertOrderedList(a), p(a)
        }, this.insertUnorderedList = function (a) {
            o(a), g.insertUnorderedList(a), p(a)
        }, this.indent = function (a) {
            o(a), g.indent(a), p(a)
        }, this.outdent = function (a) {
            o(a), g.outdent(a), p(a)
        }, this.insertImage = function (a, c, d) {
            n.createImage(c, d).then(function (b) {
                o(a), b.css({
                    display: "",
                    "max-width": "100%"
                }), l.create().insertNode(b[0]), l.createFromNodeAfter(b[0]).select(), p(a)
            }).fail(function () {
                var c = k.makeLayoutInfo(a).holder();
                b.bindCustomEvent(c, a.data("callbacks"), "image.upload.error")()
            })
        }, this.insertNode = function (a, b) {
            o(a), l.create().insertNode(b), l.createFromNodeAfter(b).select(), p(a)
        }, this.insertText = function (a, b) {
            o(a);
            var c = l.create().insertNode(k.createText(b));
            l.create(c, k.nodeLength(c)).select(), p(a)
        }, this.pasteHTML = function (a, b) {
            o(a);
            var c = l.create().pasteHTML(b);
            l.createFromNodeAfter(h.last(c)).select(), p(a)
        }, this.formatBlock = function (a, b) {
            o(a), b = f.isMSIE ? "<" + b + ">" : b, document.execCommand("FormatBlock", !1, b), p(a)
        }, this.formatPara = function (a) {
            o(a), this.formatBlock(a, "P"), p(a)
        };
        for (var w = 1; w <= 6; w++)this["formatH" + w] = function (a) {
            return function (b) {
                this.formatBlock(b, "H" + a)
            }
        }(w);
        this.fontSize = function (b, d) {
            var e = l.create(), f = e.isCollapsed();
            if (f) {
                var g = c.styleNodes(e), i = h.head(g);
                a(g).css({"font-size": d + "px"}), i && !k.nodeLength(i) && (i.innerHTML = k.ZERO_WIDTH_NBSP_CHAR, l.createFromNodeAfter(i.firstChild).select(), b.data(u, i))
            } else o(b), a(c.styleNodes(e)).css({"font-size": d + "px"}), p(b)
        }, this.removeBogus = function (a) {
            var b = a.data(u);
            if (b) {
                var c = h.find(h.from(b.childNodes), k.isText), d = c.nodeValue.indexOf(k.ZERO_WIDTH_NBSP_CHAR);
                d !== -1 && c.deleteData(d, 1), k.isEmpty(b) && k.remove(b), a.removeData(u)
            }
        }, this.lineHeight = function (a, b) {
            o(a), c.stylePara(l.create(), {lineHeight: b}), p(a)
        }, this.unlink = function (a) {
            var b = this.createRange(a);
            if (b.isOnAnchor()) {
                var c = k.ancestor(b.sc, k.isAnchor);
                b = l.createFromNode(c), b.select(), o(a), document.execCommand("unlink"), p(a)
            }
        }, this.createLink = function (b, d, e) {
            var f = d.url, g = d.text, i = d.newWindow, j = d.range, k = j.toString() !== g;
            o(b), e.onCreateLink && (f = e.onCreateLink(f));
            var m = [];
            if (k) {
                var n = j.insertNode(a("<A>" + g + "</A>")[0]);
                m.push(n)
            } else m = c.styleNodes(j, {nodeName: "A", expandClosestSibling: !0, onlyPartialContains: !0});
            a.each(m, function (b, c) {
                a(c).attr("href", f).attr("title", f), i ? a(c).attr("target", "_blank") : a(c).removeAttr("target")
            });
            var q = l.createFromNodeBefore(h.head(m)), r = q.getStartPoint(), s = l.createFromNodeAfter(h.last(m)), t = s.getEndPoint();
            l.create(r.node, r.offset, t.node, t.offset).select(), p(b)
        }, this.getLinkInfo = function (b) {
            this.focus(b);
            var c = l.create().expand(k.isAnchor), d = a(h.head(c.nodes(k.isAnchor)));
            return {
                range: c,
                text: c.toString(),
                isNewWindow: !!d.length && "_blank" === d.attr("target"),
                url: d.length ? d.attr("href") : ""
            }
        }, this.color = function (a, b) {
            var c = JSON.parse(b), d = c.foreColor, e = c.backColor;
            o(a), d && document.execCommand("foreColor", !1, d), e && document.execCommand("backColor", !1, e), p(a)
        }, this.insertTable = function (a, b) {
            var c = b.split("x");
            o(a);
            var e = l.create().deleteContents();
            e.insertNode(d.createTable(c[0], c[1])), p(a)
        }, this.floatMe = function (a, b, c) {
            o(a), c.css("float", b), p(a)
        }, this.imageShape = function (a, b, c) {
            o(a), c.removeClass("img-rounded img-circle img-thumbnail"), b && c.addClass(b), p(a)
        }, this.resize = function (a, b, c) {
            o(a), c.css({width: 100 * b + "%", height: ""}), p(a)
        }, this.resizeTo = function (a, b, c) {
            var d;
            if (c) {
                var e = a.y / a.x, f = b.data("ratio");
                d = {width: f > e ? a.x : a.y / f, height: f > e ? a.x * f : a.y}
            } else d = {width: a.x, height: a.y};
            b.css(d)
        }, this.removeMedia = function (c, d, e) {
            o(c), e.detach(), b.bindCustomEvent(a(), c.data("callbacks"), "media.delete")(e, c), p(c)
        }, this.focus = function (a) {
            a.focus(), f.isFF && !l.create().isOnEditable() && l.createFromNode(a[0]).normalize().collapse().select()
        }
    }, w = function () {
        this.update = function (b, c) {
            var d = function (b, c) {
                b.find(".dropdown-menu .btn-item").each(function () {
                    var b = a(this).data("value") + "" == c + "";
                    b ? a(this).addClass("active") : a(this).removeClass("active")
                })
            }, e = function (a, c) {
                var d = b.find(a);
                d.toggleClass("active", c())
            };
            if (c.image) {
                var g = a(c.image);
                e('button[data-event="imageShape"][data-value="img-rounded"]', function () {
                    return g.hasClass("img-rounded")
                }), e('button[data-event="imageShape"][data-value="img-circle"]', function () {
                    return g.hasClass("img-circle")
                }), e('button[data-event="imageShape"][data-value="img-thumbnail"]', function () {
                    return g.hasClass("img-thumbnail")
                }), e('button[data-event="imageShape"]:not([data-value])', function () {
                    return !g.is(".img-rounded, .img-circle, .img-thumbnail")
                });
                var h = g.css("float");
                e('button[data-event="floatMe"][data-value="left"]', function () {
                    return "left" === h
                }), e('button[data-event="floatMe"][data-value="right"]', function () {
                    return "right" === h
                }), e('button[data-event="floatMe"][data-value="none"]', function () {
                    return "left" !== h && "right" !== h
                });
                var i = g.attr("style");
                return e('button[data-event="resize"][data-value="1"]', function () {
                    return !!/(^|\s)(max-)?width\s*:\s*100%/.test(i)
                }), e('button[data-event="resize"][data-value="0.5"]', function () {
                    return !!/(^|\s)(max-)?width\s*:\s*50%/.test(i)
                }), void e('button[data-event="resize"][data-value="0.25"]', function () {
                    return !!/(^|\s)(max-)?width\s*:\s*25%/.test(i)
                })
            }
            var j = b.find(".note-fontname");
            if (j.length) {
                var k = c["font-family"];
                if (k) {
                    for (var l = k.split(","), m = 0, n = l.length; m < n && (k = l[m].replace(/[\'\"]/g, "").replace(/\s+$/, "").replace(/^\s+/, ""), !f.isFontInstalled(k)); m++);
                    j.find(".note-current-fontname").text(k), d(j, k)
                }
            }
            var o = b.find(".note-fontsize");
            d(o, parseFloat(c["font-size"]));
            var p = b.find(".note-height");
            d(p, parseFloat(c["line-height"])), e('button[data-event="bold"]', function () {
                return "bold" === c["font-bold"]
            }), e('button[data-event="italic"]', function () {
                return "italic" === c["font-italic"]
            }), e('button[data-event="underline"]', function () {
                return "underline" === c["font-underline"]
            }), e('button[data-event="strikethrough"]', function () {
                return "strikethrough" === c["font-strikethrough"]
            }), e('button[data-event="superscript"]', function () {
                return "superscript" === c["font-superscript"]
            }), e('button[data-event="subscript"]', function () {
                return "subscript" === c["font-subscript"]
            }), e('button[data-event="justifyLeft"]', function () {
                return "left" === c["text-align"] || "start" === c["text-align"]
            }), e('button[data-event="justifyCenter"]', function () {
                return "center" === c["text-align"]
            }), e('button[data-event="justifyRight"]', function () {
                return "right" === c["text-align"]
            }), e('button[data-event="justifyFull"]', function () {
                return "justify" === c["text-align"]
            }), e('button[data-event="insertUnorderedList"]', function () {
                return "unordered" === c["list-style"]
            }), e('button[data-event="insertOrderedList"]', function () {
                return "ordered" === c["list-style"]
            })
        }, this.updateRecentColor = function (b, c, d) {
            var e = a(b).closest(".note-color"), f = e.find(".note-recent-color"), g = JSON.parse(f.attr("data-value"));
            g[c] = d, f.attr("data-value", JSON.stringify(g));
            var h = "backColor" === c ? "background-color" : "color";
            f.find("i").css(h, d)
        }
    }, x = function () {
        var a = new w;
        this.update = function (b, c) {
            a.update(b, c)
        }, this.updateRecentColor = function (b, c, d) {
            a.updateRecentColor(b, c, d)
        }, this.activate = function (a) {
            a.find("button").not('button[data-event="codeview"]').removeClass("disabled")
        }, this.deactivate = function (a) {
            a.find("button").not('button[data-event="codeview"]').addClass("disabled")
        }, this.updateFullscreen = function (a, b) {
            var c = a.find('button[data-event="fullscreen"]');
            c.toggleClass("active", b)
        }, this.updateCodeview = function (a, b) {
            var c = a.find('button[data-event="codeview"]');
            c.toggleClass("active", b), b ? this.deactivate(a) : this.activate(a)
        }, this.get = function (a, b) {
            var c = k.makeLayoutInfo(a).toolbar();
            return c.find("[data-name=" + b + "]")
        }, this.setButtonState = function (a, b, c) {
            c = c !== !1;
            var d = this.get(a, b);
            d.toggleClass("active", c)
        }
    }, y = 24, z = function () {
        var b = a(document);
        this.attach = function (a, b) {
            b.disableResizeEditor || a.statusbar().on("mousedown", c)
        };
        var c = function (a) {
            a.preventDefault(), a.stopPropagation();
            var c = k.makeLayoutInfo(a.target).editable(), d = c.offset().top - b.scrollTop(), e = k.makeLayoutInfo(a.currentTarget || a.target), f = e.editor().data("options");
            b.on("mousemove", function (a) {
                var b = a.clientY - (d + y);
                b = f.minHeight > 0 ? Math.max(b, f.minHeight) : b, b = f.maxHeight > 0 ? Math.min(b, f.maxHeight) : b, c.height(b)
            }).one("mouseup", function () {
                b.off("mousemove")
            })
        }
    }, A = function () {
        var b = new w, c = function (b, c) {
            var d = a(b), e = c ? d.offset() : d.position(), f = d.outerHeight(!0);
            return {left: e.left, top: e.top + f}
        }, d = function (a, b) {
            a.css({display: "block", left: b.left, top: b.top})
        }, e = 20;
        this.update = function (f, i, j) {
            b.update(f, i);
            var k = f.find(".note-link-popover");
            if (i.anchor) {
                var l = k.find("a"), m = a(i.anchor).attr("href"), n = a(i.anchor).attr("target");
                l.attr("href", m).html(m), n ? l.attr("target", "_blank") : l.removeAttr("target"), d(k, c(i.anchor, j))
            } else k.hide();
            var o = f.find(".note-image-popover");
            i.image ? d(o, c(i.image, j)) : o.hide();
            var p = f.find(".note-air-popover");
            if (j && !i.range.isCollapsed()) {
                var q = h.last(i.range.getClientRects());
                if (q) {
                    var r = g.rect2bnd(q);
                    d(p, {left: Math.max(r.left + r.width / 2 - e, 0), top: r.top + r.height})
                }
            } else p.hide()
        }, this.updateRecentColor = function (a, b, c) {
            a.updateRecentColor(a, b, c)
        }, this.hide = function (a) {
            a.children().hide()
        }
    }, B = function (b) {
        var c = a(document), d = function (d) {
            if (k.isControlSizing(d.target)) {
                d.preventDefault(), d.stopPropagation();
                var e = k.makeLayoutInfo(d.target), f = e.handle(), g = e.popover(), h = e.editable(), i = e.editor(), j = f.find(".note-control-selection").data("target"), l = a(j), m = l.offset(), n = c.scrollTop(), o = i.data("options").airMode;
                c.on("mousemove", function (a) {
                    b.invoke("editor.resizeTo", {
                        x: a.clientX - m.left,
                        y: a.clientY - (m.top - n)
                    }, l, !a.shiftKey), b.invoke("handle.update", f, {image: j}, o), b.invoke("popover.update", g, {image: j}, o)
                }).one("mouseup", function () {
                    c.off("mousemove"), b.invoke("editor.afterCommand", h)
                }), l.data("ratio") || l.data("ratio", l.height() / l.width())
            }
        };
        this.attach = function (a) {
            a.handle().on("mousedown", d)
        }, this.update = function (b, c, d) {
            var e = b.find(".note-control-selection");
            if (c.image) {
                var f = a(c.image), g = d ? f.offset() : f.position(), h = {w: f.outerWidth(!0), h: f.outerHeight(!0)};
                e.css({display: "block", left: g.left, top: g.top, width: h.w, height: h.h}).data("target", c.image);
                var i = h.w + "x" + h.h;
                e.find(".note-control-selection-info").text(i)
            } else e.hide()
        }, this.hide = function (a) {
            a.children().hide()
        }
    }, C = function (b) {
        var c = a(window), d = a("html, body");
        this.toggle = function (a) {
            var e = a.editor(), f = a.toolbar(), g = a.editable(), h = a.codable(), i = function (a) {
                g.css("height", a.h), h.css("height", a.h), h.data("cmeditor") && h.data("cmeditor").setsize(null, a.h)
            };
            e.toggleClass("fullscreen");
            var j = e.hasClass("fullscreen");
            j ? (g.data("orgheight", g.css("height")), c.on("resize", function () {
                i({h: c.height() - f.outerHeight()})
            }).trigger("resize"), d.css("overflow", "hidden")) : (c.off("resize"), i({h: g.data("orgheight")}), d.css("overflow", "visible")), b.invoke("toolbar.updateFullscreen", f, j)
        }
    };
    f.hasCodeMirror && (f.isSupportAmd ? require(["CodeMirror"], function (a) {
        b = a
    }) : b = window.CodeMirror);
    var D = function (a) {
        this.sync = function (b) {
            var c = a.invoke("codeview.isActivated", b);
            c && f.hasCodeMirror && b.codable().data("cmEditor").save()
        }, this.isActivated = function (a) {
            var b = a.editor();
            return b.hasClass("codeview")
        }, this.toggle = function (a) {
            this.isActivated(a) ? this.deactivate(a) : this.activate(a)
        }, this.activate = function (c) {
            var d = c.editor(), e = c.toolbar(), g = c.editable(), h = c.codable(), i = c.popover(), j = c.handle(), l = d.data("options");
            if (h.val(k.html(g, l.prettifyHtml)), h.height(g.height()), a.invoke("toolbar.updateCodeview", e, !0), a.invoke("popover.hide", i), a.invoke("handle.hide", j), d.addClass("codeview"), h.focus(), f.hasCodeMirror) {
                var m = b.fromTextArea(h[0], l.codemirror);
                if (l.codemirror.tern) {
                    var n = new b.TernServer(l.codemirror.tern);
                    m.ternServer = n, m.on("cursorActivity", function (a) {
                        n.updateArgHints(a)
                    })
                }
                m.setSize(null, g.outerHeight()), h.data("cmEditor", m)
            }
        }, this.deactivate = function (b) {
            var c = b.holder(), d = b.editor(), e = b.toolbar(), g = b.editable(), h = b.codable(), i = d.data("options");
            if (f.hasCodeMirror) {
                var j = h.data("cmEditor");
                h.val(j.getValue()), j.toTextArea()
            }
            var l = k.value(h, i.prettifyHtml) || k.emptyPara, m = g.html() !== l;
            g.html(l), g.height(i.height ? h.height() : "auto"), d.removeClass("codeview"), m && a.bindCustomEvent(c, g.data("callbacks"), "change")(g.html(), g), g.focus(), a.invoke("toolbar.updateCodeview", e, !1)
        }
    }, E = function (b) {
        var c = a(document);
        this.attach = function (a, b) {
            b.airMode || b.disableDragAndDrop ? c.on("drop", function (a) {
                a.preventDefault()
            }) : this.attachDragAndDropEvent(a, b)
        }, this.attachDragAndDropEvent = function (d, e) {
            var f = a(), g = d.editor(), h = d.dropzone(), i = h.find(".note-dropzone-message");
            c.on("dragenter", function (a) {
                var c = b.invoke("codeview.isActivated", d), j = g.width() > 0 && g.height() > 0;
                c || f.length || !j || (g.addClass("dragover"), h.width(g.width()), h.height(g.height()), i.text(e.langInfo.image.dragImageHere)), f = f.add(a.target)
            }).on("dragleave", function (a) {
                f = f.not(a.target), f.length || g.removeClass("dragover")
            }).on("drop", function () {
                f = a(), g.removeClass("dragover")
            }), h.on("dragenter", function () {
                h.addClass("hover"), i.text(e.langInfo.image.dropImage)
            }).on("dragleave", function () {
                h.removeClass("hover"), i.text(e.langInfo.image.dragImageHere)
            }), h.on("drop", function (c) {
                c.preventDefault();
                var d = c.originalEvent.dataTransfer, e = d.getData("text/html"), f = d.getData("text/plain"), g = k.makeLayoutInfo(c.currentTarget || c.target);
                d && d.files && d.files.length ? (g.editable().focus(), b.insertImages(g, d.files)) : e ? a(e).each(function () {
                    g.editable().focus(), b.invoke("editor.insertNode", g.editable(), this)
                }) : f && (g.editable().focus(), b.invoke("editor.insertText", g.editable(), f))
            }).on("dragover", !1)
        }
    }, F = function (a) {
        this.attach = function (a) {
            a.editable().on("paste", b)
        };
        var b = function (b) {
            var c = b.originalEvent.clipboardData, d = k.makeLayoutInfo(b.currentTarget || b.target), e = d.editable();
            if (!c || !c.items || !c.items.length) {
                var f = e.data("callbacks");
                if (!f.onImageUpload)return;
                return a.invoke("editor.saveNode", e), a.invoke("editor.saveRange", e), e.html(""), void setTimeout(function () {
                    var b = e.find("img");
                    if (!b.length || b[0].src.indexOf("data:") === -1) {
                        var c = e.html();
                        a.invoke("editor.restoreNode", e), a.invoke("editor.restoreRange", e), a.invoke("editor.focus", e);
                        try {
                            a.invoke("editor.pasteHTML", e, c)
                        } catch (b) {
                            a.invoke("editor.insertText", e, c)
                        }
                    }
                }, 0)
            }
            a.invoke("editor.afterCommand", e)
        }
    }, G = function (b) {
        this.showLinkDialog = function (b, c, d) {
            return a.Deferred(function (a) {
                var b = new YS.ConfirmDialog({
                    title: "超链接",
                    width: 430,
                    height: 230,
                    autoClose: !0,
                    contentWidget: {
                        rowSize: [30, 30],
                        colSize: [80, 290],
                        padding: 15,
                        hgap: 20,
                        vgap: 30,
                        items: [[{type: "label", text: "链接地址"}, {
                            type: "text",
                            fieldId: "urlAddress",
                            value: d.url ? d.url : "http://"
                        }], [{type: "label", text: "显示文本"}, {type: "text", fieldId: "displayName", value: d.text}]]
                    },
                    onClose: function () {
                        "pending" === a.state() && a.reject()
                    },
                    onOk: function () {
                        var b = this.getWidgetByName("displayName").getValue(), c = this.getWidgetByName("urlAddress").getValue();
                        return d.url = c, d.text = b, a.resolve({range: d.range, url: c, text: b, newWindow: !0}), !1
                    }
                });
                b.show()
            }).promise()
        }, this.show = function (a) {
            var c = a.editor(), d = a.dialog(), e = a.editable(), f = a.popover(), g = b.invoke("editor.getLinkInfo", e), h = c.data("options");
            b.invoke("editor.saveRange", e), this.showLinkDialog(e, d, g).then(function (a) {
                b.invoke("editor.restoreRange", e), b.invoke("editor.createLink", e, a, h), b.invoke("popover.hide", f)
            }).fail(function () {
                b.invoke("editor.restoreRange", e)
            })
        }
    }, H = function (b) {
        this.show = function (a) {
            var c = a.dialog(), d = a.editable();
            b.invoke("editor.saveRange", d), this.showImageDialog(d, c).then(function (c) {
                b.invoke("editor.restoreRange", d), "string" == typeof c ? b.invoke("editor.insertImage", d, c) : b.insertImages(a, c)
            }).fail(function () {
                b.invoke("editor.restoreRange", d)
            })
        }, this.showImageDialog = function (c, d) {
            return a.Deferred(function (a) {
                b.invoke("editor.saveRange", c);
                var d = new YS.ImageDialog({
                    onOk: function () {
                        return b.invoke("editor.restoreRange", c), this.url && b.invoke("editor.insertImage", c, this.url), !1
                    }
                });
                d.show()
            }).promise()
        }
    }, I = function (b) {
        this.showHelpDialog = function (b, c) {
            return a.Deferred(function (a) {
                var b = c.find(".note-help-dialog");
                b.one("hidden.bs.modal", function () {
                    a.resolve()
                }).modal("show")
            }).promise()
        }, this.show = function (a) {
            var c = a.dialog(), d = a.editable();
            b.invoke("editor.saveRange", d, !0), this.showHelpDialog(d, c).then(function () {
                b.invoke("editor.restoreRange", d)
            })
        }
    }, J = function () {
        var b = this.modules = {
            editor: new v(this),
            toolbar: new x(this),
            statusbar: new z(this),
            popover: new A(this),
            handle: new B(this),
            fullscreen: new C(this),
            codeview: new D(this),
            dragAndDrop: new E(this),
            clipboard: new F(this),
            linkDialog: new G(this),
            imageDialog: new H(this),
            helpDialog: new I(this)
        };
        this.invoke = function () {
            var a = h.head(h.from(arguments)), b = h.tail(h.from(arguments)), c = a.split("."), d = c.length > 1, e = d && h.head(c), f = d ? h.last(c) : h.head(c), g = this.getModule(e), i = g[f];
            return i && i.apply(g, b)
        }, this.getModule = function (a) {
            return this.modules[a] || this.modules.editor
        };
        var c = this.bindCustomEvent = function (a, b, c) {
            return function () {
                var d = b[g.namespaceToCamel(c, "on")];
                return d && d.apply(a[0], arguments), a.trigger("summernote." + c, arguments)
            }
        };
        this.insertImages = function (d, e) {
            var f = d.editor(), g = d.editable(), h = d.holder(), i = g.data("callbacks"), j = f.data("options");
            i.onImageUpload ? c(h, i, "image.upload")(e) : a.each(e, function (a, d) {
                var e = d.name;
                j.maximumImageFileSize && j.maximumImageFileSize < d.size ? c(h, i, "image.upload.error")(j.langInfo.image.maximumFileSizeError) : n.readFileAsDataURL(d).then(function (a) {
                    b.editor.insertImage(g, a, e)
                }).fail(function () {
                    c(h, i, "image.upload.error")(j.langInfo.image.maximumFileSizeError)
                })
            })
        };
        var d = {
            showLinkDialog: function (a) {
                b.linkDialog.show(a)
            }, showImageDialog: function (a) {
                b.imageDialog.show(a)
            }, showHelpDialog: function (a) {
                b.helpDialog.show(a)
            }, fullscreen: function (a) {
                b.fullscreen.toggle(a)
            }, codeview: function (a) {
                b.codeview.toggle(a)
            }
        }, e = function (a) {
            k.isImg(a.target) && a.preventDefault()
        }, i = function (a) {
            var c = k.makeLayoutInfo(a.currentTarget || a.target);
            b.editor.removeBogus(c.editable()), j(a)
        }, j = function (a) {
            setTimeout(function () {
                var c = k.makeLayoutInfo(a.currentTarget || a.target), d = b.editor.currentStyle(a.target);
                if (d) {
                    var e = c.editor().data("options").airMode;
                    e || b.toolbar.update(c.toolbar(), d), b.popover.update(c.popover(), d, e), b.handle.update(c.handle(), d, e)
                }
            }, 0)
        }, l = function (a) {
            var c = k.makeLayoutInfo(a.currentTarget || a.target);
            b.popover.hide(c.popover()), b.handle.hide(c.handle())
        }, m = function (b) {
            var c = a(b.target).closest("[data-event]");
            c.length && b.preventDefault()
        }, q = function (c) {
            var e = a(c.target).closest("[data-event]");
            if (e.length) {
                var f, g = e.attr("data-event"), h = e.attr("data-value"), i = e.attr("data-hide"), l = k.makeLayoutInfo(c.target);
                if (a.inArray(g, ["resize", "floatMe", "removeMedia", "imageShape"]) !== -1) {
                    var m = l.handle().find(".note-control-selection");
                    f = a(m.data("target"))
                }
                if (i && e.parents(".popover").hide(), a.isFunction(a.summernote.pluginEvents[g]))a.summernote.pluginEvents[g](c, b.editor, l, h); else if (b.editor[g]) {
                    var n = l.editable();
                    n.focus(), b.editor[g](n, h, f), c.preventDefault()
                } else d[g] && (d[g].call(this, l), c.preventDefault());
                a.inArray(g, ["backColor", "foreColor"]) !== -1 && (e.parent().addClass("active"), e.parent().siblings(".active").removeClass("active")), a.inArray(g, ["font-size", "font-color", "paragraph"]) !== -1 && e.siblings("ul.dropdown-menu").show(), j(c)
            }
        }, r = 18, s = function (b, c) {
            var d, e = a(b.target.parentNode), f = e.next(), g = e.find(".note-dimension-picker-mousecatcher"), h = e.find(".note-dimension-picker-highlighted"), i = e.find(".note-dimension-picker-unhighlighted");
            if (void 0 === b.offsetX) {
                var j = a(b.target).offset();
                d = {x: b.pageX - j.left, y: b.pageY - j.top}
            } else d = {x: b.offsetX, y: b.offsetY};
            var k = {c: Math.ceil(d.x / r) || 1, r: Math.ceil(d.y / r) || 1};
            h.css({
                width: k.c + "em",
                height: k.r + "em"
            }), g.attr("data-value", k.c + "x" + k.r), 3 < k.c && k.c < c.insertTableMaxSize.col && i.css({width: k.c + 1 + "em"}), 3 < k.r && k.r < c.insertTableMaxSize.row && i.css({height: k.r + 1 + "em"}), f.html(k.c + " x " + k.r)
        };
        this.bindKeyMap = function (c, e) {
            var f = c.editor(), g = c.editable();
            g.on("keydown", function (h) {
                var i = [];
                h.metaKey && i.push("CMD"), h.ctrlKey && !h.altKey && i.push("CTRL"), h.shiftKey && i.push("SHIFT");
                var j = o.nameFromCode[h.keyCode];
                j && i.push(j);
                var k, l = i.join("+"), m = e[l];
                if (m) {
                    if (k = a.summernote.pluginEvents[l], a.isFunction(k) && k(h, b.editor, c))return !1;
                    k = a.summernote.pluginEvents[m], a.isFunction(k) ? k(h, b.editor, c) : b.editor[m] ? (b.editor[m](g, f.data("options")), h.preventDefault()) : d[m] && (d[m].call(this, c), h.preventDefault())
                } else o.isEdit(h.keyCode) && b.editor.afterCommand(g)
            })
        }, this.attach = function (c, d) {
            d.shortcuts && this.bindKeyMap(c, d.keyMap[f.isMac ? "mac" : "pc"]), c.editable().on("mousedown", e), c.editable().on("keyup mouseup", i), c.editable().click(function (a) {
                if (a.target && "A" === a.target.tagName.toUpperCase())return !1
            }), c.editable().on("scroll blur", l), b.clipboard.attach(c, d), b.handle.attach(c, d), c.popover().on("click", q), c.popover().on("mousedown", m), a(document).bind("click.dropdown", function (b) {
                var d = b.target, e = a(d).closest("button"), f = e.attr("data-event"), g = a(d).closest("ul.dropdown-menu");
                0 === g.length && a.inArray(f, ["font-size", "font-color", "paragraph"]) === -1 && c.toolbar().find("ul.dropdown-menu").hide()
            }), b.dragAndDrop.attach(c, d), d.airMode || (c.toolbar().on("click", q), c.toolbar().on("mousedown", m), b.statusbar.attach(c, d));
            var g = d.airMode ? c.popover() : c.toolbar(), j = g.find(".note-dimension-picker-mousecatcher");
            j.css({
                width: d.insertTableMaxSize.col + "em",
                height: d.insertTableMaxSize.row + "em"
            }).on("mousemove", function (a) {
                s(a, d)
            }), c.editor().data("options", d), f.isMSIE || setTimeout(function () {
                document.execCommand("styleWithCSS", 0, d.styleWithSpan)
            }, 0);
            var n = new p(c.editable());
            c.editable().data("NoteHistory", n), c.editable().data("callbacks", {
                onInit: d.onInit,
                onFocus: d.onFocus,
                onBlur: d.onBlur,
                onKeydown: d.onKeydown,
                onKeyup: d.onKeyup,
                onMousedown: d.onMousedown,
                onEnter: d.onEnter,
                onPaste: d.onPaste,
                onBeforeCommand: d.onBeforeCommand,
                onChange: d.onChange,
                onImageUpload: d.onImageUpload,
                onImageUploadError: d.onImageUploadError,
                onMediaDelete: d.onMediaDelete
            }), k.isTextarea(h.head(c.holder())) && c.holder().closest("form").submit(function () {
                c.holder().val(c.holder().code())
            })
        }, this.attachCustomEvent = function (b, d) {
            var e = b.holder(), g = b.editable(), i = g.data("callbacks");
            g.focus(c(e, i, "focus")), g.blur(c(e, i, "blur")), g.keydown(function (a) {
                a.keyCode === o.code.ENTER && c(e, i, "enter").call(this, a), c(e, i, "keydown").call(this, a)
            }), g.keyup(c(e, i, "keyup")), g.on("mousedown", c(e, i, "mousedown")), g.on("mouseup", c(e, i, "mouseup")), g.on("scroll", c(e, i, "scroll")), g.on("paste", c(e, i, "paste"));
            var j = f.isMSIE ? "DOMCharacterDataModified DOMSubtreeModified DOMNodeInserted" : "input";
            g.on(j, function () {
                c(e, i, "change")(g.html(), g)
            }), d.airMode || (b.toolbar().click(c(e, i, "toolbar.click")), b.popover().click(c(e, i, "popover.click"))), k.isTextarea(h.head(e)) && e.closest("form").submit(function (a) {
                c(e, i, "submit").call(this, a, e.code())
            }), c(e, i, "init")(b);
            for (var l = 0, m = a.summernote.plugins.length; l < m; l++)a.isFunction(a.summernote.plugins[l].init) && a.summernote.plugins[l].init(b)
        }, this.detach = function (a, b) {
            a.holder().off(), a.editable().off(), a.popover().off(), a.handle().off(), a.dialog().off(), b.airMode || (a.dropzone().off(), a.toolbar().off(), a.statusbar().off())
        }
    }, K = function () {
        var b = function (a, b) {
            var c = b.event, d = b.value, e = b.title, f = b.className, g = b.dropdown, h = b.hide;
            return '<button type="button" class="btn btn-default btn-sm btn-small' + (f ? " " + f : "") + (g ? " dropdown-toggle" : "") + '"' + (g ? ' data-toggle="dropdown"' : "") + (e ? ' title="' + e + '"' : "") + (c ? ' data-event="' + c + '"' : "") + (d ? " data-value='" + d + "'" : "") + (h ? " data-hide='" + h + "'" : "") + ' tabindex="-1">' + a + "</button>" + (g || "")
        }, c = function (a, c) {
            var d = '<i class="' + a + '"></i>';
            return b(d, c)
        }, d = function (b, c) {
            var d = a('<div class="' + b + ' popover bottom in" style="display: none;"><div class="arrow"></div><div class="popover-content"></div></div>');
            return d.find(".popover-content").append(c), d
        }, e = function (a, b, c, d) {
            return '<div class="' + a + ' modal" aria-hidden="false"><div class="modal-dialog"><div class="modal-content">' + (b ? '<div class="modal-header"><button type="button" class="close" aria-hidden="true" tabindex="-1">&times;</button><h4 class="modal-title">' + b + "</h4></div>" : "") + '<div class="modal-body">' + c + "</div>" + (d ? '<div class="modal-footer">' + d + "</div>" : "") + "</div></div></div>"
        }, h = {
            picture: function (a, b) {
                return c(b.iconPrefix + "image", {event: "showImageDialog", title: a.image.image, hide: !0})
            }, link: function (a, b) {
                return c(b.iconPrefix + "link", {event: "showLinkDialog", title: a.link.link, hide: !0})
            }, unlink: function (a, b) {
                return c(b.iconPrefix + "unlink", {event: "unlink", title: a.unlink.unlink, hide: !0})
            }, table: function (a, b) {
                var d = '<ul class="note-table dropdown-menu"><div class="note-dimension-picker"><div class="note-dimension-picker-mousecatcher" data-event="insertTable" data-value="1x1"></div><div class="note-dimension-picker-highlighted"></div><div class="note-dimension-picker-unhighlighted"></div></div><div class="note-dimension-display"> 1 x 1 </div></ul>';
                return c(b.iconPrefix + "table", {title: a.table.table, dropdown: d})
            }, style: function (a, b) {
                var d = b.styleTags.reduce(function (b, c) {
                    var d = a.style["p" === c ? "normal" : c];
                    return b + '<li><a data-event="formatBlock" href="#" data-value="' + c + '">' + ("p" === c || "pre" === c ? d : "<" + c + ">" + d + "</" + c + ">") + "</a></li>"
                }, "");
                return c(b.iconPrefix + "magic", {
                    title: a.style.style,
                    dropdown: '<ul class="dropdown-menu">' + d + "</ul>"
                })
            }, fontname: function (a, c) {
                var d = [], e = c.fontNames.reduce(function (a, b) {
                    return f.isFontInstalled(b) || c.fontNamesIgnoreCheck.indexOf(b) !== -1 ? (d.push(b), a + '<li><a data-event="fontName" href="#" data-value="' + b + '" style="font-family:\'' + b + '\'"><i class="' + c.iconPrefix + 'check"></i> ' + b + "</a></li>") : a
                }, ""), g = f.isFontInstalled(c.defaultFontName), h = g ? c.defaultFontName : d[0], i = '<span class="note-current-fontname">' + h + "</span>";
                return b(i, {title: a.font.name, dropdown: '<ul class="dropdown-menu note-check">' + e + "</ul>"})
            }, fontsize: function (a, b) {
                var d = b.fontSizes.reduce(function (a, b) {
                    var c = 14 === b ? " active" : "";
                    return a + '<li class="font-size"><button class="btn btn-item' + c + '" data-event="fontSize" data-value="' + b + '">' + b + "</button></li>";
                }, "");
                return c(b.iconPrefix + "font-size", {
                    title: a.font.size,
                    event: "font-size",
                    dropdown: '<ul class="x-dropdown dropdown-menu font-size-list btn-group">' + d + "</ul>"
                })
            }, color: function (a, b) {
                return c(b.iconPrefix + "color", {
                    title: a.color.font,
                    event: "font-color",
                    dropdown: '<ul class="x-dropdown dropdown-menu color-palette btn-group" data-target-event="foreColor"></ul>'
                })
            }, bold: function (a, b) {
                return c(b.iconPrefix + "bold", {event: "bold", title: a.font.bold})
            }, italic: function (a, b) {
                return c(b.iconPrefix + "italic", {event: "italic", title: a.font.italic})
            }, underline: function (a, b) {
                return c(b.iconPrefix + "underline", {event: "underline", title: a.font.underline})
            }, strikethrough: function (a) {
                return c("fa fa-strikethrough", {event: "strikethrough", title: a.font.strikethrough})
            }, superscript: function (a) {
                return c("fa fa-superscript", {event: "superscript", title: a.font.superscript})
            }, subscript: function (a) {
                return c("fa fa-subscript", {event: "subscript", title: a.font.subscript})
            }, clear: function (a, b) {
                return c(b.iconPrefix + "eraser", {event: "removeFormat", title: a.font.clear})
            }, ul: function (a, b) {
                return c(b.iconPrefix + "list-ul", {event: "insertUnorderedList", title: a.lists.unordered})
            }, ol: function (a, b) {
                return c(b.iconPrefix + "list-ol", {event: "insertOrderedList", title: a.lists.ordered})
            }, paragraph: function (a, b) {
                var d = c(b.iconPrefix + "align-left", {
                    title: a.paragraph.left,
                    event: "justifyLeft"
                }), e = c(b.iconPrefix + "align-center", {
                    title: a.paragraph.center,
                    event: "justifyCenter"
                }), f = c(b.iconPrefix + "align-right", {
                    title: a.paragraph.right,
                    event: "justifyRight"
                }), g = (c(b.iconPrefix + "align-justify", {
                    title: a.paragraph.justify,
                    event: "justifyFull"
                }), c(b.iconPrefix + "outdent", {
                    title: a.paragraph.outdent,
                    event: "outdent"
                }), c(b.iconPrefix + "indent", {
                    title: a.paragraph.indent,
                    event: "indent"
                }), '<ul class="dropdown-menu x-dropdown"><div class="note-align btn-group">' + d + e + f + "</div></ul>");
                return c(b.iconPrefix + "align-left", {title: a.paragraph.paragraph, dropdown: g, event: "paragraph"})
            }, height: function (a, b) {
                var d = b.lineHeights.reduce(function (a, c) {
                    return a + '<li><a data-event="lineHeight" href="#" data-value="' + parseFloat(c) + '"><i class="' + b.iconPrefix + 'check"></i> ' + c + "</a></li>"
                }, "");
                return c(b.iconPrefix + "text-height", {
                    title: a.font.height,
                    dropdown: '<ul class="dropdown-menu note-check">' + d + "</ul>"
                })
            }, help: function (a, b) {
                return c(b.iconPrefix + "question", {event: "showHelpDialog", title: a.options.help, hide: !0})
            }, fullscreen: function (a, b) {
                return c(b.iconPrefix + "arrows-alt", {event: "fullscreen", title: a.options.fullscreen})
            }, codeview: function (a, b) {
                return c(b.iconPrefix + "code", {event: "codeview", title: a.options.codeview})
            }, undo: function (a, b) {
                return c(b.iconPrefix + "undo", {event: "undo", title: a.history.undo})
            }, redo: function (a, b) {
                return c(b.iconPrefix + "repeat", {event: "redo", title: a.history.redo})
            }, hr: function (a, b) {
                return c(b.iconPrefix + "minus", {event: "insertHorizontalRule", title: a.hr.insert})
            }
        }, i = function (e, f) {
            var g = function () {
                var a = c(f.iconPrefix + "edit", {
                    title: e.link.edit,
                    event: "showLinkDialog",
                    hide: !0
                }), b = c(f.iconPrefix + "unlink", {
                    title: e.link.unlink,
                    event: "unlink"
                }), g = '<a href="http://www.google.com" target="_blank">www.google.com</a>&nbsp;&nbsp;<div class="note-insert btn-group">' + a + b + "</div>";
                return d("note-link-popover", g)
            }, i = function () {
                var a = b('<span class="note-fontsize-10">100%</span>', {
                    title: e.image.resizeFull,
                    event: "resize",
                    value: "1"
                }), g = b('<span class="note-fontsize-10">50%</span>', {
                    title: e.image.resizeHalf,
                    event: "resize",
                    value: "0.5"
                }), h = b('<span class="note-fontsize-10">25%</span>', {
                    title: e.image.resizeQuarter,
                    event: "resize",
                    value: "0.25"
                }), i = c(f.iconPrefix + "align-left", {
                    title: e.image.floatLeft,
                    event: "floatMe",
                    value: "left"
                }), j = c(f.iconPrefix + "align-right", {
                    title: e.image.floatRight,
                    event: "floatMe",
                    value: "right"
                }), k = c(f.iconPrefix + "align-justify", {
                    title: e.image.floatNone,
                    event: "floatMe",
                    value: "none"
                }), l = c(f.iconPrefix + "square", {
                    title: e.image.shapeRounded,
                    event: "imageShape",
                    value: "img-rounded"
                }), m = c(f.iconPrefix + "circle-o", {
                    title: e.image.shapeCircle,
                    event: "imageShape",
                    value: "img-circle"
                }), n = c(f.iconPrefix + "picture-o", {
                    title: e.image.shapeThumbnail,
                    event: "imageShape",
                    value: "img-thumbnail"
                }), o = c(f.iconPrefix + "times", {
                    title: e.image.shapeNone,
                    event: "imageShape",
                    value: ""
                }), p = c(f.iconPrefix + "trash-o", {
                    title: e.image.remove,
                    event: "removeMedia",
                    value: "none"
                }), q = '<div class="btn-group">' + a + g + h + '</div><div class="btn-group">' + i + j + k + '</div><div class="btn-group">' + l + m + n + o + '</div><div class="btn-group">' + p + "</div>";
                return d("note-image-popover", q)
            }, j = function () {
                for (var b = a("<div />"), c = 0, g = f.airPopover.length; c < g; c++) {
                    for (var i = f.airPopover[c], j = a('<div class="note-' + i[0] + ' btn-group">'), k = 0, l = i[1].length; k < l; k++) {
                        var m = a(h[i[1][k]](e, f));
                        m.attr("data-name", i[1][k]), j.append(m)
                    }
                    b.append(j)
                }
                return d("note-air-popover", b.children())
            }, k = a('<div class="note-popover" />');
            return k.append(g()), k.append(i()), f.airMode && k.append(j()), k
        }, j = function () {
            return '<div class="note-handle"><div class="note-control-selection"><div class="note-control-selection-bg"></div><div class="note-control-holder note-control-nw"></div><div class="note-control-holder note-control-ne"></div><div class="note-control-holder note-control-sw"></div><div class="note-control-sizing note-control-se"></div><div class="note-control-selection-info"></div></div></div>'
        }, l = {
            image: function (a, b) {
                var c = "";
                if (b.maximumImageFileSize) {
                    var d = Math.floor(Math.log(b.maximumImageFileSize) / Math.log(1024)), f = 1 * (b.maximumImageFileSize / Math.pow(1024, d)).toFixed(2) + " " + " KMGTP"[d] + "B";
                    c = "<small>" + a.image.maximumFileSize + " : " + f + "</small>"
                }
                var g = '<div class="form-group row-fluid note-group-select-from-files"><label>' + a.image.selectFromFiles + '</label><input class="note-image-input" type="file" name="files" accept="image/*" multiple="multiple" />' + c + '</div><div class="form-group row-fluid"><label>' + a.image.url + '</label><input class="note-image-url form-control span12" type="text" /></div>', h = '<button href="#" class="btn btn-primary note-image-btn disabled" disabled>' + a.image.insert + "</button>";
                return e("note-image-dialog", a.image.insert, g, h)
            }, link: function (a, b) {
                var c = '<div class="form-group row-fluid"><label>' + a.link.textToDisplay + '</label><input class="note-link-text form-control span12" type="text" /></div><div class="form-group row-fluid"><label>' + a.link.url + '</label><input class="note-link-url form-control span12" type="text" /></div>' + (b.disableLinkTarget ? "" : '<div class="checkbox"><label><input type="checkbox" checked> ' + a.link.openInNewWindow + "</label></div>"), d = '<button href="#" class="btn btn-primary note-link-btn disabled" disabled>' + a.link.insert + "</button>";
                return e("note-link-dialog", a.link.insert, c, d)
            }
        }, m = function (b, c) {
            var d = "";
            return a.each(l, function (a, e) {
                d += e(b, c)
            }), '<div class="note-dialog">' + d + "</div>"
        }, n = function () {
            return '<div class="note-resizebar"><div class="note-icon-bar"></div><div class="note-icon-bar"></div><div class="note-icon-bar"></div></div>'
        }, o = function (a) {
            return f.isMac && (a = a.replace("CMD", "⌘").replace("SHIFT", "⇧")), a.replace("BACKSLASH", "\\").replace("SLASH", "/").replace("LEFTBRACKET", "[").replace("RIGHTBRACKET", "]")
        }, p = function (b, c, d) {
            var e = g.invertObject(c), f = b.find("button");
            f.each(function (b, c) {
                var d = a(c), f = e[d.data("event")];
                f && d.attr("title", function (a, b) {
                    return b + " (" + o(f) + ")"
                })
            })
        }, q = function (a, b) {
            var c = b.colors, d = a.find(".color-palette"), e = d.attr("data-target-event"), f = [];
            YS.Utils.forEach(c, function (a, b) {
                f.push(['<li class="color-item btn">', '<button type="button" class="color-btn btn-item" style="background-color:', b, ';" data-event="', e, '" data-value="', b, '" data-toggle="button" tabindex="-1"></button></li>'].join(""))
            }), d.html(f.join(""))
        };
        this.createLayoutByAirMode = function (b, c) {
            var d = c.langInfo, e = c.keyMap[f.isMac ? "mac" : "pc"], h = g.uniqueId();
            b.addClass("note-air-editor note-editable"), b.attr({id: "note-editor-" + h, contentEditable: !0});
            var k = document.body, l = a(i(d, c));
            l.addClass("note-air-layout"), l.attr("id", "note-popover-" + h), l.appendTo(k), p(l, e), q(l, c);
            var n = a(j());
            n.addClass("note-air-layout"), n.attr("id", "note-handle-" + h), n.appendTo(k);
            var o = a(m(d, c));
            o.addClass("note-air-layout"), o.attr("id", "note-dialog-" + h), o.find("button.close, a.modal-close").click(function () {
                a(this).closest(".modal").modal("hide")
            }), o.appendTo(k)
        }, this.createLayoutByFrame = function (b, c) {
            var d = c.langInfo, e = a('<div class="note-editor"></div>');
            c.width && e.width(c.width), c.height > 0 && a('<div class="note-statusbar">' + (c.disableResizeEditor ? "" : n()) + "</div>").prependTo(e);
            var g = !b.is(":disabled"), i = a('<div class="note-editable" contentEditable="' + g + '"></div>').prependTo(e);
            c.height ? i.height(c.height) : c.minHeight && i.css({"min-Height": c.minHeight}), c.direction && i.attr("dir", c.direction);
            var j = b.attr("placeholder") || c.placeholder;
            j && i.attr("data-placeholder", j), i.html(k.html(b)), a('<textarea class="note-codable"></textarea>').prependTo(e);
            for (var l = a('<div class="note-toolbar btn-toolbar" />'), m = 0, o = c.toolbar.length; m < o; m++) {
                for (var r = c.toolbar[m][0], s = c.toolbar[m][1], t = a('<div class="note-' + r + ' btn-group" />'), u = 0, v = s.length; u < v; u++) {
                    var w = h[s[u]];
                    if (a.isFunction(w)) {
                        var x = a(w(d, c));
                        x.attr("data-name", s[u]), t.append(x)
                    }
                }
                l.append(t)
            }
            l.prependTo(e);
            var y = c.keyMap[f.isMac ? "mac" : "pc"];
            q(l, c), p(l, y, "bottom"), e.insertAfter(b), b.hide()
        }, this.hasNoteEditor = function (a) {
            return this.noteEditorFromHolder(a).length > 0
        }, this.noteEditorFromHolder = function (b) {
            return b.hasClass("note-air-editor") ? b : b.next().hasClass("note-editor") ? b.next() : a()
        }, this.createLayout = function (a, b) {
            b.airMode ? this.createLayoutByAirMode(a, b) : this.createLayoutByFrame(a, b)
        }, this.layoutInfoFromHolder = function (a) {
            var b = this.noteEditorFromHolder(a);
            if (b.length)return b.data("holder", a), k.buildLayoutInfo(b)
        }, this.removeLayout = function (a, b, c) {
            c.airMode ? (a.removeClass("note-air-editor note-editable").removeAttr("id contentEditable"), b.popover().remove(), b.handle().remove(), b.dialog().remove()) : (a.html(b.editable().html()), b.editor().remove(), a.show())
        }, this.getTemplate = function () {
            return {button: b, iconButton: c, dialog: e}
        }, this.addButtonInfo = function (a, b) {
            h[a] = b
        }, this.addDialogInfo = function (a, b) {
            l[a] = b
        }
    };
    a.summernote = a.summernote || {}, a.extend(a.summernote, m);
    var L = new K, M = new J;
    a.extend(a.summernote, {
        renderer: L,
        eventHandler: M,
        core: {agent: f, list: h, dom: k, range: l},
        pluginEvents: {},
        plugins: []
    }), a.summernote.addPlugin = function (b) {
        a.summernote.plugins.push(b), b.buttons && a.each(b.buttons, function (a, b) {
            L.addButtonInfo(a, b)
        }), b.dialogs && a.each(b.dialogs, function (a, b) {
            L.addDialogInfo(a, b)
        }), b.events && a.each(b.events, function (b, c) {
            a.summernote.pluginEvents[b] = c
        }), b.langs && a.each(b.langs, function (b, c) {
            a.summernote.lang[b] && a.extend(a.summernote.lang[b], c)
        }), b.options && a.extend(a.summernote.options, b.options)
    }, a.fn.extend({
        summernote: function () {
            var b = a.type(h.head(arguments)), c = "string" === b, d = "object" === b, e = d ? h.head(arguments) : {};
            if (e = a.extend({}, a.summernote.options, e), e.langInfo = a.extend(!0, {}, a.summernote.lang["zh-CN"], a.summernote.lang[e.lang]), !c && d)for (var f = 0, g = a.summernote.plugins.length; f < g; f++) {
                var i = a.summernote.plugins[f];
                e.plugin[i.name] && (a.summernote.plugins[f] = a.extend(!0, i, e.plugin[i.name]))
            }
            this.each(function (b, c) {
                var d = a(c);
                if (!L.hasNoteEditor(d)) {
                    L.createLayout(d, e);
                    var f = L.layoutInfoFromHolder(d);
                    d.data("layoutInfo", f), M.attach(f, e), M.attachCustomEvent(f, e)
                }
            });
            var j = this.first();
            if (j.length) {
                var k = L.layoutInfoFromHolder(j);
                if (c) {
                    var l = h.head(h.from(arguments)), m = h.tail(h.from(arguments)), n = [l, k.editable()].concat(m);
                    return M.invoke.apply(M, n)
                }
                e.focus && k.editable().focus()
            }
            return this
        }, code: function (b) {
            if (void 0 === b) {
                var c = this.first();
                if (!c.length)return;
                var d = L.layoutInfoFromHolder(c), e = d && d.editable();
                if (e && e.length) {
                    var f = M.invoke("codeview.isActivated", d);
                    return M.invoke("codeview.sync", d), f ? d.codable().val() : d.editable().html()
                }
                return k.value(c)
            }
            return this.each(function (c, d) {
                var e = L.layoutInfoFromHolder(a(d)), f = e && e.editable();
                f && f.html(b)
            }), this
        }, destroy: function () {
            return this.each(function (b, c) {
                var d = a(c);
                if (L.hasNoteEditor(d)) {
                    var e = L.layoutInfoFromHolder(d), f = e.editor().data("options");
                    M.detach(e, f), L.removeLayout(d, e, f)
                }
            }), this
        }
    })
}),function (a) {
    YS.RichText = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.RichText.superclass._defaultConfig.apply(), {
                baseCls: "x-richtext",
                toolbar: [["font", ["bold", "italic", "underline"]], ["para", ["paragraph"]], ["color", ["color"]], ["insert", ["link", "unlink", "picture"]]],
                onAfterEdit: null
            })
        }, _init: function () {
            YS.RichText.superclass._init.apply(this, arguments);
            var b = this.options, c = this;
            this.$editor = a("<div/>").appendTo(this.element), this.$editor.summernote({
                height: b.height,
                width: b.width,
                minHeight: b.minHeight,
                minWidth: b.minWidth,
                toolbar: b.toolbar,
                onChange: function (a, d) {
                    YS.Utils.applyFunc(c, b.onAfterEdit, [], !1)
                }
            })
        }, checkValidate: function () {
            var a = this.options, b = !0, c = this.getValue();
            return YS.Utils.isEmpty(c) && (b = !!a.fieldIsnull), b
        }, getText: function () {
            return this.getValue()
        }, setText: function (a) {
            this.setValue(a)
        }, getValue: function () {
            return this.$editor.code()
        }, setValue: function (a) {
            this.$editor.code(a)
        }
    }), a.shortcut("richtext", YS.RichText)
}(jQuery),function (a) {
    this.CodeMirror = a()
}(function () {
    "use strict";
    function a(c, d) {
        if (!(this instanceof a))return new a(c, d);
        this.options = d = d ? He(d) : {}, He(Vf, d, !1), n(d), a.keywords = d.keywords || [];
        var e = d.value;
        "string" == typeof e && (e = new rg(e, d.mode)), this.doc = e;
        var f = new a.inputStyles[d.inputStyle](this), g = this.display = new b(c, e, f);
        g.wrapper.CodeMirror = this, j(this), h(this), d.lineWrapping && (this.display.wrapper.className += " CodeMirror-wrap"), d.autofocus && !xf && g.input.focus(), r(this), this.state = {
            keyMaps: [],
            overlays: [],
            modeGen: 0,
            overwrite: !1,
            delayingBlurEvent: !1,
            focused: !1,
            suppressEdits: !1,
            pasteIncoming: !1,
            cutIncoming: !1,
            draggingText: !1,
            highlight: new ze,
            keySeq: null,
            specialChars: null
        };
        var i = this;
        nf && of < 11 && setTimeout(function () {
            i.display.input.reset(!0)
        }, 20), Pb(this), Te(), tb(this), this.curOp.forceUpdate = !0, Ud(this, e), d.autofocus && !xf || i.hasFocus() ? setTimeout(Ie(nc, this), 20) : oc(this);
        for (var k in Wf)Wf.hasOwnProperty(k) && Wf[k](this, d[k], Xf);
        w(this), d.finishInit && d.finishInit(this);
        for (var l = 0; l < _f.length; ++l)_f[l](this);
        vb(this), pf && d.lineWrapping && "optimizelegibility" == getComputedStyle(g.lineDiv).textRendering && (g.lineDiv.style.textRendering = "auto")
    }

    function b(a, b, c) {
        var d = this;
        this.input = c, d.scrollbarFiller = Me("div", null, "CodeMirror-scrollbar-filler"), d.scrollbarFiller.setAttribute("cm-not-content", "true"), d.gutterFiller = Me("div", null, "CodeMirror-gutter-filler"), d.gutterFiller.setAttribute("cm-not-content", "true"), d.lineDiv = Me("div", null, "CodeMirror-code"), d.selectionDiv = Me("div", null, null, "position: relative; z-index: 1"), d.cursorDiv = Me("div", null, "CodeMirror-cursors"), d.measure = Me("div", null, "CodeMirror-measure"), d.lineMeasure = Me("div", null, "CodeMirror-measure"), d.lineSpace = Me("div", [d.measure, d.lineMeasure, d.selectionDiv, d.cursorDiv, d.lineDiv], null, "position: relative; outline: none"), d.mover = Me("div", [Me("div", [d.lineSpace], "CodeMirror-lines")], null, "position: relative"), d.sizer = Me("div", [d.mover], "CodeMirror-sizer"), d.sizerWidth = null, d.heightForcer = Me("div", null, null, "position: absolute; height: " + Bg + "px; width: 1px;"), d.gutters = Me("div", null, "CodeMirror-gutters"), d.lineGutter = null, d.scroller = Me("div", [d.sizer, d.heightForcer, d.gutters], "CodeMirror-scroll"), d.scroller.setAttribute("tabIndex", "-1"), d.wrapper = Me("div", [d.scrollbarFiller, d.gutterFiller, d.scroller], "CodeMirror"), nf && of < 8 && (d.gutters.style.zIndex = -1, d.scroller.style.paddingRight = 0), pf || kf && xf || (d.scroller.draggable = !0), a && (a.appendChild ? a.appendChild(d.wrapper) : a(d.wrapper)), d.viewFrom = d.viewTo = b.first, d.reportedViewFrom = d.reportedViewTo = b.first, d.view = [], d.renderedView = null, d.externalMeasured = null, d.viewOffset = 0, d.lastWrapHeight = d.lastWrapWidth = 0, d.updateLineNumbers = null, d.nativeBarWidth = d.barHeight = d.barWidth = 0, d.scrollbarsClipped = !1, d.lineNumWidth = d.lineNumInnerWidth = d.lineNumChars = null, d.alignWidgets = !1, d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null, d.maxLine = null, d.maxLineLength = 0, d.maxLineChanged = !1, d.wheelDX = d.wheelDY = d.wheelStartX = d.wheelStartY = null, d.shift = !1, d.selForContextMenu = null, d.activeTouch = null, c.init(d)
    }

    function c(b) {
        b.doc.mode = a.getMode(b.options, b.doc.modeOption), d(b)
    }

    function d(a) {
        a.doc.iter(function (a) {
            a.stateAfter && (a.stateAfter = null), a.styles && (a.styles = null)
        }), a.doc.frontier = a.doc.first, Ma(a, 100), a.state.modeGen++, a.curOp && Ib(a)
    }

    function e(a) {
        a.options.lineWrapping ? (Rg(a.display.wrapper, "CodeMirror-wrap"), a.display.sizer.style.minWidth = "", a.display.sizerWidth = null) : (Qg(a.display.wrapper, "CodeMirror-wrap"), m(a)), g(a), Ib(a), gb(a), setTimeout(function () {
            s(a)
        }, 100)
    }

    function f(a) {
        var b = rb(a.display), c = a.options.lineWrapping, d = c && Math.max(5, a.display.scroller.clientWidth / sb(a.display) - 3);
        return function (e) {
            if (sd(a.doc, e))return 0;
            var f = 0;
            if (e.widgets)for (var g = 0; g < e.widgets.length; g++)e.widgets[g].height && (f += e.widgets[g].height);
            return c ? f + (Math.ceil(e.text.length / d) || 1) * b : f + b
        }
    }

    function g(a) {
        var b = a.doc, c = f(a);
        b.iter(function (a) {
            var b = c(a);
            b != a.height && Yd(a, b)
        })
    }

    function h(a) {
        a.display.wrapper.className = a.display.wrapper.className.replace(/\s*cm-s-\S+/g, "") + a.options.theme.replace(/(^|\s)\s*/g, " cm-s-"), gb(a)
    }

    function i(a) {
        j(a), Ib(a), setTimeout(function () {
            v(a)
        }, 20)
    }

    function j(a) {
        var b = a.display.gutters, c = a.options.gutters;
        Ne(b);
        for (var d = 0; d < c.length; ++d) {
            var e = c[d], f = b.appendChild(Me("div", null, "CodeMirror-gutter " + e));
            "CodeMirror-linenumbers" == e && (a.display.lineGutter = f, f.style.width = (a.display.lineNumWidth || 1) + "px")
        }
        b.style.display = d ? "" : "none", k(a)
    }

    function k(a) {
        var b = a.display.gutters.offsetWidth;
        a.display.sizer.style.marginLeft = b + "px"
    }

    function l(a) {
        if (0 == a.height)return 0;
        for (var b, c = a.text.length, d = a; b = ld(d);) {
            var e = b.find(0, !0);
            d = e.from.line, c += e.from.ch - e.to.ch
        }
        for (d = a; b = md(d);) {
            var e = b.find(0, !0);
            c -= d.text.length - e.from.ch, d = e.to.line, c += d.text.length - e.to.ch
        }
        return c
    }

    function m(a) {
        var b = a.display, c = a.doc;
        b.maxLine = Vd(c, c.first), b.maxLineLength = l(b.maxLine), b.maxLineChanged = !0, c.iter(function (a) {
            var c = l(a);
            c > b.maxLineLength && (b.maxLineLength = c, b.maxLine = a)
        })
    }

    function n(a) {
        var b = De(a.gutters, "CodeMirror-linenumbers");
        b == -1 && a.lineNumbers ? a.gutters = a.gutters.concat(["CodeMirror-linenumbers"]) : b > -1 && !a.lineNumbers && (a.gutters = a.gutters.slice(0), a.gutters.splice(b, 1))
    }

    function o(a) {
        var b = a.display, c = b.gutters.offsetWidth, d = Math.round(a.doc.height + Ra(a.display));
        return {
            clientHeight: b.scroller.clientHeight,
            viewHeight: b.wrapper.clientHeight,
            scrollWidth: b.scroller.scrollWidth,
            clientWidth: b.scroller.clientWidth,
            viewWidth: b.wrapper.clientWidth,
            barLeft: a.options.fixedGutter ? c : 0,
            docHeight: d,
            scrollHeight: d + Ta(a) + b.barHeight,
            nativeBarWidth: b.nativeBarWidth,
            gutterWidth: c
        }
    }

    function p(a, b, c) {
        this.cm = c;
        var d = this.vert = Me("div", [Me("div", null, null, "min-width: 1px")], "CodeMirror-vscrollbar"), e = this.horiz = Me("div", [Me("div", null, null, "height: 100%; min-height: 1px")], "CodeMirror-hscrollbar");
        a(d), a(e), xg(d, "scroll", function () {
            d.clientHeight && b(d.scrollTop, "vertical")
        }), xg(e, "scroll", function () {
            e.clientWidth && b(e.scrollLeft, "horizontal")
        }), this.checkedOverlay = !1, nf && of < 8 && (this.horiz.style.minHeight = this.vert.style.minWidth = "18px")
    }

    function q() {
    }

    function r(b) {
        b.display.scrollbars && (b.display.scrollbars.clear(), b.display.scrollbars.addClass && Qg(b.display.wrapper, b.display.scrollbars.addClass)), b.display.scrollbars = new a.scrollbarModel[b.options.scrollbarStyle](function (a) {
            b.display.wrapper.insertBefore(a, b.display.scrollbarFiller), xg(a, "mousedown", function () {
                b.state.focused && setTimeout(function () {
                    b.display.input.focus()
                }, 0)
            }), a.setAttribute("cm-not-content", "true")
        }, function (a, c) {
            "horizontal" == c ? bc(b, a) : ac(b, a)
        }, b), b.display.scrollbars.addClass && Rg(b.display.wrapper, b.display.scrollbars.addClass)
    }

    function s(a, b) {
        b || (b = o(a));
        var c = a.display.barWidth, d = a.display.barHeight;
        t(a, b);
        for (var e = 0; e < 4 && c != a.display.barWidth || d != a.display.barHeight; e++)c != a.display.barWidth && a.options.lineWrapping && F(a), t(a, o(a)), c = a.display.barWidth, d = a.display.barHeight
    }

    function t(a, b) {
        var c = a.display, d = c.scrollbars.update(b);
        c.sizer.style.paddingRight = (c.barWidth = d.right) + "px", c.sizer.style.paddingBottom = (c.barHeight = d.bottom) + "px", d.right && d.bottom ? (c.scrollbarFiller.style.display = "block", c.scrollbarFiller.style.height = d.bottom + "px", c.scrollbarFiller.style.width = d.right + "px") : c.scrollbarFiller.style.display = "", d.bottom && a.options.coverGutterNextToScrollbar && a.options.fixedGutter ? (c.gutterFiller.style.display = "block", c.gutterFiller.style.height = d.bottom + "px", c.gutterFiller.style.width = b.gutterWidth + "px") : c.gutterFiller.style.display = ""
    }

    function u(a, b, c) {
        var d = c && null != c.top ? Math.max(0, c.top) : a.scroller.scrollTop;
        d = Math.floor(d - Qa(a));
        var e = c && null != c.bottom ? c.bottom : d + a.wrapper.clientHeight, f = $d(b, d), g = $d(b, e);
        if (c && c.ensure) {
            var h = c.ensure.from.line, i = c.ensure.to.line;
            h < f ? (f = h, g = $d(b, _d(Vd(b, h)) + a.wrapper.clientHeight)) : Math.min(i, b.lastLine()) >= g && (f = $d(b, _d(Vd(b, i)) - a.wrapper.clientHeight), g = i)
        }
        return {from: f, to: Math.max(g, f + 1)}
    }

    function v(a) {
        var b = a.display, c = b.view;
        if (b.alignWidgets || b.gutters.firstChild && a.options.fixedGutter) {
            for (var d = y(b) - b.scroller.scrollLeft + a.doc.scrollLeft, e = b.gutters.offsetWidth, f = d + "px", g = 0; g < c.length; g++)if (!c[g].hidden) {
                a.options.fixedGutter && c[g].gutter && (c[g].gutter.style.left = f);
                var h = c[g].alignable;
                if (h)for (var i = 0; i < h.length; i++)h[i].style.left = f
            }
            a.options.fixedGutter && (b.gutters.style.left = d + e + "px")
        }
    }

    function w(a) {
        if (!a.options.lineNumbers)return !1;
        var b = a.doc, c = x(a.options, b.first + b.size - 1), d = a.display;
        if (c.length != d.lineNumChars) {
            var e = d.measure.appendChild(Me("div", [Me("div", c)], "CodeMirror-linenumber CodeMirror-gutter-elt")), f = e.firstChild.offsetWidth, g = e.offsetWidth - f;
            return d.lineGutter.style.width = "", d.lineNumInnerWidth = Math.max(f, d.lineGutter.offsetWidth - g) + 1, d.lineNumWidth = d.lineNumInnerWidth + g, d.lineNumChars = d.lineNumInnerWidth ? c.length : -1, d.lineGutter.style.width = d.lineNumWidth + "px", k(a), !0
        }
        return !1
    }

    function x(a, b) {
        return String(a.lineNumberFormatter(b + a.firstLineNumber))
    }

    function y(a) {
        return a.scroller.getBoundingClientRect().left - a.sizer.getBoundingClientRect().left
    }

    function z(a, b, c) {
        var d = a.display;
        this.viewport = b, this.visible = u(d, a.doc, b), this.editorIsHidden = !d.wrapper.offsetWidth, this.wrapperHeight = d.wrapper.clientHeight, this.wrapperWidth = d.wrapper.clientWidth, this.oldDisplayWidth = Ua(a), this.force = c, this.dims = H(a), this.events = []
    }

    function A(a) {
        var b = a.display;
        !b.scrollbarsClipped && b.scroller.offsetWidth && (b.nativeBarWidth = b.scroller.offsetWidth - b.scroller.clientWidth, b.heightForcer.style.height = Ta(a) + "px", b.sizer.style.marginBottom = -b.nativeBarWidth + "px", b.sizer.style.borderRightWidth = Ta(a) + "px", b.scrollbarsClipped = !0)
    }

    function B(a, b) {
        var c = a.display, d = a.doc;
        if (b.editorIsHidden)return Kb(a), !1;
        if (!b.force && b.visible.from >= c.viewFrom && b.visible.to <= c.viewTo && (null == c.updateLineNumbers || c.updateLineNumbers >= c.viewTo) && c.renderedView == c.view && 0 == Ob(a))return !1;
        w(a) && (Kb(a), b.dims = H(a));
        var e = d.first + d.size, f = Math.max(b.visible.from - a.options.viewportMargin, d.first), g = Math.min(e, b.visible.to + a.options.viewportMargin);
        c.viewFrom < f && f - c.viewFrom < 20 && (f = Math.max(d.first, c.viewFrom)), c.viewTo > g && c.viewTo - g < 20 && (g = Math.min(e, c.viewTo)), Ef && (f = qd(a.doc, f), g = rd(a.doc, g));
        var h = f != c.viewFrom || g != c.viewTo || c.lastWrapHeight != b.wrapperHeight || c.lastWrapWidth != b.wrapperWidth;
        Nb(a, f, g), c.viewOffset = _d(Vd(a.doc, c.viewFrom)), a.display.mover.style.top = c.viewOffset + "px";
        var i = Ob(a);
        if (!h && 0 == i && !b.force && c.renderedView == c.view && (null == c.updateLineNumbers || c.updateLineNumbers >= c.viewTo))return !1;
        var j = Pe();
        return i > 4 && (c.lineDiv.style.display = "none"), I(a, c.updateLineNumbers, b.dims), i > 4 && (c.lineDiv.style.display = ""), c.renderedView = c.view, j && Pe() != j && j.offsetHeight && j.focus(), Ne(c.cursorDiv), Ne(c.selectionDiv), c.gutters.style.height = 0, h && (c.lastWrapHeight = b.wrapperHeight, c.lastWrapWidth = b.wrapperWidth, Ma(a, 400)), c.updateLineNumbers = null, !0
    }

    function C(a, b) {
        for (var c = b.viewport, d = !0; (d && a.options.lineWrapping && b.oldDisplayWidth != Ua(a) || (c && null != c.top && (c = {top: Math.min(a.doc.height + Ra(a.display) - Va(a), c.top)}), b.visible = u(a.display, a.doc, c), !(b.visible.from >= a.display.viewFrom && b.visible.to <= a.display.viewTo))) && B(a, b); d = !1) {
            F(a);
            var e = o(a);
            Ha(a), E(a, e), s(a, e)
        }
        b.signal(a, "update", a), a.display.viewFrom == a.display.reportedViewFrom && a.display.viewTo == a.display.reportedViewTo || (b.signal(a, "viewportChange", a, a.display.viewFrom, a.display.viewTo), a.display.reportedViewFrom = a.display.viewFrom, a.display.reportedViewTo = a.display.viewTo)
    }

    function D(a, b) {
        var c = new z(a, b);
        if (B(a, c)) {
            F(a), C(a, c);
            var d = o(a);
            Ha(a), E(a, d), s(a, d), c.finish()
        }
    }

    function E(a, b) {
        a.display.sizer.style.minHeight = b.docHeight + "px";
        var c = b.docHeight + a.display.barHeight;
        a.display.heightForcer.style.top = c + "px", a.display.gutters.style.height = Math.max(c + Ta(a), b.clientHeight) + "px"
    }

    function F(a) {
        for (var b = a.display, c = b.lineDiv.offsetTop, d = 0; d < b.view.length; d++) {
            var e, f = b.view[d];
            if (!f.hidden) {
                if (nf && of < 8) {
                    var g = f.node.offsetTop + f.node.offsetHeight;
                    e = g - c, c = g
                } else {
                    var h = f.node.getBoundingClientRect();
                    e = h.bottom - h.top
                }
                var i = f.line.height - e;
                if (e < 2 && (e = rb(b)), (i > .001 || i < -.001) && (Yd(f.line, e), G(f.line), f.rest))for (var j = 0; j < f.rest.length; j++)G(f.rest[j])
            }
        }
    }

    function G(a) {
        if (a.widgets)for (var b = 0; b < a.widgets.length; ++b)a.widgets[b].height = a.widgets[b].node.offsetHeight
    }

    function H(a) {
        for (var b = a.display, c = {}, d = {}, e = b.gutters.clientLeft, f = b.gutters.firstChild, g = 0; f; f = f.nextSibling, ++g)c[a.options.gutters[g]] = f.offsetLeft + f.clientLeft + e, d[a.options.gutters[g]] = f.clientWidth;
        return {
            fixedPos: y(b),
            gutterTotalWidth: b.gutters.offsetWidth,
            gutterLeft: c,
            gutterWidth: d,
            wrapperWidth: b.wrapper.clientWidth
        }
    }

    function I(a, b, c) {
        function d(b) {
            var c = b.nextSibling;
            return pf && yf && a.display.currentWheelTarget == b ? b.style.display = "none" : b.parentNode.removeChild(b), c
        }

        for (var e = a.display, f = a.options.lineNumbers, g = e.lineDiv, h = g.firstChild, i = e.view, j = e.viewFrom, k = 0; k < i.length; k++) {
            var l = i[k];
            if (l.hidden); else if (l.node && l.node.parentNode == g) {
                for (; h != l.node;)h = d(h);
                var m = f && null != b && b <= j && l.lineNumber;
                l.changes && (De(l.changes, "gutter") > -1 && (m = !1), J(a, l, j, c)), m && (Ne(l.lineNumber), l.lineNumber.appendChild(document.createTextNode(x(a.options, j)))), h = l.node.nextSibling
            } else {
                var n = R(a, l, j, c);
                g.insertBefore(n, h)
            }
            j += l.size
        }
        for (; h;)h = d(h)
    }

    function J(a, b, c, d) {
        for (var e = 0; e < b.changes.length; e++) {
            var f = b.changes[e];
            "text" == f ? N(a, b) : "gutter" == f ? P(a, b, c, d) : "class" == f ? O(b) : "widget" == f && Q(a, b, d)
        }
        b.changes = null
    }

    function K(a) {
        return a.node == a.text && (a.node = Me("div", null, null, "position: relative"), a.text.parentNode && a.text.parentNode.replaceChild(a.node, a.text), a.node.appendChild(a.text), nf && of < 8 && (a.node.style.zIndex = 2)), a.node
    }

    function L(a) {
        var b = a.bgClass ? a.bgClass + " " + (a.line.bgClass || "") : a.line.bgClass;
        if (b && (b += " CodeMirror-linebackground"), a.background)b ? a.background.className = b : (a.background.parentNode.removeChild(a.background), a.background = null); else if (b) {
            var c = K(a);
            a.background = c.insertBefore(Me("div", null, b), c.firstChild)
        }
    }

    function M(a, b) {
        var c = a.display.externalMeasured;
        return c && c.line == b.line ? (a.display.externalMeasured = null, b.measure = c.measure, c.built) : Id(a, b)
    }

    function N(a, b) {
        var c = b.text.className, d = M(a, b);
        b.text == b.node && (b.node = d.pre), b.text.parentNode.replaceChild(d.pre, b.text), b.text = d.pre, d.bgClass != b.bgClass || d.textClass != b.textClass ? (b.bgClass = d.bgClass, b.textClass = d.textClass, O(b)) : c && (b.text.className = c)
    }

    function O(a) {
        L(a), a.line.wrapClass ? K(a).className = a.line.wrapClass : a.node != a.text && (a.node.className = "");
        var b = a.textClass ? a.textClass + " " + (a.line.textClass || "") : a.line.textClass;
        a.text.className = b || ""
    }

    function P(a, b, c, d) {
        b.gutter && (b.node.removeChild(b.gutter), b.gutter = null);
        var e = b.line.gutterMarkers;
        if (a.options.lineNumbers || e) {
            var f = K(b), g = b.gutter = Me("div", null, "CodeMirror-gutter-wrapper", "left: " + (a.options.fixedGutter ? d.fixedPos : -d.gutterTotalWidth) + "px; width: " + d.gutterTotalWidth + "px");
            if (a.display.input.setUneditable(g), f.insertBefore(g, b.text), b.line.gutterClass && (g.className += " " + b.line.gutterClass), !a.options.lineNumbers || e && e["CodeMirror-linenumbers"] || (b.lineNumber = g.appendChild(Me("div", x(a.options, c), "CodeMirror-linenumber CodeMirror-gutter-elt", "left: " + d.gutterLeft["CodeMirror-linenumbers"] + "px; width: " + a.display.lineNumInnerWidth + "px"))), e)for (var h = 0; h < a.options.gutters.length; ++h) {
                var i = a.options.gutters[h], j = e.hasOwnProperty(i) && e[i];
                j && g.appendChild(Me("div", [j], "CodeMirror-gutter-elt", "left: " + d.gutterLeft[i] + "px; width: " + d.gutterWidth[i] + "px"))
            }
        }
    }

    function Q(a, b, c) {
        b.alignable && (b.alignable = null);
        for (var d, e = b.node.firstChild; e; e = d) {
            var d = e.nextSibling;
            "CodeMirror-linewidget" == e.className && b.node.removeChild(e)
        }
        S(a, b, c)
    }

    function R(a, b, c, d) {
        var e = M(a, b);
        return b.text = b.node = e.pre, e.bgClass && (b.bgClass = e.bgClass), e.textClass && (b.textClass = e.textClass), O(b), P(a, b, c, d), S(a, b, d), b.node
    }

    function S(a, b, c) {
        if (T(a, b.line, b, c, !0), b.rest)for (var d = 0; d < b.rest.length; d++)T(a, b.rest[d], b, c, !1)
    }

    function T(a, b, c, d, e) {
        if (b.widgets)for (var f = K(c), g = 0, h = b.widgets; g < h.length; ++g) {
            var i = h[g], j = Me("div", [i.node], "CodeMirror-linewidget");
            i.handleMouseEvents || j.setAttribute("cm-ignore-events", "true"), U(i, j, c, d), a.display.input.setUneditable(j), e && i.above ? f.insertBefore(j, c.gutter || c.text) : f.appendChild(j), te(i, "redraw")
        }
    }

    function U(a, b, c, d) {
        if (a.noHScroll) {
            (c.alignable || (c.alignable = [])).push(b);
            var e = d.wrapperWidth;
            b.style.left = d.fixedPos + "px", a.coverGutter || (e -= d.gutterTotalWidth, b.style.paddingLeft = d.gutterTotalWidth + "px"), b.style.width = e + "px"
        }
        a.coverGutter && (b.style.zIndex = 5, b.style.position = "relative", a.noHScroll || (b.style.marginLeft = -d.gutterTotalWidth + "px"))
    }

    function V(a) {
        return Ff(a.line, a.ch)
    }

    function W(a, b) {
        return Gf(a, b) < 0 ? b : a
    }

    function X(a, b) {
        return Gf(a, b) < 0 ? a : b
    }

    function Y(a) {
        a.state.focused || (a.display.input.focus(), nc(a))
    }

    function Z(a) {
        return a.options.readOnly || a.doc.cantEdit
    }

    function $(a, b, c, d, e) {
        var f = a.doc;
        a.display.shift = !1, d || (d = f.sel);
        var g = a.state.pasteIncoming || "paste" == e, h = Ug(b), i = null;
        g && d.ranges.length > 1 && (Hf && Hf.join("\n") == b ? i = d.ranges.length % Hf.length == 0 && Ee(Hf, Ug) : h.length == d.ranges.length && (i = Ee(h, function (a) {
                return [a]
            })));
        for (var j = d.ranges.length - 1; j >= 0; j--) {
            var k = d.ranges[j], l = k.from(), m = k.to();
            k.empty() && (c && c > 0 ? l = Ff(l.line, l.ch - c) : a.state.overwrite && !g && (m = Ff(m.line, Math.min(Vd(f, m.line).text.length, m.ch + Ce(h).length))));
            var n = a.curOp.updateInput, o = {
                from: l,
                to: m,
                text: i ? i[j % i.length] : h,
                origin: e || (g ? "paste" : a.state.cutIncoming ? "cut" : "+input")
            };
            wc(a.doc, o), te(a, "inputRead", a, o)
        }
        b && !g && aa(a, b), Ic(a), a.curOp.updateInput = n, a.curOp.typing = !0, a.state.pasteIncoming = a.state.cutIncoming = !1
    }

    function _(a, b) {
        var c = a.clipboardData && a.clipboardData.getData("text/plain");
        if (c)return a.preventDefault(), Cb(b, function () {
            $(b, c, 0, null, "paste")
        }), !0
    }

    function aa(a, b) {
        if (a.options.electricChars && a.options.smartIndent)for (var c = a.doc.sel, d = c.ranges.length - 1; d >= 0; d--) {
            var e = c.ranges[d];
            if (!(e.head.ch > 100 || d && c.ranges[d - 1].head.line == e.head.line)) {
                var f = a.getModeAt(e.head), g = !1;
                if (f.electricChars) {
                    for (var h = 0; h < f.electricChars.length; h++)if (b.indexOf(f.electricChars.charAt(h)) > -1) {
                        g = Kc(a, e.head.line, "smart");
                        break
                    }
                } else f.electricInput && f.electricInput.test(Vd(a.doc, e.head.line).text.slice(0, e.head.ch)) && (g = Kc(a, e.head.line, "smart"));
                g && te(a, "electricInput", a, e.head.line)
            }
        }
    }

    function ba(a) {
        for (var b = [], c = [], d = 0; d < a.doc.sel.ranges.length; d++) {
            var e = a.doc.sel.ranges[d].head.line, f = {anchor: Ff(e, 0), head: Ff(e + 1, 0)};
            c.push(f), b.push(a.getRange(f.anchor, f.head))
        }
        return {text: b, ranges: c}
    }

    function ca(a) {
        a.setAttribute("autocorrect", "off"), a.setAttribute("autocapitalize", "off"), a.setAttribute("spellcheck", "false")
    }

    function da(a) {
        this.cm = a, this.prevInput = "", this.pollingFast = !1, this.polling = new ze, this.inaccurateSelection = !1, this.hasSelection = !1, this.composing = null
    }

    function ea() {
        var a = Me("textarea", null, null, "position: absolute; padding: 0; width: 1px; height: 1em; outline: none"), b = Me("div", [a], null, "overflow: hidden; position: relative; width: 3px; height: 0px;");
        return pf ? a.style.width = "1000px" : a.setAttribute("wrap", "off"), wf && (a.style.border = "1px solid black"), ca(a), b
    }

    function fa(a) {
        this.cm = a, this.lastAnchorNode = this.lastAnchorOffset = this.lastFocusNode = this.lastFocusOffset = null, this.polling = new ze, this.gracePeriod = !1
    }

    function ga(a, b) {
        var c = $a(a, b.line);
        if (!c || c.hidden)return null;
        var d = Vd(a.doc, b.line), e = Xa(c, d, b.line), f = ae(d), g = "left";
        if (f) {
            var h = ff(f, b.ch);
            g = h % 2 ? "right" : "left"
        }
        var i = bb(e.map, b.ch, g);
        return i.offset = "right" == i.collapse ? i.end : i.start, i
    }

    function ha(a, b) {
        return b && (a.bad = !0), a
    }

    function ia(a, b, c) {
        var d;
        if (b == a.display.lineDiv) {
            if (d = a.display.lineDiv.childNodes[c], !d)return ha(a.clipPos(Ff(a.display.viewTo - 1)), !0);
            b = null, c = 0
        } else for (d = b; ; d = d.parentNode) {
            if (!d || d == a.display.lineDiv)return null;
            if (d.parentNode && d.parentNode == a.display.lineDiv)break
        }
        for (var e = 0; e < a.display.view.length; e++) {
            var f = a.display.view[e];
            if (f.node == d)return ja(f, b, c)
        }
    }

    function ja(a, b, c) {
        function d(b, c, d) {
            for (var e = -1; e < (k ? k.length : 0); e++)for (var f = e < 0 ? j.map : k[e], g = 0; g < f.length; g += 3) {
                var h = f[g + 2];
                if (h == b || h == c) {
                    var i = Zd(e < 0 ? a.line : a.rest[e]), l = f[g] + d;
                    return (d < 0 || h != b) && (l = f[g + (d ? 1 : 0)]), Ff(i, l)
                }
            }
        }

        var e = a.text.firstChild, f = !1;
        if (!b || !Ng(e, b))return ha(Ff(Zd(a.line), 0), !0);
        if (b == e && (f = !0, b = e.childNodes[c], c = 0, !b)) {
            var g = a.rest ? Ce(a.rest) : a.line;
            return ha(Ff(Zd(g), g.text.length), f)
        }
        var h = 3 == b.nodeType ? b : null, i = b;
        for (h || 1 != b.childNodes.length || 3 != b.firstChild.nodeType || (h = b.firstChild, c && (c = h.nodeValue.length)); i.parentNode != e;)i = i.parentNode;
        var j = a.measure, k = j.maps, l = d(h, i, c);
        if (l)return ha(l, f);
        for (var m = i.nextSibling, n = h ? h.nodeValue.length - c : 0; m; m = m.nextSibling) {
            if (l = d(m, m.firstChild, 0))return ha(Ff(l.line, l.ch - n), f);
            n += m.textContent.length
        }
        for (var o = i.previousSibling, n = c; o; o = o.previousSibling) {
            if (l = d(o, o.firstChild, -1))return ha(Ff(l.line, l.ch + n), f);
            n += m.textContent.length
        }
    }

    function ka(a, b, c, d, e) {
        function f(a) {
            return function (b) {
                return b.id == a
            }
        }

        function g(b) {
            if (1 == b.nodeType) {
                var c = b.getAttribute("cm-text");
                if (null != c)return "" == c && (c = b.textContent.replace(/\u200b/g, "")), void(h += c);
                var j, k = b.getAttribute("cm-marker");
                if (k) {
                    var l = a.findMarks(Ff(d, 0), Ff(e + 1, 0), f(+k));
                    return void(l.length && (j = l[0].find()) && (h += Wd(a.doc, j.from, j.to).join("\n")))
                }
                if ("false" == b.getAttribute("contenteditable"))return;
                for (var m = 0; m < b.childNodes.length; m++)g(b.childNodes[m]);
                /^(pre|div|p)$/i.test(b.nodeName) && (i = !0)
            } else if (3 == b.nodeType) {
                var n = b.nodeValue;
                if (!n)return;
                i && (h += "\n", i = !1), h += n
            }
        }

        for (var h = "", i = !1; g(b), b != c;)b = b.nextSibling;
        return h
    }

    function la(a, b) {
        this.ranges = a, this.primIndex = b
    }

    function ma(a, b) {
        this.anchor = a, this.head = b
    }

    function na(a, b) {
        var c = a[b];
        a.sort(function (a, b) {
            return Gf(a.from(), b.from())
        }), b = De(a, c);
        for (var d = 1; d < a.length; d++) {
            var e = a[d], f = a[d - 1];
            if (Gf(f.to(), e.from()) >= 0) {
                var g = X(f.from(), e.from()), h = W(f.to(), e.to()), i = f.empty() ? e.from() == e.head : f.from() == f.head;
                d <= b && --b, a.splice(--d, 2, new ma(i ? h : g, i ? g : h))
            }
        }
        return new la(a, b)
    }

    function oa(a, b) {
        return new la([new ma(a, b || a)], 0)
    }

    function pa(a, b) {
        return Math.max(a.first, Math.min(b, a.first + a.size - 1))
    }

    function qa(a, b) {
        if (b.line < a.first)return Ff(a.first, 0);
        var c = a.first + a.size - 1;
        return b.line > c ? Ff(c, Vd(a, c).text.length) : ra(b, Vd(a, b.line).text.length)
    }

    function ra(a, b) {
        var c = a.ch;
        return null == c || c > b ? Ff(a.line, b) : c < 0 ? Ff(a.line, 0) : a
    }

    function sa(a, b) {
        return b >= a.first && b < a.first + a.size
    }

    function ta(a, b) {
        for (var c = [], d = 0; d < b.length; d++)c[d] = qa(a, b[d]);
        return c
    }

    function ua(a, b, c, d) {
        if (a.cm && a.cm.display.shift || a.extend) {
            var e = b.anchor;
            if (d) {
                var f = Gf(c, e) < 0;
                f != Gf(d, e) < 0 ? (e = c, c = d) : f != Gf(c, d) < 0 && (c = d)
            }
            return new ma(e, c)
        }
        return new ma(d || c, c)
    }

    function va(a, b, c, d) {
        Ba(a, new la([ua(a, a.sel.primary(), b, c)], 0), d)
    }

    function wa(a, b, c) {
        for (var d = [], e = 0; e < a.sel.ranges.length; e++)d[e] = ua(a, a.sel.ranges[e], b[e], null);
        var f = na(d, a.sel.primIndex);
        Ba(a, f, c)
    }

    function xa(a, b, c, d) {
        var e = a.sel.ranges.slice(0);
        e[b] = c, Ba(a, na(e, a.sel.primIndex), d)
    }

    function ya(a, b, c, d) {
        Ba(a, oa(b, c), d)
    }

    function za(a, b) {
        var c = {
            ranges: b.ranges, update: function (b) {
                this.ranges = [];
                for (var c = 0; c < b.length; c++)this.ranges[c] = new ma(qa(a, b[c].anchor), qa(a, b[c].head))
            }
        };
        return zg(a, "beforeSelectionChange", a, c), a.cm && zg(a.cm, "beforeSelectionChange", a.cm, c), c.ranges != b.ranges ? na(c.ranges, c.ranges.length - 1) : b
    }

    function Aa(a, b, c) {
        var d = a.history.done, e = Ce(d);
        e && e.ranges ? (d[d.length - 1] = b, Ca(a, b, c)) : Ba(a, b, c)
    }

    function Ba(a, b, c) {
        Ca(a, b, c), he(a, a.sel, a.cm ? a.cm.curOp.id : NaN, c)
    }

    function Ca(a, b, c) {
        (xe(a, "beforeSelectionChange") || a.cm && xe(a.cm, "beforeSelectionChange")) && (b = za(a, b));
        var d = c && c.bias || (Gf(b.primary().head, a.sel.primary().head) < 0 ? -1 : 1);
        Da(a, Fa(a, b, d, !0)), c && c.scroll === !1 || !a.cm || Ic(a.cm)
    }

    function Da(a, b) {
        b.equals(a.sel) || (a.sel = b, a.cm && (a.cm.curOp.updateInput = a.cm.curOp.selectionChanged = !0, we(a.cm)), te(a, "cursorActivity", a))
    }

    function Ea(a) {
        Da(a, Fa(a, a.sel, null, !1), Dg)
    }

    function Fa(a, b, c, d) {
        for (var e, f = 0; f < b.ranges.length; f++) {
            var g = b.ranges[f], h = Ga(a, g.anchor, c, d), i = Ga(a, g.head, c, d);
            (e || h != g.anchor || i != g.head) && (e || (e = b.ranges.slice(0, f)), e[f] = new ma(h, i))
        }
        return e ? na(e, b.primIndex) : b
    }

    function Ga(a, b, c, d) {
        var e = !1, f = b, g = c || 1;
        a.cantEdit = !1;
        a:for (; ;) {
            var h = Vd(a, f.line);
            if (h.markedSpans)for (var i = 0; i < h.markedSpans.length; ++i) {
                var j = h.markedSpans[i], k = j.marker;
                if ((null == j.from || (k.inclusiveLeft ? j.from <= f.ch : j.from < f.ch)) && (null == j.to || (k.inclusiveRight ? j.to >= f.ch : j.to > f.ch))) {
                    if (d && (zg(k, "beforeCursorEnter"), k.explicitlyCleared)) {
                        if (h.markedSpans) {
                            --i;
                            continue
                        }
                        break
                    }
                    if (!k.atomic)continue;
                    var l = k.find(g < 0 ? -1 : 1);
                    if (0 == Gf(l, f) && (l.ch += g, l.ch < 0 ? l = l.line > a.first ? qa(a, Ff(l.line - 1)) : null : l.ch > h.text.length && (l = l.line < a.first + a.size - 1 ? Ff(l.line + 1, 0) : null), !l)) {
                        if (e)return d ? (a.cantEdit = !0, Ff(a.first, 0)) : Ga(a, b, c, !0);
                        e = !0, l = b, g = -g
                    }
                    f = l;
                    continue a
                }
            }
            return f
        }
    }

    function Ha(a) {
        a.display.input.showSelection(a.display.input.prepareSelection())
    }

    function Ia(a, b) {
        for (var c = a.doc, d = {}, e = d.cursors = document.createDocumentFragment(), f = d.selection = document.createDocumentFragment(), g = 0; g < c.sel.ranges.length; g++)if (b !== !1 || g != c.sel.primIndex) {
            var h = c.sel.ranges[g], i = h.empty();
            (i || a.options.showCursorWhenSelecting) && Ja(a, h, e), i || Ka(a, h, f)
        }
        return d
    }

    function Ja(a, b, c) {
        var d = mb(a, b.head, "div", null, null, !a.options.singleCursorHeightPerLine), e = c.appendChild(Me("div", " ", "CodeMirror-cursor"));
        if (e.style.left = d.left + "px", e.style.top = d.top + "px", e.style.height = Math.max(0, d.bottom - d.top) * a.options.cursorHeight + "px", d.other) {
            var f = c.appendChild(Me("div", " ", "CodeMirror-cursor CodeMirror-secondarycursor"));
            f.style.display = "", f.style.left = d.other.left + "px", f.style.top = d.other.top + "px", f.style.height = .85 * (d.other.bottom - d.other.top) + "px"
        }
    }

    function Ka(a, b, c) {
        function d(a, b, c, d) {
            b < 0 && (b = 0), b = Math.round(b), d = Math.round(d), h.appendChild(Me("div", null, "CodeMirror-selected", "position: absolute; left: " + a + "px; top: " + b + "px; width: " + (null == c ? k - a : c) + "px; height: " + (d - b) + "px"))
        }

        function e(b, c, e) {
            function f(c, d) {
                return lb(a, Ff(b, c), "div", l, d)
            }

            var h, i, l = Vd(g, b), m = l.text.length;
            return Ye(ae(l), c || 0, null == e ? m : e, function (a, b, g) {
                var l, n, o, p = f(a, "left");
                if (a == b)l = p, n = o = p.left; else {
                    if (l = f(b - 1, "right"), "rtl" == g) {
                        var q = p;
                        p = l, l = q
                    }
                    n = p.left, o = l.right
                }
                null == c && 0 == a && (n = j), l.top - p.top > 3 && (d(n, p.top, null, p.bottom), n = j, p.bottom < l.top && d(n, p.bottom, null, l.top)), null == e && b == m && (o = k), (!h || p.top < h.top || p.top == h.top && p.left < h.left) && (h = p), (!i || l.bottom > i.bottom || l.bottom == i.bottom && l.right > i.right) && (i = l), n < j + 1 && (n = j), d(n, l.top, o - n, l.bottom)
            }), {start: h, end: i}
        }

        var f = a.display, g = a.doc, h = document.createDocumentFragment(), i = Sa(a.display), j = i.left, k = Math.max(f.sizerWidth, Ua(a) - f.sizer.offsetLeft) - i.right, l = b.from(), m = b.to();
        if (l.line == m.line)e(l.line, l.ch, m.ch); else {
            var n = Vd(g, l.line), o = Vd(g, m.line), p = od(n) == od(o), q = e(l.line, l.ch, p ? n.text.length + 1 : null).end, r = e(m.line, p ? 0 : null, m.ch).start;
            p && (q.top < r.top - 2 ? (d(q.right, q.top, null, q.bottom), d(j, r.top, r.left, r.bottom)) : d(q.right, q.top, r.left - q.right, q.bottom)), q.bottom < r.top && d(j, q.bottom, null, r.top)
        }
        c.appendChild(h)
    }

    function La(a) {
        if (a.state.focused) {
            var b = a.display;
            clearInterval(b.blinker);
            var c = !0;
            b.cursorDiv.style.visibility = "", a.options.cursorBlinkRate > 0 ? b.blinker = setInterval(function () {
                b.cursorDiv.style.visibility = (c = !c) ? "" : "hidden"
            }, a.options.cursorBlinkRate) : a.options.cursorBlinkRate < 0 && (b.cursorDiv.style.visibility = "hidden")
        }
    }

    function Ma(a, b) {
        a.doc.mode.startState && a.doc.frontier < a.display.viewTo && a.state.highlight.set(b, Ie(Na, a))
    }

    function Na(a) {
        var b = a.doc;
        if (b.frontier < b.first && (b.frontier = b.first), !(b.frontier >= a.display.viewTo)) {
            var c = +new Date + a.options.workTime, d = bg(b.mode, Pa(a, b.frontier)), e = [];
            b.iter(b.frontier, Math.min(b.first + b.size, a.display.viewTo + 500), function (f) {
                if (b.frontier >= a.display.viewFrom) {
                    var g = f.styles, h = Ed(a, f, d, !0);
                    f.styles = h.styles;
                    var i = f.styleClasses, j = h.classes;
                    j ? f.styleClasses = j : i && (f.styleClasses = null);
                    for (var k = !g || g.length != f.styles.length || i != j && (!i || !j || i.bgClass != j.bgClass || i.textClass != j.textClass), l = 0; !k && l < g.length; ++l)k = g[l] != f.styles[l];
                    k && e.push(b.frontier), f.stateAfter = bg(b.mode, d)
                } else Gd(a, f.text, d), f.stateAfter = b.frontier % 5 == 0 ? bg(b.mode, d) : null;
                if (++b.frontier, +new Date > c)return Ma(a, a.options.workDelay), !0
            }), e.length && Cb(a, function () {
                for (var b = 0; b < e.length; b++)Jb(a, e[b], "text")
            })
        }
    }

    function Oa(a, b, c) {
        for (var d, e, f = a.doc, g = c ? -1 : b - (a.doc.mode.innerMode ? 1e3 : 100), h = b; h > g; --h) {
            if (h <= f.first)return f.first;
            var i = Vd(f, h - 1);
            if (i.stateAfter && (!c || h <= f.frontier))return h;
            var j = Gg(i.text, null, a.options.tabSize);
            (null == e || d > j) && (e = h - 1, d = j)
        }
        return e
    }

    function Pa(a, b, c) {
        var d = a.doc, e = a.display;
        if (!d.mode.startState)return !0;
        var f = Oa(a, b, c), g = f > d.first && Vd(d, f - 1).stateAfter;
        return g = g ? bg(d.mode, g) : cg(d.mode), d.iter(f, b, function (c) {
            Gd(a, c.text, g);
            var h = f == b - 1 || f % 5 == 0 || f >= e.viewFrom && f < e.viewTo;
            c.stateAfter = h ? bg(d.mode, g) : null, ++f
        }), c && (d.frontier = f), g
    }

    function Qa(a) {
        return a.lineSpace.offsetTop
    }

    function Ra(a) {
        return a.mover.offsetHeight - a.lineSpace.offsetHeight
    }

    function Sa(a) {
        if (a.cachedPaddingH)return a.cachedPaddingH;
        var b = Oe(a.measure, Me("pre", "x")), c = window.getComputedStyle ? window.getComputedStyle(b) : b.currentStyle, d = {
            left: parseInt(c.paddingLeft),
            right: parseInt(c.paddingRight)
        };
        return isNaN(d.left) || isNaN(d.right) || (a.cachedPaddingH = d), d
    }

    function Ta(a) {
        return Bg - a.display.nativeBarWidth
    }

    function Ua(a) {
        return a.display.scroller.clientWidth - Ta(a) - a.display.barWidth
    }

    function Va(a) {
        return a.display.scroller.clientHeight - Ta(a) - a.display.barHeight
    }

    function Wa(a, b, c) {
        var d = a.options.lineWrapping, e = d && Ua(a);
        if (!b.measure.heights || d && b.measure.width != e) {
            var f = b.measure.heights = [];
            if (d) {
                b.measure.width = e;
                for (var g = b.text.firstChild.getClientRects(), h = 0; h < g.length - 1; h++) {
                    var i = g[h], j = g[h + 1];
                    Math.abs(i.bottom - j.bottom) > 2 && f.push((i.bottom + j.top) / 2 - c.top)
                }
            }
            f.push(c.bottom - c.top)
        }
    }

    function Xa(a, b, c) {
        if (a.line == b)return {map: a.measure.map, cache: a.measure.cache};
        for (var d = 0; d < a.rest.length; d++)if (a.rest[d] == b)return {
            map: a.measure.maps[d],
            cache: a.measure.caches[d]
        };
        for (var d = 0; d < a.rest.length; d++)if (Zd(a.rest[d]) > c)return {
            map: a.measure.maps[d],
            cache: a.measure.caches[d],
            before: !0
        }
    }

    function Ya(a, b) {
        b = od(b);
        var c = Zd(b), d = a.display.externalMeasured = new Gb(a.doc, b, c);
        d.lineN = c;
        var e = d.built = Id(a, d);
        return d.text = e.pre, Oe(a.display.lineMeasure, e.pre), d
    }

    function Za(a, b, c, d) {
        return ab(a, _a(a, b), c, d)
    }

    function $a(a, b) {
        if (b >= a.display.viewFrom && b < a.display.viewTo)return a.display.view[Lb(a, b)];
        var c = a.display.externalMeasured;
        return c && b >= c.lineN && b < c.lineN + c.size ? c : void 0
    }

    function _a(a, b) {
        var c = Zd(b), d = $a(a, c);
        d && !d.text ? d = null : d && d.changes && J(a, d, c, H(a)), d || (d = Ya(a, b));
        var e = Xa(d, b, c);
        return {line: b, view: d, rect: null, map: e.map, cache: e.cache, before: e.before, hasHeights: !1}
    }

    function ab(a, b, c, d, e) {
        b.before && (c = -1);
        var f, g = c + (d || "");
        return b.cache.hasOwnProperty(g) ? f = b.cache[g] : (b.rect || (b.rect = b.view.text.getBoundingClientRect()), b.hasHeights || (Wa(a, b.view, b.rect), b.hasHeights = !0), f = cb(a, b, c, d), f.bogus || (b.cache[g] = f)), {
            left: f.left,
            right: f.right,
            top: e ? f.rtop : f.top,
            bottom: e ? f.rbottom : f.bottom
        }
    }

    function bb(a, b, c) {
        for (var d, e, f, g, h = 0; h < a.length; h += 3) {
            var i = a[h], j = a[h + 1];
            if (b < i ? (e = 0, f = 1, g = "left") : b < j ? (e = b - i, f = e + 1) : (h == a.length - 3 || b == j && a[h + 3] > b) && (f = j - i, e = f - 1, b >= j && (g = "right")), null != e) {
                if (d = a[h + 2], i == j && c == (d.insertLeft ? "left" : "right") && (g = c), "left" == c && 0 == e)for (; h && a[h - 2] == a[h - 3] && a[h - 1].insertLeft;)d = a[(h -= 3) + 2], g = "left";
                if ("right" == c && e == j - i)for (; h < a.length - 3 && a[h + 3] == a[h + 4] && !a[h + 5].insertLeft;)d = a[(h += 3) + 2], g = "right";
                break
            }
        }
        return {node: d, start: e, end: f, collapse: g, coverStart: i, coverEnd: j}
    }

    function cb(a, b, c, d) {
        var e, f = bb(b.map, c, d), g = f.node, h = f.start, i = f.end, j = f.collapse;
        if (3 == g.nodeType) {
            for (var k = 0; k < 4; k++) {
                for (; h && Le(b.line.text.charAt(f.coverStart + h));)--h;
                for (; f.coverStart + i < f.coverEnd && Le(b.line.text.charAt(f.coverStart + i));)++i;
                if (nf && of < 9 && 0 == h && i == f.coverEnd - f.coverStart)e = g.parentNode.getBoundingClientRect(); else if (nf && a.options.lineWrapping) {
                    var l = Jg(g, h, i).getClientRects();
                    e = l.length ? l["right" == d ? l.length - 1 : 0] : Lf
                } else e = Jg(g, h, i).getBoundingClientRect() || Lf;
                if (e.left || e.right || 0 == h)break;
                i = h, h -= 1, j = "right"
            }
            nf && of < 11 && (e = db(a.display.measure, e))
        } else {
            h > 0 && (j = d = "right");
            var l;
            e = a.options.lineWrapping && (l = g.getClientRects()).length > 1 ? l["right" == d ? l.length - 1 : 0] : g.getBoundingClientRect()
        }
        if (nf && of < 9 && !h && (!e || !e.left && !e.right)) {
            var m = g.parentNode.getClientRects()[0];
            e = m ? {left: m.left, right: m.left + sb(a.display), top: m.top, bottom: m.bottom} : Lf
        }
        for (var n = e.top - b.rect.top, o = e.bottom - b.rect.top, p = (n + o) / 2, q = b.view.measure.heights, k = 0; k < q.length - 1 && !(p < q[k]); k++);
        var r = k ? q[k - 1] : 0, s = q[k], t = {
            left: ("right" == j ? e.right : e.left) - b.rect.left,
            right: ("left" == j ? e.left : e.right) - b.rect.left,
            top: r,
            bottom: s
        };
        return e.left || e.right || (t.bogus = !0), a.options.singleCursorHeightPerLine || (t.rtop = n, t.rbottom = o), t
    }

    function db(a, b) {
        if (!window.screen || null == screen.logicalXDPI || screen.logicalXDPI == screen.deviceXDPI || !Xe(a))return b;
        var c = screen.logicalXDPI / screen.deviceXDPI, d = screen.logicalYDPI / screen.deviceYDPI;
        return {left: b.left * c, right: b.right * c, top: b.top * d, bottom: b.bottom * d}
    }

    function eb(a) {
        if (a.measure && (a.measure.cache = {}, a.measure.heights = null, a.rest))for (var b = 0; b < a.rest.length; b++)a.measure.caches[b] = {}
    }

    function fb(a) {
        a.display.externalMeasure = null, Ne(a.display.lineMeasure);
        for (var b = 0; b < a.display.view.length; b++)eb(a.display.view[b])
    }

    function gb(a) {
        fb(a), a.display.cachedCharWidth = a.display.cachedTextHeight = a.display.cachedPaddingH = null, a.options.lineWrapping || (a.display.maxLineChanged = !0), a.display.lineNumChars = null
    }

    function hb() {
        return window.pageXOffset || (document.documentElement || document.body).scrollLeft
    }

    function ib() {
        return window.pageYOffset || (document.documentElement || document.body).scrollTop
    }

    function jb(a, b, c, d) {
        if (b.widgets)for (var e = 0; e < b.widgets.length; ++e)if (b.widgets[e].above) {
            var f = vd(b.widgets[e]);
            c.top += f, c.bottom += f
        }
        if ("line" == d)return c;
        d || (d = "local");
        var g = _d(b);
        if ("local" == d ? g += Qa(a.display) : g -= a.display.viewOffset, "page" == d || "window" == d) {
            var h = a.display.lineSpace.getBoundingClientRect();
            g += h.top + ("window" == d ? 0 : ib());
            var i = h.left + ("window" == d ? 0 : hb());
            c.left += i, c.right += i
        }
        return c.top += g, c.bottom += g, c
    }

    function kb(a, b, c) {
        if ("div" == c)return b;
        var d = b.left, e = b.top;
        if ("page" == c)d -= hb(), e -= ib(); else if ("local" == c || !c) {
            var f = a.display.sizer.getBoundingClientRect();
            d += f.left, e += f.top
        }
        var g = a.display.lineSpace.getBoundingClientRect();
        return {left: d - g.left, top: e - g.top}
    }

    function lb(a, b, c, d, e) {
        return d || (d = Vd(a.doc, b.line)), jb(a, d, Za(a, d, b.ch, e), c)
    }

    function mb(a, b, c, d, e, f) {
        function g(b, g) {
            var h = ab(a, e, b, g ? "right" : "left", f);
            return g ? h.left = h.right : h.right = h.left, jb(a, d, h, c)
        }

        function h(a, b) {
            var c = i[b], d = c.level % 2;
            return a == Ze(c) && b && c.level < i[b - 1].level ? (c = i[--b], a = $e(c) - (c.level % 2 ? 0 : 1), d = !0) : a == $e(c) && b < i.length - 1 && c.level < i[b + 1].level && (c = i[++b], a = Ze(c) - c.level % 2, d = !1), d && a == c.to && a > c.from ? g(a - 1) : g(a, d)
        }

        d = d || Vd(a.doc, b.line), e || (e = _a(a, d));
        var i = ae(d), j = b.ch;
        if (!i)return g(j);
        var k = ff(i, j), l = h(j, k);
        return null != Zg && (l.other = h(j, Zg)), l
    }

    function nb(a, b) {
        var c = 0, b = qa(a.doc, b);
        a.options.lineWrapping || (c = sb(a.display) * b.ch);
        var d = Vd(a.doc, b.line), e = _d(d) + Qa(a.display);
        return {left: c, right: c, top: e, bottom: e + d.height}
    }

    function ob(a, b, c, d) {
        var e = Ff(a, b);
        return e.xRel = d, c && (e.outside = !0), e
    }

    function pb(a, b, c) {
        var d = a.doc;
        if (c += a.display.viewOffset, c < 0)return ob(d.first, 0, !0, -1);
        var e = $d(d, c), f = d.first + d.size - 1;
        if (e > f)return ob(d.first + d.size - 1, Vd(d, f).text.length, !0, 1);
        b < 0 && (b = 0);
        for (var g = Vd(d, e); ;) {
            var h = qb(a, g, e, b, c), i = md(g), j = i && i.find(0, !0);
            if (!i || !(h.ch > j.from.ch || h.ch == j.from.ch && h.xRel > 0))return h;
            e = Zd(g = j.to.line)
        }
    }

    function qb(a, b, c, d, e) {
        function f(d) {
            var e = mb(a, Ff(c, d), "line", b, j);
            return h = !0, g > e.bottom ? e.left - i : g < e.top ? e.left + i : (h = !1, e.left)
        }

        var g = e - _d(b), h = !1, i = 2 * a.display.wrapper.clientWidth, j = _a(a, b), k = ae(b), l = b.text.length, m = _e(b), n = af(b), o = f(m), p = h, q = f(n), r = h;
        if (d > q)return ob(c, n, r, 1);
        for (; ;) {
            if (k ? n == m || n == hf(b, m, 1) : n - m <= 1) {
                for (var s = d < o || d - o <= q - d ? m : n, t = d - (s == m ? o : q); Le(b.text.charAt(s));)++s;
                var u = ob(c, s, s == m ? p : r, t < -1 ? -1 : t > 1 ? 1 : 0);
                return u
            }
            var v = Math.ceil(l / 2), w = m + v;
            if (k) {
                w = m;
                for (var x = 0; x < v; ++x)w = hf(b, w, 1)
            }
            var y = f(w);
            y > d ? (n = w, q = y, (r = h) && (q += 1e3), l = v) : (m = w, o = y, p = h, l -= v)
        }
    }

    function rb(a) {
        if (null != a.cachedTextHeight)return a.cachedTextHeight;
        if (null == If) {
            If = Me("pre");
            for (var b = 0; b < 49; ++b)If.appendChild(document.createTextNode("x")), If.appendChild(Me("br"));
            If.appendChild(document.createTextNode("x"))
        }
        Oe(a.measure, If);
        var c = If.offsetHeight / 50;
        return c > 3 && (a.cachedTextHeight = c), Ne(a.measure), c || 1
    }

    function sb(a) {
        if (null != a.cachedCharWidth)return a.cachedCharWidth;
        var b = Me("span", "xxxxxxxxxx"), c = Me("pre", [b]);
        Oe(a.measure, c);
        var d = b.getBoundingClientRect(), e = (d.right - d.left) / 10;
        return e > 2 && (a.cachedCharWidth = e), e || 10
    }

    function tb(a) {
        a.curOp = {
            cm: a,
            viewChanged: !1,
            startHeight: a.doc.height,
            forceUpdate: !1,
            updateInput: null,
            typing: !1,
            changeObjs: null,
            cursorActivityHandlers: null,
            cursorActivityCalled: 0,
            selectionChanged: !1,
            updateMaxLine: !1,
            scrollLeft: null,
            scrollTop: null,
            scrollToPos: null,
            focus: !1,
            id: ++Nf
        }, Mf ? Mf.ops.push(a.curOp) : a.curOp.ownsGroup = Mf = {ops: [a.curOp], delayedCallbacks: []}
    }

    function ub(a) {
        var b = a.delayedCallbacks, c = 0;
        do {
            for (; c < b.length; c++)b[c]();
            for (var d = 0; d < a.ops.length; d++) {
                var e = a.ops[d];
                if (e.cursorActivityHandlers)for (; e.cursorActivityCalled < e.cursorActivityHandlers.length;)e.cursorActivityHandlers[e.cursorActivityCalled++](e.cm)
            }
        } while (c < b.length)
    }

    function vb(a) {
        var b = a.curOp, c = b.ownsGroup;
        if (c)try {
            ub(c)
        } finally {
            Mf = null;
            for (var d = 0; d < c.ops.length; d++)c.ops[d].cm.curOp = null;
            wb(c)
        }
    }

    function wb(a) {
        for (var b = a.ops, c = 0; c < b.length; c++)xb(b[c]);
        for (var c = 0; c < b.length; c++)yb(b[c]);
        for (var c = 0; c < b.length; c++)zb(b[c]);
        for (var c = 0; c < b.length; c++)Ab(b[c]);
        for (var c = 0; c < b.length; c++)Bb(b[c])
    }

    function xb(a) {
        var b = a.cm, c = b.display;
        A(b), a.updateMaxLine && m(b), a.mustUpdate = a.viewChanged || a.forceUpdate || null != a.scrollTop || a.scrollToPos && (a.scrollToPos.from.line < c.viewFrom || a.scrollToPos.to.line >= c.viewTo) || c.maxLineChanged && b.options.lineWrapping, a.update = a.mustUpdate && new z(b, a.mustUpdate && {
                    top: a.scrollTop,
                    ensure: a.scrollToPos
                }, a.forceUpdate)
    }

    function yb(a) {
        a.updatedDisplay = a.mustUpdate && B(a.cm, a.update)
    }

    function zb(a) {
        var b = a.cm, c = b.display;
        a.updatedDisplay && F(b), a.barMeasure = o(b), c.maxLineChanged && !b.options.lineWrapping && (a.adjustWidthTo = Za(b, c.maxLine, c.maxLine.text.length).left + 3, b.display.sizerWidth = a.adjustWidthTo, a.barMeasure.scrollWidth = Math.max(c.scroller.clientWidth, c.sizer.offsetLeft + a.adjustWidthTo + Ta(b) + b.display.barWidth), a.maxScrollLeft = Math.max(0, c.sizer.offsetLeft + a.adjustWidthTo - Ua(b))), (a.updatedDisplay || a.selectionChanged) && (a.preparedSelection = c.input.prepareSelection())
    }

    function Ab(a) {
        var b = a.cm;
        null != a.adjustWidthTo && (b.display.sizer.style.minWidth = a.adjustWidthTo + "px", a.maxScrollLeft < b.doc.scrollLeft && bc(b, Math.min(b.display.scroller.scrollLeft, a.maxScrollLeft), !0), b.display.maxLineChanged = !1), a.preparedSelection && b.display.input.showSelection(a.preparedSelection), a.updatedDisplay && E(b, a.barMeasure), (a.updatedDisplay || a.startHeight != b.doc.height) && s(b, a.barMeasure), a.selectionChanged && La(b), b.state.focused && a.updateInput && b.display.input.reset(a.typing), a.focus && a.focus == Pe() && Y(a.cm)
    }

    function Bb(a) {
        var b = a.cm, c = b.display, d = b.doc;
        if (a.updatedDisplay && C(b, a.update), null == c.wheelStartX || null == a.scrollTop && null == a.scrollLeft && !a.scrollToPos || (c.wheelStartX = c.wheelStartY = null), null == a.scrollTop || c.scroller.scrollTop == a.scrollTop && !a.forceScroll || (d.scrollTop = Math.max(0, Math.min(c.scroller.scrollHeight - c.scroller.clientHeight, a.scrollTop)), c.scrollbars.setScrollTop(d.scrollTop), c.scroller.scrollTop = d.scrollTop), null == a.scrollLeft || c.scroller.scrollLeft == a.scrollLeft && !a.forceScroll || (d.scrollLeft = Math.max(0, Math.min(c.scroller.scrollWidth - Ua(b), a.scrollLeft)), c.scrollbars.setScrollLeft(d.scrollLeft), c.scroller.scrollLeft = d.scrollLeft, v(b)), a.scrollToPos) {
            var e = Ec(b, qa(d, a.scrollToPos.from), qa(d, a.scrollToPos.to), a.scrollToPos.margin);
            a.scrollToPos.isCursor && b.state.focused && Dc(b, e)
        }
        var f = a.maybeHiddenMarkers, g = a.maybeUnhiddenMarkers;
        if (f)for (var h = 0; h < f.length; ++h)f[h].lines.length || zg(f[h], "hide");
        if (g)for (var h = 0; h < g.length; ++h)g[h].lines.length && zg(g[h], "unhide");
        c.wrapper.offsetHeight && (d.scrollTop = b.display.scroller.scrollTop), a.changeObjs && zg(b, "changes", b, a.changeObjs), a.update && a.update.finish()
    }

    function Cb(a, b) {
        if (a.curOp)return b();
        tb(a);
        try {
            return b()
        } finally {
            vb(a)
        }
    }

    function Db(a, b) {
        return function () {
            if (a.curOp)return b.apply(a, arguments);
            tb(a);
            try {
                return b.apply(a, arguments)
            } finally {
                vb(a)
            }
        }
    }

    function Eb(a) {
        return function () {
            if (this.curOp)return a.apply(this, arguments);
            tb(this);
            try {
                return a.apply(this, arguments)
            } finally {
                vb(this)
            }
        }
    }

    function Fb(a) {
        return function () {
            var b = this.cm;
            if (!b || b.curOp)return a.apply(this, arguments);
            tb(b);
            try {
                return a.apply(this, arguments)
            } finally {
                vb(b)
            }
        }
    }

    function Gb(a, b, c) {
        this.line = b, this.rest = pd(b), this.size = this.rest ? Zd(Ce(this.rest)) - c + 1 : 1, this.node = this.text = null, this.hidden = sd(a, b)
    }

    function Hb(a, b, c) {
        for (var d, e = [], f = b; f < c; f = d) {
            var g = new Gb(a.doc, Vd(a.doc, f), f);
            d = f + g.size, e.push(g)
        }
        return e
    }

    function Ib(a, b, c, d) {
        null == b && (b = a.doc.first), null == c && (c = a.doc.first + a.doc.size), d || (d = 0);
        var e = a.display;
        if (d && c < e.viewTo && (null == e.updateLineNumbers || e.updateLineNumbers > b) && (e.updateLineNumbers = b), a.curOp.viewChanged = !0, b >= e.viewTo)Ef && qd(a.doc, b) < e.viewTo && Kb(a); else if (c <= e.viewFrom)Ef && rd(a.doc, c + d) > e.viewFrom ? Kb(a) : (e.viewFrom += d, e.viewTo += d); else if (b <= e.viewFrom && c >= e.viewTo)Kb(a); else if (b <= e.viewFrom) {
            var f = Mb(a, c, c + d, 1);
            f ? (e.view = e.view.slice(f.index), e.viewFrom = f.lineN, e.viewTo += d) : Kb(a)
        } else if (c >= e.viewTo) {
            var f = Mb(a, b, b, -1);
            f ? (e.view = e.view.slice(0, f.index), e.viewTo = f.lineN) : Kb(a)
        } else {
            var g = Mb(a, b, b, -1), h = Mb(a, c, c + d, 1);
            g && h ? (e.view = e.view.slice(0, g.index).concat(Hb(a, g.lineN, h.lineN)).concat(e.view.slice(h.index)), e.viewTo += d) : Kb(a)
        }
        var i = e.externalMeasured;
        i && (c < i.lineN ? i.lineN += d : b < i.lineN + i.size && (e.externalMeasured = null))
    }

    function Jb(a, b, c) {
        a.curOp.viewChanged = !0;
        var d = a.display, e = a.display.externalMeasured;
        if (e && b >= e.lineN && b < e.lineN + e.size && (d.externalMeasured = null), !(b < d.viewFrom || b >= d.viewTo)) {
            var f = d.view[Lb(a, b)];
            if (null != f.node) {
                var g = f.changes || (f.changes = []);
                De(g, c) == -1 && g.push(c)
            }
        }
    }

    function Kb(a) {
        a.display.viewFrom = a.display.viewTo = a.doc.first, a.display.view = [], a.display.viewOffset = 0
    }

    function Lb(a, b) {
        if (b >= a.display.viewTo)return null;
        if (b -= a.display.viewFrom, b < 0)return null;
        for (var c = a.display.view, d = 0; d < c.length; d++)if (b -= c[d].size, b < 0)return d
    }

    function Mb(a, b, c, d) {
        var e, f = Lb(a, b), g = a.display.view;
        if (!Ef || c == a.doc.first + a.doc.size)return {index: f, lineN: c};
        for (var h = 0, i = a.display.viewFrom; h < f; h++)i += g[h].size;
        if (i != b) {
            if (d > 0) {
                if (f == g.length - 1)return null;
                e = i + g[f].size - b, f++
            } else e = i - b;
            b += e, c += e
        }
        for (; qd(a.doc, c) != c;) {
            if (f == (d < 0 ? 0 : g.length - 1))return null;
            c += d * g[f - (d < 0 ? 1 : 0)].size, f += d
        }
        return {index: f, lineN: c}
    }

    function Nb(a, b, c) {
        var d = a.display, e = d.view;
        0 == e.length || b >= d.viewTo || c <= d.viewFrom ? (d.view = Hb(a, b, c), d.viewFrom = b) : (d.viewFrom > b ? d.view = Hb(a, b, d.viewFrom).concat(d.view) : d.viewFrom < b && (d.view = d.view.slice(Lb(a, b))), d.viewFrom = b, d.viewTo < c ? d.view = d.view.concat(Hb(a, d.viewTo, c)) : d.viewTo > c && (d.view = d.view.slice(0, Lb(a, c)))), d.viewTo = c
    }

    function Ob(a) {
        for (var b = a.display.view, c = 0, d = 0; d < b.length; d++) {
            var e = b[d];
            e.hidden || e.node && !e.changes || ++c
        }
        return c
    }

    function Pb(a) {
        function b() {
            e.activeTouch && (f = setTimeout(function () {
                e.activeTouch = null
            }, 1e3), g = e.activeTouch, g.end = +new Date)
        }

        function c(a) {
            if (1 != a.touches.length)return !1;
            var b = a.touches[0];
            return b.radiusX <= 1 && b.radiusY <= 1
        }

        function d(a, b) {
            if (null == b.left)return !0;
            var c = b.left - a.left, d = b.top - a.top;
            return c * c + d * d > 400
        }

        var e = a.display;
        xg(e.scroller, "mousedown", Db(a, Ub)), nf && of < 11 ? xg(e.scroller, "dblclick", Db(a, function (b) {
            if (!ve(a, b)) {
                var c = Tb(a, b);
                if (c && !Zb(a, b) && !Sb(a.display, b)) {
                    ug(b);
                    var d = a.findWordAt(c);
                    va(a.doc, d.anchor, d.head)
                }
            }
        })) : xg(e.scroller, "dblclick", function (b) {
            ve(a, b) || ug(b)
        }), Cf || xg(e.scroller, "contextmenu", function (b) {
            pc(a, b)
        });
        var f, g = {end: 0};
        xg(e.scroller, "touchstart", function (a) {
            if (!c(a)) {
                clearTimeout(f);
                var b = +new Date;
                e.activeTouch = {
                    start: b,
                    moved: !1,
                    prev: b - g.end <= 300 ? g : null
                }, 1 == a.touches.length && (e.activeTouch.left = a.touches[0].pageX, e.activeTouch.top = a.touches[0].pageY)
            }
        }), xg(e.scroller, "touchmove", function () {
            e.activeTouch && (e.activeTouch.moved = !0)
        }), xg(e.scroller, "touchend", function (c) {
            var f = e.activeTouch;
            if (f && !Sb(e, c) && null != f.left && !f.moved && new Date - f.start < 300) {
                var g, h = a.coordsChar(e.activeTouch, "page");
                g = !f.prev || d(f, f.prev) ? new ma(h, h) : !f.prev.prev || d(f, f.prev.prev) ? a.findWordAt(h) : new ma(Ff(h.line, 0), qa(a.doc, Ff(h.line + 1, 0))), a.setSelection(g.anchor, g.head), a.focus(), ug(c)
            }
            b()
        }), xg(e.scroller, "touchcancel", b), xg(e.scroller, "scroll", function () {
            e.scroller.clientHeight && (ac(a, e.scroller.scrollTop), bc(a, e.scroller.scrollLeft, !0), zg(a, "scroll", a))
        }), xg(e.scroller, "mousewheel", function (b) {
            cc(a, b)
        }), xg(e.scroller, "DOMMouseScroll", function (b) {
            cc(a, b)
        }), xg(e.wrapper, "scroll", function () {
            e.wrapper.scrollTop = e.wrapper.scrollLeft = 0
        }), e.dragFunctions = {
            simple: function (b) {
                ve(a, b) || wg(b)
            }, start: function (b) {
                _b(a, b)
            }, drop: Db(a, $b)
        };
        var h = e.input.getField();
        xg(h, "keyup", function (b) {
            kc.call(a, b)
        }), xg(h, "keydown", Db(a, ic)), xg(h, "keypress", Db(a, lc)), xg(h, "focus", Ie(nc, a)), xg(h, "blur", Ie(oc, a))
    }

    function Qb(b, c, d) {
        var e = d && d != a.Init;
        if (!c != !e) {
            var f = b.display.dragFunctions, g = c ? xg : yg;
            g(b.display.scroller, "dragstart", f.start), g(b.display.scroller, "dragenter", f.simple), g(b.display.scroller, "dragover", f.simple), g(b.display.scroller, "drop", f.drop)
        }
    }

    function Rb(a) {
        var b = a.display;
        b.lastWrapHeight == b.wrapper.clientHeight && b.lastWrapWidth == b.wrapper.clientWidth || (b.cachedCharWidth = b.cachedTextHeight = b.cachedPaddingH = null, b.scrollbarsClipped = !1, a.setSize())
    }

    function Sb(a, b) {
        for (var c = re(b); c != a.wrapper; c = c.parentNode)if (!c || 1 == c.nodeType && "true" == c.getAttribute("cm-ignore-events") || c.parentNode == a.sizer && c != a.mover)return !0
    }

    function Tb(a, b, c, d) {
        var e = a.display;
        if (!c && "true" == re(b).getAttribute("cm-not-content"))return null;
        var f, g, h = e.lineSpace.getBoundingClientRect();
        try {
            f = b.clientX - h.left, g = b.clientY - h.top
        } catch (a) {
            return null
        }
        var i, j = pb(a, f, g);
        if (d && 1 == j.xRel && (i = Vd(a.doc, j.line).text).length == j.ch) {
            var k = Gg(i, i.length, a.options.tabSize) - i.length;
            j = Ff(j.line, Math.max(0, Math.round((f - Sa(a.display).left) / sb(a.display)) - k))
        }
        return j
    }

    function Ub(a) {
        var b = this, c = b.display;
        if (!(c.activeTouch && c.input.supportsTouch() || ve(b, a))) {
            if (c.shift = a.shiftKey, Sb(c, a))return void(pf || (c.scroller.draggable = !1, setTimeout(function () {
                c.scroller.draggable = !0
            }, 100)));
            if (!Zb(b, a)) {
                var d = Tb(b, a);
                switch (window.focus(), se(a)) {
                    case 1:
                        d ? Vb(b, a, d) : re(a) == c.scroller && ug(a);
                        break;
                    case 2:
                        pf && (b.state.lastMiddleDown = +new Date), d && va(b.doc, d), setTimeout(function () {
                            c.input.focus()
                        }, 20), ug(a);
                        break;
                    case 3:
                        Cf ? pc(b, a) : mc(b)
                }
            }
        }
    }

    function Vb(a, b, c) {
        nf ? setTimeout(Ie(Y, a), 0) : a.curOp.focus = Pe();
        var d, e = +new Date;
        Kf && Kf.time > e - 400 && 0 == Gf(Kf.pos, c) ? d = "triple" : Jf && Jf.time > e - 400 && 0 == Gf(Jf.pos, c) ? (d = "double", Kf = {
            time: e,
            pos: c
        }) : (d = "single", Jf = {time: e, pos: c});
        var f, g = a.doc.sel, h = yf ? b.metaKey : b.ctrlKey;
        a.options.dragDrop && Tg && !Z(a) && "single" == d && (f = g.contains(c)) > -1 && (Gf((f = g.ranges[f]).from(), c) < 0 || c.xRel > 0) && (Gf(f.to(), c) > 0 || c.xRel < 0) ? Wb(a, b, c, h) : Xb(a, b, c, d, h)
    }

    function Wb(a, b, c, d) {
        var e = a.display, f = +new Date, g = Db(a, function (h) {
            pf && (e.scroller.draggable = !1), a.state.draggingText = !1, yg(document, "mouseup", g), yg(e.scroller, "drop", g), Math.abs(b.clientX - h.clientX) + Math.abs(b.clientY - h.clientY) < 10 && (ug(h), !d && +new Date - 200 < f && va(a.doc, c), pf || nf && 9 == of ? setTimeout(function () {
                document.body.focus(), e.input.focus()
            }, 20) : e.input.focus())
        });
        pf && (e.scroller.draggable = !0), a.state.draggingText = g, e.scroller.dragDrop && e.scroller.dragDrop(), xg(document, "mouseup", g), xg(e.scroller, "drop", g)
    }

    function Xb(a, b, c, d, e) {
        function f(b) {
            if (0 != Gf(q, b))if (q = b, "rect" == d) {
                for (var e = [], f = a.options.tabSize, g = Gg(Vd(j, c.line).text, c.ch, f), h = Gg(Vd(j, b.line).text, b.ch, f), i = Math.min(g, h), n = Math.max(g, h), o = Math.min(c.line, b.line), p = Math.min(a.lastLine(), Math.max(c.line, b.line)); o <= p; o++) {
                    var r = Vd(j, o).text, s = Ae(r, i, f);
                    i == n ? e.push(new ma(Ff(o, s), Ff(o, s))) : r.length > s && e.push(new ma(Ff(o, s), Ff(o, Ae(r, n, f))))
                }
                e.length || e.push(new ma(c, c)), Ba(j, na(m.ranges.slice(0, l).concat(e), l), {
                    origin: "*mouse",
                    scroll: !1
                }), a.scrollIntoView(b)
            } else {
                var t = k, u = t.anchor, v = b;
                if ("single" != d) {
                    if ("double" == d)var w = a.findWordAt(b); else var w = new ma(Ff(b.line, 0), qa(j, Ff(b.line + 1, 0)));
                    Gf(w.anchor, u) > 0 ? (v = w.head, u = X(t.from(), w.anchor)) : (v = w.anchor, u = W(t.to(), w.head))
                }
                var e = m.ranges.slice(0);
                e[l] = new ma(qa(j, u), v), Ba(j, na(e, l), Eg)
            }
        }

        function g(b) {
            var c = ++s, e = Tb(a, b, !0, "rect" == d);
            if (e)if (0 != Gf(e, q)) {
                a.curOp.focus = Pe(), f(e);
                var h = u(i, j);
                (e.line >= h.to || e.line < h.from) && setTimeout(Db(a, function () {
                    s == c && g(b)
                }), 150)
            } else {
                var k = b.clientY < r.top ? -20 : b.clientY > r.bottom ? 20 : 0;
                k && setTimeout(Db(a, function () {
                    s == c && (i.scroller.scrollTop += k, g(b))
                }), 50)
            }
        }

        function h(a) {
            s = 1 / 0, ug(a), i.input.focus(), yg(document, "mousemove", t), yg(document, "mouseup", v), j.history.lastSelOrigin = null
        }

        var i = a.display, j = a.doc;
        ug(b);
        var k, l, m = j.sel, n = m.ranges;
        if (e && !b.shiftKey ? (l = j.sel.contains(c), k = l > -1 ? n[l] : new ma(c, c)) : (k = j.sel.primary(), l = j.sel.primIndex), b.altKey)d = "rect", e || (k = new ma(c, c)), c = Tb(a, b, !0, !0), l = -1; else if ("double" == d) {
            var o = a.findWordAt(c);
            k = a.display.shift || j.extend ? ua(j, k, o.anchor, o.head) : o
        } else if ("triple" == d) {
            var p = new ma(Ff(c.line, 0), qa(j, Ff(c.line + 1, 0)));
            k = a.display.shift || j.extend ? ua(j, k, p.anchor, p.head) : p
        } else k = ua(j, k, c);
        e ? l == -1 ? (l = n.length, Ba(j, na(n.concat([k]), l), {
            scroll: !1,
            origin: "*mouse"
        })) : n.length > 1 && n[l].empty() && "single" == d && !b.shiftKey ? (Ba(j, na(n.slice(0, l).concat(n.slice(l + 1)), 0)), m = j.sel) : xa(j, l, k, Eg) : (l = 0, Ba(j, new la([k], 0), Eg), m = j.sel);
        var q = c, r = i.wrapper.getBoundingClientRect(), s = 0, t = Db(a, function (a) {
            se(a) ? g(a) : h(a)
        }), v = Db(a, h);
        xg(document, "mousemove", t), xg(document, "mouseup", v)
    }

    function Yb(a, b, c, d, e) {
        try {
            var f = b.clientX, g = b.clientY
        } catch (a) {
            return !1
        }
        if (f >= Math.floor(a.display.gutters.getBoundingClientRect().right))return !1;
        d && ug(b);
        var h = a.display, i = h.lineDiv.getBoundingClientRect();
        if (g > i.bottom || !xe(a, c))return qe(b);
        g -= i.top - h.viewOffset;
        for (var j = 0; j < a.options.gutters.length; ++j) {
            var k = h.gutters.childNodes[j];
            if (k && k.getBoundingClientRect().right >= f) {
                var l = $d(a.doc, g), m = a.options.gutters[j];
                return e(a, c, a, l, m, b), qe(b)
            }
        }
    }

    function Zb(a, b) {
        return Yb(a, b, "gutterClick", !0, te)
    }

    function $b(a) {
        var b = this;
        if (!ve(b, a) && !Sb(b.display, a)) {
            ug(a), nf && (Of = +new Date);
            var c = Tb(b, a, !0), d = a.dataTransfer.files;
            if (c && !Z(b))if (d && d.length && window.FileReader && window.File)for (var e = d.length, f = Array(e), g = 0, h = function (a, d) {
                var h = new FileReader;
                h.onload = Db(b, function () {
                    if (f[d] = h.result, ++g == e) {
                        c = qa(b.doc, c);
                        var a = {from: c, to: c, text: Ug(f.join("\n")), origin: "paste"};
                        wc(b.doc, a), Aa(b.doc, oa(c, Uf(a)))
                    }
                }), h.readAsText(a)
            }, i = 0; i < e; ++i)h(d[i], i); else {
                if (b.state.draggingText && b.doc.sel.contains(c) > -1)return b.state.draggingText(a), void setTimeout(function () {
                    b.display.input.focus()
                }, 20);
                try {
                    var f = a.dataTransfer.getData("Text");
                    if (f) {
                        if (b.state.draggingText && !(yf ? a.altKey : a.ctrlKey))var j = b.listSelections();
                        if (Ca(b.doc, oa(c, c)), j)for (var i = 0; i < j.length; ++i)Cc(b.doc, "", j[i].anchor, j[i].head, "drag");
                        b.replaceSelection(f, "around", "paste"), b.display.input.focus()
                    }
                } catch (a) {
                }
            }
        }
    }

    function _b(a, b) {
        if (nf && (!a.state.draggingText || +new Date - Of < 100))return void wg(b);
        if (!ve(a, b) && !Sb(a.display, b) && (b.dataTransfer.setData("Text", a.getSelection()), b.dataTransfer.setDragImage && !tf)) {
            var c = Me("img", null, null, "position: fixed; left: 0; top: 0;");
            c.src = "data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==", sf && (c.width = c.height = 1, a.display.wrapper.appendChild(c), c._top = c.offsetTop), b.dataTransfer.setDragImage(c, 0, 0), sf && c.parentNode.removeChild(c)
        }
    }

    function ac(a, b) {
        Math.abs(a.doc.scrollTop - b) < 2 || (a.doc.scrollTop = b, kf || D(a, {top: b}), a.display.scroller.scrollTop != b && (a.display.scroller.scrollTop = b),
            a.display.scrollbars.setScrollTop(b), kf && D(a), Ma(a, 100))
    }

    function bc(a, b, c) {
        (c ? b == a.doc.scrollLeft : Math.abs(a.doc.scrollLeft - b) < 2) || (b = Math.min(b, a.display.scroller.scrollWidth - a.display.scroller.clientWidth), a.doc.scrollLeft = b, v(a), a.display.scroller.scrollLeft != b && (a.display.scroller.scrollLeft = b), a.display.scrollbars.setScrollLeft(b))
    }

    function cc(a, b) {
        var c = Rf(b), d = c.x, e = c.y, f = a.display, g = f.scroller;
        if (d && g.scrollWidth > g.clientWidth || e && g.scrollHeight > g.clientHeight) {
            if (e && yf && pf)a:for (var h = b.target, i = f.view; h != g; h = h.parentNode)for (var j = 0; j < i.length; j++)if (i[j].node == h) {
                a.display.currentWheelTarget = h;
                break a
            }
            if (d && !kf && !sf && null != Qf)return e && ac(a, Math.max(0, Math.min(g.scrollTop + e * Qf, g.scrollHeight - g.clientHeight))), bc(a, Math.max(0, Math.min(g.scrollLeft + d * Qf, g.scrollWidth - g.clientWidth))), ug(b), void(f.wheelStartX = null);
            if (e && null != Qf) {
                var k = e * Qf, l = a.doc.scrollTop, m = l + f.wrapper.clientHeight;
                k < 0 ? l = Math.max(0, l + k - 50) : m = Math.min(a.doc.height, m + k + 50), D(a, {top: l, bottom: m})
            }
            Pf < 20 && (null == f.wheelStartX ? (f.wheelStartX = g.scrollLeft, f.wheelStartY = g.scrollTop, f.wheelDX = d, f.wheelDY = e, setTimeout(function () {
                if (null != f.wheelStartX) {
                    var a = g.scrollLeft - f.wheelStartX, b = g.scrollTop - f.wheelStartY, c = b && f.wheelDY && b / f.wheelDY || a && f.wheelDX && a / f.wheelDX;
                    f.wheelStartX = f.wheelStartY = null, c && (Qf = (Qf * Pf + c) / (Pf + 1), ++Pf)
                }
            }, 200)) : (f.wheelDX += d, f.wheelDY += e))
        }
    }

    function dc(a, b, c) {
        if ("string" == typeof b && (b = dg[b], !b))return !1;
        a.display.input.ensurePolled();
        var d = a.display.shift, e = !1;
        try {
            Z(a) && (a.state.suppressEdits = !0), c && (a.display.shift = !1), e = b(a) != Cg
        } finally {
            a.display.shift = d, a.state.suppressEdits = !1
        }
        return e
    }

    function ec(a, b, c) {
        for (var d = 0; d < a.state.keyMaps.length; d++) {
            var e = fg(b, a.state.keyMaps[d], c, a);
            if (e)return e
        }
        return a.options.extraKeys && fg(b, a.options.extraKeys, c, a) || fg(b, a.options.keyMap, c, a)
    }

    function fc(a, b, c, d) {
        var e = a.state.keySeq;
        if (e) {
            if (gg(b))return "handled";
            Sf.set(50, function () {
                a.state.keySeq == e && (a.state.keySeq = null, a.display.input.reset())
            }), b = e + " " + b
        }
        var f = ec(a, b, d);
        return "multi" == f && (a.state.keySeq = b), "handled" == f && te(a, "keyHandled", a, b, c), "handled" != f && "multi" != f || (ug(c), La(a)), e && !f && /\'$/.test(b) ? (ug(c), !0) : !!f
    }

    function gc(a, b) {
        var c = hg(b, !0);
        return !!c && (b.shiftKey && !a.state.keySeq ? fc(a, "Shift-" + c, b, function (b) {
                    return dc(a, b, !0)
                }) || fc(a, c, b, function (b) {
                    if ("string" == typeof b ? /^go[A-Z]/.test(b) : b.motion)return dc(a, b)
                }) : fc(a, c, b, function (b) {
                return dc(a, b)
            }))
    }

    function hc(a, b, c) {
        return fc(a, "'" + c + "'", b, function (b) {
            return dc(a, b, !0)
        })
    }

    function ic(a) {
        var b = this;
        if (b.curOp.focus = Pe(), !ve(b, a)) {
            nf && of < 11 && 27 == a.keyCode && (a.returnValue = !1);
            var c = a.keyCode;
            b.display.shift = 16 == c || a.shiftKey;
            var d = gc(b, a);
            sf && (Tf = d ? c : null, !d && 88 == c && !Wg && (yf ? a.metaKey : a.ctrlKey) && b.replaceSelection("", null, "cut")), 18 != c || /\bCodeMirror-crosshair\b/.test(b.display.lineDiv.className) || jc(b)
        }
    }

    function jc(a) {
        function b(a) {
            18 != a.keyCode && a.altKey || (Qg(c, "CodeMirror-crosshair"), yg(document, "keyup", b), yg(document, "mouseover", b))
        }

        var c = a.display.lineDiv;
        Rg(c, "CodeMirror-crosshair"), xg(document, "keyup", b), xg(document, "mouseover", b)
    }

    function kc(a) {
        16 == a.keyCode && (this.doc.sel.shift = !1), ve(this, a)
    }

    function lc(a) {
        var b = this;
        if (!(Sb(b.display, a) || ve(b, a) || a.ctrlKey && !a.altKey || yf && a.metaKey)) {
            var c = a.keyCode, d = a.charCode;
            if (sf && c == Tf)return Tf = null, void ug(a);
            if (!sf || a.which && !(a.which < 10) || !gc(b, a)) {
                var e = String.fromCharCode(null == d ? c : d);
                hc(b, a, e) || b.display.input.onKeyPress(a)
            }
        }
    }

    function mc(a) {
        a.state.delayingBlurEvent = !0, setTimeout(function () {
            a.state.delayingBlurEvent && (a.state.delayingBlurEvent = !1, oc(a))
        }, 100)
    }

    function nc(a) {
        a.state.delayingBlurEvent && (a.state.delayingBlurEvent = !1), "nocursor" != a.options.readOnly && (a.state.focused || (zg(a, "focus", a), a.state.focused = !0, Rg(a.display.wrapper, "CodeMirror-focused"), a.curOp || a.display.selForContextMenu == a.doc.sel || (a.display.input.reset(), pf && setTimeout(function () {
            a.display.input.reset(!0)
        }, 20)), a.display.input.receivedFocus()), La(a))
    }

    function oc(a) {
        a.state.delayingBlurEvent || (a.state.focused && (zg(a, "blur", a), a.state.focused = !1, Qg(a.display.wrapper, "CodeMirror-focused")), clearInterval(a.display.blinker), setTimeout(function () {
            a.state.focused || (a.display.shift = !1)
        }, 150))
    }

    function pc(a, b) {
        Sb(a.display, b) || qc(a, b) || a.display.input.onContextMenu(b)
    }

    function qc(a, b) {
        return !!xe(a, "gutterContextMenu") && Yb(a, b, "gutterContextMenu", !1, zg)
    }

    function rc(a, b) {
        if (Gf(a, b.from) < 0)return a;
        if (Gf(a, b.to) <= 0)return Uf(b);
        var c = a.line + b.text.length - (b.to.line - b.from.line) - 1, d = a.ch;
        return a.line == b.to.line && (d += Uf(b).ch - b.to.ch), Ff(c, d)
    }

    function sc(a, b) {
        for (var c = [], d = 0; d < a.sel.ranges.length; d++) {
            var e = a.sel.ranges[d];
            c.push(new ma(rc(e.anchor, b), rc(e.head, b)))
        }
        return na(c, a.sel.primIndex)
    }

    function tc(a, b, c) {
        return a.line == b.line ? Ff(c.line, a.ch - b.ch + c.ch) : Ff(c.line + (a.line - b.line), a.ch)
    }

    function uc(a, b, c) {
        for (var d = [], e = Ff(a.first, 0), f = e, g = 0; g < b.length; g++) {
            var h = b[g], i = tc(h.from, e, f), j = tc(Uf(h), e, f);
            if (e = h.to, f = j, "around" == c) {
                var k = a.sel.ranges[g], l = Gf(k.head, k.anchor) < 0;
                d[g] = new ma(l ? j : i, l ? i : j)
            } else d[g] = new ma(i, i)
        }
        return new la(d, a.sel.primIndex)
    }

    function vc(a, b, c) {
        var d = {
            canceled: !1, from: b.from, to: b.to, text: b.text, origin: b.origin, cancel: function () {
                this.canceled = !0
            }
        };
        return c && (d.update = function (b, c, d, e) {
            b && (this.from = qa(a, b)), c && (this.to = qa(a, c)), d && (this.text = d), void 0 !== e && (this.origin = e)
        }), zg(a, "beforeChange", a, d), a.cm && zg(a.cm, "beforeChange", a.cm, d), d.canceled ? null : {
            from: d.from,
            to: d.to,
            text: d.text,
            origin: d.origin
        }
    }

    function wc(a, b, c) {
        if (a.cm) {
            if (!a.cm.curOp)return Db(a.cm, wc)(a, b, c);
            if (a.cm.state.suppressEdits)return
        }
        if (!(xe(a, "beforeChange") || a.cm && xe(a.cm, "beforeChange")) || (b = vc(a, b, !0))) {
            var d = Df && !c && ed(a, b.from, b.to);
            if (d)for (var e = d.length - 1; e >= 0; --e)xc(a, {
                from: d[e].from,
                to: d[e].to,
                text: e ? [""] : b.text
            }); else xc(a, b)
        }
    }

    function xc(a, b) {
        if (1 != b.text.length || "" != b.text[0] || 0 != Gf(b.from, b.to)) {
            var c = sc(a, b);
            fe(a, b, c, a.cm ? a.cm.curOp.id : NaN), Ac(a, b, c, bd(a, b));
            var d = [];
            Td(a, function (a, c) {
                c || De(d, a.history) != -1 || (pe(a.history, b), d.push(a.history)), Ac(a, b, null, bd(a, b))
            })
        }
    }

    function yc(a, b, c) {
        if (!a.cm || !a.cm.state.suppressEdits) {
            for (var d, e = a.history, f = a.sel, g = "undo" == b ? e.done : e.undone, h = "undo" == b ? e.undone : e.done, i = 0; i < g.length && (d = g[i], c ? !d.ranges || d.equals(a.sel) : d.ranges); i++);
            if (i != g.length) {
                for (e.lastOrigin = e.lastSelOrigin = null; d = g.pop(), d.ranges;) {
                    if (ie(d, h), c && !d.equals(a.sel))return void Ba(a, d, {clearRedo: !1});
                    f = d
                }
                var j = [];
                ie(f, h), h.push({
                    changes: j,
                    generation: e.generation
                }), e.generation = d.generation || ++e.maxGeneration;
                for (var k = xe(a, "beforeChange") || a.cm && xe(a.cm, "beforeChange"), i = d.changes.length - 1; i >= 0; --i) {
                    var l = d.changes[i];
                    if (l.origin = b, k && !vc(a, l, !1))return void(g.length = 0);
                    j.push(ce(a, l));
                    var m = i ? sc(a, l) : Ce(g);
                    Ac(a, l, m, dd(a, l)), !i && a.cm && a.cm.scrollIntoView({from: l.from, to: Uf(l)});
                    var n = [];
                    Td(a, function (a, b) {
                        b || De(n, a.history) != -1 || (pe(a.history, l), n.push(a.history)), Ac(a, l, null, dd(a, l))
                    })
                }
            }
        }
    }

    function zc(a, b) {
        if (0 != b && (a.first += b, a.sel = new la(Ee(a.sel.ranges, function (a) {
                return new ma(Ff(a.anchor.line + b, a.anchor.ch), Ff(a.head.line + b, a.head.ch))
            }), a.sel.primIndex), a.cm)) {
            Ib(a.cm, a.first, a.first - b, b);
            for (var c = a.cm.display, d = c.viewFrom; d < c.viewTo; d++)Jb(a.cm, d, "gutter")
        }
    }

    function Ac(a, b, c, d) {
        if (a.cm && !a.cm.curOp)return Db(a.cm, Ac)(a, b, c, d);
        if (b.to.line < a.first)return void zc(a, b.text.length - 1 - (b.to.line - b.from.line));
        if (!(b.from.line > a.lastLine())) {
            if (b.from.line < a.first) {
                var e = b.text.length - 1 - (a.first - b.from.line);
                zc(a, e), b = {
                    from: Ff(a.first, 0),
                    to: Ff(b.to.line + e, b.to.ch),
                    text: [Ce(b.text)],
                    origin: b.origin
                }
            }
            var f = a.lastLine();
            b.to.line > f && (b = {
                from: b.from,
                to: Ff(f, Vd(a, f).text.length),
                text: [b.text[0]],
                origin: b.origin
            }), b.removed = Wd(a, b.from, b.to), c || (c = sc(a, b)), a.cm ? Bc(a.cm, b, d) : Qd(a, b, d), Ca(a, c, Dg)
        }
    }

    function Bc(a, b, c) {
        var d = a.doc, e = a.display, g = b.from, h = b.to, i = !1, j = g.line;
        a.options.lineWrapping || (j = Zd(od(Vd(d, g.line))), d.iter(j, h.line + 1, function (a) {
            if (a == e.maxLine)return i = !0, !0
        })), d.sel.contains(b.from, b.to) > -1 && we(a), Qd(d, b, c, f(a)), a.options.lineWrapping || (d.iter(j, g.line + b.text.length, function (a) {
            var b = l(a);
            b > e.maxLineLength && (e.maxLine = a, e.maxLineLength = b, e.maxLineChanged = !0, i = !1)
        }), i && (a.curOp.updateMaxLine = !0)), d.frontier = Math.min(d.frontier, g.line), Ma(a, 400);
        var k = b.text.length - (h.line - g.line) - 1;
        b.full ? Ib(a) : g.line != h.line || 1 != b.text.length || Pd(a.doc, b) ? Ib(a, g.line, h.line + 1, k) : Jb(a, g.line, "text");
        var m = xe(a, "changes"), n = xe(a, "change");
        if (n || m) {
            var o = {from: g, to: h, text: b.text, removed: b.removed, origin: b.origin};
            n && te(a, "change", a, o), m && (a.curOp.changeObjs || (a.curOp.changeObjs = [])).push(o)
        }
        a.display.selForContextMenu = null
    }

    function Cc(a, b, c, d, e) {
        if (d || (d = c), Gf(d, c) < 0) {
            var f = d;
            d = c, c = f
        }
        "string" == typeof b && (b = Ug(b)), wc(a, {from: c, to: d, text: b, origin: e})
    }

    function Dc(a, b) {
        if (!ve(a, "scrollCursorIntoView")) {
            var c = a.display, d = c.sizer.getBoundingClientRect(), e = null;
            if (b.top + d.top < 0 ? e = !0 : b.bottom + d.top > (window.innerHeight || document.documentElement.clientHeight) && (e = !1), null != e && !vf) {
                var f = Me("div", "​", null, "position: absolute; top: " + (b.top - c.viewOffset - Qa(a.display)) + "px; height: " + (b.bottom - b.top + Ta(a) + c.barHeight) + "px; left: " + b.left + "px; width: 2px;");
                a.display.lineSpace.appendChild(f), f.scrollIntoView(e), a.display.lineSpace.removeChild(f)
            }
        }
    }

    function Ec(a, b, c, d) {
        null == d && (d = 0);
        for (var e = 0; e < 5; e++) {
            var f = !1, g = mb(a, b), h = c && c != b ? mb(a, c) : g, i = Gc(a, Math.min(g.left, h.left), Math.min(g.top, h.top) - d, Math.max(g.left, h.left), Math.max(g.bottom, h.bottom) + d), j = a.doc.scrollTop, k = a.doc.scrollLeft;
            if (null != i.scrollTop && (ac(a, i.scrollTop), Math.abs(a.doc.scrollTop - j) > 1 && (f = !0)), null != i.scrollLeft && (bc(a, i.scrollLeft), Math.abs(a.doc.scrollLeft - k) > 1 && (f = !0)), !f)break
        }
        return g
    }

    function Fc(a, b, c, d, e) {
        var f = Gc(a, b, c, d, e);
        null != f.scrollTop && ac(a, f.scrollTop), null != f.scrollLeft && bc(a, f.scrollLeft)
    }

    function Gc(a, b, c, d, e) {
        var f = a.display, g = rb(a.display);
        c < 0 && (c = 0);
        var h = a.curOp && null != a.curOp.scrollTop ? a.curOp.scrollTop : f.scroller.scrollTop, i = Va(a), j = {};
        e - c > i && (e = c + i);
        var k = a.doc.height + Ra(f), l = c < g, m = e > k - g;
        if (c < h)j.scrollTop = l ? 0 : c; else if (e > h + i) {
            var n = Math.min(c, (m ? k : e) - i);
            n != h && (j.scrollTop = n)
        }
        var o = a.curOp && null != a.curOp.scrollLeft ? a.curOp.scrollLeft : f.scroller.scrollLeft, p = Ua(a) - (a.options.fixedGutter ? f.gutters.offsetWidth : 0), q = d - b > p;
        return q && (d = b + p), b < 10 ? j.scrollLeft = 0 : b < o ? j.scrollLeft = Math.max(0, b - (q ? 0 : 10)) : d > p + o - 3 && (j.scrollLeft = d + (q ? 0 : 10) - p), j
    }

    function Hc(a, b, c) {
        null == b && null == c || Jc(a), null != b && (a.curOp.scrollLeft = (null == a.curOp.scrollLeft ? a.doc.scrollLeft : a.curOp.scrollLeft) + b), null != c && (a.curOp.scrollTop = (null == a.curOp.scrollTop ? a.doc.scrollTop : a.curOp.scrollTop) + c)
    }

    function Ic(a) {
        Jc(a);
        var b = a.getCursor(), c = b, d = b;
        a.options.lineWrapping || (c = b.ch ? Ff(b.line, b.ch - 1) : b, d = Ff(b.line, b.ch + 1)), a.curOp.scrollToPos = {
            from: c,
            to: d,
            margin: a.options.cursorScrollMargin,
            isCursor: !0
        }
    }

    function Jc(a) {
        var b = a.curOp.scrollToPos;
        if (b) {
            a.curOp.scrollToPos = null;
            var c = nb(a, b.from), d = nb(a, b.to), e = Gc(a, Math.min(c.left, d.left), Math.min(c.top, d.top) - b.margin, Math.max(c.right, d.right), Math.max(c.bottom, d.bottom) + b.margin);
            a.scrollTo(e.scrollLeft, e.scrollTop)
        }
    }

    function Kc(a, b, c, d) {
        var e, f = a.doc;
        null == c && (c = "add"), "smart" == c && (f.mode.indent ? e = Pa(a, b) : c = "prev");
        var g = a.options.tabSize, h = Vd(f, b), i = Gg(h.text, null, g);
        h.stateAfter && (h.stateAfter = null);
        var j, k = h.text.match(/^\s*/)[0];
        if (d || /\S/.test(h.text)) {
            if ("smart" == c && (j = f.mode.indent(e, h.text.slice(k.length), h.text), j == Cg || j > 150)) {
                if (!d)return;
                c = "prev"
            }
        } else j = 0, c = "not";
        "prev" == c ? j = b > f.first ? Gg(Vd(f, b - 1).text, null, g) : 0 : "add" == c ? j = i + a.options.indentUnit : "subtract" == c ? j = i - a.options.indentUnit : "number" == typeof c && (j = i + c), j = Math.max(0, j);
        var l = "", m = 0;
        if (a.options.indentWithTabs)for (var n = Math.floor(j / g); n; --n)m += g, l += "\t";
        if (m < j && (l += Be(j - m)), l != k)return Cc(f, l, Ff(b, 0), Ff(b, k.length), "+input"), h.stateAfter = null, !0;
        for (var n = 0; n < f.sel.ranges.length; n++) {
            var o = f.sel.ranges[n];
            if (o.head.line == b && o.head.ch < k.length) {
                var m = Ff(b, k.length);
                xa(f, n, new ma(m, m));
                break
            }
        }
    }

    function Lc(a, b, c, d) {
        var e = b, f = b;
        return "number" == typeof b ? f = Vd(a, pa(a, b)) : e = Zd(b), null == e ? null : (d(f, e) && a.cm && Jb(a.cm, e, c), f)
    }

    function Mc(a, b) {
        for (var c = a.doc.sel.ranges, d = [], e = 0; e < c.length; e++) {
            for (var f = b(c[e]); d.length && Gf(f.from, Ce(d).to) <= 0;) {
                var g = d.pop();
                if (Gf(g.from, f.from) < 0) {
                    f.from = g.from;
                    break
                }
            }
            d.push(f)
        }
        Cb(a, function () {
            for (var b = d.length - 1; b >= 0; b--)Cc(a.doc, "", d[b].from, d[b].to, "+delete");
            Ic(a)
        })
    }

    function Nc(a, b, c, d, e) {
        function f() {
            var b = h + c;
            return b < a.first || b >= a.first + a.size ? l = !1 : (h = b, k = Vd(a, b))
        }

        function g(a) {
            var b = (e ? hf : jf)(k, i, c, !0);
            if (null == b) {
                if (a || !f())return l = !1;
                i = e ? (c < 0 ? af : _e)(k) : c < 0 ? k.text.length : 0
            } else i = b;
            return !0
        }

        var h = b.line, i = b.ch, j = c, k = Vd(a, h), l = !0;
        if ("char" == d)g(); else if ("column" == d)g(!0); else if ("word" == d || "group" == d)for (var m = null, n = "group" == d, o = a.cm && a.cm.getHelper(b, "wordChars"), p = !0; !(c < 0) || g(!p); p = !1) {
            var q = k.text.charAt(i) || "\n", r = Je(q, o) ? "w" : n && "\n" == q ? "n" : !n || /\s/.test(q) ? null : "p";
            if (!n || p || r || (r = "s"), m && m != r) {
                c < 0 && (c = 1, g());
                break
            }
            if (r && (m = r), c > 0 && !g(!p))break
        }
        var s = Ga(a, Ff(h, i), j, !0);
        return l || (s.hitSide = !0), s
    }

    function Oc(a, b, c, d) {
        var e, f = a.doc, g = b.left;
        if ("page" == d) {
            var h = Math.min(a.display.wrapper.clientHeight, window.innerHeight || document.documentElement.clientHeight);
            e = b.top + c * (h - (c < 0 ? 1.5 : .5) * rb(a.display))
        } else"line" == d && (e = c > 0 ? b.bottom + 3 : b.top - 3);
        for (; ;) {
            var i = pb(a, g, e);
            if (!i.outside)break;
            if (c < 0 ? e <= 0 : e >= f.height) {
                i.hitSide = !0;
                break
            }
            e += 5 * c
        }
        return i
    }

    function Pc(b, c, d, e) {
        a.defaults[b] = c, d && (Wf[b] = e ? function (a, b, c) {
            c != Xf && d(a, b, c)
        } : d)
    }

    function Qc(a) {
        for (var b, c, d, e, f = a.split(/-(?!$)/), a = f[f.length - 1], g = 0; g < f.length - 1; g++) {
            var h = f[g];
            if (/^(cmd|meta|m)$/i.test(h))e = !0; else if (/^a(lt)?$/i.test(h))b = !0; else if (/^(c|ctrl|control)$/i.test(h))c = !0; else {
                if (!/^s(hift)$/i.test(h))throw new Error("Unrecognized modifier name: " + h);
                d = !0
            }
        }
        return b && (a = "Alt-" + a), c && (a = "Ctrl-" + a), e && (a = "Cmd-" + a), d && (a = "Shift-" + a), a
    }

    function Rc(a) {
        return "string" == typeof a ? eg[a] : a
    }

    function Sc(a, b, c, d, e) {
        if (d && d.shared)return Tc(a, b, c, d, e);
        if (a.cm && !a.cm.curOp)return Db(a.cm, Sc)(a, b, c, d, e);
        var f = new kg(a, e), g = Gf(b, c);
        if (d && He(d, f, !1), g > 0 || 0 == g && f.clearWhenEmpty !== !1)return f;
        if (f.replacedWith && (f.collapsed = !0, f.widgetNode = Me("span", [f.replacedWith], "CodeMirror-widget"), d.handleMouseEvents || f.widgetNode.setAttribute("cm-ignore-events", "true"), d.insertLeft && (f.widgetNode.insertLeft = !0)), f.collapsed) {
            if (nd(a, b.line, b, c, f) || b.line != c.line && nd(a, c.line, b, c, f))throw new Error("Inserting collapsed marker partially overlapping an existing one");
            Ef = !0
        }
        f.addToHistory && fe(a, {from: b, to: c, origin: "markText"}, a.sel, NaN);
        var h, i = b.line, j = a.cm;
        if (a.iter(i, c.line + 1, function (a) {
                j && f.collapsed && !j.options.lineWrapping && od(a) == j.display.maxLine && (h = !0), f.collapsed && i != b.line && Yd(a, 0), $c(a, new Xc(f, i == b.line ? b.ch : null, i == c.line ? c.ch : null)), ++i
            }), f.collapsed && a.iter(b.line, c.line + 1, function (b) {
                sd(a, b) && Yd(b, 0)
            }), f.clearOnEnter && xg(f, "beforeCursorEnter", function () {
                f.clear()
            }), f.readOnly && (Df = !0, (a.history.done.length || a.history.undone.length) && a.clearHistory()), f.collapsed && (f.id = ++jg, f.atomic = !0), j) {
            if (h && (j.curOp.updateMaxLine = !0), f.collapsed)Ib(j, b.line, c.line + 1); else if (f.className || f.title || f.startStyle || f.endStyle || f.css)for (var k = b.line; k <= c.line; k++)Jb(j, k, "text");
            f.atomic && Ea(j.doc), te(j, "markerAdded", j, f)
        }
        return f
    }

    function Tc(a, b, c, d, e) {
        d = He(d), d.shared = !1;
        var f = [Sc(a, b, c, d, e)], g = f[0], h = d.widgetNode;
        return Td(a, function (a) {
            h && (d.widgetNode = h.cloneNode(!0)), f.push(Sc(a, qa(a, b), qa(a, c), d, e));
            for (var i = 0; i < a.linked.length; ++i)if (a.linked[i].isParent)return;
            g = Ce(f)
        }), new lg(f, g)
    }

    function Uc(a) {
        return a.findMarks(Ff(a.first, 0), a.clipPos(Ff(a.lastLine())), function (a) {
            return a.parent
        })
    }

    function Vc(a, b) {
        for (var c = 0; c < b.length; c++) {
            var d = b[c], e = d.find(), f = a.clipPos(e.from), g = a.clipPos(e.to);
            if (Gf(f, g)) {
                var h = Sc(a, f, g, d.primary, d.primary.type);
                d.markers.push(h), h.parent = d
            }
        }
    }

    function Wc(a) {
        for (var b = 0; b < a.length; b++) {
            var c = a[b], d = [c.primary.doc];
            Td(c.primary.doc, function (a) {
                d.push(a)
            });
            for (var e = 0; e < c.markers.length; e++) {
                var f = c.markers[e];
                De(d, f.doc) == -1 && (f.parent = null, c.markers.splice(e--, 1))
            }
        }
    }

    function Xc(a, b, c) {
        this.marker = a, this.from = b, this.to = c
    }

    function Yc(a, b) {
        if (a)for (var c = 0; c < a.length; ++c) {
            var d = a[c];
            if (d.marker == b)return d
        }
    }

    function Zc(a, b) {
        for (var c, d = 0; d < a.length; ++d)a[d] != b && (c || (c = [])).push(a[d]);
        return c
    }

    function $c(a, b) {
        a.markedSpans = a.markedSpans ? a.markedSpans.concat([b]) : [b], b.marker.attachLine(a)
    }

    function _c(a, b, c) {
        if (a)for (var d, e = 0; e < a.length; ++e) {
            var f = a[e], g = f.marker, h = null == f.from || (g.inclusiveLeft ? f.from <= b : f.from < b);
            if (h || f.from == b && "bookmark" == g.type && (!c || !f.marker.insertLeft)) {
                var i = null == f.to || (g.inclusiveRight ? f.to >= b : f.to > b);
                (d || (d = [])).push(new Xc(g, f.from, i ? null : f.to))
            }
        }
        return d
    }

    function ad(a, b, c) {
        if (a)for (var d, e = 0; e < a.length; ++e) {
            var f = a[e], g = f.marker, h = null == f.to || (g.inclusiveRight ? f.to >= b : f.to > b);
            if (h || f.from == b && "bookmark" == g.type && (!c || f.marker.insertLeft)) {
                var i = null == f.from || (g.inclusiveLeft ? f.from <= b : f.from < b);
                (d || (d = [])).push(new Xc(g, i ? null : f.from - b, null == f.to ? null : f.to - b))
            }
        }
        return d
    }

    function bd(a, b) {
        if (b.full)return null;
        var c = sa(a, b.from.line) && Vd(a, b.from.line).markedSpans, d = sa(a, b.to.line) && Vd(a, b.to.line).markedSpans;
        if (!c && !d)return null;
        var e = b.from.ch, f = b.to.ch, g = 0 == Gf(b.from, b.to), h = _c(c, e, g), i = ad(d, f, g), j = 1 == b.text.length, k = Ce(b.text).length + (j ? e : 0);
        if (h)for (var l = 0; l < h.length; ++l) {
            var m = h[l];
            if (null == m.to) {
                var n = Yc(i, m.marker);
                n ? j && (m.to = null == n.to ? null : n.to + k) : m.to = e
            }
        }
        if (i)for (var l = 0; l < i.length; ++l) {
            var m = i[l];
            if (null != m.to && (m.to += k), null == m.from) {
                var n = Yc(h, m.marker);
                n || (m.from = k, j && (h || (h = [])).push(m))
            } else m.from += k, j && (h || (h = [])).push(m)
        }
        h && (h = cd(h)), i && i != h && (i = cd(i));
        var o = [h];
        if (!j) {
            var p, q = b.text.length - 2;
            if (q > 0 && h)for (var l = 0; l < h.length; ++l)null == h[l].to && (p || (p = [])).push(new Xc(h[l].marker, null, null));
            for (var l = 0; l < q; ++l)o.push(p);
            o.push(i)
        }
        return o
    }

    function cd(a) {
        for (var b = 0; b < a.length; ++b) {
            var c = a[b];
            null != c.from && c.from == c.to && c.marker.clearWhenEmpty !== !1 && a.splice(b--, 1)
        }
        return a.length ? a : null
    }

    function dd(a, b) {
        var c = le(a, b), d = bd(a, b);
        if (!c)return d;
        if (!d)return c;
        for (var e = 0; e < c.length; ++e) {
            var f = c[e], g = d[e];
            if (f && g)a:for (var h = 0; h < g.length; ++h) {
                for (var i = g[h], j = 0; j < f.length; ++j)if (f[j].marker == i.marker)continue a;
                f.push(i)
            } else g && (c[e] = g)
        }
        return c
    }

    function ed(a, b, c) {
        var d = null;
        if (a.iter(b.line, c.line + 1, function (a) {
                if (a.markedSpans)for (var b = 0; b < a.markedSpans.length; ++b) {
                    var c = a.markedSpans[b].marker;
                    !c.readOnly || d && De(d, c) != -1 || (d || (d = [])).push(c)
                }
            }), !d)return null;
        for (var e = [{
            from: b,
            to: c
        }], f = 0; f < d.length; ++f)for (var g = d[f], h = g.find(0), i = 0; i < e.length; ++i) {
            var j = e[i];
            if (!(Gf(j.to, h.from) < 0 || Gf(j.from, h.to) > 0)) {
                var k = [i, 1], l = Gf(j.from, h.from), m = Gf(j.to, h.to);
                (l < 0 || !g.inclusiveLeft && !l) && k.push({
                    from: j.from,
                    to: h.from
                }), (m > 0 || !g.inclusiveRight && !m) && k.push({
                    from: h.to,
                    to: j.to
                }), e.splice.apply(e, k), i += k.length - 1
            }
        }
        return e
    }

    function fd(a) {
        var b = a.markedSpans;
        if (b) {
            for (var c = 0; c < b.length; ++c)b[c].marker.detachLine(a);
            a.markedSpans = null
        }
    }

    function gd(a, b) {
        if (b) {
            for (var c = 0; c < b.length; ++c)b[c].marker.attachLine(a);
            a.markedSpans = b
        }
    }

    function hd(a) {
        return a.inclusiveLeft ? -1 : 0
    }

    function id(a) {
        return a.inclusiveRight ? 1 : 0
    }

    function jd(a, b) {
        var c = a.lines.length - b.lines.length;
        if (0 != c)return c;
        var d = a.find(), e = b.find(), f = Gf(d.from, e.from) || hd(a) - hd(b);
        if (f)return -f;
        var g = Gf(d.to, e.to) || id(a) - id(b);
        return g ? g : b.id - a.id
    }

    function kd(a, b) {
        var c, d = Ef && a.markedSpans;
        if (d)for (var e, f = 0; f < d.length; ++f)e = d[f], e.marker.collapsed && null == (b ? e.from : e.to) && (!c || jd(c, e.marker) < 0) && (c = e.marker);
        return c
    }

    function ld(a) {
        return kd(a, !0)
    }

    function md(a) {
        return kd(a, !1)
    }

    function nd(a, b, c, d, e) {
        var f = Vd(a, b), g = Ef && f.markedSpans;
        if (g)for (var h = 0; h < g.length; ++h) {
            var i = g[h];
            if (i.marker.collapsed) {
                var j = i.marker.find(0), k = Gf(j.from, c) || hd(i.marker) - hd(e), l = Gf(j.to, d) || id(i.marker) - id(e);
                if (!(k >= 0 && l <= 0 || k <= 0 && l >= 0) && (k <= 0 && (Gf(j.to, c) > 0 || i.marker.inclusiveRight && e.inclusiveLeft) || k >= 0 && (Gf(j.from, d) < 0 || i.marker.inclusiveLeft && e.inclusiveRight)))return !0
            }
        }
    }

    function od(a) {
        for (var b; b = ld(a);)a = b.find(-1, !0).line;
        return a
    }

    function pd(a) {
        for (var b, c; b = md(a);)a = b.find(1, !0).line, (c || (c = [])).push(a);
        return c
    }

    function qd(a, b) {
        var c = Vd(a, b), d = od(c);
        return c == d ? b : Zd(d)
    }

    function rd(a, b) {
        if (b > a.lastLine())return b;
        var c, d = Vd(a, b);
        if (!sd(a, d))return b;
        for (; c = md(d);)d = c.find(1, !0).line;
        return Zd(d) + 1
    }

    function sd(a, b) {
        var c = Ef && b.markedSpans;
        if (c)for (var d, e = 0; e < c.length; ++e)if (d = c[e], d.marker.collapsed) {
            if (null == d.from)return !0;
            if (!d.marker.widgetNode && 0 == d.from && d.marker.inclusiveLeft && td(a, b, d))return !0
        }
    }

    function td(a, b, c) {
        if (null == c.to) {
            var d = c.marker.find(1, !0);
            return td(a, d.line, Yc(d.line.markedSpans, c.marker))
        }
        if (c.marker.inclusiveRight && c.to == b.text.length)return !0;
        for (var e, f = 0; f < b.markedSpans.length; ++f)if (e = b.markedSpans[f], e.marker.collapsed && !e.marker.widgetNode && e.from == c.to && (null == e.to || e.to != c.from) && (e.marker.inclusiveLeft || c.marker.inclusiveRight) && td(a, b, e))return !0
    }

    function ud(a, b, c) {
        _d(b) < (a.curOp && a.curOp.scrollTop || a.doc.scrollTop) && Hc(a, null, c)
    }

    function vd(a) {
        if (null != a.height)return a.height;
        var b = a.doc.cm;
        if (!b)return 0;
        if (!Ng(document.body, a.node)) {
            var c = "position: relative;";
            a.coverGutter && (c += "margin-left: -" + b.display.gutters.offsetWidth + "px;"), a.noHScroll && (c += "width: " + b.display.wrapper.clientWidth + "px;"), Oe(b.display.measure, Me("div", [a.node], null, c))
        }
        return a.height = a.node.offsetHeight
    }

    function wd(a, b, c, d) {
        var e = new mg(a, c, d), f = a.cm;
        return f && e.noHScroll && (f.display.alignWidgets = !0), Lc(a, b, "widget", function (b) {
            var c = b.widgets || (b.widgets = []);
            if (null == e.insertAt ? c.push(e) : c.splice(Math.min(c.length - 1, Math.max(0, e.insertAt)), 0, e), e.line = b, f && !sd(a, b)) {
                var d = _d(b) < a.scrollTop;
                Yd(b, b.height + vd(e)), d && Hc(f, null, e.height), f.curOp.forceUpdate = !0
            }
            return !0
        }), e
    }

    function xd(a, b, c, d) {
        a.text = b, a.stateAfter && (a.stateAfter = null), a.styles && (a.styles = null), null != a.order && (a.order = null), fd(a), gd(a, c);
        var e = d ? d(a) : 1;
        e != a.height && Yd(a, e)
    }

    function yd(a) {
        a.parent = null, fd(a)
    }

    function zd(a, b) {
        if (a)for (; ;) {
            var c = a.match(/(?:^|\s+)line-(background-)?(\S+)/);
            if (!c)break;
            a = a.slice(0, c.index) + a.slice(c.index + c[0].length);
            var d = c[1] ? "bgClass" : "textClass";
            null == b[d] ? b[d] = c[2] : new RegExp("(?:^|s)" + c[2] + "(?:$|s)").test(b[d]) || (b[d] += " " + c[2])
        }
        return a
    }

    function Ad(b, c) {
        if (b.blankLine)return b.blankLine(c);
        if (b.innerMode) {
            var d = a.innerMode(b, c);
            return d.mode.blankLine ? d.mode.blankLine(d.state) : void 0
        }
    }

    function Bd(b, c, d, e) {
        for (var f = 0; f < 10; f++) {
            e && (e[0] = a.innerMode(b, d).mode);
            var g = b.token(c, d);
            if (c.pos > c.start)return g
        }
        throw new Error("Mode " + b.name + " failed to advance stream.")
    }

    function Cd(a, b, c, d) {
        function e(a) {
            return {start: l.start, end: l.pos, string: l.current(), type: f || null, state: a ? bg(g.mode, k) : k}
        }

        var f, g = a.doc, h = g.mode;
        b = qa(g, b);
        var i, j = Vd(g, b.line), k = Pa(a, b.line, c), l = new ig(j.text, a.options.tabSize);
        for (d && (i = []); (d || l.pos < b.ch) && !l.eol();)l.start = l.pos, f = Bd(h, l, k), d && i.push(e(!0));
        return d ? i : e()
    }

    function Dd(a, b, c, d, e, f, g) {
        var h = c.flattenSpans;
        null == h && (h = a.options.flattenSpans);
        var i, j = 0, k = null, l = new ig(b, a.options.tabSize), m = a.options.addModeClass && [null];
        for ("" == b && zd(Ad(c, d), f); !l.eol();) {
            if (l.pos > a.options.maxHighlightLength ? (h = !1, g && Gd(a, b, d, l.pos), l.pos = b.length, i = null) : i = zd(Bd(c, l, d, m), f), m) {
                var n = m[0].name;
                n && (i = "m-" + (i ? n + " " + i : n))
            }
            if (!h || k != i) {
                for (; j < l.start;)j = Math.min(l.start, j + 5e4), e(j, k);
                k = i
            }
            l.start = l.pos
        }
        for (; j < l.pos;) {
            var o = Math.min(l.pos, j + 5e4);
            e(o, k), j = o
        }
    }

    function Ed(a, b, c, d) {
        var e = [a.state.modeGen], f = {};
        Dd(a, b.text, a.doc.mode, c, function (a, b) {
            e.push(a, b)
        }, f, d);
        for (var g = 0; g < a.state.overlays.length; ++g) {
            var h = a.state.overlays[g], i = 1, j = 0;
            Dd(a, b.text, h.mode, !0, function (a, b) {
                for (var c = i; j < a;) {
                    var d = e[i];
                    d > a && e.splice(i, 1, a, e[i + 1], d), i += 2, j = Math.min(a, d)
                }
                if (b)if (h.opaque)e.splice(c, i - c, a, "cm-overlay " + b), i = c + 2; else for (; c < i; c += 2) {
                    var f = e[c + 1];
                    e[c + 1] = (f ? f + " " : "") + "cm-overlay " + b
                }
            }, f)
        }
        return {styles: e, classes: f.bgClass || f.textClass ? f : null}
    }

    function Fd(a, b, c) {
        if (!b.styles || b.styles[0] != a.state.modeGen) {
            var d = Ed(a, b, b.stateAfter = Pa(a, Zd(b)));
            b.styles = d.styles, d.classes ? b.styleClasses = d.classes : b.styleClasses && (b.styleClasses = null), c === a.doc.frontier && a.doc.frontier++
        }
        return b.styles
    }

    function Gd(a, b, c, d) {
        var e = a.doc.mode, f = new ig(b, a.options.tabSize);
        for (f.start = f.pos = d || 0, "" == b && Ad(e, c); !f.eol() && f.pos <= a.options.maxHighlightLength;)Bd(e, f, c), f.start = f.pos
    }

    function Hd(a, b) {
        if (!a || /^\s*$/.test(a))return null;
        var c = b.addModeClass ? pg : og;
        return c[a] || (c[a] = a.replace(/\S+/g, "cm-$&"))
    }

    function Id(a, b) {
        var c = Me("span", null, "CodeMirror-line-content", pf ? "padding-right: .1px" : null), d = {
            pre: Me("pre", [c], "CodeMirror-line"),
            content: c,
            col: 0,
            pos: 0,
            cm: a,
            splitSpaces: (nf || pf) && a.getOption("lineWrapping")
        };
        b.measure = {};
        for (var e = 0; e <= (b.rest ? b.rest.length : 0); e++) {
            var f, g = e ? b.rest[e - 1] : b.line;
            d.pos = 0, d.addToken = Kd, We(a.display.measure) && (f = ae(g)) && (d.addToken = Md(d.addToken, f)), d.map = [];
            var h = b != a.display.externalMeasured && Zd(g);
            Od(g, d, Fd(a, g, h)), g.styleClasses && (g.styleClasses.bgClass && (d.bgClass = Re(g.styleClasses.bgClass, d.bgClass || "")), g.styleClasses.textClass && (d.textClass = Re(g.styleClasses.textClass, d.textClass || ""))), 0 == d.map.length && d.map.push(0, 0, d.content.appendChild(Ve(a.display.measure))), 0 == e ? (b.measure.map = d.map, b.measure.cache = {}) : ((b.measure.maps || (b.measure.maps = [])).push(d.map), (b.measure.caches || (b.measure.caches = [])).push({}))
        }
        return pf && /\bcm-tab\b/.test(d.content.lastChild.className) && (d.content.className = "cm-tab-wrap-hack"), zg(a, "renderLine", a, b.line, d.pre), d.pre.className && (d.textClass = Re(d.pre.className, d.textClass || "")), d
    }

    function Jd(a) {
        var b = Me("span", "•", "cm-invalidchar");
        return b.title = "\\u" + a.charCodeAt(0).toString(16), b.setAttribute("aria-label", b.title), b
    }

    function Kd(a, b, c, d, e, f, g, h) {
        if (b) {
            var i = a.splitSpaces ? b.replace(/ {3,}/g, Ld) : b, j = a.cm.state.specialChars, k = !1;
            if (j.test(b))for (var l = document.createDocumentFragment(), m = 0; ;) {
                j.lastIndex = m;
                var n = j.exec(b), o = n ? n.index - m : b.length - m;
                if (o) {
                    var p = document.createTextNode(i.slice(m, m + o));
                    nf && of < 9 ? l.appendChild(Me("span", [p])) : l.appendChild(p), a.map.push(a.pos, a.pos + o, p), a.col += o, a.pos += o
                }
                if (!n)break;
                if (m += o + 1, "\t" == n[0]) {
                    var q = a.cm.options.tabSize, r = q - a.col % q, p = l.appendChild(Me("span", Be(r), "cm-tab"));
                    p.setAttribute("role", "presentation"), p.setAttribute("cm-text", "\t"), a.col += r
                } else {
                    var p = a.cm.options.specialCharPlaceholder(n[0]);
                    p.setAttribute("cm-text", n[0]), nf && of < 9 ? l.appendChild(Me("span", [p])) : l.appendChild(p), a.col += 1
                }
                a.map.push(a.pos, a.pos + 1, p), a.pos++
            } else {
                a.col += b.length;
                var l = document.createTextNode(i);
                a.map.push(a.pos, a.pos + b.length, l), nf && of < 9 && (k = !0), a.pos += b.length
            }
            if (c || d || e || k || g || h) {
                var s = c || "";
                d && (s += d), e && (s += e);
                var t = Me("span", [l], s, g, h);
                return f && (t.title = f), a.content.appendChild(t)
            }
            a.content.appendChild(l)
        }
    }

    function Ld(a) {
        for (var b = " ", c = 0; c < a.length - 2; ++c)b += c % 2 ? " " : " ";
        return b += " "
    }

    function Md(a, b) {
        return function (c, d, e, f, g, h, i) {
            e = e ? e + " cm-force-border" : "cm-force-border";
            for (var j = c.pos, k = j + d.length; ;) {
                for (var l = 0; l < b.length; l++) {
                    var m = b[l];
                    if (m.to > j && m.from <= j)break
                }
                if (m.to >= k)return a(c, d, e, f, g, h, i);
                a(c, d.slice(0, m.to - j), e, f, null, h, i), f = null, d = d.slice(m.to - j), j = m.to
            }
        }
    }

    function Nd(a, b, c, d) {
        var e = !d && c.widgetNode;
        e && a.map.push(a.pos, a.pos + b, e), !d && a.cm.display.input.needsContentAttribute && (e || (e = a.content.appendChild(document.createElement("span"))), e.setAttribute("cm-marker", c.id)), e && (a.cm.display.input.setUneditable(e), a.content.appendChild(e)), a.pos += b
    }

    function Od(a, b, c) {
        var d = a.markedSpans, e = a.text, f = 0;
        if (d)for (var g, h, i, j, k, l, m, n, o = e.length, p = 0, q = 1, r = "", s = 0; ;) {
            if (s == p) {
                j = k = l = m = h = "", i = null, n = null, s = 1 / 0;
                for (var t = [], u = 0; u < d.length; ++u) {
                    var v = d[u], w = v.marker;
                    "bookmark" == w.type && v.from == p && w.widgetNode ? t.push(w) : v.from <= p && (null == v.to || v.to > p || w.collapsed && v.to == p && v.from == p) ? (null != v.to && v.to != p && s > v.to && (s = v.to, k = ""), w.className && (j += " " + w.className), w.attr && (i = w.attr), w.css && (h = w.css), w.startStyle && v.from == p && (l += " " + w.startStyle), w.endStyle && v.to == s && (k += " " + w.endStyle), w.title && !m && (m = w.title), w.collapsed && (!n || jd(n.marker, w) < 0) && (n = v)) : v.from > p && s > v.from && (s = v.from)
                }
                if (n && (n.from || 0) == p) {
                    if (Nd(b, (null == n.to ? o + 1 : n.to) - p, n.marker, null == n.from), null == n.to)return;
                    n.to == p && (n = !1)
                }
                if (!n && t.length)for (var u = 0; u < t.length; ++u)Nd(b, 0, t[u])
            }
            if (p >= o)break;
            for (var x = Math.min(o, s); ;) {
                if (r) {
                    var y = p + r.length;
                    if (!n) {
                        var z = y > x ? r.slice(0, x - p) : r;
                        b.addToken(b, z, g ? g + j : j, l, p + z.length == s ? k : "", m, h, i)
                    }
                    if (y >= x) {
                        r = r.slice(x - p), p = x;
                        break
                    }
                    p = y, l = ""
                }
                r = e.slice(f, f = c[q++]), g = Hd(c[q++], b.cm.options)
            }
        } else for (var q = 1; q < c.length; q += 2)b.addToken(b, e.slice(f, f = c[q]), Hd(c[q + 1], b.cm.options))
    }

    function Pd(a, b) {
        return 0 == b.from.ch && 0 == b.to.ch && "" == Ce(b.text) && (!a.cm || a.cm.options.wholeLineUpdateBefore)
    }

    function Qd(a, b, c, d) {
        function e(a) {
            return c ? c[a] : null
        }

        function f(a, c, e) {
            xd(a, c, e, d), te(a, "change", a, b)
        }

        function g(a, b) {
            for (var c = a, f = []; c < b; ++c)f.push(new ng(j[c], e(c), d));
            return f
        }

        var h = b.from, i = b.to, j = b.text, k = Vd(a, h.line), l = Vd(a, i.line), m = Ce(j), n = e(j.length - 1), o = i.line - h.line;
        if (b.full)a.insert(0, g(0, j.length)), a.remove(j.length, a.size - j.length); else if (Pd(a, b)) {
            var p = g(0, j.length - 1);
            f(l, l.text, n), o && a.remove(h.line, o), p.length && a.insert(h.line, p)
        } else if (k == l)if (1 == j.length)f(k, k.text.slice(0, h.ch) + m + k.text.slice(i.ch), n); else {
            var p = g(1, j.length - 1);
            p.push(new ng(m + k.text.slice(i.ch), n, d)), f(k, k.text.slice(0, h.ch) + j[0], e(0)), a.insert(h.line + 1, p)
        } else if (1 == j.length)f(k, k.text.slice(0, h.ch) + j[0] + l.text.slice(i.ch), e(0)), a.remove(h.line + 1, o); else {
            f(k, k.text.slice(0, h.ch) + j[0], e(0)), f(l, m + l.text.slice(i.ch), n);
            var p = g(1, j.length - 1);
            o > 1 && a.remove(h.line + 1, o - 1), a.insert(h.line + 1, p)
        }
        te(a, "change", a, b)
    }

    function Rd(a) {
        this.lines = a, this.parent = null;
        for (var b = 0, c = 0; b < a.length; ++b)a[b].parent = this, c += a[b].height;
        this.height = c
    }

    function Sd(a) {
        this.children = a;
        for (var b = 0, c = 0, d = 0; d < a.length; ++d) {
            var e = a[d];
            b += e.chunkSize(), c += e.height, e.parent = this
        }
        this.size = b, this.height = c, this.parent = null
    }

    function Td(a, b, c) {
        function d(a, e, f) {
            if (a.linked)for (var g = 0; g < a.linked.length; ++g) {
                var h = a.linked[g];
                if (h.doc != e) {
                    var i = f && h.sharedHist;
                    c && !i || (b(h.doc, i), d(h.doc, a, i))
                }
            }
        }

        d(a, null, !0)
    }

    function Ud(a, b) {
        if (b.cm)throw new Error("This document is already in use.");
        a.doc = b, b.cm = a, g(a), c(a), a.options.lineWrapping || m(a), a.options.mode = b.modeOption, Ib(a)
    }

    function Vd(a, b) {
        if (b -= a.first, b < 0 || b >= a.size)throw new Error("There is no line " + (b + a.first) + " in the document.");
        for (var c = a; !c.lines;)for (var d = 0; ; ++d) {
            var e = c.children[d], f = e.chunkSize();
            if (b < f) {
                c = e;
                break
            }
            b -= f
        }
        return c.lines[b]
    }

    function Wd(a, b, c) {
        var d = [], e = b.line;
        return a.iter(b.line, c.line + 1, function (a) {
            var f = a.text;
            e == c.line && (f = f.slice(0, c.ch)), e == b.line && (f = f.slice(b.ch)), d.push(f), ++e
        }), d
    }

    function Xd(a, b, c) {
        var d = [];
        return a.iter(b, c, function (a) {
            d.push(a.text)
        }), d
    }

    function Yd(a, b) {
        var c = b - a.height;
        if (c)for (var d = a; d; d = d.parent)d.height += c
    }

    function Zd(a) {
        if (null == a.parent)return null;
        for (var b = a.parent, c = De(b.lines, a), d = b.parent; d; b = d, d = d.parent)for (var e = 0; d.children[e] != b; ++e)c += d.children[e].chunkSize();
        return c + b.first
    }

    function $d(a, b) {
        var c = a.first;
        a:do {
            for (var d = 0; d < a.children.length; ++d) {
                var e = a.children[d], f = e.height;
                if (b < f) {
                    a = e;
                    continue a
                }
                b -= f, c += e.chunkSize()
            }
            return c
        } while (!a.lines);
        for (var d = 0; d < a.lines.length; ++d) {
            var g = a.lines[d], h = g.height;
            if (b < h)break;
            b -= h
        }
        return c + d
    }

    function _d(a) {
        a = od(a);
        for (var b = 0, c = a.parent, d = 0; d < c.lines.length; ++d) {
            var e = c.lines[d];
            if (e == a)break;
            b += e.height
        }
        for (var f = c.parent; f; c = f, f = c.parent)for (var d = 0; d < f.children.length; ++d) {
            var g = f.children[d];
            if (g == c)break;
            b += g.height
        }
        return b
    }

    function ae(a) {
        var b = a.order;
        return null == b && (b = a.order = $g(a.text)), b
    }

    function be(a) {
        this.done = [], this.undone = [], this.undoDepth = 1 / 0, this.lastModTime = this.lastSelTime = 0, this.lastOp = this.lastSelOp = null, this.lastOrigin = this.lastSelOrigin = null, this.generation = this.maxGeneration = a || 1
    }

    function ce(a, b) {
        var c = {from: V(b.from), to: Uf(b), text: Wd(a, b.from, b.to)};
        return je(a, c, b.from.line, b.to.line + 1), Td(a, function (a) {
            je(a, c, b.from.line, b.to.line + 1)
        }, !0), c
    }

    function de(a) {
        for (; a.length;) {
            var b = Ce(a);
            if (!b.ranges)break;
            a.pop()
        }
    }

    function ee(a, b) {
        return b ? (de(a.done), Ce(a.done)) : a.done.length && !Ce(a.done).ranges ? Ce(a.done) : a.done.length > 1 && !a.done[a.done.length - 2].ranges ? (a.done.pop(), Ce(a.done)) : void 0
    }

    function fe(a, b, c, d) {
        var e = a.history;
        e.undone.length = 0;
        var f, g = +new Date;
        if ((e.lastOp == d || e.lastOrigin == b.origin && b.origin && ("+" == b.origin.charAt(0) && a.cm && e.lastModTime > g - a.cm.options.historyEventDelay || "*" == b.origin.charAt(0))) && (f = ee(e, e.lastOp == d))) {
            var h = Ce(f.changes);
            0 == Gf(b.from, b.to) && 0 == Gf(b.from, h.to) ? h.to = Uf(b) : f.changes.push(ce(a, b));
        } else {
            var i = Ce(e.done);
            for (i && i.ranges || ie(a.sel, e.done), f = {
                changes: [ce(a, b)],
                generation: e.generation
            }, e.done.push(f); e.done.length > e.undoDepth;)e.done.shift(), e.done[0].ranges || e.done.shift()
        }
        e.done.push(c), e.generation = ++e.maxGeneration, e.lastModTime = e.lastSelTime = g, e.lastOp = e.lastSelOp = d, e.lastOrigin = e.lastSelOrigin = b.origin, h || zg(a, "historyAdded")
    }

    function ge(a, b, c, d) {
        var e = b.charAt(0);
        return "*" == e || "+" == e && c.ranges.length == d.ranges.length && c.somethingSelected() == d.somethingSelected() && new Date - a.history.lastSelTime <= (a.cm ? a.cm.options.historyEventDelay : 500)
    }

    function he(a, b, c, d) {
        var e = a.history, f = d && d.origin;
        c == e.lastSelOp || f && e.lastSelOrigin == f && (e.lastModTime == e.lastSelTime && e.lastOrigin == f || ge(a, f, Ce(e.done), b)) ? e.done[e.done.length - 1] = b : ie(b, e.done), e.lastSelTime = +new Date, e.lastSelOrigin = f, e.lastSelOp = c, d && d.clearRedo !== !1 && de(e.undone)
    }

    function ie(a, b) {
        var c = Ce(b);
        c && c.ranges && c.equals(a) || b.push(a)
    }

    function je(a, b, c, d) {
        var e = b["spans_" + a.id], f = 0;
        a.iter(Math.max(a.first, c), Math.min(a.first + a.size, d), function (c) {
            c.markedSpans && ((e || (e = b["spans_" + a.id] = {}))[f] = c.markedSpans), ++f
        })
    }

    function ke(a) {
        if (!a)return null;
        for (var b, c = 0; c < a.length; ++c)a[c].marker.explicitlyCleared ? b || (b = a.slice(0, c)) : b && b.push(a[c]);
        return b ? b.length ? b : null : a
    }

    function le(a, b) {
        var c = b["spans_" + a.id];
        if (!c)return null;
        for (var d = 0, e = []; d < b.text.length; ++d)e.push(ke(c[d]));
        return e
    }

    function me(a, b, c) {
        for (var d = 0, e = []; d < a.length; ++d) {
            var f = a[d];
            if (f.ranges)e.push(c ? la.prototype.deepCopy.call(f) : f); else {
                var g = f.changes, h = [];
                e.push({changes: h});
                for (var i = 0; i < g.length; ++i) {
                    var j, k = g[i];
                    if (h.push({
                            from: k.from,
                            to: k.to,
                            text: k.text
                        }), b)for (var l in k)(j = l.match(/^spans_(\d+)$/)) && De(b, Number(j[1])) > -1 && (Ce(h)[l] = k[l], delete k[l])
                }
            }
        }
        return e
    }

    function ne(a, b, c, d) {
        c < a.line ? a.line += d : b < a.line && (a.line = b, a.ch = 0)
    }

    function oe(a, b, c, d) {
        for (var e = 0; e < a.length; ++e) {
            var f = a[e], g = !0;
            if (f.ranges) {
                f.copied || (f = a[e] = f.deepCopy(), f.copied = !0);
                for (var h = 0; h < f.ranges.length; h++)ne(f.ranges[h].anchor, b, c, d), ne(f.ranges[h].head, b, c, d)
            } else {
                for (var h = 0; h < f.changes.length; ++h) {
                    var i = f.changes[h];
                    if (c < i.from.line)i.from = Ff(i.from.line + d, i.from.ch), i.to = Ff(i.to.line + d, i.to.ch); else if (b <= i.to.line) {
                        g = !1;
                        break
                    }
                }
                g || (a.splice(0, e + 1), e = 0)
            }
        }
    }

    function pe(a, b) {
        var c = b.from.line, d = b.to.line, e = b.text.length - (d - c) - 1;
        oe(a.done, c, d, e), oe(a.undone, c, d, e)
    }

    function qe(a) {
        return null != a.defaultPrevented ? a.defaultPrevented : 0 == a.returnValue
    }

    function re(a) {
        return a.target || a.srcElement
    }

    function se(a) {
        var b = a.which;
        return null == b && (1 & a.button ? b = 1 : 2 & a.button ? b = 3 : 4 & a.button && (b = 2)), yf && a.ctrlKey && 1 == b && (b = 3), b
    }

    function te(a, b) {
        function c(a) {
            return function () {
                a.apply(null, f)
            }
        }

        var d = a._handlers && a._handlers[b];
        if (d) {
            var e, f = Array.prototype.slice.call(arguments, 2);
            Mf ? e = Mf.delayedCallbacks : Ag ? e = Ag : (e = Ag = [], setTimeout(ue, 0));
            for (var g = 0; g < d.length; ++g)e.push(c(d[g]))
        }
    }

    function ue() {
        var a = Ag;
        Ag = null;
        for (var b = 0; b < a.length; ++b)a[b]()
    }

    function ve(a, b, c) {
        return "string" == typeof b && (b = {
            type: b, preventDefault: function () {
                this.defaultPrevented = !0
            }
        }), zg(a, c || b.type, a, b), qe(b) || b.codemirrorIgnore
    }

    function we(a) {
        var b = a._handlers && a._handlers.cursorActivity;
        if (b)for (var c = a.curOp.cursorActivityHandlers || (a.curOp.cursorActivityHandlers = []), d = 0; d < b.length; ++d)De(c, b[d]) == -1 && c.push(b[d])
    }

    function xe(a, b) {
        var c = a._handlers && a._handlers[b];
        return c && c.length > 0
    }

    function ye(a) {
        a.prototype.on = function (a, b) {
            xg(this, a, b)
        }, a.prototype.off = function (a, b) {
            yg(this, a, b)
        }
    }

    function ze() {
        this.id = null
    }

    function Ae(a, b, c) {
        for (var d = 0, e = 0; ;) {
            var f = a.indexOf("\t", d);
            f == -1 && (f = a.length);
            var g = f - d;
            if (f == a.length || e + g >= b)return d + Math.min(g, b - e);
            if (e += f - d, e += c - e % c, d = f + 1, e >= b)return d
        }
    }

    function Be(a) {
        for (; Hg.length <= a;)Hg.push(Ce(Hg) + " ");
        return Hg[a]
    }

    function Ce(a) {
        return a[a.length - 1]
    }

    function De(a, b) {
        for (var c = 0; c < a.length; ++c)if (a[c] == b)return c;
        return -1
    }

    function Ee(a, b) {
        for (var c = [], d = 0; d < a.length; d++)c[d] = b(a[d], d);
        return c
    }

    function Fe() {
    }

    function Ge(a, b) {
        var c;
        return Object.create ? c = Object.create(a) : (Fe.prototype = a, c = new Fe), b && He(b, c), c
    }

    function He(a, b, c) {
        b || (b = {});
        for (var d in a)!a.hasOwnProperty(d) || c === !1 && b.hasOwnProperty(d) || (b[d] = a[d]);
        return b
    }

    function Ie(a) {
        var b = Array.prototype.slice.call(arguments, 1);
        return function () {
            return a.apply(null, b)
        }
    }

    function Je(a, b) {
        return b ? !!(b.source.indexOf("\\w") > -1 && Lg(a)) || b.test(a) : Lg(a)
    }

    function Ke(a) {
        for (var b in a)if (a.hasOwnProperty(b) && a[b])return !1;
        return !0
    }

    function Le(a) {
        return a.charCodeAt(0) >= 768 && Mg.test(a)
    }

    function Me(a, b, c, d, e) {
        var f = document.createElement(a);
        if (c && (f.className = c), d && (f.style.cssText = d), "string" == typeof b)f.appendChild(document.createTextNode(b)); else if (b)for (var g = 0; g < b.length; ++g)f.appendChild(b[g]);
        if (e)for (var h in e)f.setAttribute(h, e[h]);
        return f
    }

    function Ne(a) {
        for (var b = a.childNodes.length; b > 0; --b)a.removeChild(a.firstChild);
        return a
    }

    function Oe(a, b) {
        return Ne(a).appendChild(b)
    }

    function Pe() {
        return document.activeElement
    }

    function Qe(a) {
        return new RegExp("(^|\\s)" + a + "(?:$|\\s)\\s*")
    }

    function Re(a, b) {
        for (var c = a.split(" "), d = 0; d < c.length; d++)c[d] && !Qe(c[d]).test(b) && (b += " " + c[d]);
        return b
    }

    function Se(a) {
        if (document.body.getElementsByClassName)for (var b = document.body.getElementsByClassName("CodeMirror"), c = 0; c < b.length; c++) {
            var d = b[c].CodeMirror;
            d && a(d)
        }
    }

    function Te() {
        Sg || (Ue(), Sg = !0)
    }

    function Ue() {
        var a;
        xg(window, "resize", function () {
            null == a && (a = setTimeout(function () {
                a = null, Se(Rb)
            }, 100))
        }), xg(window, "blur", function () {
            Se(oc)
        })
    }

    function Ve(a) {
        if (null == Og) {
            var b = Me("span", "​");
            Oe(a, Me("span", [b, document.createTextNode("x")])), 0 != a.firstChild.offsetHeight && (Og = b.offsetWidth <= 1 && b.offsetHeight > 2 && !(nf && of < 8))
        }
        var c = Og ? Me("span", "​") : Me("span", " ", null, "display: inline-block; width: 1px; margin-right: -1px");
        return c.setAttribute("cm-text", ""), c
    }

    function We(a) {
        if (null != Pg)return Pg;
        var b = Oe(a, document.createTextNode("AخA")), c = Jg(b, 0, 1).getBoundingClientRect();
        if (!c || c.left == c.right)return !1;
        var d = Jg(b, 1, 2).getBoundingClientRect();
        return Pg = d.right - c.right < 3
    }

    function Xe(a) {
        if (null != Xg)return Xg;
        var b = Oe(a, Me("span", "x")), c = b.getBoundingClientRect(), d = Jg(b, 0, 1).getBoundingClientRect();
        return Xg = Math.abs(c.left - d.left) > 1
    }

    function Ye(a, b, c, d) {
        if (!a)return d(b, c, "ltr");
        for (var e = !1, f = 0; f < a.length; ++f) {
            var g = a[f];
            (g.from < c && g.to > b || b == c && g.to == b) && (d(Math.max(g.from, b), Math.min(g.to, c), 1 == g.level ? "rtl" : "ltr"), e = !0)
        }
        e || d(b, c, "ltr")
    }

    function Ze(a) {
        return a.level % 2 ? a.to : a.from
    }

    function $e(a) {
        return a.level % 2 ? a.from : a.to
    }

    function _e(a) {
        var b = ae(a);
        return b ? Ze(b[0]) : 0
    }

    function af(a) {
        var b = ae(a);
        return b ? $e(Ce(b)) : a.text.length
    }

    function bf(a, b) {
        var c = Vd(a.doc, b), d = od(c);
        d != c && (b = Zd(d));
        var e = ae(d), f = e ? e[0].level % 2 ? af(d) : _e(d) : 0;
        return Ff(b, f)
    }

    function cf(a, b) {
        for (var c, d = Vd(a.doc, b); c = md(d);)d = c.find(1, !0).line, b = null;
        var e = ae(d), f = e ? e[0].level % 2 ? _e(d) : af(d) : d.text.length;
        return Ff(null == b ? Zd(d) : b, f)
    }

    function df(a, b) {
        var c = bf(a, b.line), d = Vd(a.doc, c.line), e = ae(d);
        if (!e || 0 == e[0].level) {
            var f = Math.max(0, d.text.search(/\S/)), g = b.line == c.line && b.ch <= f && b.ch;
            return Ff(c.line, g ? 0 : f)
        }
        return c
    }

    function ef(a, b, c) {
        var d = a[0].level;
        return b == d || c != d && b < c
    }

    function ff(a, b) {
        Zg = null;
        for (var c, d = 0; d < a.length; ++d) {
            var e = a[d];
            if (e.from < b && e.to > b)return d;
            if (e.from == b || e.to == b) {
                if (null != c)return ef(a, e.level, a[c].level) ? (e.from != e.to && (Zg = c), d) : (e.from != e.to && (Zg = d), c);
                c = d
            }
        }
        return c
    }

    function gf(a, b, c, d) {
        if (!d)return b + c;
        do b += c; while (b > 0 && Le(a.text.charAt(b)));
        return b
    }

    function hf(a, b, c, d) {
        var e = ae(a);
        if (!e)return jf(a, b, c, d);
        for (var f = ff(e, b), g = e[f], h = gf(a, b, g.level % 2 ? -c : c, d); ;) {
            if (h > g.from && h < g.to)return h;
            if (h == g.from || h == g.to)return ff(e, h) == f ? h : (g = e[f += c], c > 0 == g.level % 2 ? g.to : g.from);
            if (g = e[f += c], !g)return null;
            h = c > 0 == g.level % 2 ? gf(a, g.to, -1, d) : gf(a, g.from, 1, d)
        }
    }

    function jf(a, b, c, d) {
        var e = b + c;
        if (d)for (; e > 0 && Le(a.text.charAt(e));)e += c;
        return e < 0 || e > a.text.length ? null : e
    }

    var kf = /gecko\/\d/i.test(navigator.userAgent), lf = /MSIE \d/.test(navigator.userAgent), mf = /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent), nf = lf || mf, of = nf && (lf ? document.documentMode || 6 : mf[1]), pf = /WebKit\//.test(navigator.userAgent), qf = pf && /Qt\/\d+\.\d+/.test(navigator.userAgent), rf = /Chrome\//.test(navigator.userAgent), sf = /Opera\//.test(navigator.userAgent), tf = /Apple Computer/.test(navigator.vendor), uf = /Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent), vf = /PhantomJS/.test(navigator.userAgent), wf = /AppleWebKit/.test(navigator.userAgent) && /Mobile\/\w+/.test(navigator.userAgent), xf = wf || /Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent), yf = wf || /Mac/.test(navigator.platform), zf = /win/i.test(navigator.platform), Af = sf && navigator.userAgent.match(/Version\/(\d*\.\d*)/);
    Af && (Af = Number(Af[1])), Af && Af >= 15 && (sf = !1, pf = !0);
    var Bf = yf && (qf || sf && (null == Af || Af < 12.11)), Cf = kf || nf && of >= 9, Df = !1, Ef = !1;
    p.prototype = He({
        update: function (a) {
            var b = a.scrollWidth > a.clientWidth + 1, c = a.scrollHeight > a.clientHeight + 1, d = a.nativeBarWidth;
            if (c) {
                this.vert.style.display = "block", this.vert.style.bottom = b ? d + "px" : "0";
                var e = a.viewHeight - (b ? d : 0);
                this.vert.firstChild.style.height = Math.max(0, a.scrollHeight - a.clientHeight + e) + "px"
            } else this.vert.style.display = "", this.vert.firstChild.style.height = "0";
            if (b) {
                this.horiz.style.display = "block", this.horiz.style.right = c ? d + "px" : "0", this.horiz.style.left = a.barLeft + "px";
                var f = a.viewWidth - a.barLeft - (c ? d : 0);
                this.horiz.firstChild.style.width = a.scrollWidth - a.clientWidth + f + "px"
            } else this.horiz.style.display = "", this.horiz.firstChild.style.width = "0";
            return !this.checkedOverlay && a.clientHeight > 0 && (0 == d && this.overlayHack(), this.checkedOverlay = !0), {
                right: c ? d : 0,
                bottom: b ? d : 0
            }
        }, setScrollLeft: function (a) {
            this.horiz.scrollLeft != a && (this.horiz.scrollLeft = a)
        }, setScrollTop: function (a) {
            this.vert.scrollTop != a && (this.vert.scrollTop = a)
        }, overlayHack: function () {
            var a = yf && !uf ? "12px" : "18px";
            this.horiz.style.minHeight = this.vert.style.minWidth = a;
            var b = this, c = function (a) {
                re(a) != b.vert && re(a) != b.horiz && Db(b.cm, Ub)(a)
            };
            xg(this.vert, "mousedown", c), xg(this.horiz, "mousedown", c)
        }, clear: function () {
            var a = this.horiz.parentNode;
            a.removeChild(this.horiz), a.removeChild(this.vert)
        }
    }, p.prototype), q.prototype = He({
        update: function () {
            return {bottom: 0, right: 0}
        }, setScrollLeft: function () {
        }, setScrollTop: function () {
        }, clear: function () {
        }
    }, q.prototype), a.scrollbarModel = {native: p, null: q}, z.prototype.signal = function (a, b) {
        xe(a, b) && this.events.push(arguments)
    }, z.prototype.finish = function () {
        for (var a = 0; a < this.events.length; a++)zg.apply(null, this.events[a])
    };
    var Ff = a.Pos = function (a, b) {
        return this instanceof Ff ? (this.line = a, void(this.ch = b)) : new Ff(a, b)
    }, Gf = a.cmpPos = function (a, b) {
        return a.line - b.line || a.ch - b.ch
    }, Hf = null;
    da.prototype = He({
        init: function (a) {
            function b(a) {
                if (d.somethingSelected())Hf = d.getSelections(), c.inaccurateSelection && (c.prevInput = "", c.inaccurateSelection = !1, f.value = Hf.join("\n"), Ig(f)); else {
                    if (!d.options.lineWiseCopyCut)return;
                    var b = ba(d);
                    Hf = b.text, "cut" == a.type ? d.setSelections(b.ranges, null, Dg) : (c.prevInput = "", f.value = b.text.join("\n"), Ig(f))
                }
                "cut" == a.type && (d.state.cutIncoming = !0)
            }

            var c = this, d = this.cm, e = this.wrapper = ea(), f = this.textarea = e.firstChild;
            a.wrapper.insertBefore(e, a.wrapper.firstChild), wf && (f.style.width = "0px"), xg(f, "input", function () {
                nf && of >= 9 && c.hasSelection && (c.hasSelection = null), c.poll()
            }), xg(f, "paste", function (a) {
                return !!_(a, d) || (d.state.pasteIncoming = !0, void c.fastPoll())
            }), xg(f, "cut", b), xg(f, "copy", b), xg(a.scroller, "paste", function (b) {
                Sb(a, b) || (d.state.pasteIncoming = !0, c.focus())
            }), xg(a.lineSpace, "selectstart", function (b) {
                Sb(a, b) || ug(b)
            }), xg(f, "compositionstart", function () {
                var a = d.getCursor("from");
                c.composing = {start: a, range: d.markText(a, d.getCursor("to"), {className: "CodeMirror-composing"})}
            }), xg(f, "compositionend", function () {
                c.composing && (c.poll(), c.composing.range.clear(), c.composing = null)
            })
        }, prepareSelection: function () {
            var a = this.cm, b = a.display, c = a.doc, d = Ia(a);
            if (a.options.moveInputWithCursor) {
                var e = mb(a, c.sel.primary().head, "div"), f = b.wrapper.getBoundingClientRect(), g = b.lineDiv.getBoundingClientRect();
                d.teTop = Math.max(0, Math.min(b.wrapper.clientHeight - 10, e.top + g.top - f.top)), d.teLeft = Math.max(0, Math.min(b.wrapper.clientWidth - 10, e.left + g.left - f.left))
            }
            return d
        }, showSelection: function (a) {
            var b = this.cm, c = b.display;
            Oe(c.cursorDiv, a.cursors), Oe(c.selectionDiv, a.selection), null != a.teTop && (this.wrapper.style.top = a.teTop + "px", this.wrapper.style.left = a.teLeft + "px")
        }, reset: function (a) {
            if (!this.contextMenuPending) {
                var b, c, d = this.cm, e = d.doc;
                if (d.somethingSelected()) {
                    this.prevInput = "";
                    var f = e.sel.primary();
                    b = Wg && (f.to().line - f.from().line > 100 || (c = d.getSelection()).length > 1e3);
                    var g = b ? "-" : c || d.getSelection();
                    this.textarea.value = g, d.state.focused && Ig(this.textarea), nf && of >= 9 && (this.hasSelection = g)
                } else a || (this.prevInput = this.textarea.value = "", nf && of >= 9 && (this.hasSelection = null));
                this.inaccurateSelection = b
            }
        }, getField: function () {
            return this.textarea
        }, supportsTouch: function () {
            return !1
        }, focus: function () {
            if ("nocursor" != this.cm.options.readOnly && (!xf || Pe() != this.textarea))try {
                this.textarea.focus()
            } catch (a) {
            }
        }, blur: function () {
            this.textarea.blur()
        }, resetPosition: function () {
            this.wrapper.style.top = this.wrapper.style.left = 0
        }, receivedFocus: function () {
            this.slowPoll()
        }, slowPoll: function () {
            var a = this;
            a.pollingFast || a.polling.set(this.cm.options.pollInterval, function () {
                a.poll(), a.cm.state.focused && a.slowPoll()
            })
        }, fastPoll: function () {
            function a() {
                var d = c.poll();
                d || b ? (c.pollingFast = !1, c.slowPoll()) : (b = !0, c.polling.set(60, a))
            }

            var b = !1, c = this;
            c.pollingFast = !0, c.polling.set(20, a)
        }, poll: function () {
            var a = this.cm, b = this.textarea, c = this.prevInput;
            if (this.contextMenuPending || !a.state.focused || Vg(b) && !c || Z(a) || a.options.disableInput || a.state.keySeq)return !1;
            var d = b.value;
            if (d == c && !a.somethingSelected())return !1;
            if (nf && of >= 9 && this.hasSelection === d || yf && /[\uf700-\uf7ff]/.test(d))return a.display.input.reset(), !1;
            if (a.doc.sel == a.display.selForContextMenu) {
                var e = d.charCodeAt(0);
                if (8203 != e || c || (c = "​"), 8666 == e)return this.reset(), this.cm.execCommand("undo")
            }
            for (var f = 0, g = Math.min(c.length, d.length); f < g && c.charCodeAt(f) == d.charCodeAt(f);)++f;
            var h = this;
            return Cb(a, function () {
                $(a, d.slice(f), c.length - f, null, h.composing ? "*compose" : null), d.length > 1e3 || d.indexOf("\n") > -1 ? b.value = h.prevInput = "" : h.prevInput = d, h.composing && (h.composing.range.clear(), h.composing.range = a.markText(h.composing.start, a.getCursor("to"), {className: "CodeMirror-composing"}))
            }), !0
        }, ensurePolled: function () {
            this.pollingFast && this.poll() && (this.pollingFast = !1)
        }, onKeyPress: function () {
            nf && of >= 9 && (this.hasSelection = null), this.fastPoll()
        }, onContextMenu: function (a) {
            function b() {
                if (null != g.selectionStart) {
                    var a = e.somethingSelected(), b = "​" + (a ? g.value : "");
                    g.value = "⇚", g.value = b, d.prevInput = a ? "" : "​", g.selectionStart = 1, g.selectionEnd = b.length, f.selForContextMenu = e.doc.sel
                }
            }

            function c() {
                if (d.contextMenuPending = !1, d.wrapper.style.position = "relative", g.style.cssText = k, nf && of < 9 && f.scrollbars.setScrollTop(f.scroller.scrollTop = i), null != g.selectionStart) {
                    (!nf || nf && of < 9) && b();
                    var a = 0, c = function () {
                        f.selForContextMenu == e.doc.sel && 0 == g.selectionStart && g.selectionEnd > 0 && "​" == d.prevInput ? Db(e, dg.selectAll)(e) : a++ < 10 ? f.detectingSelectAll = setTimeout(c, 500) : f.input.reset()
                    };
                    f.detectingSelectAll = setTimeout(c, 200)
                }
            }

            var d = this, e = d.cm, f = e.display, g = d.textarea, h = Tb(e, a), i = f.scroller.scrollTop;
            if (h && !sf) {
                var j = e.options.resetSelectionOnContextMenu;
                j && e.doc.sel.contains(h) == -1 && Db(e, Ba)(e.doc, oa(h), Dg);
                var k = g.style.cssText;
                if (d.wrapper.style.position = "absolute", g.style.cssText = "position: fixed; width: 30px; height: 30px; top: " + (a.clientY - 5) + "px; left: " + (a.clientX - 5) + "px; z-index: 1000; background: " + (nf ? "rgba(255, 255, 255, .05)" : "transparent") + "; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);", pf)var l = window.scrollY;
                if (f.input.focus(), pf && window.scrollTo(null, l), f.input.reset(), e.somethingSelected() || (g.value = d.prevInput = " "), d.contextMenuPending = !0, f.selForContextMenu = e.doc.sel, clearTimeout(f.detectingSelectAll), nf && of >= 9 && b(), Cf) {
                    wg(a);
                    var m = function () {
                        yg(window, "mouseup", m), setTimeout(c, 20)
                    };
                    xg(window, "mouseup", m)
                } else setTimeout(c, 50)
            }
        }, setUneditable: Fe, needsContentAttribute: !1
    }, da.prototype), fa.prototype = He({
        init: function (a) {
            function b(a) {
                if (d.somethingSelected())Hf = d.getSelections(), "cut" == a.type && d.replaceSelection("", null, "cut"); else {
                    if (!d.options.lineWiseCopyCut)return;
                    var b = ba(d);
                    Hf = b.text, "cut" == a.type && d.operation(function () {
                        d.setSelections(b.ranges, 0, Dg), d.replaceSelection("", null, "cut")
                    })
                }
                if (a.clipboardData && !wf)a.preventDefault(), a.clipboardData.clearData(), a.clipboardData.setData("text/plain", Hf.join("\n")); else {
                    var c = ea(), e = c.firstChild;
                    d.display.lineSpace.insertBefore(c, d.display.lineSpace.firstChild), e.value = Hf.join("\n");
                    var f = document.activeElement;
                    Ig(e), setTimeout(function () {
                        d.display.lineSpace.removeChild(c), f.focus()
                    }, 50)
                }
            }

            var c = this, d = c.cm, e = c.div = a.lineDiv;
            e.contentEditable = "true", ca(e), xg(e, "paste", function (a) {
                _(a, d)
            }), xg(e, "compositionstart", function (a) {
                var b = a.data;
                if (c.composing = {sel: d.doc.sel, data: b, startData: b}, b) {
                    var e = d.doc.sel.primary(), f = d.getLine(e.head.line), g = f.indexOf(b, Math.max(0, e.head.ch - b.length));
                    g > -1 && g <= e.head.ch && (c.composing.sel = oa(Ff(e.head.line, g), Ff(e.head.line, g + b.length)))
                }
            }), xg(e, "compositionupdate", function (a) {
                c.composing.data = a.data
            }), xg(e, "compositionend", function (a) {
                var b = c.composing;
                b && (a.data == b.startData || /\u200b/.test(a.data) || (b.data = a.data), setTimeout(function () {
                    b.handled || c.applyComposition(b), c.composing == b && (c.composing = null)
                }, 50))
            }), xg(e, "touchstart", function () {
                c.forceCompositionEnd()
            }), xg(e, "input", function () {
                c.composing || c.pollContent() || Cb(c.cm, function () {
                    Ib(d)
                })
            }), xg(e, "copy", b), xg(e, "cut", b)
        }, prepareSelection: function () {
            var a = Ia(this.cm, !1);
            return a.focus = this.cm.state.focused, a
        }, showSelection: function (a) {
            a && this.cm.display.view.length && (a.focus && this.showPrimarySelection(), this.showMultipleSelections(a))
        }, showPrimarySelection: function () {
            var a = window.getSelection(), b = this.cm.doc.sel.primary(), c = ia(this.cm, a.anchorNode, a.anchorOffset), d = ia(this.cm, a.focusNode, a.focusOffset);
            if (!c || c.bad || !d || d.bad || 0 != Gf(X(c, d), b.from()) || 0 != Gf(W(c, d), b.to())) {
                var e = ga(this.cm, b.from()), f = ga(this.cm, b.to());
                if (e || f) {
                    var g = this.cm.display.view, h = a.rangeCount && a.getRangeAt(0);
                    if (e) {
                        if (!f) {
                            var i = g[g.length - 1].measure, j = i.maps ? i.maps[i.maps.length - 1] : i.map;
                            f = {node: j[j.length - 1], offset: j[j.length - 2] - j[j.length - 3]}
                        }
                    } else e = {node: g[0].measure.map[2], offset: 0};
                    try {
                        var k = Jg(e.node, e.offset, f.offset, f.node)
                    } catch (a) {
                    }
                    k && (a.removeAllRanges(), a.addRange(k), h && null == a.anchorNode ? a.addRange(h) : kf && this.startGracePeriod()), this.rememberSelection()
                }
            }
        }, startGracePeriod: function () {
            var a = this;
            clearTimeout(this.gracePeriod), this.gracePeriod = setTimeout(function () {
                a.gracePeriod = !1, a.selectionChanged() && a.cm.operation(function () {
                    a.cm.curOp.selectionChanged = !0
                })
            }, 20)
        }, showMultipleSelections: function (a) {
            Oe(this.cm.display.cursorDiv, a.cursors), Oe(this.cm.display.selectionDiv, a.selection)
        }, rememberSelection: function () {
            var a = window.getSelection();
            this.lastAnchorNode = a.anchorNode, this.lastAnchorOffset = a.anchorOffset, this.lastFocusNode = a.focusNode, this.lastFocusOffset = a.focusOffset
        }, selectionInEditor: function () {
            var a = window.getSelection();
            if (!a.rangeCount)return !1;
            var b = a.getRangeAt(0).commonAncestorContainer;
            return Ng(this.div, b)
        }, focus: function () {
            "nocursor" != this.cm.options.readOnly && this.div.focus()
        }, blur: function () {
            this.div.blur()
        }, getField: function () {
            return this.div
        }, supportsTouch: function () {
            return !0
        }, receivedFocus: function () {
            function a() {
                b.cm.state.focused && (b.pollSelection(), b.polling.set(b.cm.options.pollInterval, a))
            }

            var b = this;
            this.selectionInEditor() ? this.pollSelection() : Cb(this.cm, function () {
                b.cm.curOp.selectionChanged = !0
            }), this.polling.set(this.cm.options.pollInterval, a)
        }, selectionChanged: function () {
            var a = window.getSelection();
            return a.anchorNode != this.lastAnchorNode || a.anchorOffset != this.lastAnchorOffset || a.focusNode != this.lastFocusNode || a.focusOffset != this.lastFocusOffset
        }, pollSelection: function () {
            if (!this.composing && !this.gracePeriod && this.selectionChanged()) {
                var a = window.getSelection(), b = this.cm;
                this.rememberSelection();
                var c = ia(b, a.anchorNode, a.anchorOffset), d = ia(b, a.focusNode, a.focusOffset);
                c && d && Cb(b, function () {
                    Ba(b.doc, oa(c, d), Dg), (c.bad || d.bad) && (b.curOp.selectionChanged = !0)
                })
            }
        }, pollContent: function () {
            var a = this.cm, b = a.display, c = a.doc.sel.primary(), d = c.from(), e = c.to();
            if (d.line < b.viewFrom || e.line > b.viewTo - 1)return !1;
            var f;
            if (d.line == b.viewFrom || 0 == (f = Lb(a, d.line)))var g = Zd(b.view[0].line), h = b.view[0].node; else var g = Zd(b.view[f].line), h = b.view[f - 1].node.nextSibling;
            var i = Lb(a, e.line);
            if (i == b.view.length - 1)var j = b.viewTo - 1, k = b.lineDiv.lastChild; else var j = Zd(b.view[i + 1].line) - 1, k = b.view[i + 1].node.previousSibling;
            for (var l = Ug(ka(a, h, k, g, j)), m = Wd(a.doc, Ff(g, 0), Ff(j, Vd(a.doc, j).text.length)); l.length > 1 && m.length > 1;)if (Ce(l) == Ce(m))l.pop(), m.pop(), j--; else {
                if (l[0] != m[0])break;
                l.shift(), m.shift(), g++
            }
            for (var n = 0, o = 0, p = l[0], q = m[0], r = Math.min(p.length, q.length); n < r && p.charCodeAt(n) == q.charCodeAt(n);)++n;
            for (var s = Ce(l), t = Ce(m), u = Math.min(s.length - (1 == l.length ? n : 0), t.length - (1 == m.length ? n : 0)); o < u && s.charCodeAt(s.length - o - 1) == t.charCodeAt(t.length - o - 1);)++o;
            l[l.length - 1] = s.slice(0, s.length - o), l[0] = l[0].slice(n);
            var v = Ff(g, n), w = Ff(j, m.length ? Ce(m).length - o : 0);
            return l.length > 1 || l[0] || Gf(v, w) ? (Cc(a.doc, l, v, w, "+input"), !0) : void 0
        }, ensurePolled: function () {
            this.forceCompositionEnd()
        }, reset: function () {
            this.forceCompositionEnd()
        }, forceCompositionEnd: function () {
            this.composing && !this.composing.handled && (this.applyComposition(this.composing), this.composing.handled = !0, this.div.blur(), this.div.focus())
        }, applyComposition: function (a) {
            a.data && a.data != a.startData && Db(this.cm, $)(this.cm, a.data, 0, a.sel)
        }, setUneditable: function (a) {
            a.setAttribute("contenteditable", "false")
        }, onKeyPress: function (a) {
            a.preventDefault(), Db(this.cm, $)(this.cm, String.fromCharCode(null == a.charCode ? a.keyCode : a.charCode), 0)
        }, onContextMenu: Fe, resetPosition: Fe, needsContentAttribute: !0
    }, fa.prototype), a.inputStyles = {textarea: da, contenteditable: fa}, la.prototype = {
        primary: function () {
            return this.ranges[this.primIndex]
        }, equals: function (a) {
            if (a == this)return !0;
            if (a.primIndex != this.primIndex || a.ranges.length != this.ranges.length)return !1;
            for (var b = 0; b < this.ranges.length; b++) {
                var c = this.ranges[b], d = a.ranges[b];
                if (0 != Gf(c.anchor, d.anchor) || 0 != Gf(c.head, d.head))return !1
            }
            return !0
        }, deepCopy: function () {
            for (var a = [], b = 0; b < this.ranges.length; b++)a[b] = new ma(V(this.ranges[b].anchor), V(this.ranges[b].head));
            return new la(a, this.primIndex)
        }, somethingSelected: function () {
            for (var a = 0; a < this.ranges.length; a++)if (!this.ranges[a].empty())return !0;
            return !1
        }, contains: function (a, b) {
            b || (b = a);
            for (var c = 0; c < this.ranges.length; c++) {
                var d = this.ranges[c];
                if (Gf(b, d.from()) >= 0 && Gf(a, d.to()) <= 0)return c
            }
            return -1
        }
    }, ma.prototype = {
        from: function () {
            return X(this.anchor, this.head)
        }, to: function () {
            return W(this.anchor, this.head)
        }, empty: function () {
            return this.head.line == this.anchor.line && this.head.ch == this.anchor.ch
        }
    };
    var If, Jf, Kf, Lf = {left: 0, right: 0, top: 0, bottom: 0}, Mf = null, Nf = 0, Of = 0, Pf = 0, Qf = null;
    nf ? Qf = -.53 : kf ? Qf = 15 : rf ? Qf = -.7 : tf && (Qf = -1 / 3);
    var Rf = function (a) {
        var b = a.wheelDeltaX, c = a.wheelDeltaY;
        return null == b && a.detail && a.axis == a.HORIZONTAL_AXIS && (b = a.detail), null == c && a.detail && a.axis == a.VERTICAL_AXIS ? c = a.detail : null == c && (c = a.wheelDelta), {
            x: b,
            y: c
        }
    };
    a.wheelEventPixels = function (a) {
        var b = Rf(a);
        return b.x *= Qf, b.y *= Qf, b
    };
    var Sf = new ze, Tf = null, Uf = a.changeEnd = function (a) {
        return a.text ? Ff(a.from.line + a.text.length - 1, Ce(a.text).length + (1 == a.text.length ? a.from.ch : 0)) : a.to
    };
    a.prototype = {
        constructor: a, focus: function () {
            window.focus(), this.display.input.focus()
        }, setOption: function (a, b) {
            var c = this.options, d = c[a];
            c[a] == b && "mode" != a || (c[a] = b, Wf.hasOwnProperty(a) && Db(this, Wf[a])(this, b, d))
        }, getOption: function (a) {
            return this.options[a]
        }, getDoc: function () {
            return this.doc
        }, addKeyMap: function (a, b) {
            this.state.keyMaps[b ? "push" : "unshift"](Rc(a))
        }, removeKeyMap: function (a) {
            for (var b = this.state.keyMaps, c = 0; c < b.length; ++c)if (b[c] == a || b[c].name == a)return b.splice(c, 1), !0
        }, addOverlay: Eb(function (b, c) {
            var d = b.token ? b : a.getMode(this.options, b);
            if (d.startState)throw new Error("Overlays may not be stateful.");
            this.state.overlays.push({mode: d, modeSpec: b, opaque: c && c.opaque}), this.state.modeGen++, Ib(this)
        }), removeOverlay: Eb(function (a) {
            for (var b = this.state.overlays, c = 0; c < b.length; ++c) {
                var d = b[c].modeSpec;
                if (d == a || "string" == typeof a && d.name == a)return b.splice(c, 1), this.state.modeGen++, void Ib(this)
            }
        }), indentLine: Eb(function (a, b, c) {
            "string" != typeof b && "number" != typeof b && (b = null == b ? this.options.smartIndent ? "smart" : "prev" : b ? "add" : "subtract"), sa(this.doc, a) && Kc(this, a, b, c)
        }), indentSelection: Eb(function (a) {
            for (var b = this.doc.sel.ranges, c = -1, d = 0; d < b.length; d++) {
                var e = b[d];
                if (e.empty())e.head.line > c && (Kc(this, e.head.line, a, !0), c = e.head.line, d == this.doc.sel.primIndex && Ic(this)); else {
                    var f = e.from(), g = e.to(), h = Math.max(c, f.line);
                    c = Math.min(this.lastLine(), g.line - (g.ch ? 0 : 1)) + 1;
                    for (var i = h; i < c; ++i)Kc(this, i, a);
                    var j = this.doc.sel.ranges;
                    0 == f.ch && b.length == j.length && j[d].from().ch > 0 && xa(this.doc, d, new ma(f, j[d].to()), Dg)
                }
            }
        }), getTokenAt: function (a, b) {
            return Cd(this, a, b)
        }, getLineTokens: function (a, b) {
            return Cd(this, Ff(a), b, !0)
        }, getTokenTypeAt: function (a) {
            a = qa(this.doc, a);
            var b, c = Fd(this, Vd(this.doc, a.line)), d = 0, e = (c.length - 1) / 2, f = a.ch;
            if (0 == f)b = c[2]; else for (; ;) {
                var g = d + e >> 1;
                if ((g ? c[2 * g - 1] : 0) >= f)e = g; else {
                    if (!(c[2 * g + 1] < f)) {
                        b = c[2 * g + 2];
                        break
                    }
                    d = g + 1
                }
            }
            var h = b ? b.indexOf("cm-overlay ") : -1;
            return h < 0 ? b : 0 == h ? null : b.slice(0, h - 1)
        }, getModeAt: function (b) {
            var c = this.doc.mode;
            return c.innerMode ? a.innerMode(c, this.getTokenAt(b).state).mode : c
        }, getHelper: function (a, b) {
            return this.getHelpers(a, b)[0]
        }, getHelpers: function (a, b) {
            var c = [];
            if (!ag.hasOwnProperty(b))return c;
            var d = ag[b], e = this.getModeAt(a);
            if ("string" == typeof e[b])d[e[b]] && c.push(d[e[b]]); else if (e[b])for (var f = 0; f < e[b].length; f++) {
                var g = d[e[b][f]];
                g && c.push(g)
            } else e.helperType && d[e.helperType] ? c.push(d[e.helperType]) : d[e.name] && c.push(d[e.name]);
            for (var f = 0; f < d._global.length; f++) {
                var h = d._global[f];
                h.pred(e, this) && De(c, h.val) == -1 && c.push(h.val)
            }
            return c
        }, getStateAfter: function (a, b) {
            var c = this.doc;
            return a = pa(c, null == a ? c.first + c.size - 1 : a), Pa(this, a + 1, b)
        }, cursorCoords: function (a, b) {
            var c, d = this.doc.sel.primary();
            return c = null == a ? d.head : "object" == typeof a ? qa(this.doc, a) : a ? d.from() : d.to(), mb(this, c, b || "page")
        }, charCoords: function (a, b) {
            return lb(this, qa(this.doc, a), b || "page")
        }, coordsChar: function (a, b) {
            return a = kb(this, a, b || "page"), pb(this, a.left, a.top)
        }, lineAtHeight: function (a, b) {
            return a = kb(this, {top: a, left: 0}, b || "page").top, $d(this.doc, a + this.display.viewOffset)
        }, heightAtLine: function (a, b) {
            var c, d = !1;
            if ("number" == typeof a) {
                var e = this.doc.first + this.doc.size - 1;
                a < this.doc.first ? a = this.doc.first : a > e && (a = e, d = !0), c = Vd(this.doc, a)
            } else c = a;
            return jb(this, c, {top: 0, left: 0}, b || "page").top + (d ? this.doc.height - _d(c) : 0)
        }, defaultTextHeight: function () {
            return rb(this.display)
        }, defaultCharWidth: function () {
            return sb(this.display)
        }, setGutterMarker: Eb(function (a, b, c) {
            return Lc(this.doc, a, "gutter", function (a) {
                var d = a.gutterMarkers || (a.gutterMarkers = {});
                return d[b] = c, !c && Ke(d) && (a.gutterMarkers = null), !0
            })
        }), clearGutter: Eb(function (a) {
            var b = this, c = b.doc, d = c.first;
            c.iter(function (c) {
                c.gutterMarkers && c.gutterMarkers[a] && (c.gutterMarkers[a] = null, Jb(b, d, "gutter"), Ke(c.gutterMarkers) && (c.gutterMarkers = null)), ++d
            })
        }), lineInfo: function (a) {
            if ("number" == typeof a) {
                if (!sa(this.doc, a))return null;
                var b = a;
                if (a = Vd(this.doc, a), !a)return null
            } else {
                var b = Zd(a);
                if (null == b)return null
            }
            return {
                line: b,
                handle: a,
                text: a.text,
                gutterMarkers: a.gutterMarkers,
                textClass: a.textClass,
                bgClass: a.bgClass,
                wrapClass: a.wrapClass,
                widgets: a.widgets
            }
        }, getViewport: function () {
            return {from: this.display.viewFrom, to: this.display.viewTo}
        }, addWidget: function (a, b, c, d, e) {
            var f = this.display;
            a = mb(this, qa(this.doc, a));
            var g = a.bottom, h = a.left;
            if (b.style.position = "absolute", b.setAttribute("cm-ignore-events", "true"), this.display.input.setUneditable(b), f.sizer.appendChild(b), "over" == d)g = a.top; else if ("above" == d || "near" == d) {
                var i = Math.max(f.wrapper.clientHeight, this.doc.height), j = Math.max(f.sizer.clientWidth, f.lineSpace.clientWidth);
                ("above" == d || a.bottom + b.offsetHeight > i) && a.top > b.offsetHeight ? g = a.top - b.offsetHeight : a.bottom + b.offsetHeight <= i && (g = a.bottom), h + b.offsetWidth > j && (h = j - b.offsetWidth)
            }
            b.style.top = g + "px", b.style.left = b.style.right = "", "right" == e ? (h = f.sizer.clientWidth - b.offsetWidth, b.style.right = "0px") : ("left" == e ? h = 0 : "middle" == e && (h = (f.sizer.clientWidth - b.offsetWidth) / 2), b.style.left = h + "px"), c && Fc(this, h, g, h + b.offsetWidth, g + b.offsetHeight)
        }, triggerOnKeyDown: Eb(ic), triggerOnKeyPress: Eb(lc), triggerOnKeyUp: kc, execCommand: function (a) {
            if (dg.hasOwnProperty(a))return dg[a](this)
        }, triggerElectric: Eb(function (a) {
            aa(this, a)
        }), findPosH: function (a, b, c, d) {
            var e = 1;
            b < 0 && (e = -1, b = -b);
            for (var f = 0, g = qa(this.doc, a); f < b && (g = Nc(this.doc, g, e, c, d), !g.hitSide); ++f);
            return g
        }, moveH: Eb(function (a, b) {
            var c = this;
            c.extendSelectionsBy(function (d) {
                return c.display.shift || c.doc.extend || d.empty() ? Nc(c.doc, d.head, a, b, c.options.rtlMoveVisually) : a < 0 ? d.from() : d.to()
            }, Fg)
        }), deleteH: Eb(function (a, b) {
            var c = this.doc.sel, d = this.doc;
            c.somethingSelected() ? d.replaceSelection("", null, "+delete") : Mc(this, function (c) {
                var e = Nc(d, c.head, a, b, !1);
                return a < 0 ? {from: e, to: c.head} : {from: c.head, to: e}
            })
        }), findPosV: function (a, b, c, d) {
            var e = 1, f = d;
            b < 0 && (e = -1, b = -b);
            for (var g = 0, h = qa(this.doc, a); g < b; ++g) {
                var i = mb(this, h, "div");
                if (null == f ? f = i.left : i.left = f, h = Oc(this, i, e, c), h.hitSide)break
            }
            return h
        }, moveV: Eb(function (a, b) {
            var c = this, d = this.doc, e = [], f = !c.display.shift && !d.extend && d.sel.somethingSelected();
            if (d.extendSelectionsBy(function (g) {
                    if (f)return a < 0 ? g.from() : g.to();
                    var h = mb(c, g.head, "div");
                    null != g.goalColumn && (h.left = g.goalColumn), e.push(h.left);
                    var i = Oc(c, h, a, b);
                    return "page" == b && g == d.sel.primary() && Hc(c, null, lb(c, i, "div").top - h.top), i
                }, Fg), e.length)for (var g = 0; g < d.sel.ranges.length; g++)d.sel.ranges[g].goalColumn = e[g]
        }), findWordAt: function (a) {
            var b = this.doc, c = Vd(b, a.line).text, d = a.ch, e = a.ch;
            if (c) {
                var f = this.getHelper(a, "wordChars");
                (a.xRel < 0 || e == c.length) && d ? --d : ++e;
                for (var g = c.charAt(d), h = Je(g, f) ? function (a) {
                    return Je(a, f)
                } : /\s/.test(g) ? function (a) {
                    return /\s/.test(a)
                } : function (a) {
                    return !/\s/.test(a) && !Je(a)
                }; d > 0 && h(c.charAt(d - 1));)--d;
                for (; e < c.length && h(c.charAt(e));)++e
            }
            return new ma(Ff(a.line, d), Ff(a.line, e))
        }, toggleOverwrite: function (a) {
            null != a && a == this.state.overwrite || ((this.state.overwrite = !this.state.overwrite) ? Rg(this.display.cursorDiv, "CodeMirror-overwrite") : Qg(this.display.cursorDiv, "CodeMirror-overwrite"), zg(this, "overwriteToggle", this, this.state.overwrite))
        }, hasFocus: function () {
            return this.display.input.getField() == Pe()
        }, scrollTo: Eb(function (a, b) {
            null == a && null == b || Jc(this), null != a && (this.curOp.scrollLeft = a), null != b && (this.curOp.scrollTop = b)
        }), getScrollInfo: function () {
            var a = this.display.scroller;
            return {
                left: a.scrollLeft,
                top: a.scrollTop,
                height: a.scrollHeight - Ta(this) - this.display.barHeight,
                width: a.scrollWidth - Ta(this) - this.display.barWidth,
                clientHeight: Va(this),
                clientWidth: Ua(this)
            }
        }, scrollIntoView: Eb(function (a, b) {
            if (null == a ? (a = {
                    from: this.doc.sel.primary().head,
                    to: null
                }, null == b && (b = this.options.cursorScrollMargin)) : "number" == typeof a ? a = {
                    from: Ff(a, 0),
                    to: null
                } : null == a.from && (a = {
                        from: a,
                        to: null
                    }), a.to || (a.to = a.from), a.margin = b || 0, null != a.from.line)Jc(this), this.curOp.scrollToPos = a; else {
                var c = Gc(this, Math.min(a.from.left, a.to.left), Math.min(a.from.top, a.to.top) - a.margin, Math.max(a.from.right, a.to.right), Math.max(a.from.bottom, a.to.bottom) + a.margin);
                this.scrollTo(c.scrollLeft, c.scrollTop)
            }
        }), setSize: Eb(function (a, b) {
            function c(a) {
                return "number" == typeof a || /^\d+$/.test(String(a)) ? a + "px" : a
            }

            var d = this;
            null != a && (d.display.wrapper.style.width = c(a)), null != b && (d.display.wrapper.style.height = c(b)), d.options.lineWrapping && fb(this);
            var e = d.display.viewFrom;
            d.doc.iter(e, d.display.viewTo, function (a) {
                if (a.widgets)for (var b = 0; b < a.widgets.length; b++)if (a.widgets[b].noHScroll) {
                    Jb(d, e, "widget");
                    break
                }
                ++e
            }), d.curOp.forceUpdate = !0, zg(d, "refresh", this)
        }), operation: function (a) {
            return Cb(this, a)
        }, refresh: Eb(function () {
            var a = this.display.cachedTextHeight;
            Ib(this), this.curOp.forceUpdate = !0, gb(this), this.scrollTo(this.doc.scrollLeft, this.doc.scrollTop), k(this), (null == a || Math.abs(a - rb(this.display)) > .5) && g(this), zg(this, "refresh", this)
        }), swapDoc: Eb(function (a) {
            var b = this.doc;
            return b.cm = null, Ud(this, a), gb(this), this.display.input.reset(), this.scrollTo(a.scrollLeft, a.scrollTop), this.curOp.forceScroll = !0, te(this, "swapDoc", this, b), b
        }), getInputField: function () {
            return this.display.input.getField()
        }, getWrapperElement: function () {
            return this.display.wrapper
        }, getScrollerElement: function () {
            return this.display.scroller
        }, getGutterElement: function () {
            return this.display.gutters
        }
    }, ye(a);
    var Vf = a.defaults = {}, Wf = a.optionHandlers = {}, Xf = a.Init = {
        toString: function () {
            return "CodeMirror.Init"
        }
    };
    Pc("value", "", function (a, b) {
        a.setValue(b)
    }, !0), Pc("mode", null, function (a, b) {
        a.doc.modeOption = b, c(a)
    }, !0), Pc("indentUnit", 2, c, !0), Pc("indentWithTabs", !1), Pc("smartIndent", !0), Pc("tabSize", 4, function (a) {
        d(a), gb(a), Ib(a)
    }, !0), Pc("specialChars", /[\t\u0000-\u0019\u00ad\u200b-\u200f\u2028\u2029\ufeff]/g, function (b, c, d) {
        b.state.specialChars = new RegExp(c.source + (c.test("\t") ? "" : "|\t"), "g"), d != a.Init && b.refresh()
    }), Pc("specialCharPlaceholder", Jd, function (a) {
        a.refresh()
    }, !0), Pc("electricChars", !0), Pc("inputStyle", xf ? "contenteditable" : "textarea", function () {
        throw new Error("inputStyle can not (yet) be changed in a running editor")
    }, !0), Pc("rtlMoveVisually", !zf), Pc("wholeLineUpdateBefore", !0), Pc("theme", "default", function (a) {
        h(a), i(a)
    }, !0), Pc("keyMap", "default", function (b, c, d) {
        var e = Rc(c), f = d != a.Init && Rc(d);
        f && f.detach && f.detach(b, e), e.attach && e.attach(b, f || null)
    }), Pc("extraKeys", null), Pc("lineWrapping", !1, e, !0), Pc("gutters", [], function (a) {
        n(a.options), i(a)
    }, !0), Pc("fixedGutter", !0, function (a, b) {
        a.display.gutters.style.left = b ? y(a.display) + "px" : "0", a.refresh()
    }, !0), Pc("coverGutterNextToScrollbar", !1, function (a) {
        s(a)
    }, !0), Pc("scrollbarStyle", "native", function (a) {
        r(a), s(a), a.display.scrollbars.setScrollTop(a.doc.scrollTop), a.display.scrollbars.setScrollLeft(a.doc.scrollLeft)
    }, !0), Pc("lineNumbers", !1, function (a) {
        n(a.options), i(a)
    }, !0), Pc("firstLineNumber", 1, i, !0), Pc("lineNumberFormatter", function (a) {
        return a
    }, i, !0), Pc("showCursorWhenSelecting", !1, Ha, !0), Pc("resetSelectionOnContextMenu", !0), Pc("lineWiseCopyCut", !0), Pc("readOnly", !1, function (a, b) {
        "nocursor" == b ? (oc(a), a.display.input.blur(), a.display.disabled = !0) : (a.display.disabled = !1, b || a.display.input.reset())
    }), Pc("disableInput", !1, function (a, b) {
        b || a.display.input.reset()
    }, !0), Pc("dragDrop", !0, Qb), Pc("cursorBlinkRate", 530), Pc("cursorScrollMargin", 0), Pc("cursorHeight", 1, Ha, !0), Pc("singleCursorHeightPerLine", !0, Ha, !0), Pc("workTime", 100), Pc("workDelay", 100), Pc("flattenSpans", !0, d, !0), Pc("addModeClass", !1, d, !0), Pc("pollInterval", 100), Pc("undoDepth", 200, function (a, b) {
        a.doc.history.undoDepth = b
    }), Pc("historyEventDelay", 1250), Pc("viewportMargin", 10, function (a) {
        a.refresh()
    }, !0), Pc("maxHighlightLength", 1e4, d, !0), Pc("moveInputWithCursor", !0, function (a, b) {
        b || a.display.input.resetPosition()
    }), Pc("tabindex", null, function (a, b) {
        a.display.input.getField().tabIndex = b || ""
    }), Pc("autofocus", null);
    var Yf = a.modes = {}, Zf = a.mimeModes = {};
    a.defineMode = function (b, c) {
        a.defaults.mode || "null" == b || (a.defaults.mode = b), arguments.length > 2 && (c.dependencies = Array.prototype.slice.call(arguments, 2)), Yf[b] = c
    }, a.defineMIME = function (a, b) {
        Zf[a] = b
    }, a.resolveMode = function (b) {
        if ("string" == typeof b && Zf.hasOwnProperty(b))b = Zf[b]; else if (b && "string" == typeof b.name && Zf.hasOwnProperty(b.name)) {
            var c = Zf[b.name];
            "string" == typeof c && (c = {name: c}), b = Ge(c, b), b.name = c.name
        } else if ("string" == typeof b && /^[\w\-]+\/[\w\-]+\+xml$/.test(b))return a.resolveMode("application/cstm1.xml");
        return "string" == typeof b ? {name: b} : b || {name: "null"}
    }, a.getMode = function (b, c) {
        var c = a.resolveMode(c), d = Yf[c.name];
        if (!d)return a.getMode(b, "text/plain");
        var e = d(b, c);
        if ($f.hasOwnProperty(c.name)) {
            var f = $f[c.name];
            for (var g in f)f.hasOwnProperty(g) && (e.hasOwnProperty(g) && (e["_" + g] = e[g]), e[g] = f[g])
        }
        if (e.name = c.name, c.helperType && (e.helperType = c.helperType), c.modeProps)for (var g in c.modeProps)e[g] = c.modeProps[g];
        return e
    }, a.defineMode("null", function () {
        return {
            token: function (a) {
                a.skipToEnd()
            }
        }
    }), a.defineMIME("text/plain", "null");
    var $f = a.modeExtensions = {};
    a.extendMode = function (a, b) {
        var c = $f.hasOwnProperty(a) ? $f[a] : $f[a] = {};
        He(b, c)
    }, a.defineExtension = function (b, c) {
        a.prototype[b] = c
    }, a.defineDocExtension = function (a, b) {
        rg.prototype[a] = b
    }, a.defineOption = Pc;
    var _f = [];
    a.defineInitHook = function (a) {
        _f.push(a)
    };
    var ag = a.helpers = {};
    a.registerHelper = function (b, c, d) {
        ag.hasOwnProperty(b) || (ag[b] = a[b] = {_global: []}), ag[b][c] = d
    }, a.registerGlobalHelper = function (b, c, d, e) {
        a.registerHelper(b, c, e), ag[b]._global.push({pred: d, val: e})
    };
    var bg = a.copyState = function (a, b) {
        if (b === !0)return b;
        if (a.copyState)return a.copyState(b);
        var c = {};
        for (var d in b) {
            var e = b[d];
            e instanceof Array && (e = e.concat([])), c[d] = e
        }
        return c
    }, cg = a.startState = function (a, b, c) {
        return !a.startState || a.startState(b, c)
    };
    a.innerMode = function (a, b) {
        for (; a.innerMode;) {
            var c = a.innerMode(b);
            if (!c || c.mode == a)break;
            b = c.state, a = c.mode
        }
        return c || {mode: a, state: b}
    };
    var dg = a.commands = {
        selectAll: function (a) {
            a.setSelection(Ff(a.firstLine(), 0), Ff(a.lastLine()), Dg)
        }, singleSelection: function (a) {
            a.setSelection(a.getCursor("anchor"), a.getCursor("head"), Dg)
        }, killLine: function (a) {
            Mc(a, function (b) {
                if (b.empty()) {
                    var c = Vd(a.doc, b.head.line).text.length;
                    return b.head.ch == c && b.head.line < a.lastLine() ? {
                        from: b.head,
                        to: Ff(b.head.line + 1, 0)
                    } : {from: b.head, to: Ff(b.head.line, c)}
                }
                return {from: b.from(), to: b.to()}
            })
        }, deleteLine: function (a) {
            Mc(a, function (b) {
                return {from: Ff(b.from().line, 0), to: qa(a.doc, Ff(b.to().line + 1, 0))}
            })
        }, delLineLeft: function (a) {
            Mc(a, function (a) {
                return {from: Ff(a.from().line, 0), to: a.from()}
            })
        }, delWrappedLineLeft: function (a) {
            Mc(a, function (b) {
                var c = a.charCoords(b.head, "div").top + 5, d = a.coordsChar({left: 0, top: c}, "div");
                return {from: d, to: b.from()}
            })
        }, delWrappedLineRight: function (a) {
            Mc(a, function (b) {
                var c = a.charCoords(b.head, "div").top + 5, d = a.coordsChar({
                    left: a.display.lineDiv.offsetWidth + 100,
                    top: c
                }, "div");
                return {from: b.from(), to: d}
            })
        }, undo: function (a) {
            a.undo()
        }, redo: function (a) {
            a.redo()
        }, undoSelection: function (a) {
            a.undoSelection()
        }, redoSelection: function (a) {
            a.redoSelection()
        }, goDocStart: function (a) {
            a.extendSelection(Ff(a.firstLine(), 0))
        }, goDocEnd: function (a) {
            a.extendSelection(Ff(a.lastLine()))
        }, goLineStart: function (a) {
            a.extendSelectionsBy(function (b) {
                return bf(a, b.head.line)
            }, {origin: "+move", bias: 1})
        }, goLineStartSmart: function (a) {
            a.extendSelectionsBy(function (b) {
                return df(a, b.head)
            }, {origin: "+move", bias: 1})
        }, goLineEnd: function (a) {
            a.extendSelectionsBy(function (b) {
                return cf(a, b.head.line)
            }, {origin: "+move", bias: -1})
        }, goLineRight: function (a) {
            a.extendSelectionsBy(function (b) {
                var c = a.charCoords(b.head, "div").top + 5;
                return a.coordsChar({left: a.display.lineDiv.offsetWidth + 100, top: c}, "div")
            }, Fg)
        }, goLineLeft: function (a) {
            a.extendSelectionsBy(function (b) {
                var c = a.charCoords(b.head, "div").top + 5;
                return a.coordsChar({left: 0, top: c}, "div")
            }, Fg)
        }, goLineLeftSmart: function (a) {
            a.extendSelectionsBy(function (b) {
                var c = a.charCoords(b.head, "div").top + 5, d = a.coordsChar({left: 0, top: c}, "div");
                return d.ch < a.getLine(d.line).search(/\S/) ? df(a, b.head) : d
            }, Fg)
        }, goLineUp: function (a) {
            a.moveV(-1, "line")
        }, goLineDown: function (a) {
            a.moveV(1, "line")
        }, goPageUp: function (a) {
            a.moveV(-1, "page")
        }, goPageDown: function (a) {
            a.moveV(1, "page")
        }, goCharLeft: function (a) {
            a.moveH(-1, "char")
        }, goCharRight: function (a) {
            a.moveH(1, "char")
        }, goColumnLeft: function (a) {
            a.moveH(-1, "column")
        }, goColumnRight: function (a) {
            a.moveH(1, "column")
        }, goWordLeft: function (a) {
            a.moveH(-1, "word")
        }, goGroupRight: function (a) {
            a.moveH(1, "group")
        }, goGroupLeft: function (a) {
            a.moveH(-1, "group")
        }, goWordRight: function (a) {
            a.moveH(1, "word")
        }, delCharBefore: function (a) {
            a.deleteH(-1, "char")
        }, delCharAfter: function (a) {
            a.deleteH(1, "char")
        }, delWordBefore: function (a) {
            a.deleteH(-1, "word")
        }, delWordAfter: function (a) {
            a.deleteH(1, "word")
        }, delGroupBefore: function (a) {
            a.deleteH(-1, "group")
        }, delGroupAfter: function (a) {
            a.deleteH(1, "group")
        }, indentAuto: function (a) {
            a.indentSelection("smart")
        }, indentMore: function (a) {
            a.indentSelection("add")
        }, indentLess: function (a) {
            a.indentSelection("subtract")
        }, insertTab: function (a) {
            a.replaceSelection("\t")
        }, insertSoftTab: function (a) {
            for (var b = [], c = a.listSelections(), d = a.options.tabSize, e = 0; e < c.length; e++) {
                var f = c[e].from(), g = Gg(a.getLine(f.line), f.ch, d);
                b.push(new Array(d - g % d + 1).join(" "))
            }
            a.replaceSelections(b)
        }, defaultTab: function (a) {
            a.somethingSelected() ? a.indentSelection("add") : a.execCommand("insertTab")
        }, transposeChars: function (a) {
            Cb(a, function () {
                for (var b = a.listSelections(), c = [], d = 0; d < b.length; d++) {
                    var e = b[d].head, f = Vd(a.doc, e.line).text;
                    if (f)if (e.ch == f.length && (e = new Ff(e.line, e.ch - 1)), e.ch > 0)e = new Ff(e.line, e.ch + 1), a.replaceRange(f.charAt(e.ch - 1) + f.charAt(e.ch - 2), Ff(e.line, e.ch - 2), e, "+transpose"); else if (e.line > a.doc.first) {
                        var g = Vd(a.doc, e.line - 1).text;
                        g && a.replaceRange(f.charAt(0) + "\n" + g.charAt(g.length - 1), Ff(e.line - 1, g.length - 1), Ff(e.line, 1), "+transpose")
                    }
                    c.push(new ma(e, e))
                }
                a.setSelections(c)
            })
        }, newlineAndIndent: function (a) {
            Cb(a, function () {
                for (var b = a.listSelections().length, c = 0; c < b; c++) {
                    var d = a.listSelections()[c];
                    a.replaceRange("\n", d.anchor, d.head, "+input"), a.indentLine(d.from().line + 1, null, !0), Ic(a)
                }
            })
        }, toggleOverwrite: function (a) {
            a.toggleOverwrite()
        }
    }, eg = a.keyMap = {};
    eg.basic = {
        Left: "goCharLeft",
        Right: "goCharRight",
        Up: "goLineUp",
        Down: "goLineDown",
        End: "goLineEnd",
        Home: "goLineStartSmart",
        PageUp: "goPageUp",
        PageDown: "goPageDown",
        Delete: "delCharAfter",
        Backspace: "delCharBefore",
        "Shift-Backspace": "delCharBefore",
        Tab: "defaultTab",
        "Shift-Tab": "indentAuto",
        Enter: "newlineAndIndent",
        Insert: "toggleOverwrite",
        Esc: "singleSelection"
    }, eg.pcDefault = {
        "Ctrl-A": "selectAll",
        "Ctrl-D": "deleteLine",
        "Ctrl-Z": "undo",
        "Shift-Ctrl-Z": "redo",
        "Ctrl-Y": "redo",
        "Ctrl-Home": "goDocStart",
        "Ctrl-End": "goDocEnd",
        "Ctrl-Up": "goLineUp",
        "Ctrl-Down": "goLineDown",
        "Ctrl-Left": "goGroupLeft",
        "Ctrl-Right": "goGroupRight",
        "Alt-Left": "goLineStart",
        "Alt-Right": "goLineEnd",
        "Ctrl-Backspace": "delGroupBefore",
        "Ctrl-Delete": "delGroupAfter",
        "Ctrl-S": "save",
        "Ctrl-F": "find",
        "Ctrl-G": "findNext",
        "Shift-Ctrl-G": "findPrev",
        "Shift-Ctrl-F": "replace",
        "Shift-Ctrl-R": "replaceAll",
        "Ctrl-[": "indentLess",
        "Ctrl-]": "indentMore",
        "Ctrl-U": "undoSelection",
        "Shift-Ctrl-U": "redoSelection",
        "Alt-U": "redoSelection",
        fallthrough: "basic"
    }, eg.emacsy = {
        "Ctrl-F": "goCharRight",
        "Ctrl-B": "goCharLeft",
        "Ctrl-P": "goLineUp",
        "Ctrl-N": "goLineDown",
        "Alt-F": "goWordRight",
        "Alt-B": "goWordLeft",
        "Ctrl-A": "goLineStart",
        "Ctrl-E": "goLineEnd",
        "Ctrl-V": "goPageDown",
        "Shift-Ctrl-V": "goPageUp",
        "Ctrl-D": "delCharAfter",
        "Ctrl-H": "delCharBefore",
        "Alt-D": "delWordAfter",
        "Alt-Backspace": "delWordBefore",
        "Ctrl-K": "killLine",
        "Ctrl-T": "transposeChars"
    }, eg.macDefault = {
        "Cmd-A": "selectAll",
        "Cmd-D": "deleteLine",
        "Cmd-Z": "undo",
        "Shift-Cmd-Z": "redo",
        "Cmd-Y": "redo",
        "Cmd-Home": "goDocStart",
        "Cmd-Up": "goDocStart",
        "Cmd-End": "goDocEnd",
        "Cmd-Down": "goDocEnd",
        "Alt-Left": "goGroupLeft",
        "Alt-Right": "goGroupRight",
        "Cmd-Left": "goLineLeft",
        "Cmd-Right": "goLineRight",
        "Alt-Backspace": "delGroupBefore",
        "Ctrl-Alt-Backspace": "delGroupAfter",
        "Alt-Delete": "delGroupAfter",
        "Cmd-S": "save",
        "Cmd-F": "find",
        "Cmd-G": "findNext",
        "Shift-Cmd-G": "findPrev",
        "Cmd-Alt-F": "replace",
        "Shift-Cmd-Alt-F": "replaceAll",
        "Cmd-[": "indentLess",
        "Cmd-]": "indentMore",
        "Cmd-Backspace": "delWrappedLineLeft",
        "Cmd-Delete": "delWrappedLineRight",
        "Cmd-U": "undoSelection",
        "Shift-Cmd-U": "redoSelection",
        "Ctrl-Up": "goDocStart",
        "Ctrl-Down": "goDocEnd",
        fallthrough: ["basic", "emacsy"]
    }, eg.default = yf ? eg.macDefault : eg.pcDefault, a.normalizeKeyMap = function (a) {
        var b = {};
        for (var c in a)if (a.hasOwnProperty(c)) {
            var d = a[c];
            if (/^(name|fallthrough|(de|at)tach)$/.test(c))continue;
            if ("..." == d) {
                delete a[c];
                continue
            }
            for (var e = Ee(c.split(" "), Qc), f = 0; f < e.length; f++) {
                var g, h;
                f == e.length - 1 ? (h = e.join(" "), g = d) : (h = e.slice(0, f + 1).join(" "), g = "...");
                var i = b[h];
                if (i) {
                    if (i != g)throw new Error("Inconsistent bindings for " + h)
                } else b[h] = g
            }
            delete a[c]
        }
        for (var j in b)a[j] = b[j];
        return a
    };
    var fg = a.lookupKey = function (a, b, c, d) {
        b = Rc(b);
        var e = b.call ? b.call(a, d) : b[a];
        if (e === !1)return "nothing";
        if ("..." === e)return "multi";
        if (null != e && c(e))return "handled";
        if (b.fallthrough) {
            if ("[object Array]" != Object.prototype.toString.call(b.fallthrough))return fg(a, b.fallthrough, c, d);
            for (var f = 0; f < b.fallthrough.length; f++) {
                var g = fg(a, b.fallthrough[f], c, d);
                if (g)return g
            }
        }
    }, gg = a.isModifierKey = function (a) {
        var b = "string" == typeof a ? a : Yg[a.keyCode];
        return "Ctrl" == b || "Alt" == b || "Shift" == b || "Mod" == b
    }, hg = a.keyName = function (a, b) {
        if (sf && 34 == a.keyCode && a.char)return !1;
        var c = Yg[a.keyCode], d = c;
        return null != d && !a.altGraphKey && (a.altKey && "Alt" != c && (d = "Alt-" + d), (Bf ? a.metaKey : a.ctrlKey) && "Ctrl" != c && (d = "Ctrl-" + d), (Bf ? a.ctrlKey : a.metaKey) && "Cmd" != c && (d = "Cmd-" + d), !b && a.shiftKey && "Shift" != c && (d = "Shift-" + d), d)
    };
    a.fromTextArea = function (b, c) {
        function d() {
            b.value = i.getValue()
        }

        if (c = c ? He(c) : {}, c.value = b.value, !c.tabindex && b.tabIndex && (c.tabindex = b.tabIndex), !c.placeholder && b.placeholder && (c.placeholder = b.placeholder), null == c.autofocus) {
            var e = Pe();
            c.autofocus = e == b || null != b.getAttribute("autofocus") && e == document.body
        }
        if (b.form && (xg(b.form, "submit", d), !c.leaveSubmitMethodAlone)) {
            var f = b.form, g = f.submit;
            try {
                var h = f.submit = function () {
                    d(), f.submit = g, f.submit(), f.submit = h
                }
            } catch (a) {
            }
        }
        c.finishInit = function (a) {
            a.save = d, a.getTextArea = function () {
                return b
            }, a.toTextArea = function () {
                a.toTextArea = isNaN, d(), b.parentNode.removeChild(a.getWrapperElement()), b.style.display = "", b.form && (yg(b.form, "submit", d), "function" == typeof b.form.submit && (b.form.submit = g))
            }
        }, b.style.display = "none";
        var i = a(function (a) {
            b.parentNode.insertBefore(a, b.nextSibling)
        }, c);
        return i
    };
    var ig = a.StringStream = function (a, b) {
        this.pos = this.start = 0, this.string = a, this.tabSize = b || 8, this.lastColumnPos = this.lastColumnValue = 0, this.lineStart = 0
    };
    ig.prototype = {
        eol: function () {
            return this.pos >= this.string.length
        }, sol: function () {
            return this.pos == this.lineStart
        }, peek: function () {
            return this.string.charAt(this.pos) || void 0
        }, next: function () {
            if (this.pos < this.string.length)return this.string.charAt(this.pos++)
        }, eat: function (a) {
            var b = this.string.charAt(this.pos);
            if ("string" == typeof a)var c = b == a; else var c = b && (a.test ? a.test(b) : a(b));
            if (c)return ++this.pos, b
        }, eatWhile: function (a) {
            for (var b = this.pos; this.eat(a););
            return this.pos > b
        }, eatSpace: function () {
            for (var a = this.pos; /[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;
            return this.pos > a
        }, skipToEnd: function () {
            this.pos = this.string.length
        }, skipTo: function (a) {
            var b = this.string.indexOf(a, this.pos);
            if (b > -1)return this.pos = b, !0
        }, backUp: function (a) {
            this.pos -= a
        }, column: function () {
            return this.lastColumnPos < this.start && (this.lastColumnValue = Gg(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue), this.lastColumnPos = this.start), this.lastColumnValue - (this.lineStart ? Gg(this.string, this.lineStart, this.tabSize) : 0)
        }, indentation: function () {
            return Gg(this.string, null, this.tabSize) - (this.lineStart ? Gg(this.string, this.lineStart, this.tabSize) : 0)
        }, match: function (a, b, c) {
            if ("string" != typeof a) {
                var d = this.string.slice(this.pos).match(a);
                return d && d.index > 0 ? null : (d && b !== !1 && (this.pos += d[0].length), d)
            }
            var e = function (a) {
                return c ? a.toLowerCase() : a
            }, f = this.string.substr(this.pos, a.length);
            if (e(f) == e(a))return b !== !1 && (this.pos += a.length), !0
        }, current: function () {
            return this.string.slice(this.start, this.pos)
        }, hideFirstChars: function (a, b) {
            this.lineStart += a;
            try {
                return b()
            } finally {
                this.lineStart -= a
            }
        }
    };
    var jg = 0, kg = a.TextMarker = function (a, b) {
        this.lines = [], this.type = b, this.doc = a, this.id = ++jg
    };
    ye(kg), kg.prototype.clear = function () {
        if (!this.explicitlyCleared) {
            var a = this.doc.cm, b = a && !a.curOp;
            if (b && tb(a), xe(this, "clear")) {
                var c = this.find();
                c && te(this, "clear", c.from, c.to)
            }
            for (var d = null, e = null, f = 0; f < this.lines.length; ++f) {
                var g = this.lines[f], h = Yc(g.markedSpans, this);
                a && !this.collapsed ? Jb(a, Zd(g), "text") : a && (null != h.to && (e = Zd(g)), null != h.from && (d = Zd(g))), g.markedSpans = Zc(g.markedSpans, h), null == h.from && this.collapsed && !sd(this.doc, g) && a && Yd(g, rb(a.display))
            }
            if (a && this.collapsed && !a.options.lineWrapping)for (var f = 0; f < this.lines.length; ++f) {
                var i = od(this.lines[f]), j = l(i);
                j > a.display.maxLineLength && (a.display.maxLine = i, a.display.maxLineLength = j, a.display.maxLineChanged = !0)
            }
            null != d && a && this.collapsed && Ib(a, d, e + 1), this.lines.length = 0, this.explicitlyCleared = !0, this.atomic && this.doc.cantEdit && (this.doc.cantEdit = !1, a && Ea(a.doc)), a && te(a, "markerCleared", a, this), b && vb(a), this.parent && this.parent.clear()
        }
    }, kg.prototype.find = function (a, b) {
        null == a && "bookmark" == this.type && (a = 1);
        for (var c, d, e = 0; e < this.lines.length; ++e) {
            var f = this.lines[e], g = Yc(f.markedSpans, this);
            if (null != g.from && (c = Ff(b ? f : Zd(f), g.from), a == -1))return c;
            if (null != g.to && (d = Ff(b ? f : Zd(f), g.to), 1 == a))return d
        }
        return c && {from: c, to: d}
    }, kg.prototype.changed = function () {
        var a = this.find(-1, !0), b = this, c = this.doc.cm;
        a && c && Cb(c, function () {
            var d = a.line, e = Zd(a.line), f = $a(c, e);
            if (f && (eb(f), c.curOp.selectionChanged = c.curOp.forceUpdate = !0), c.curOp.updateMaxLine = !0, !sd(b.doc, d) && null != b.height) {
                var g = b.height;
                b.height = null;
                var h = vd(b) - g;
                h && Yd(d, d.height + h)
            }
        })
    }, kg.prototype.attachLine = function (a) {
        if (!this.lines.length && this.doc.cm) {
            var b = this.doc.cm.curOp;
            b.maybeHiddenMarkers && De(b.maybeHiddenMarkers, this) != -1 || (b.maybeUnhiddenMarkers || (b.maybeUnhiddenMarkers = [])).push(this)
        }
        this.lines.push(a)
    }, kg.prototype.detachLine = function (a) {
        if (this.lines.splice(De(this.lines, a), 1), !this.lines.length && this.doc.cm) {
            var b = this.doc.cm.curOp;
            (b.maybeHiddenMarkers || (b.maybeHiddenMarkers = [])).push(this)
        }
    };
    var jg = 0, lg = a.SharedTextMarker = function (a, b) {
        this.markers = a, this.primary = b;
        for (var c = 0; c < a.length; ++c)a[c].parent = this
    };
    ye(lg), lg.prototype.clear = function () {
        if (!this.explicitlyCleared) {
            this.explicitlyCleared = !0;
            for (var a = 0; a < this.markers.length; ++a)this.markers[a].clear();
            te(this, "clear")
        }
    }, lg.prototype.find = function (a, b) {
        return this.primary.find(a, b)
    };
    var mg = a.LineWidget = function (a, b, c) {
        if (c)for (var d in c)c.hasOwnProperty(d) && (this[d] = c[d]);
        this.doc = a, this.node = b
    };
    ye(mg), mg.prototype.clear = function () {
        var a = this.doc.cm, b = this.line.widgets, c = this.line, d = Zd(c);
        if (null != d && b) {
            for (var e = 0; e < b.length; ++e)b[e] == this && b.splice(e--, 1);
            b.length || (c.widgets = null);
            var f = vd(this);
            Yd(c, Math.max(0, c.height - f)), a && Cb(a, function () {
                ud(a, c, -f), Jb(a, d, "widget")
            })
        }
    }, mg.prototype.changed = function () {
        var a = this.height, b = this.doc.cm, c = this.line;
        this.height = null;
        var d = vd(this) - a;
        d && (Yd(c, c.height + d), b && Cb(b, function () {
            b.curOp.forceUpdate = !0, ud(b, c, d)
        }))
    };
    var ng = a.Line = function (a, b, c) {
        this.text = a, gd(this, b), this.height = c ? c(this) : 1
    };
    ye(ng), ng.prototype.lineNo = function () {
        return Zd(this)
    };
    var og = {}, pg = {};
    Rd.prototype = {
        chunkSize: function () {
            return this.lines.length
        }, removeInner: function (a, b) {
            for (var c = a, d = a + b; c < d; ++c) {
                var e = this.lines[c];
                this.height -= e.height, yd(e), te(e, "delete")
            }
            this.lines.splice(a, b)
        }, collapse: function (a) {
            a.push.apply(a, this.lines)
        }, insertInner: function (a, b, c) {
            this.height += c, this.lines = this.lines.slice(0, a).concat(b).concat(this.lines.slice(a));
            for (var d = 0; d < b.length; ++d)b[d].parent = this
        }, iterN: function (a, b, c) {
            for (var d = a + b; a < d; ++a)if (c(this.lines[a]))return !0
        }
    }, Sd.prototype = {
        chunkSize: function () {
            return this.size
        }, removeInner: function (a, b) {
            this.size -= b;
            for (var c = 0; c < this.children.length; ++c) {
                var d = this.children[c], e = d.chunkSize();
                if (a < e) {
                    var f = Math.min(b, e - a), g = d.height;
                    if (d.removeInner(a, f), this.height -= g - d.height, e == f && (this.children.splice(c--, 1), d.parent = null), 0 == (b -= f))break;
                    a = 0
                } else a -= e
            }
            if (this.size - b < 25 && (this.children.length > 1 || !(this.children[0]instanceof Rd))) {
                var h = [];
                this.collapse(h), this.children = [new Rd(h)], this.children[0].parent = this
            }
        }, collapse: function (a) {
            for (var b = 0; b < this.children.length; ++b)this.children[b].collapse(a)
        }, insertInner: function (a, b, c) {
            this.size += b.length, this.height += c;
            for (var d = 0; d < this.children.length; ++d) {
                var e = this.children[d], f = e.chunkSize();
                if (a <= f) {
                    if (e.insertInner(a, b, c), e.lines && e.lines.length > 50) {
                        for (; e.lines.length > 50;) {
                            var g = e.lines.splice(e.lines.length - 25, 25), h = new Rd(g);
                            e.height -= h.height, this.children.splice(d + 1, 0, h), h.parent = this
                        }
                        this.maybeSpill()
                    }
                    break
                }
                a -= f
            }
        }, maybeSpill: function () {
            if (!(this.children.length <= 10)) {
                var a = this;
                do {
                    var b = a.children.splice(a.children.length - 5, 5), c = new Sd(b);
                    if (a.parent) {
                        a.size -= c.size, a.height -= c.height;
                        var d = De(a.parent.children, a);
                        a.parent.children.splice(d + 1, 0, c)
                    } else {
                        var e = new Sd(a.children);
                        e.parent = a, a.children = [e, c], a = e
                    }
                    c.parent = a.parent
                } while (a.children.length > 10);
                a.parent.maybeSpill()
            }
        }, iterN: function (a, b, c) {
            for (var d = 0; d < this.children.length; ++d) {
                var e = this.children[d], f = e.chunkSize();
                if (a < f) {
                    var g = Math.min(b, f - a);
                    if (e.iterN(a, g, c))return !0;
                    if (0 == (b -= g))break;
                    a = 0
                } else a -= f
            }
        }
    };
    var qg = 0, rg = a.Doc = function (a, b, c) {
        if (!(this instanceof rg))return new rg(a, b, c);
        null == c && (c = 0), Sd.call(this, [new Rd([new ng("", null)])]), this.first = c, this.scrollTop = this.scrollLeft = 0, this.cantEdit = !1, this.cleanGeneration = 1, this.frontier = c;
        var d = Ff(c, 0);
        this.sel = oa(d), this.history = new be(null), this.id = ++qg, this.modeOption = b, "string" == typeof a && (a = Ug(a)), Qd(this, {
            from: d,
            to: d,
            text: a
        }), Ba(this, oa(d), Dg)
    };
    rg.prototype = Ge(Sd.prototype, {
        constructor: rg, iter: function (a, b, c) {
            c ? this.iterN(a - this.first, b - a, c) : this.iterN(this.first, this.first + this.size, a)
        }, insert: function (a, b) {
            for (var c = 0, d = 0; d < b.length; ++d)c += b[d].height;
            this.insertInner(a - this.first, b, c)
        }, remove: function (a, b) {
            this.removeInner(a - this.first, b)
        }, getValue: function (a) {
            var b = Xd(this, this.first, this.first + this.size);
            return a === !1 ? b : b.join(a || "\n")
        }, setValue: Fb(function (a) {
            var b = Ff(this.first, 0), c = this.first + this.size - 1;
            wc(this, {
                from: b,
                to: Ff(c, Vd(this, c).text.length),
                text: Ug(a),
                origin: "setValue",
                full: !0
            }, !0), Ba(this, oa(b))
        }), replaceRange: function (a, b, c, d) {
            b = qa(this, b), c = c ? qa(this, c) : b, Cc(this, a, b, c, d)
        }, getRange: function (a, b, c) {
            var d = Wd(this, qa(this, a), qa(this, b));
            return c === !1 ? d : d.join(c || "\n")
        }, getLine: function (a) {
            var b = this.getLineHandle(a);
            return b && b.text
        }, getLineHandle: function (a) {
            if (sa(this, a))return Vd(this, a)
        }, getLineNumber: function (a) {
            return Zd(a)
        }, getLineHandleVisualStart: function (a) {
            return "number" == typeof a && (a = Vd(this, a)), od(a)
        }, lineCount: function () {
            return this.size
        }, firstLine: function () {
            return this.first
        }, lastLine: function () {
            return this.first + this.size - 1
        }, clipPos: function (a) {
            return qa(this, a)
        }, getCursor: function (a) {
            var b, c = this.sel.primary();
            return b = null == a || "head" == a ? c.head : "anchor" == a ? c.anchor : "end" == a || "to" == a || a === !1 ? c.to() : c.from()
        }, listSelections: function () {
            return this.sel.ranges
        }, somethingSelected: function () {
            return this.sel.somethingSelected()
        }, setCursor: Fb(function (a, b, c) {
            ya(this, qa(this, "number" == typeof a ? Ff(a, b || 0) : a), null, c)
        }), setSelection: Fb(function (a, b, c) {
            ya(this, qa(this, a), qa(this, b || a), c)
        }), extendSelection: Fb(function (a, b, c) {
            va(this, qa(this, a), b && qa(this, b), c)
        }), extendSelections: Fb(function (a, b) {
            wa(this, ta(this, a, b))
        }), extendSelectionsBy: Fb(function (a, b) {
            wa(this, Ee(this.sel.ranges, a), b)
        }), setSelections: Fb(function (a, b, c) {
            if (a.length) {
                for (var d = 0, e = []; d < a.length; d++)e[d] = new ma(qa(this, a[d].anchor), qa(this, a[d].head));
                null == b && (b = Math.min(a.length - 1, this.sel.primIndex)), Ba(this, na(e, b), c)
            }
        }), addSelection: Fb(function (a, b, c) {
            var d = this.sel.ranges.slice(0);
            d.push(new ma(qa(this, a), qa(this, b || a))), Ba(this, na(d, d.length - 1), c)
        }), getSelection: function (a) {
            for (var b, c = this.sel.ranges, d = 0; d < c.length; d++) {
                var e = Wd(this, c[d].from(), c[d].to());
                b = b ? b.concat(e) : e
            }
            return a === !1 ? b : b.join(a || "\n")
        }, getSelections: function (a) {
            for (var b = [], c = this.sel.ranges, d = 0; d < c.length; d++) {
                var e = Wd(this, c[d].from(), c[d].to());
                a !== !1 && (e = e.join(a || "\n")), b[d] = e
            }
            return b
        }, replaceSelection: function (a, b, c) {
            for (var d = [], e = 0; e < this.sel.ranges.length; e++)d[e] = a;
            this.replaceSelections(d, b, c || "+input")
        }, replaceSelections: Fb(function (a, b, c) {
            for (var d = [], e = this.sel, f = 0; f < e.ranges.length; f++) {
                var g = e.ranges[f];
                d[f] = {from: g.from(), to: g.to(), text: Ug(a[f]), origin: c}
            }
            for (var h = b && "end" != b && uc(this, d, b), f = d.length - 1; f >= 0; f--)wc(this, d[f]);
            h ? Aa(this, h) : this.cm && Ic(this.cm)
        }), undo: Fb(function () {
            yc(this, "undo")
        }), redo: Fb(function () {
            yc(this, "redo")
        }), undoSelection: Fb(function () {
            yc(this, "undo", !0)
        }), redoSelection: Fb(function () {
            yc(this, "redo", !0)
        }), setExtending: function (a) {
            this.extend = a
        }, getExtending: function () {
            return this.extend
        }, historySize: function () {
            for (var a = this.history, b = 0, c = 0, d = 0; d < a.done.length; d++)a.done[d].ranges || ++b;
            for (var d = 0; d < a.undone.length; d++)a.undone[d].ranges || ++c;
            return {undo: b, redo: c}
        }, clearHistory: function () {
            this.history = new be(this.history.maxGeneration)
        }, markClean: function () {
            this.cleanGeneration = this.changeGeneration(!0)
        }, changeGeneration: function (a) {
            return a && (this.history.lastOp = this.history.lastSelOp = this.history.lastOrigin = null), this.history.generation
        }, isClean: function (a) {
            return this.history.generation == (a || this.cleanGeneration)
        }, getHistory: function () {
            return {done: me(this.history.done), undone: me(this.history.undone)}
        }, setHistory: function (a) {
            var b = this.history = new be(this.history.maxGeneration);
            b.done = me(a.done.slice(0), null, !0), b.undone = me(a.undone.slice(0), null, !0)
        }, addLineClass: Fb(function (a, b, c) {
            return Lc(this, a, "gutter" == b ? "gutter" : "class", function (a) {
                var d = "text" == b ? "textClass" : "background" == b ? "bgClass" : "gutter" == b ? "gutterClass" : "wrapClass";
                if (a[d]) {
                    if (Qe(c).test(a[d]))return !1;
                    a[d] += " " + c
                } else a[d] = c;
                return !0
            })
        }), removeLineClass: Fb(function (a, b, c) {
            return Lc(this, a, "gutter" == b ? "gutter" : "class", function (a) {
                var d = "text" == b ? "textClass" : "background" == b ? "bgClass" : "gutter" == b ? "gutterClass" : "wrapClass", e = a[d];
                if (!e)return !1;
                if (null == c)a[d] = null; else {
                    var f = e.match(Qe(c));
                    if (!f)return !1;
                    var g = f.index + f[0].length;
                    a[d] = e.slice(0, f.index) + (f.index && g != e.length ? " " : "") + e.slice(g) || null
                }
                return !0
            })
        }), addLineWidget: Fb(function (a, b, c) {
            return wd(this, a, b, c)
        }), removeLineWidget: function (a) {
            a.clear()
        }, markText: function (a, b, c) {
            return Sc(this, qa(this, a), qa(this, b), c, "range")
        }, setBookmark: function (a, b) {
            var c = {
                replacedWith: b && (null == b.nodeType ? b.widget : b),
                insertLeft: b && b.insertLeft,
                clearWhenEmpty: !1,
                shared: b && b.shared,
                handleMouseEvents: b && b.handleMouseEvents
            };
            return a = qa(this, a), Sc(this, a, a, c, "bookmark")
        }, findMarksAt: function (a) {
            a = qa(this, a);
            var b = [], c = Vd(this, a.line).markedSpans;
            if (c)for (var d = 0; d < c.length; ++d) {
                var e = c[d];
                (null == e.from || e.from <= a.ch) && (null == e.to || e.to >= a.ch) && b.push(e.marker.parent || e.marker)
            }
            return b
        }, findMarks: function (a, b, c) {
            a = qa(this, a), b = qa(this, b);
            var d = [], e = a.line;
            return this.iter(a.line, b.line + 1, function (f) {
                var g = f.markedSpans;
                if (g)for (var h = 0; h < g.length; h++) {
                    var i = g[h];
                    e == a.line && a.ch > i.to || null == i.from && e != a.line || e == b.line && i.from > b.ch || c && !c(i.marker) || d.push(i.marker.parent || i.marker)
                }
                ++e
            }), d
        }, getAllMarks: function () {
            var a = [];
            return this.iter(function (b) {
                var c = b.markedSpans;
                if (c)for (var d = 0; d < c.length; ++d)null != c[d].from && a.push(c[d].marker)
            }), a
        }, posFromIndex: function (a) {
            var b, c = this.first;
            return this.iter(function (d) {
                var e = d.text.length + 1;
                return e > a ? (b = a, !0) : (a -= e, void++c)
            }), qa(this, Ff(c, b))
        }, indexFromPos: function (a) {
            a = qa(this, a);
            var b = a.ch;
            return a.line < this.first || a.ch < 0 ? 0 : (this.iter(this.first, a.line, function (a) {
                b += a.text.length + 1
            }), b)
        }, copy: function (a) {
            var b = new rg(Xd(this, this.first, this.first + this.size), this.modeOption, this.first);
            return b.scrollTop = this.scrollTop, b.scrollLeft = this.scrollLeft, b.sel = this.sel, b.extend = !1, a && (b.history.undoDepth = this.history.undoDepth, b.setHistory(this.getHistory())), b
        }, linkedDoc: function (a) {
            a || (a = {});
            var b = this.first, c = this.first + this.size;
            null != a.from && a.from > b && (b = a.from), null != a.to && a.to < c && (c = a.to);
            var d = new rg(Xd(this, b, c), a.mode || this.modeOption, b);
            return a.sharedHist && (d.history = this.history), (this.linked || (this.linked = [])).push({
                doc: d,
                sharedHist: a.sharedHist
            }), d.linked = [{doc: this, isParent: !0, sharedHist: a.sharedHist}], Vc(d, Uc(this)), d
        }, unlinkDoc: function (b) {
            if (b instanceof a && (b = b.doc), this.linked)for (var c = 0; c < this.linked.length; ++c) {
                var d = this.linked[c];
                if (d.doc == b) {
                    this.linked.splice(c, 1), b.unlinkDoc(this), Wc(Uc(this));
                    break
                }
            }
            if (b.history == this.history) {
                var e = [b.id];
                Td(b, function (a) {
                    e.push(a.id)
                }, !0), b.history = new be(null), b.history.done = me(this.history.done, e), b.history.undone = me(this.history.undone, e)
            }
        }, iterLinkedDocs: function (a) {
            Td(this, a)
        }, getMode: function () {
            return this.mode
        }, getEditor: function () {
            return this.cm
        }
    }), rg.prototype.eachLine = rg.prototype.iter;
    var sg = "iter insert remove copy getEditor constructor".split(" ");
    for (var tg in rg.prototype)rg.prototype.hasOwnProperty(tg) && De(sg, tg) < 0 && (a.prototype[tg] = function (a) {
        return function () {
            return a.apply(this.doc, arguments)
        }
    }(rg.prototype[tg]));
    ye(rg);
    var ug = a.e_preventDefault = function (a) {
        a.preventDefault ? a.preventDefault() : a.returnValue = !1
    }, vg = a.e_stopPropagation = function (a) {
        a.stopPropagation ? a.stopPropagation() : a.cancelBubble = !0
    }, wg = a.e_stop = function (a) {
        ug(a), vg(a)
    }, xg = a.on = function (a, b, c) {
        if (a.addEventListener)a.addEventListener(b, c, !1); else if (a.attachEvent)a.attachEvent("on" + b, c); else {
            var d = a._handlers || (a._handlers = {}), e = d[b] || (d[b] = []);
            e.push(c)
        }
    }, yg = a.off = function (a, b, c) {
        if (a.removeEventListener)a.removeEventListener(b, c, !1); else if (a.detachEvent)a.detachEvent("on" + b, c); else {
            var d = a._handlers && a._handlers[b];
            if (!d)return;
            for (var e = 0; e < d.length; ++e)if (d[e] == c) {
                d.splice(e, 1);
                break
            }
        }
    }, zg = a.signal = function (a, b) {
        var c = a._handlers && a._handlers[b];
        if (c)for (var d = Array.prototype.slice.call(arguments, 2), e = 0; e < c.length; ++e)c[e].apply(null, d)
    }, Ag = null, Bg = 30, Cg = a.Pass = {
        toString: function () {
            return "CodeMirror.Pass"
        }
    }, Dg = {scroll: !1}, Eg = {origin: "*mouse"}, Fg = {origin: "+move"};
    ze.prototype.set = function (a, b) {
        clearTimeout(this.id), this.id = setTimeout(b, a)
    };
    var Gg = a.countColumn = function (a, b, c, d, e) {
        null == b && (b = a.search(/[^\s\u00a0]/), b == -1 && (b = a.length));
        for (var f = d || 0, g = e || 0; ;) {
            var h = a.indexOf("\t", f);
            if (h < 0 || h >= b)return g + (b - f);
            g += h - f, g += c - g % c, f = h + 1
        }
    }, Hg = [""], Ig = function (a) {
        a.select()
    };
    wf ? Ig = function (a) {
        a.selectionStart = 0, a.selectionEnd = a.value.length
    } : nf && (Ig = function (a) {
            try {
                a.select()
            } catch (a) {
            }
        });
    var Jg, Kg = /[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/, Lg = a.isWordChar = function (a) {
        return /\w/.test(a) || a > "" && (a.toUpperCase() != a.toLowerCase() || Kg.test(a))
    }, Mg = /[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;
    Jg = document.createRange ? function (a, b, c, d) {
        var e = document.createRange();
        return e.setEnd(d || a, c), e.setStart(a, b), e
    } : function (a, b, c) {
        var d = document.body.createTextRange();
        try {
            d.moveToElementText(a.parentNode)
        } catch (a) {
            return d
        }
        return d.collapse(!0), d.moveEnd("character", c), d.moveStart("character", b), d
    };
    var Ng = a.contains = function (a, b) {
        if (3 == b.nodeType && (b = b.parentNode), a.contains)return a.contains(b);
        do if (11 == b.nodeType && (b = b.host), b == a)return !0; while (b = b.parentNode)
    };
    nf && of < 11 && (Pe = function () {
        try {
            return document.activeElement;
        } catch (a) {
            return document.body
        }
    });
    var Og, Pg, Qg = a.rmClass = function (a, b) {
        var c = a.className, d = Qe(b).exec(c);
        if (d) {
            var e = c.slice(d.index + d[0].length);
            a.className = c.slice(0, d.index) + (e ? d[1] + e : "")
        }
    }, Rg = a.addClass = function (a, b) {
        var c = a.className;
        Qe(b).test(c) || (a.className += (c ? " " : "") + b)
    }, Sg = !1, Tg = function () {
        if (nf && of < 9)return !1;
        var a = Me("div");
        return "draggable"in a || "dragDrop"in a
    }(), Ug = a.splitLines = 3 != "\n\nb".split(/\n/).length ? function (a) {
        for (var b = 0, c = [], d = a.length; b <= d;) {
            var e = a.indexOf("\n", b);
            e == -1 && (e = a.length);
            var f = a.slice(b, "\r" == a.charAt(e - 1) ? e - 1 : e), g = f.indexOf("\r");
            g != -1 ? (c.push(f.slice(0, g)), b += g + 1) : (c.push(f), b = e + 1)
        }
        return c
    } : function (a) {
        return a.split(/\r\n?|\n/)
    }, Vg = window.getSelection ? function (a) {
        try {
            return a.selectionStart != a.selectionEnd
        } catch (a) {
            return !1
        }
    } : function (a) {
        try {
            var b = a.ownerDocument.selection.createRange()
        } catch (a) {
        }
        return !(!b || b.parentElement() != a) && 0 != b.compareEndPoints("StartToEnd", b)
    }, Wg = function () {
        var a = Me("div");
        return "oncopy"in a || (a.setAttribute("oncopy", "return;"), "function" == typeof a.oncopy)
    }(), Xg = null, Yg = {
        3: "Enter",
        8: "Backspace",
        9: "Tab",
        13: "Enter",
        16: "Shift",
        17: "Ctrl",
        18: "Alt",
        19: "Pause",
        20: "CapsLock",
        27: "Esc",
        32: "Space",
        33: "PageUp",
        34: "PageDown",
        35: "End",
        36: "Home",
        37: "Left",
        38: "Up",
        39: "Right",
        40: "Down",
        44: "PrintScrn",
        45: "Insert",
        46: "Delete",
        59: ";",
        61: "=",
        91: "Mod",
        92: "Mod",
        93: "Mod",
        107: "=",
        109: "-",
        127: "Delete",
        173: "-",
        186: ";",
        187: "=",
        188: ",",
        189: "-",
        190: ".",
        191: "/",
        192: "`",
        219: "[",
        220: "\\",
        221: "]",
        222: "'",
        63232: "Up",
        63233: "Down",
        63234: "Left",
        63235: "Right",
        63272: "Delete",
        63273: "Home",
        63275: "End",
        63276: "PageUp",
        63277: "PageDown",
        63302: "Insert"
    };
    a.keyNames = Yg, function () {
        for (var a = 0; a < 10; a++)Yg[a + 48] = Yg[a + 96] = String(a);
        for (var a = 65; a <= 90; a++)Yg[a] = String.fromCharCode(a);
        for (var a = 1; a <= 12; a++)Yg[a + 111] = Yg[a + 63235] = "F" + a
    }();
    var Zg, $g = function () {
        function a(a) {
            return a <= 247 ? c.charAt(a) : 1424 <= a && a <= 1524 ? "R" : 1536 <= a && a <= 1773 ? d.charAt(a - 1536) : 1774 <= a && a <= 2220 ? "r" : 8192 <= a && a <= 8203 ? "w" : 8204 == a ? "b" : "L"
        }

        function b(a, b, c) {
            this.level = a, this.from = b, this.to = c
        }

        var c = "bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN", d = "rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm", e = /[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/, f = /[stwN]/, g = /[LRr]/, h = /[Lb1n]/, i = /[1n]/, j = "L";
        return function (c) {
            if (!e.test(c))return !1;
            for (var d, k = c.length, l = [], m = 0; m < k; ++m)l.push(d = a(c.charCodeAt(m)));
            for (var m = 0, n = j; m < k; ++m) {
                var d = l[m];
                "m" == d ? l[m] = n : n = d
            }
            for (var m = 0, o = j; m < k; ++m) {
                var d = l[m];
                "1" == d && "r" == o ? l[m] = "n" : g.test(d) && (o = d, "r" == d && (l[m] = "R"))
            }
            for (var m = 1, n = l[0]; m < k - 1; ++m) {
                var d = l[m];
                "+" == d && "1" == n && "1" == l[m + 1] ? l[m] = "1" : "," != d || n != l[m + 1] || "1" != n && "n" != n || (l[m] = n), n = d
            }
            for (var m = 0; m < k; ++m) {
                var d = l[m];
                if ("," == d)l[m] = "N"; else if ("%" == d) {
                    for (var p = m + 1; p < k && "%" == l[p]; ++p);
                    for (var q = m && "!" == l[m - 1] || p < k && "1" == l[p] ? "1" : "N", r = m; r < p; ++r)l[r] = q;
                    m = p - 1
                }
            }
            for (var m = 0, o = j; m < k; ++m) {
                var d = l[m];
                "L" == o && "1" == d ? l[m] = "L" : g.test(d) && (o = d)
            }
            for (var m = 0; m < k; ++m)if (f.test(l[m])) {
                for (var p = m + 1; p < k && f.test(l[p]); ++p);
                for (var s = "L" == (m ? l[m - 1] : j), t = "L" == (p < k ? l[p] : j), q = s || t ? "L" : "R", r = m; r < p; ++r)l[r] = q;
                m = p - 1
            }
            for (var u, v = [], m = 0; m < k;)if (h.test(l[m])) {
                var w = m;
                for (++m; m < k && h.test(l[m]); ++m);
                v.push(new b(0, w, m))
            } else {
                var x = m, y = v.length;
                for (++m; m < k && "L" != l[m]; ++m);
                for (var r = x; r < m;)if (i.test(l[r])) {
                    x < r && v.splice(y, 0, new b(1, x, r));
                    var z = r;
                    for (++r; r < m && i.test(l[r]); ++r);
                    v.splice(y, 0, new b(2, z, r)), x = r
                } else++r;
                x < m && v.splice(y, 0, new b(1, x, m))
            }
            return 1 == v[0].level && (u = c.match(/^\s+/)) && (v[0].from = u[0].length, v.unshift(new b(0, 0, u[0].length))), 1 == Ce(v).level && (u = c.match(/\s+$/)) && (Ce(v).to -= u[0].length, v.push(new b(0, k - u[0].length, k))), 2 == v[0].level && v.unshift(new b(1, v[0].to, v[0].to)), v[0].level != Ce(v).level && v.push(new b(v[0].level, k, k)), v
        }
    }();
    return a.version = "5.4.1", a
}),function (a) {
    YS.FormulaEditor = YS.extend(YS.Widget, {
        CONST: {
            NAME_FILED_CLS: "cm-field-name",
            VALUE_FIELD_CLS: "cm-field-value",
            INVALID_FIELD_CLS: "cm-field-invalid",
            DEPRECATE_FIELD_CLS: "cm-deprecate"
        }, _defaultConfig: function () {
            return a.extend(YS.FormulaEditor.superclass._defaultConfig.apply(), {
                baseCls: "x-formula-editor",
                keywords: [],
                text: "公式",
                hasFunction: !0,
                labelMap: null
            })
        }, _init: function () {
            YS.FormulaEditor.superclass._init.apply(this, arguments);
            var b = this.options, c = "<li>请从左侧面板选择包含的字段名</li>";
            b.hasFunction && (c += '<li>支持<span class="x-c-red">英文</span>运算符模式下的基础运算</li><li>公式编辑样式举例:<span class="formula-key">SUM</span>(<span class="formula-field">基本工资</span>,<span class="formula-field">加班工资</span>)</li>', this.element.addClass("has-func")), this.element.append(a('<div class="formula-head"/>').append(a('<span class="formula-name"/>').text(b.text)).append(a('<span class="formula-equal"/>').text("="))).append(a('<div class="formula-foot"><ul>' + c + "</ul></div>")), this.editor = CodeMirror(this.element[0], {
                keywords: b.keywords,
                textWrapping: !0,
                lineWrapping: !0,
                lineNumbers: !1,
                specialChars: /[\u0000-\u001f\u007f\u00ad\u200c-\u200f\u2028\u2029\ufeff]/,
                mode: "formula"
            }), this.editor.on("change", function (a, b) {
                CodeMirror.showHint(a, CodeMirror.formulaHint, {completeSingle: !1})
            }), this.editor.addKeyMap({
                Backspace: function (a) {
                    var b = a.getTokenAt(a.getCursor());
                    if ("field" == b.type) {
                        var c = a.getCursor().line;
                        a.setSelection(new CodeMirror.Pos(c, b.start), new CodeMirror.Pos(c, b.end)), a.replaceSelection("", null, "+delete")
                    } else a.execCommand("delCharBefore")
                }
            })
        }, _markField: function (a) {
            var b = "", c = {"data-field": a.field};
            a.invalid ? b = this.CONST.INVALID_FIELD_CLS : a.entry ? (b = this.CONST.NAME_FILED_CLS, c["data-entry"] = a.entry) : b = this.CONST.VALUE_FIELD_CLS, this.editor.markText(a.from, a.to, {
                className: b,
                attr: c
            })
        }, insertField: function (a, b) {
            var c = this.editor.getCursor();
            this.editor.replaceSelection("​" + a.text + "​");
            var d = this.editor.getCursor(), e = {from: c, to: d, field: a.name, entry: b ? a.id : null};
            this._markField(e), this.editor.focus()
        }, checkValidate: function () {
            var b = a(this.editor.display.lineDiv);
            return b.find("span." + this.CONST.DEPRECATE_FIELD_CLS).length > 0 ? (this.setInvalidateType("deprecated field"), !1) : b.find("span." + this.CONST.INVALID_FIELD_CLS).length > 0 ? (this.setInvalidateType("invalid field"), !1) : (this.setInvalidateType(null), !0)
        }, getValue: function () {
            var b = [], c = this.CONST, d = [], e = a(this.editor.display.lineDiv).find(".CodeMirror-line-content");
            YS.Utils.forEach(e, function (e, f) {
                var g = [];
                YS.Utils.forEach(a(f).children("span"), function (b, e) {
                    var f = a(e).attr("data-field"), h = a(e).attr("data-entry");
                    if (a(e).hasClass(c.NAME_FILED_CLS))g.push("$" + f + "#" + h); else if (a(e).hasClass(c.VALUE_FIELD_CLS))g.push("$" + f + "#"), d.indexOf(f) === -1 && d.push(f); else {
                        if (a(e).hasClass(c.DEPRECATE_FIELD_CLS) || a(e).hasClass(c.INVALID_FIELD_CLS))return;
                        g.push(a(e).text())
                    }
                });
                var h = g.join("").replace(/\u200b/g, "").replace(/\u00a0/g, " ");
                b.push(h)
            })
            return b.join("\n")
        }, setValue: function (a) {
            var b = this, c = this.options, d = [], e = [];
            if (a) {
                var f = a.split("\n");
                YS.Utils.forEach(f, function (a, b) {
                    var f = "", g = b.split(/(\$[0-9a-zA-Z\._#@]+)/g);
                    YS.Utils.forEach(g, function (b, d) {
                        if (/^\$(_field_|_formula_|ext)/.test(d)) {
                            var g;
                            YS.Utils.startWith(d, "$ext") ? g = "扩展字段" : c.labelMap && (g = c.labelMap[d]);
                            var h = !1;
                            !g && (g = "无效字段", h = !0);
                            var i = d.replace("$", "").split("#"), j = i[0], k = i[1], l = CodeMirror.Pos(a, f.length);
                            f += "​" + g + "​";
                            var m = CodeMirror.Pos(a, f.length);
                            e.push({from: l, to: m, field: j, entry: k, invalid: h})
                        } else f += d
                    }), d.push(f)
                })
            }
            this.editor.setValue(d.join("\n")), YS.Utils.forEach(e, function (a, c) {
                b._markField(c)
            })
        }
    }), a.shortcut("formulaeditor", YS.FormulaEditor)
}(jQuery),function (a) {
    a(CodeMirror)
}(function (a) {
    "use strict";
    function b(a, b) {
        this.cm = a, this.options = this.buildOptions(b), this.widget = null, this.debounce = 0, this.tick = 0, this.startPos = this.cm.getCursor(), this.startLen = this.cm.getLine(this.startPos.line).length;
        var c = this;
        a.on("cursorActivity", this.activityFunc = function () {
            c.cursorActivity()
        })
    }

    function c(a) {
        return "string" == typeof a ? a : a.text
    }

    function d(a, b) {
        function c(a, c) {
            var e;
            e = "string" != typeof c ? function (a) {
                return c(a, b)
            } : d.hasOwnProperty(c) ? d[c] : c, f[a] = e
        }

        var d = {
            Up: function () {
                b.moveFocus(-1)
            }, Down: function () {
                b.moveFocus(1)
            }, PageUp: function () {
                b.moveFocus(-b.menuSize() + 1, !0)
            }, PageDown: function () {
                b.moveFocus(b.menuSize() - 1, !0)
            }, Home: function () {
                b.setFocus(0)
            }, End: function () {
                b.setFocus(b.length - 1)
            }, Enter: b.pick, Tab: b.pick, Esc: b.close
        }, e = a.options.customKeys, f = e ? {} : d;
        if (e)for (var g in e)e.hasOwnProperty(g) && c(g, e[g]);
        var h = a.options.extraKeys;
        if (h)for (var g in h)h.hasOwnProperty(g) && c(g, h[g]);
        return f
    }

    function e(a, b) {
        for (; b && b != a;) {
            if ("LI" === b.nodeName.toUpperCase() && b.parentNode == a)return b;
            b = b.parentNode
        }
    }

    function f(b, f) {
        this.completion = b, this.data = f, this.picked = !1;
        var i = this, j = b.cm, k = this.hints = document.createElement("ul");
        k.className = "CodeMirror-hints", this.selectedHint = f.selectedHint || 0;
        for (var l = f.list, m = 0; m < l.length; ++m) {
            var n = k.appendChild(document.createElement("li")), o = l[m], p = g + (m != this.selectedHint ? "" : " " + h);
            null != o.className && (p = o.className + " " + p), n.className = p, o.render ? o.render(n, f, o) : n.appendChild(document.createTextNode(o.displayText || c(o))), n.hintId = m
        }
        var q = j.cursorCoords(b.options.alignWithWord ? f.from : null), r = q.left, s = q.bottom, t = !0;
        k.style.left = r + "px", k.style.top = s + "px";
        var u = window.innerWidth || Math.max(document.body.offsetWidth, document.documentElement.offsetWidth), v = window.innerHeight || Math.max(document.body.offsetHeight, document.documentElement.offsetHeight);
        (b.options.container || document.body).appendChild(k);
        var w = k.getBoundingClientRect(), x = w.bottom - v;
        if (x > 0) {
            var y = w.bottom - w.top, z = q.top - (q.bottom - w.top);
            if (z - y > 0)k.style.top = (s = q.top - y) + "px", t = !1; else if (y > v) {
                k.style.height = v - 5 + "px", k.style.top = (s = q.bottom - w.top) + "px";
                var A = j.getCursor();
                f.from.ch != A.ch && (q = j.cursorCoords(A), k.style.left = (r = q.left) + "px", w = k.getBoundingClientRect())
            }
        }
        var B = w.right - u;
        if (B > 0 && (w.right - w.left > u && (k.style.width = u - 5 + "px", B -= w.right - w.left - u), k.style.left = (r = q.left - B) + "px"), j.addKeyMap(this.keyMap = d(b, {
                moveFocus: function (a, b) {
                    i.changeActive(i.selectedHint + a, b)
                }, setFocus: function (a) {
                    i.changeActive(a)
                }, menuSize: function () {
                    return i.screenAmount()
                }, length: l.length, close: function () {
                    b.close()
                }, pick: function () {
                    i.pick()
                }, data: f
            })), b.options.closeOnUnfocus) {
            var C;
            j.on("blur", this.onBlur = function () {
                C = setTimeout(function () {
                    b.close()
                }, 100)
            }), j.on("focus", this.onFocus = function () {
                clearTimeout(C)
            })
        }
        var D = j.getScrollInfo();
        return j.on("scroll", this.onScroll = function () {
            var a = j.getScrollInfo(), c = j.getWrapperElement().getBoundingClientRect(), d = s + D.top - a.top, e = d - (window.pageYOffset || (document.documentElement || document.body).scrollTop);
            return t || (e += k.offsetHeight), e <= c.top || e >= c.bottom ? b.close() : (k.style.top = d + "px", void(k.style.left = r + D.left - a.left + "px"))
        }), a.on(k, "dblclick", function (a) {
            var b = e(k, a.target || a.srcElement);
            b && null != b.hintId && (i.changeActive(b.hintId), i.pick())
        }), a.on(k, "click", function (a) {
            var c = e(k, a.target || a.srcElement);
            c && null != c.hintId && (i.changeActive(c.hintId), b.options.completeOnSingleClick && i.pick())
        }), a.on(k, "mousedown", function () {
            setTimeout(function () {
                j.focus()
            }, 20)
        }), a.signal(f, "select", l[0], k.firstChild), !0
    }

    var g = "CodeMirror-hint", h = "CodeMirror-hint-active";
    a.showHint = function (a, b, c) {
        if (!b)return a.showHint(c);
        c && c.async && (b.async = !0);
        var d = {hint: b};
        if (c)for (var e in c)d[e] = c[e];
        return a.showHint(d)
    }, a.defineExtension("showHint", function (c) {
        if (!(this.listSelections().length > 1 || this.somethingSelected())) {
            this.state.completionActive && this.state.completionActive.close();
            var d = this.state.completionActive = new b(this, c);
            d.options.hint && (a.signal(this, "startCompletion", this), d.update(!0))
        }
    });
    var i = window.requestAnimationFrame || function (a) {
            return setTimeout(a, 1e3 / 60)
        }, j = window.cancelAnimationFrame || clearTimeout;
    b.prototype = {
        close: function () {
            this.active() && (this.cm.state.completionActive = null, this.tick = null, this.cm.off("cursorActivity", this.activityFunc), this.widget && this.data && a.signal(this.data, "close"), this.widget && this.widget.close(), a.signal(this.cm, "endCompletion", this.cm))
        }, active: function () {
            return this.cm.state.completionActive == this
        }, pick: function (b, d) {
            var e = b.list[d];
            e.hint ? e.hint(this.cm, b, e) : this.cm.replaceRange(c(e), e.from || b.from, e.to || b.to, "complete"), a.signal(b, "pick", e), this.close()
        }, cursorActivity: function () {
            this.debounce && (j(this.debounce), this.debounce = 0);
            var a = this.cm.getCursor(), b = this.cm.getLine(a.line);
            if (a.line != this.startPos.line || b.length - a.ch != this.startLen - this.startPos.ch || a.ch < this.startPos.ch || this.cm.somethingSelected() || a.ch && this.options.closeCharacters.test(b.charAt(a.ch - 1)))this.close(); else {
                var c = this;
                this.debounce = i(function () {
                    c.update()
                }), this.widget && this.widget.disable()
            }
        }, update: function (b) {
            if (null != this.tick)if (this.data && a.signal(this.data, "update"), this.options.hint.async) {
                var c = ++this.tick, d = this;
                this.options.hint(this.cm, function (a) {
                    d.tick == c && d.finishUpdate(a, b)
                }, this.options)
            } else this.finishUpdate(this.options.hint(this.cm, this.options), b)
        }, finishUpdate: function (b, c) {
            this.data = b;
            var d = this.widget && this.widget.picked || c && this.options.completeSingle;
            this.widget && this.widget.close(), b && b.list.length && (d && 1 == b.list.length ? this.pick(b, 0) : (this.widget = new f(this, b), a.signal(b, "shown")))
        }, buildOptions: function (a) {
            var b = this.cm.options.hintOptions, c = {};
            for (var d in k)c[d] = k[d];
            if (b)for (var d in b)void 0 !== b[d] && (c[d] = b[d]);
            if (a)for (var d in a)void 0 !== a[d] && (c[d] = a[d]);
            return c
        }
    }, f.prototype = {
        close: function () {
            if (this.completion.widget == this) {
                this.completion.widget = null, this.hints.parentNode.removeChild(this.hints), this.completion.cm.removeKeyMap(this.keyMap);
                var a = this.completion.cm;
                this.completion.options.closeOnUnfocus && (a.off("blur", this.onBlur), a.off("focus", this.onFocus)), a.off("scroll", this.onScroll)
            }
        }, disable: function () {
            this.completion.cm.removeKeyMap(this.keyMap);
            var a = this;
            this.keyMap = {
                Enter: function () {
                    a.picked = !0
                }
            }, this.completion.cm.addKeyMap(this.keyMap)
        }, pick: function () {
            this.completion.pick(this.data, this.selectedHint)
        }, changeActive: function (b, c) {
            if (b >= this.data.list.length ? b = c ? this.data.list.length - 1 : 0 : b < 0 && (b = c ? 0 : this.data.list.length - 1), this.selectedHint != b) {
                var d = this.hints.childNodes[this.selectedHint];
                d.className = d.className.replace(" " + h, ""), d = this.hints.childNodes[this.selectedHint = b], d.className += " " + h, d.offsetTop < this.hints.scrollTop ? this.hints.scrollTop = d.offsetTop - 3 : d.offsetTop + d.offsetHeight > this.hints.scrollTop + this.hints.clientHeight && (this.hints.scrollTop = d.offsetTop + d.offsetHeight - this.hints.clientHeight + 3), a.signal(this.data, "select", this.data.list[this.selectedHint], d)
            }
        }, screenAmount: function () {
            return Math.floor(this.hints.clientHeight / this.hints.firstChild.offsetHeight) || 1
        }
    }, a.registerHelper("hint", "auto", function (b, c) {
        var d, e = b.getHelpers(b.getCursor(), "hint");
        if (e.length)for (var f = 0; f < e.length; f++) {
            var g = e[f](b, c);
            if (g && g.list.length)return g
        } else if (d = b.getHelper(b.getCursor(), "hintWords")) {
            if (d)return a.hint.fromList(b, {words: d})
        } else if (a.hint.anyword)return a.hint.anyword(b, c)
    }), a.registerHelper("hint", "fromList", function (b, c) {
        for (var d = b.getCursor(), e = b.getTokenAt(d), f = [], g = 0; g < c.words.length; g++) {
            var h = c.words[g];
            h.slice(0, e.string.length) == e.string && f.push(h)
        }
        if (f.length)return {list: f, from: a.Pos(d.line, e.start), to: a.Pos(d.line, e.end)}
    }), a.commands.autocomplete = a.showHint;
    var k = {
        hint: a.hint.auto,
        completeSingle: !0,
        alignWithWord: !0,
        closeCharacters: /[\s()\[\]{};:>,]/,
        closeOnUnfocus: !0,
        completeOnSingleClick: !1,
        container: null,
        customKeys: null,
        extraKeys: null
    };
    a.defineOption("hintOptions", null)
}),function (a) {
    a(CodeMirror)
}(function (a) {
    function b(a, b) {
        for (var c = 0, d = a.length; c < d; ++c)b(a[c])
    }

    function c(a, b) {
        if (!Array.prototype.indexOf) {
            for (var c = a.length; c--;)if (a[c] === b)return !0;
            return !1
        }
        return a.indexOf(b) != -1
    }

    function d(b, c, d, e) {
        var h = b.getCursor(), i = d(b, h);
        if (!/\b(?:string)\b/.test(i.type)) {
            i.state = a.innerMode(b.getMode(), i.state).state, /^[\w$_]*$/.test(i.string) ? i.end > h.ch && (i.end = h.ch, i.string = i.string.slice(0, h.ch - i.start)) : i = {
                start: h.ch,
                end: h.ch,
                string: "",
                state: i.state,
                type: "." == i.string ? "property" : null
            };
            for (var j = i; "property" == j.type;) {
                if (j = d(b, g(h.line, j.start)), "." != j.string)return;
                if (j = d(b, g(h.line, j.start)), !k)var k = [];
                k.push(j)
            }
            return {list: f(i, k, c, e), from: g(h.line, i.start), to: g(h.line, i.end)}
        }
    }

    function e(b, c) {
        return d(b, a.keywords, function (a, b) {
            return a.getTokenAt(b)
        }, c)
    }

    function f(a, d, e, f) {
        function g(a) {
            0 != a.lastIndexOf(i, 0) || c(h, a) || h.push(a)
        }

        var h = [], i = a.string.toUpperCase();
        return i ? (d && d.length ? d.pop() : b(e, g), h) : h
    }

    var g = a.Pos;
    a.registerHelper("hint", "formula", e)
}),function (a) {
    a(CodeMirror)
}(function (a) {
    "use strict";
    a.defineMode("formula", function () {
        function b(a) {
            for (var b = {}, c = 0, d = a.length; c < d; ++c)b[a[c]] = !0;
            return b
        }

        function c(a, b) {
            if (a.eatSpace())return null;
            var c = a.next();
            if ('"' === c || "'" === c)return d(a, c), "string";
            if ("​" === c)return d(a, c), "field";
            if (/[\[\],\(\)]/.test(c))return "bracket";
            if (/[+\-*\/=<>!&|]/.test(c))return "operator";
            if (/\d/.test(c))return a.eatWhile(/[\d\.]/), "number";
            a.eatWhile(/[\w]/);
            var e = a.current();
            return f.hasOwnProperty(e) ? "atom" : g.hasOwnProperty(e) ? "keyword" : h.hasOwnProperty(e) ? "deprecate" : null
        }

        function d(a, b) {
            for (var c, d = !1; null != (c = a.next());) {
                if (c === b && !d)return !1;
                d = !d && "\\" === c
            }
            return d
        }

        function e(a, b) {
            return (b.tokens[0] || c)(a, b)
        }

        var f = b(["false", "true"]), g = b(a.keywords), h = b(["MAP"]);
        return {
            startState: function () {
                return {tokens: []}
            }, token: function (a, b) {
                return e(a, b)
            }, fold: "brace"
        }
    }), a.defineMIME("text/fx-formula", "formula")
}),function (a) {
    YS.ConfigPane = YS.extend(YS.Container, {
        _defaultConfig: function () {
            return a.extend(YS.ConfigPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_config_pane",
                items: []
            })
        }, _init: function () {
            YS.ConfigPane.superclass._init.apply(this, arguments);
            var b = this.options, c = this.element, d = this;
            b.items && a.each(b.items, function (b, e) {
                if (!e.disabled) {
                    if (e.label) {
                        var f = a('<div class="cfg_title"/>').append(a("<span/>").text(e.label)).appendTo(c);
                        if (e.tooltip) {
                            var g = e.tooltip_type || "info", h = "";
                            "info" === g ? h = "icon-help" : "warning" === g && (h = "icon-tip-warning");
                            var i = a('<i class="cfg_tooltip ' + h + '"/>').hover(function () {
                                YS.UI.showPopover({
                                    position: "topRight",
                                    anchor: i,
                                    content: e.tooltip,
                                    type: e.tooltip_type,
                                    maxWidth: 250
                                })
                            }, function () {
                                YS.UI.closePopover()
                            }).appendTo(f)
                        }
                        e.widgetType && e.widgetType.appendTo(f)
                    }
                    e.widget && (e.widget.renderEl = a('<div class="cfg_content"/>').appendTo(c), d._addWidget(e.widget)), e.contentEl && c.append(e.contentEl), e.splitLine && a('<div class="cfg_split"/>').appendTo(c)
                }
            })
        }
    }), a.shortcut("configpane", YS.ConfigPane)
}(jQuery),function (a) {
    YS.Tooltip = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.Tooltip.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_tooltip_pane",
                text: "",
                tipWidth: 200
            })
        }, _init: function () {
            YS.Tooltip.superclass._init.apply(this, arguments);
            var b = this.options, c = a('<i class="tip-icon icon-help"/>').hover(function () {
                YS.UI.showPopover({
                    position: b.position,
                    anchor: c,
                    maxWidth: b.tipWidth,
                    content: a("<span/>").text(b.text)
                })
            }, function () {
                YS.UI.closePopover()
            }).appendTo(this.element)
        }
    }), a.shortcut("tooltippane", YS.Tooltip)
}(jQuery),function (a) {
    YS.BaseFieldSelectPane = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.BaseFieldSelectPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_field_select_pane",
                mode: "pop-right",
                forms: [],
                fields: [],
                excludeFields: [],
                onFieldSelect: null,
                onFieldFilter: null
            })
        }, _init: function () {
            YS.BaseFieldSelectPane.superclass._init.apply(this, arguments);
            var a = this.options;
            switch (a.mode) {
                case"dialog":
                    this.element.addClass("dialog-menu");
                    break;
                case"pop-left":
                    this.element.addClass("pop-menu pop-left x-dropdown");
                    break;
                case"pop-right":
                default:
                    this.element.addClass("pop-menu pop-right x-dropdown")
            }
            this._createMenuList(), this._bindMenuEvents()
        }, _createMenuList: function () {
            this.$menuList = a('<ul class="menu-list"/>').appendTo(this.element)
        }, _bindMenuEvents: function () {
            var b = this, c = (this.options, function (c) {
                if (b.isEnabled()) {
                    var d = c.target, e = c.type, f = a(d).closest("li");
                    f && f.length && !f.hasClass("disabled") && "click" === e && b._onMenuItemClick(f)
                }
            });
            this.$menuList.unbind(".field-select"), this.$menuList.bind({"click.field-select": c})
        }, _createFieldItem: function (b) {
            return a('<li class="field"/>').attr("name", b.name).data("field", b).appendTo(this.$menuList)
        }, _onMenuItemClick: function (a) {
        }, _isFieldTypeAllowed: function (a) {
            var b = this.options;
            return !b.availableFields || b.availableFields.indexOf(a.type) > -1
        }, _isFieldExcluded: function (a) {
            var b = this.options;
            return b.excludeFields && b.excludeFields.indexOf(a.name) > -1 || YS.Utils.applyFunc(this, b.onFieldFilter, [a], !1)
        }, _findSelectedFieldIndex: function (a) {
            var b = this.options, c = -1;
            return YS.Utils.forEach(b.fields, function (b, d) {
                if (a.name === d.name && a.id === d.id)return c = b, !1
            }), c
        }, show: function () {
            var a = this.options;
            "dialog" !== a.mode && this.element.addClass("active")
        }, selectField: function (a) {
        }, deselectField: function (a) {
        }, setForms: function (a) {
            this.options.forms = a, this._refreshList()
        }, setFields: function (a) {
            this.options.fields = a, this._refreshList()
        }, _refreshList: function () {
        }
    }), a.shortcut("field_select", YS.BaseFieldSelectPane)
}(jQuery),function (a) {
    YS.EntryFieldSelectPane = YS.extend(YS.BaseFieldSelectPane, {
        _defaultConfig: function () {
            return a.extend(YS.EntryFieldSelectPane.superclass._defaultConfig.apply(this, arguments), {
                entryList: null,
                forms: [],
                subform: null,
                fields: [],
                joinedFields: [],
                excludeFields: [],
                attributeFields: [],
                hasCount: !1,
                hasCalcFormula: !1,
                isAggregate: !1,
                allowMultiTable: !1,
                allowSameField: !1,
                allowMultiSubform: !0,
                onFieldSelect: null
            })
        }, _init: function () {
            YS.EntryFieldSelectPane.superclass._init.apply(this, arguments);
            var a = this.options;
            this._initCalcFormulas(), a.entryList && 1 === a.entryList.length && this.$menuList.children().eq(0).click()
        }, _initCalcFormulas: function () {
            var a = this, b = this.options;
            this.entryCalcFormulaMap = {}, b.hasCalcFormula && YS.Utils.forEach(b.fields, function (b, c) {
                if ("formula" === c.type && "calc" === c.category) {
                    var d = c.forms[0];
                    a.entryCalcFormulaMap[d] = a.entryCalcFormulaMap[d] || [], a.entryCalcFormulaMap[d].push(c)
                }
            })
        }, _createMenuList: function () {
            YS.EntryFieldSelectPane.superclass._createMenuList.apply(this, arguments);
            var a = this, b = this.options;
            this._hasJoinedFields() && (b.allowMultiTable = !0, a._createJoinedEntryItem()), YS.Utils.forEach(b.entryList, function (b, c) {
                a._createEntryItem(c)
            });
            var c = null;
            YS.Utils.forEach(b.fields, function (a, b) {
                if (b.subform)return c = b.subform, !1
            }), b.subform = c
        }, _hasJoinedFields: function () {
            var a = this.options;
            return a.joinedFields.length > 0
        }, _createJoinedEntryItem: function () {
            var b = this, c = this.options, d = a('<li class="entry"/>').data("entry", {isJoined: !0});
            a('<a class="menu-item"/>').append(a('<i class="icon-field-form"/>')).append(a("<span/>").text("关联字段")).appendTo(d);
            var e = a('<ul class="field-list"/>').hide();
            YS.Utils.forEach(c.joinedFields, function (c, d) {
                var f = a('<li class="field"/>').attr("name", d.name).data("field", d).appendTo(e);
                a('<a class="menu-item"/>').append(a("<span/>").text(d.text)).appendTo(f), b._filterJoinedFieldEnabled(d) === !1 && f.addClass("disabled")
            }), e.appendTo(d), e.children().length && d.appendTo(this.$menuList)
        }, _filterJoinedFieldEnabled: function (a) {
            var b = this.options, c = !0;
            return YS.Utils.forEach(b.fields, function (b, d) {
                if (a.name === d.name)return c = !1, !1
            }), c
        }, _createEntryItem: function (b) {
            var c = a('<li class="entry"/>').data("entry", b).appendTo(this.$menuList), d = "icon-form";
            a('<a class="menu-item"/>').append(a("<i class=" + d + "/>")).append(a("<span/>").text(b.formName)).appendTo(c)
        }, _createEntryFieldList: function (b) {
            var c = this, d = this.options, e = a('<ul class="field-list"/>').hide(), f = [].concat(d.attributeFields);
            if (YS.Utils.forEach(b.fields, function (f, g) {
                    var h = a.extend({}, g, {id: b.formId});
                    h && c._isFieldTypeAllowed(h) && !c._isFieldExcluded(h) && ("subform" === h.type ? (d.subform || (d.subform = h.subform), YS.Utils.forEach(h.items, function (d, f) {
                        if (c._isFieldTypeAllowed(f) && !c._isFieldExcluded(f)) {
                            var g = a.extend({}, f, {
                                id: b.entryId,
                                name: h.name + "." + f.name,
                                text: h.text + "." + f.text,
                                subformText: h.text,
                                subform: h.name
                            });
                            c._createEntryFieldItem(b, g, e)
                        }
                    })) : c._createEntryFieldItem(b, h, e))
                }), d.hasCalcFormula) {
                var g = b.entryId;
                YS.Utils.forEach(this.entryCalcFormulaMap[g], function (a, d) {
                    c._createEntryFieldItem(b, d, e)
                })
            }
            if (d.hasCount) {
                var h = {name: "_count_" + b.formId, text: "计数", type: "count", formula: "1", id: b.formId};
                c._createEntryFieldItem(b, h, e)
            }
            return e
        }, _createEntryFieldItem: function (b, c, d) {
            var e = a('<li class="field"/>').attr("name", c.name).data("field", c).appendTo(d);
            return a('<a class="menu-item"/>').append(a("<span/>").text(c.text)).appendTo(e), this._filterFieldEnabled(b, c) === !1 && e.addClass("disabled"), e
        }, _filterFieldEnabled: function (a, b) {
            var c = this.options, d = !0;
            return !c.allowSameField && c.fields.length > 0 && YS.Utils.forEach(c.fields, function (e, f) {
                return "subform" === f.type ? (YS.Utils.forEach(f.items, function (c, e) {
                    var f = e.subform + "." + e.name;
                    if (a.entryId === e.id && b.name === f)return d = !1, !1
                }), d) : a.entryId === f.id && b.name === f.name ? (d = !1, !1) : "formula" === b.type && b.name === f.name ? (d = !f.fieldEnable, !1) : void 0
            }), d
        }, _onMenuItemClick: function (b) {
            var c = this, d = this.options;
            if (b.hasClass("entry")) {
                b.siblings().children(".field-list").slideUp("fast");
                var e = b.children(".field-list");
                if (!e || !e.length) {
                    var f = b.data("entry");
                    e = this._createEntryFieldList(f).appendTo(b)
                }
                e.slideToggle("fast")
            } else if (b.hasClass("field")) {
                var g = b.data("field");
                YS.Utils.applyFunc(this, d.onFieldSelect, [a.extend({}, g)], !1) === !1 && (g.subform && !d.subform && (d.allowMultiTable = !1, d.subform = g.subform), c.selectField(g))
            }
        }, selectField: function (a) {
            var b = this.options;
            "formula" !== a.type && b.fields.push(a), this._refreshList()
        }, deselectField: function (a) {
            var b = this.options;
            if ("formula" !== a.type) {
                var c = this._findSelectedFieldIndex(a);
                c > -1 && b.fields.splice(c, 1), 0 === b.fields.length && (b.subform = null)
            }
            this._refreshList()
        }, _refreshList: function () {
            var b = this;
            this.$menuList.children().each(function () {
                var c = a(this), d = c.data("entry"), e = c.children(".field-list");
                e && e.length && e.children().each(function () {
                    var c = a(this), e = c.data("field");
                    b._filterFieldEnabled(d, e) ? c.removeClass("disabled") : c.addClass("disabled")
                })
            })
        }
    }), a.shortcut("entry_field_select", YS.EntryFieldSelectPane)
}(jQuery),function (a) {
    YS.FilterFieldSelectPane = YS.extend(YS.BaseFieldSelectPane, {
        _defaultConfig: function () {
            return a.extend(YS.FilterFieldSelectPane.superclass._defaultConfig.apply(this, arguments), {
                entryList: null,
                forms: [],
                fields: [],
                excludeFields: [],
                allowMultiTable: !1,
                allowSameField: !1,
                onFieldSelect: null
            })
        }, _init: function () {
            YS.FilterFieldSelectPane.superclass._init.apply(this, arguments), this.$menuList.children().length <= 1 && this.$menuList.children().eq(0).click()
        }, _createMenuList: function () {
            YS.FilterFieldSelectPane.superclass._createMenuList.apply(this, arguments);
            var a = this, b = this.options;
            YS.Utils.forEach(b.entryList, function (b, c) {
                c.id = b, a._createEntryItem(c)
            })
        }, _createEntryItem: function (b) {
            var c = a('<li class="entry"/>').data("entry", b).appendTo(this.$menuList), d = "icon-form";
            a('<a class="menu-item"/>').append(a("<i class=" + d + "/>")).append(a("<span/>").text(b.formName)).appendTo(c)
        }, _createEntryFieldList: function (b) {
            var c = this, d = (this.options, a('<ul class="field-list"/>').hide());
            return YS.Utils.forEach(b.fields, function (a, e) {
                e && !c._isFieldExcluded(e) && c._isFieldTypeAllowed(e) && (e.id = b.id, c._createEntryFieldItem(b, e, d))
            }), d
        }, _isFieldTypeAllowed: function (a) {
            var b = this.options;
            return (!b.availableFields || b.availableFields.indexOf(a.type) > -1)
        }, _createEntryFieldItem: function (b, c, d) {
            var e = a('<li class="field"/>').attr("name", c.name).data("field", c).appendTo(d);
            return a('<a class="menu-item"/>').append(a("<span/>").text(c.text)).appendTo(e), this._filterFieldEnabled(b, c) === !1 && e.addClass("disabled"), e
        }, _filterFieldEnabled: function (a, b) {
            var c = this.options, d = !0;
            return !c.allowSameField && c.fields.length > 0 && YS.Utils.forEach(c.fields, function (c, e) {
                if (a.id === e.id && b.name === e.name)return d = !1, !1
            }), d
        }, _onMenuItemClick: function (b) {
            var c = this, d = this.options;
            if (b.hasClass("entry")) {
                b.siblings().children(".field-list").slideUp("fast");
                var e = b.children(".field-list");
                if (!e || !e.length) {
                    var f = b.data("entry");
                    e = this._createEntryFieldList(f).appendTo(b)
                }
                e.slideToggle("fast")
            } else if (b.hasClass("field")) {
                var g = b.data("field");
                YS.Utils.applyFunc(this, d.onFieldSelect, [a.extend({}, g)], !1) === !1 && (g.subform && !d.subform && (d.allowMultiTable = !1, d.subform = g.subform), c.selectField(g))
            }
        }, selectField: function (a) {
            var b = this.options;
            b.fields.push(a), this._refreshList()
        }, deselectField: function (a) {
            var b = this.options, c = this._findSelectedFieldIndex(a);
            c > -1 && b.fields.splice(c, 1), 0 === b.fields.length && (b.subform = null), this._refreshList()
        }, _refreshList: function () {
            var b = this;
            this.$menuList.children().each(function () {
                var c = a(this), d = c.data("entry"), e = c.children(".field-list");
                e && e.length && e.children().each(function () {
                    var c = a(this), e = c.data("field");
                    b._filterFieldEnabled(d, e) ? c.removeClass("disabled") : c.addClass("disabled")
                })
            })
        }
    }), a.shortcut("filter_field_select", YS.FilterFieldSelectPane)
}(jQuery),function (a) {
    YS.JoinedFieldSelectPane = YS.extend(YS.BaseFieldSelectPane, {
        _defaultConfig: function () {
            return a.extend(YS.JoinedFieldSelectPane.superclass._defaultConfig.apply(this, arguments), {
                forms: [],
                fields: [],
                joinedFields: [],
                onFieldSelect: null
            })
        }, _createMenuList: function () {
            YS.JoinedFieldSelectPane.superclass._createMenuList.apply(this, arguments);
            var a = this, b = this.options;
            YS.Utils.forEach(b.joinedFields, function (b, c) {
                a._isFieldTypeAllowed(c) && a._createFieldItem(c)
            })
        }, _createFieldItem: function (b) {
            var c = a('<li class="field"/>').attr("name", b.name).data("field", b).appendTo(this.$menuList);
            return a('<a class="menu-item"/>').append(a("<span/>").text(b.text)).appendTo(c), this._filterJoinedFieldEnabled(b) === !1 && c.addClass("disabled"), c
        }, _onMenuItemClick: function (b) {
            var c = this, d = this.options;
            if (b.hasClass("field")) {
                var e = b.data("field");
                YS.Utils.applyFunc(c, d.onFieldSelect, [a.extend({}, e)], !1) === !1 && this.selectField(e)
            }
        }, _filterJoinedFieldEnabled: function (a) {
            var b = this.options, c = !0;
            return YS.Utils.forEach(b.fields, function (b, d) {
                if (a.name === d.name)return c = !1, !1
            }), c
        }, selectField: function (a) {
            var b = this.options;
            "formula" !== a.type && b.fields.push(a), this._refreshList()
        }, deselectField: function (a) {
            var b = this.options;
            if ("formula" !== a.type) {
                var c = this._findSelectedFieldIndex(a);
                c > -1 && b.fields.splice(c, 1)
            }
            this._refreshList()
        }, _refreshList: function () {
            var b = this;
            this.$menuList.children().each(function () {
                var c = a(this), d = c.data("field");
                b._filterJoinedFieldEnabled(d) ? c.removeClass("disabled") : c.addClass("disabled")
            })
        }
    }), a.shortcut("joined_field_select", YS.JoinedFieldSelectPane)
}(jQuery),function (a) {
    YS.LinkFieldSelectPane = YS.extend(YS.BaseFieldSelectPane, {
        _defaultConfig: function () {
            return a.extend(YS.LinkFieldSelectPane.superclass._defaultConfig.apply(this, arguments), {
                items: [],
                fields: [],
                onFieldSelect: null
            })
        }, _createMenuList: function () {
            YS.LinkFieldSelectPane.superclass._createMenuList.apply(this, arguments);
            var a = this, b = this.options;
            YS.Utils.forEach(b.items, function (b, c) {
                a._isFieldTypeAllowed(c) && a._createFieldItem(c)
            })
        }, _createFieldItem: function (b) {
            var c = a('<li class="field"/>').attr("name", b.name).data("field", b).appendTo(this.$menuList);
            return a('<a class="menu-item"/>').append(a("<span/>").text(b.text)).appendTo(c), this._filterFieldEnabled(b) === !1 && c.addClass("disabled"), c
        }, _onMenuItemClick: function (b) {
            var c = this, d = this.options;
            if (b.hasClass("field")) {
                var e = b.data("field");
                YS.Utils.applyFunc(c, d.onFieldSelect, [a.extend({}, e)], !1) === !1 && this.selectField(e)
            }
        }, selectField: function (a) {
            this._refreshList()
        }, deselectField: function (a) {
            var b = this.options, c = this._findSelectedFieldIndex(a);
            c > -1 && b.fields.splice(c, 1), this._refreshList()
        }, _filterFieldEnabled: function (a) {
            var b = this.options, c = !0;
            return YS.Utils.forEach(b.fields, function (b, d) {
                if (a.name === d.name)return c = !1, !1
            }), c
        }, _refreshList: function () {
            var b = this;
            this.$menuList.children().each(function () {
                var c = a(this), d = c.data("field");
                b._filterFieldEnabled(d) ? c.removeClass("disabled") : c.addClass("disabled")
            })
        }
    }), a.shortcut("link_field_select", YS.LinkFieldSelectPane)
}(jQuery),function (a) {
    YS.BaseFieldConfigPane = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.BaseFieldConfigPane.superclass._defaultConfig.apply(this, arguments), {
                $field: a('<li class="field-item"/>'),
                $anchor: null,
                onAfterEdit: null
            })
        }, _init: function () {
            YS.BaseFieldConfigPane.superclass._init.apply(this, arguments), this._initField(), this._initConfigContainer()
        }, _initField: function () {
            var a = this.options;
            this.field = a.$field.data("field"), this.$fieldLabel = a.$field.children(".field-label").addClass("selected")
        }, _initConfigContainer: function () {
            this.container = new YS.TableContainer({
                rowSize: this._getConfigItemsRowSize(),
                colSize: this._getConfigItemsColSize(),
                hgap: 10,
                vgap: 8,
                items: this._getConfigItems()
            })
        }, show: function () {
            var b = this, c = this.options, d = a.extend({}, this.field);
            YS.Msg.bubble({
                anchor: c.$anchor,
                dockPosition: "right",
                contentHTML: this.container.element,
                edge: 350,
                onShow: function () {
                    b._onConfigShow()
                },
                onClose: function () {
                    return b._onConfigClose()
                },
                onOk: function () {
                    return !!b._onConfigOk() && (YS.Utils.applyFunc(this, c.onAfterFieldUpdate, [b.field, c.$field.index()], !1), !0)
                },
                onCancel: function () {
                    a.extend(b.field, d)
                }
            })
        }, _getConfigItems: function () {
            return [[{type: "label", text: "显示名"}, {
                fieldId: "fieldTextEditor",
                type: "text",
                value: this.field.text,
                fieldIsnull: !1,
                waterMark: "输入字段名"
            }]]
        }, _changeNumberStyleConfigItems: function (a) {
        }, _saveNumberStyleConfig: function () {
            var a = this.container.getWidgetByName("format-type");
            if (a && 1 === a.getValue()) {
                var b = this.container.getWidgetByName("format-preset").getValue(), c = "", d = 0;
                c += b[0] ? "#,##" : "", c += b[2] === !1 ? "" : d.toFixed(Math.min(Math.max(b[2], 0), 5)), c += b[1] ? "%" : "", this.field.cellFmt = {
                    type: "preset",
                    data: c
                }
            } else this.field.cellFmt = {
                type: "custom",
                data: this.container.getWidgetByName("format-custom").getValue()
            }
        }, _getNumberStyleConfigItems: function () {
            var a = this, b = this.field.cellFmt, c = b && "custom" === b.type;
            b || (b = {});
            var d = !1, e = 0;
            if (b.data) {
                d = !(/0\./.test(b.data) && !/0\.0/.test(b.data));
                var f = b.data.replace(/0\.0+/, "0.");
                e = Math.min(Math.max(b.data.length - f.length, 0), 5)
            }
            return [[{type: "label", text: "数据格式"}, {
                type: "combo",
                searchable: !1,
                fieldIsnull: !1,
                fieldId: "format-type",
                value: c ? 2 : 1,
                items: [{value: 1, text: "预定义格式"}, {value: 2, text: "自定义格式"}],
                onAfterItemSelect: function (b, c) {
                    var d = 1 === c.value;
                    a._changeNumberStyleConfigItems(d)
                }
            }], [{}, {
                fieldId: "format-preset",
                type: "formatcheckpane",
                items: [{text: "千分符", selected: /,/.test(b.data)}, {text: "百分比", selected: /%/.test(b.data)}, {
                    text: "小数位数",
                    custom: !0,
                    value: e,
                    selected: d
                }]
            }], [{}, {fieldId: "format-custom", type: "text", value: b.data, fieldIsnull: !1}]]
        }, _getConfigItemsColSize: function () {
            return [70, 160]
        }, _getConfigItemsRowSize: function () {
            return [30]
        }, _onConfigShow: function () {
        }, _onConfigClose: function () {
            return this.$fieldLabel.removeClass("selected"), !1
        }, _onConfigOk: function () {
            var a = this.container.getWidgetByName("fieldTextEditor");
            if (!a.checkValidate())return !1;
            var b = a.getValue();
            return this.$fieldLabel.children(".field-name").text(b), this.field.text = b, !0
        }
    }), a.shortcut("field_config", YS.BaseFieldConfigPane)
}(jQuery),function (a) {
    YS.GroupFieldConfigPane = YS.extend(YS.BaseFieldConfigPane, {
        _defaultConfig: function () {
            return a.extend(YS.GroupFieldConfigPane.superclass._defaultConfig.apply(this, arguments), {
                $field: a('<li class="field-item"/>'),
                $anchor: null,
                hasDetail: !1,
                onAfterEdit: null
            })
        }, _init: function () {
            YS.GroupFieldConfigPane.superclass._init.apply(this, arguments)
        }, _initField: function () {
            YS.GroupFieldConfigPane.superclass._initField.apply(this, arguments), this._initFieldDetailConfig()
        }, _initFieldDetailConfig: function () {
            var a = this, b = this.options;
            if (this.detailFields = [], this.detailChoice = [], this.detailSelection = [], b.hasDetail &= "combo" === this.field.type, b.hasDetail &= !(!this.field.async || !this.field.async.data), b.hasDetail = !!b.hasDetail, b.hasDetail) {
                var c = this.field.async.data.formId, d = this.field.async.data.field;
                YS.Utils.forEach(YS.EditReport.entryList, function (b, d) {
                    if (d.entryId === c)return a.detailFields = d.fields, !1
                });
                var e = ["text", "number", "textarea", "radiogroup", "combo"];
                YS.Utils.forEach(this.detailFields, function (b, c) {
                    c.name !== d && e.indexOf(c.type) !== -1 && a.detailChoice.push({text: c.text, value: c.name})
                }), YS.Utils.isObjectEmpty(this.field.detail) || YS.Utils.forEach(this.field.detail.fields, function (b, c) {
                    a.detailSelection.push(c.name)
                })
            }
        }, _getConfigItems: function () {
            var a = this;
            return [[{type: "label", text: "显示名"}, {
                fieldId: "fieldTextEditor",
                type: "text",
                value: this.field.text,
                fieldIsnull: !1,
                waterMark: "输入字段名"
            }], [{type: "label", text: "日期汇总"}, {
                fieldId: "dateTypeSelect",
                type: "combo",
                items: [{value: "year", text: "年"}, {value: "year&month", text: "年、月"}, {
                    value: "year&month&day",
                    text: "年、月、日"
                }],
                value: a.field.dateType ? a.field.dateType : "year"
            }], [{type: "label", text: "地址汇总"}, {
                fieldId: "addressTypeSelect",
                type: "combo",
                items: [{value: "province", text: "省"}, {value: "province&city", text: "省、市"}],
                value: a.field.addressType ? a.field.addressType : "province"
            }], [{type: "label", text: "关联释义"}, {
                fieldId: "fieldDetailCombo",
                type: "combocheck",
                items: this.detailChoice,
                value: this.detailSelection
            }]]
        }, _getConfigItemsRowSize: function () {
            return [30, 30, 30, 30]
        }, _onConfigShow: function () {
            var a = this.options;
            "datetime" !== this.field.type && this.container.$rows[1].hide(), ["address"].indexOf(this.field.type) < 0 && this.container.$rows[2].hide(), a.hasDetail || this.container.$rows[3].hide()
        }, _onConfigOk: function () {
            var a = YS.GroupFieldConfigPane.superclass._onConfigOk.apply(this, arguments);
            if (!a)return !1;
            var b = this.options;
            if ("datetime" === this.field.type ? this.field.dateType = this.container.getWidgetByName("dateTypeSelect").getValue() : "address" !== this.field.type || (this.field.addressType = this.container.getWidgetByName("addressTypeSelect").getValue()), b.hasDetail) {
                var c = [], d = this.container.getWidgetByName("fieldDetailCombo"), e = d.getValue();
                YS.Utils.forEach(this.detailFields, function (a, b) {
                    e.indexOf(b.name) !== -1 && c.push({name: b.name, text: b.text})
                }), this.field.detail = {
                    entry: this.field.async.data.formId,
                    key: this.field.async.data.field,
                    fields: c
                }
            } else this.field.detail = null;
            return YS.Utils.applyFunc(this, b.onAfterEdit, [this.field], !1), !0
        }
    }), a.shortcut("group_field_config", YS.GroupFieldConfigPane)
}(jQuery),function (a) {
    YS.ListFieldConfigPane = YS.extend(YS.BaseFieldConfigPane, {
        _defaultConfig: function () {
            return a.extend(YS.ListFieldConfigPane.superclass._defaultConfig.apply(this, arguments), {
                $field: a('<li class="field-item"/>'),
                $anchor: null,
                editor: null,
                onAfterEdit: null
            })
        }, _init: function () {
            YS.ListFieldConfigPane.superclass._init.apply(this, arguments)
        }, _getConfigItems: function () {
            var a = this.options, b = this, c = [[{type: "label", text: "显示名"}, {
                fieldId: "fieldTextEditor",
                type: "text",
                value: this.field.text,
                fieldIsnull: !1,
                waterMark: "输入字段名",
                onAfterEdit: function () {
                    b.field.text = this.getText()
                }
            }], [{type: "label", text: "编辑公式"}, {
                type: "button",
                style: "white",
                text: "...",
                iconCls: "icon-function",
                onClick: function () {
                    a.editor.createFormulaEditDialog(a.$field, {
                        onOk: function (a) {
                            return b.container.getWidgetByName("fieldTextEditor").setText(a.text), !1
                        }
                    })
                }
            }], [{type: "label", text: "仅详情显示"}, {
                fieldId: "detailOnlySwitch",
                type: "switch",
                width: 44,
                height: 22,
                value: !!b.field.detailOnly,
                onSwitch: function (a) {
                    b.field.detailOnly = a
                }
            }]], d = this.field.cellFmt, e = d && "custom" === d.type;
            switch (d || (d = {}), this.field.type) {
                case"datetime":
                    d.data || (d.data = this.field.fieldFormat), c.push([{
                        type: "label",
                        text: "数据格式"
                    }, {
                        fieldId: "format-type",
                        type: "combo",
                        value: e ? "custom" : d.data,
                        fieldIsnull: !1,
                        searchable: !1,
                        items: [{value: "yyyy-MM-dd", text: "2015-01-01"}, {
                            value: "yyyy-MM-dd HH:mm:ss",
                            text: "2015-01-01 01:01:01"
                        }, {value: "yyyy/MM/dd", text: "2015/1/1"}, {
                            value: "yyyy/MM/dd HH:mm:ss",
                            text: "2015/1/1 01:01:01"
                        }, {value: "yyyy年MM月dd日", text: "2015年1月1日"}, {
                            value: "yyyy年MM月dd日 HH时mm分ss秒",
                            text: "2015年1月1日 01时01分01秒"
                        }, {value: "yyyy年MM月dd日 EEE", text: "2015年1月1日 星期四"}, {
                            value: "yyyy年MM月",
                            text: "2015年1月"
                        }, {value: "MM月dd日", text: "1月1日"}, {value: "EEE", text: "星期四"}, {
                            value: "custom",
                            text: "自定义格式"
                        }],
                        onAfterItemSelect: function (a, c) {
                            b.container.setRowVisible([4], "custom" === c.value)
                        }
                    }], [{}, {
                        fieldId: "format-custom",
                        type: "text",
                        value: d.data,
                        waterMark: "如：yyyy-mm-dd",
                        fieldIsnull: !1
                    }]);
                    break;
                case"number":
                case"formula":
                    c = c.concat(this._getNumberStyleConfigItems());
                    break;
                case"address":
                    d.data == null && (d.data = "pcda"), c.push([{
                        type: "label",
                        text: "数据格式"
                    }, {
                        fieldId: "format-check",
                        type: "checkboxgroup",
                        customCls: "address-format-check",
                        layout: "horizontal",
                        items: [{selected: /p/.test(d.data), text: "省", value: "p"}, {
                            selected: /c/.test(d.data),
                            text: "市",
                            value: "c"
                        }, {selected: /d/.test(d.data), text: "县", value: "d"}, {
                            selected: /a/.test(d.data),
                            text: "详细地址",
                            value: "a"
                        }]
                    }])
            }
            return c
        }, _changeNumberStyleConfigItems: function (a) {
            this.container.setRowVisible([5], !a), this.container.setRowVisible([4], a)
        }, _getConfigItemsColSize: function () {
            return [75, 160]
        }, _getConfigItemsRowSize: function () {
            switch (this.field.type) {
                case"number":
                case"formula":
                    return [30, 30, 30, 30, 90, 30];
                case"datetime":
                    return [30, 30, 30, 30, 30];
                case"address":
                    return [30, 30, 30, 60];
                default:
                    return [30, 30, 30]
            }
        }, _onConfigShow: function () {
            var a = this.field.cellFmt && "custom" === this.field.cellFmt.type;
            switch (this.field.formula || this.container.setRowVisible([1], !1), this.field.subform && this.container.setRowVisible([2], !1), this.field.type) {
                case"number":
                case"formula":
                    this.container.setRowVisible([5], !!a), this.container.setRowVisible([4], !a);
                    break;
                case"datetime":
                    this.container.setRowVisible([4], !!a)
            }
        }, _onConfigClose: function () {
            var a = this.options;
            return !(!a.editor.formulaEdit || !a.editor.formulaEdit.isEditing) || (this.$fieldLabel.removeClass("selected"), !1)
        }, _onConfigOk: function () {
            var a = this.options;
            switch (this.field.type) {
                case"datetime":
                    var b = this.container.getWidgetByName("format-type"), c = "preset";
                    b && "custom" === b.getValue() && (b = this.container.getWidgetByName("format-custom"), c = "custom"), this.field.cellFmt = {
                        data: b.getValue(),
                        type: c
                    };
                    break;
                case"number":
                case"formula":
                    this._saveNumberStyleConfig();
                    break;
                case"address":
                    var d = this.container.getWidgetByName("format-check").getValue();
                    this.field.cellFmt = {type: "preset", data: d.join("")}
            }
            var e = YS.ListFieldConfigPane.superclass._onConfigOk.apply(this, arguments);
            return e && YS.Utils.applyFunc(this, a.onAfterEdit, [this.field], !1), e
        }
    }), a.shortcut("list_field_config", YS.ListFieldConfigPane)
}(jQuery),function (a) {
    YS.ValueFieldConfigPane = YS.extend(YS.BaseFieldConfigPane, {
        _defaultConfig: function () {
            return a.extend(YS.ValueFieldConfigPane.superclass._defaultConfig.apply(this, arguments), {
                $field: a('<li class="field-item"/>'),
                $anchor: null,
                editor: null,
                onAfterEdit: null,
                showFormat: !0,
                showPercent: !0
            })
        }, _init: function () {
            YS.ValueFieldConfigPane.superclass._init.apply(this, arguments)
        }, _getConfigItems: function () {
            var a = this, b = this.options, c = [[{type: "label", text: "显示名"}, {
                fieldId: "fieldTextEditor",
                type: "text",
                value: this.field.text,
                fieldIsnull: !1,
                waterMark: "输入字段名",
                onAfterEdit: function () {
                    a.field.text = this.getText()
                }
            }], [{type: "label", text: "编辑公式"}, {
                type: "button",
                style: "white",
                text: "...",
                iconCls: "icon-function",
                onClick: function () {
                    b.editor.createFormulaEditDialog(b.$field, {
                        hasCalcFormula: "formula" === a.field.type && "combine" === a.field.category,
                        onOk: function (b) {
                            return a.container.getWidgetByName("fieldTextEditor").setText(b.text), !1
                        }
                    })
                }
            }], [{type: "label", text: "汇总方式"}, {
                fieldId: "aggregateMethodCombo",
                type: "combo",
                fieldIsnull: !1,
                items: [{value: "sum", text: "求和"}, {value: "avg", text: "平均"}, {value: "max", text: "最大值"}, {
                    value: "min",
                    text: "最小值"
                }, {value: "none", text: "无"}],
                value: this.field.op ? this.field.op : "sum",
                onItemCreate: function (b) {
                    return !("formula" !== a.field.type || "avg" !== b.value)
                },
                onAfterItemSelect: function (c, d) {
                    b.showPercent && "sum" === d.value ? a.container.$rows[3].show() : a.container.$rows[3].hide()
                }
            }], [{type: "label", text: "汇总占比"}, {
                fieldId: "percentageSwitch",
                type: "switch",
                width: 44,
                height: 22,
                value: !!a.field.percent
            }]];
            return c.concat(this._getNumberStyleConfigItems())
        }, _changeNumberStyleConfigItems: function (a) {
            this.container.setRowVisible([6], !a), this.container.setRowVisible([5], a)
        }, _getConfigItemsRowSize: function () {
            return [30, 30, 30, 30, 30, 90, 30]
        }, _onConfigShow: function () {
            var a = this.options;
            this.field.formula || this.container.$rows[1].hide(), (!a.showPercent || this.field.op && "sum" !== this.field.op) && this.container.$rows[3].hide(), "count" === this.field.type && (this.container.$rows[1].hide(), this.container.$rows[2].hide()), a.showFormat ? this.field.cellFmt && "custom" === this.field.cellFmt.type ? this.container.setRowVisible([5], !1) : this.container.setRowVisible([6], !1) : this.container.setRowVisible([4, 5, 6], !1), a.isAggregate && this.container.setRowVisible([2, 3], !1)
        }, _onConfigClose: function () {
            var a = this.options;
            return !(!a.editor.formulaEdit || !a.editor.formulaEdit.isEditing) || (this.$fieldLabel.removeClass("selected"), !1)
        }, _onConfigOk: function () {
            var a = this.options, b = YS.GroupFieldConfigPane.superclass._onConfigOk.apply(this, arguments);
            if (!b)return !1;
            var c = this.container.getWidgetByName("aggregateMethodCombo");
            return this.field.op = c.getValue(), a.showPercent && "sum" === this.field.op ? this.field.percent = this.container.getWidgetByName("percentageSwitch").getValue() : this.field.percent = !1, a.showFormat && this._saveNumberStyleConfig(), YS.Utils.applyFunc(this, a.onAfterEdit, [this.field], !1), !0
        }
    }), a.shortcut("value_field_config", YS.ValueFieldConfigPane)
}(jQuery),function (a) {
    YS.FilterFieldConfigPane = YS.extend(YS.BaseFieldConfigPane, {
        _defaultConfig: function () {
            return a.extend(YS.FilterFieldConfigPane.superclass._defaultConfig.apply(this, arguments), {
                $field: a('<li class="field-item"/>'),
                $anchor: null,
                editor: null,
                onBeforeEdit: null,
                onAfterEdit: null
            })
        }, _getConfigItemsRowSize: function () {
            return "datetime" === this.field.type ? [30, "auto"] : [30, 30]
        }, _getConfigItems: function () {
            var b = this.options, c = this, d = b.$field.data("field"), e = {
                width: 160,
                fieldId: "defaultValue",
                value: d.defaultValue
            }, f = YS.Utils.applyFunc(c, b.onBeforeEdit, [d], !1);
            if (f !== !1 && (d = f), d) {
                var g = YS.Utils.getFieldInfoById(d.id);
                switch (d.type) {
                    case"text":
                    case"radiogroup":
                    case"combo":
                        e.type = "xcombocheck", "ext" === d.name ? (e.items = [], YS.Utils.forEach(d.items, function (a, b) {
                            e.items.push({text: b, value: b})
                        })) : d.async ? (e.async = d.async, e.hasLimit = !0) : YS.Utils.isObjectEmpty(d.items) ? (e.async = {
                            url: "/data/distinct",
                            data: {formId: g.entryId, field: d.name, type: d.type}
                        }, e.hasLimit = !0) : e.items = d.items;
                        break;
                    case"number":
                        e.type = "numberlimit", e.width4number = 70;
                        break;
                    case"datetime":
                        e.type = "dateconfigpane", e.width4date = 160;
                        break;
                    case"address":
                        e.type = "address", e.customCls = "default-fix", e.needDetail = !1, e.height = 70;
                        break;
                    case"user":
                        e.type = "usercheck", a.extend(e, this._getUserConfig());
                        break;
                    case"dept":
                        e.type = "deptselect", e.dynamicType = "set";
                        break;
                    default:
                        "creator" === d.name && (e.type = "usercheck", a.extend(e, this._getUserConfig()))
                }
            }
            return [[{type: "label", text: "显示名"}, {
                fieldId: "fieldTextEditor",
                type: "text",
                value: this.field.text,
                fieldIsnull: !1,
                waterMark: "输入字段名",
                onAfterEdit: function () {
                    c.field.text = this.getText()
                }
            }], [{type: "label", text: "默认值"}, e]]
        }, _getUserConfig: function () {
            return {
                textField: "nickname",
                valueField: "_id",
                asyncResultKey: "members",
                async: {url: "manager/team/list", data: {hasCurrentUser: !0, hasAdmin: !0, hasCount: !1}},
                hasLimit: !0,
                searchKey: "filter"
            }
        }, _onConfigOk: function () {
            var a = this.options, b = YS.FilterFieldConfigPane.superclass._onConfigOk.apply(this, arguments), c = this.container.getWidgetByName("defaultValue"), d = c.checkValidate();
            return b && d && (this.field.defaultValue = c.getValue(), YS.Utils.applyFunc(this, a.onAfterEdit, [this.field], !1)), b && d
        }
    }), a.shortcut("filter_field_config", YS.FilterFieldConfigPane)
}(jQuery),function (a) {
    YS.LinkFieldConfigPane = YS.extend(YS.BaseFieldConfigPane, {
        _defaultConfig: function () {
            return a.extend(YS.LinkFieldConfigPane.superclass._defaultConfig.apply(this, arguments), {onAfterEdit: null})
        }, _onConfigOk: function () {
            var a = this.options, b = YS.LinkFieldConfigPane.superclass._onConfigOk.apply(this, arguments);
            return b && YS.Utils.applyFunc(this, a.onAfterEdit, [this.field], !1), b
        }
    }), a.shortcut("link_field_config", YS.LinkFieldConfigPane)
}(jQuery),function (a) {
    YS.BaseFieldEditPane = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.BaseFieldEditPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_field_edit_pane",
                title: "FieldEditPane",
                entryList: [],
                fields: [],
                selectedFields: [],
                supportFormula: !1,
                supportGroupFormula: !1,
                allowMultiTable: !1,
                onAfterFieldAdd: null,
                onAfterFieldUpdate: null,
                onAfterFieldRemove: null,
                onAfterFieldSorted: null,
                onFinishAdd: null
            })
        }, _init: function () {
            YS.BaseFieldEditPane.superclass._init.apply(this, arguments), this._createHeader(), this._createFieldList(), this._setFieldListSortable(), this._bindFieldListEvents()
        }, _createHeader: function () {
            var b = this, c = this.options;
            this.$title = a('<div class="cfg_title"/>'), a('<div class="title-text"/>').text(c.title).appendTo(this.$title), this.$navi = a('<div class="edit-group"/>').appendTo(this.$title), c.isAggregate || this.$navi.append(a('<i class="icon-add"/>').click(function () {
                var d = b._createFieldSelect();
                return d.addClass("active"), a(document).bind("mousedown.field-menu", function (e) {
                    var f = e.target, g = a(f).closest(".fx_field_select_pane");
                    (!g || g.length <= 0) && (YS.Utils.applyFunc(b, c.onFinishAdd, [], !1), d.remove(), a(document).unbind("mousedown.field-menu"))
                }), !1
            })), c.supportGroupFormula && this.$navi.append(a('<i class="x-iconfont icon-sigma">').click(function () {
                b._onCombineFormulaBtnClick()
            })), this.$title.appendTo(this.element)
        }, _onCombineFormulaBtnClick: function () {
            this.createFormulaEditDialog(null, {formulaCategory: "combine", hasCalcFormula: !0})
        }, createFormulaEditDialog: function (b, c) {
            var d = this, e = this.options, f = b ? b.data("field") : {};
            this.formulaEdit = new YS.FormulaEditPane(a.extend({
                field: f,
                forms: e.forms,
                entryList: e.entryList,
                joinedSubform: e.joinedSubform,
                selectedFields: e.fields.slice(),
                operators: YS.Operators.group,
                allowNumber: !e.isAggregate,
                allowMultiTable: e.allowMultiTable,
                onAfterFormulaAdd: function (a) {
                    d._appendFieldItem(a), YS.Utils.applyFunc(d, e.onFinishAdd, [], !1)
                },
                onAfterFieldUpdate: function (a) {
                    b.data("field", a)
                }
            }, c)), this.formulaEdit.show()
        }, _createFieldList: function () {
            var b = this, c = this.options, d = a('<div class="cfg_content"/>');
            this.$fieldList = a('<ul class="field-list"/>').appendTo(d), YS.Utils.forEach(c.fields, function (a, c) {
                var d = b._addFieldItem(c);
                b._isFieldVisible(c) || d.hide()
            }), d.appendTo(this.element)
        }, _isFieldVisible: function (a) {
            return !("formula" === a.type && a.fieldEnable === !1)
        }, _setFieldListSortable: function () {
            var a, b, c, d = this.options;
            this.$fieldList.sortable({
                handle: ".field-name",
                nested: !1,
                itemSelector: "li.field-item.main-field",
                onDragStart: function (c, d, e) {
                    var f = c.offset(), g = d.rootGroup.pointer;
                    a = g.top - f.top, b = c.index(), e(c)
                },
                onDrag: function (b, c, d) {
                    c.left = 0, c.top -= a, d(b, c)
                },
                onDrop: function (a, e, f) {
                    f(a), c = a.index(), b > -1 && c > -1 && b !== c && (d.fields.splice(c, 0, d.fields.splice(b, 1)[0]), YS.Utils.applyFunc(this, d.onAfterFieldUpdate, [a.data("field"), c], !1), YS.Utils.applyFunc(this, d.onAfterFieldSorted, [a.data("field")], !1))
                }
            })
        }, _addFieldItem: function (b) {
            var c = a('<div class="field-label"/>').append(a('<div class="field-name"/>').text(b.text)).append(a('<div class="edit-group"/>').append(a('<i class="nav nav-edit icon-setting x-c-key hv"/>')).append(a('<i class="nav nav-remove icon-field-remove"/>')));
            return a('<li class="field-item main-field"/>').append(c).data("field", b).appendTo(this.$fieldList)
        }, _appendFieldItem: function (a) {
            var b = this.options, c = this._getFieldAttr(a);
            b.fields.push(c), this._addFieldItem(c), YS.Utils.applyFunc(this, b.onAfterFieldAdd, [c], !1)
        }, _getFieldAttr: function (b) {
            var c = {
                tag: this._getTag(b),
                id: b.id,
                name: b.name,
                text: b.text,
                type: b.type,
                subform: b.subform,
                isJoined: b.isJoined
            };
            switch (b.type) {
                case"combo":
                    a.extend(c, {async: b.async});
                    break;
                case"linkdata":
                    a.extend(c, {linkForm: b.linkForm, linkFields: b.linkFields});
                    break;
                case"datetime":
                    a.extend(c, {fieldFormat: b.fieldFormat});
                    break;
                case"address":
                    a.extend(c, {needDetail: b.needDetail});
                    break;
                case"formula":
                    a.extend(c, b)
            }
            return c
        }, _getTag: function (a) {
            var b = this.options;
            return b.isAggregate && a && /_formula_/.test(a.name) ? a.name.replace("_formula_", "f_") : ["f", YS.STATIC.IDBase++].join("_")
        }, _createFieldSelect: function () {
            return a('<div class="field-select"/>').appendTo(this.$title)
        }, _bindFieldListEvents: function () {
            var b = this, c = function (c) {
                var d = c.target, e = c.type, f = a(d).closest(".nav"), g = a(d).closest("li.field-item");
                f && f.length && "click" === e && (f.hasClass("nav-edit") ? b._showFieldConfig(g, f) : f.hasClass("nav-remove") && b._removeField(g))
            };
            this.$fieldList.unbind(".field-list"), this.$fieldList.bind({"click.field-list": c})
        }, _removeField: function (a) {
            var b = this.options, c = a.data("field"), d = this._findFieldIndex(c);
            d > -1 && b.fields.splice(d, 1), b.selectedFields && b.selectedFields.length > 0 && (d = this._findSelectedFieldIndex(c), d > -1 && b.selectedFields.splice(d, 1)), YS.Utils.applyFunc(this, b.onAfterFieldRemove, [c, d], !1), a.remove()
        }, _findFieldIndex: function (a) {
            var b = this.options, c = -1;
            return YS.Utils.forEach(b.fields, function (b, d) {
                if (d.name === a.name && d.id === a.id)return c = b, !1
            }), c
        }, _findSelectedFieldIndex: function (a) {
            var b = this.options, c = -1;
            return YS.Utils.forEach(b.selectedFields, function (b, d) {
                if (a.name === d.name && a.id === d.id)return c = b, !1
            }), c
        }, _showFieldConfig: function (a, b) {
        }
    }), a.shortcut("field_edit", YS.BaseFieldEditPane)
}(jQuery),function (a) {
    YS.ListFieldEditPane = YS.extend(YS.BaseFieldEditPane, {
        _defaultConfig: function () {
            return a.extend(YS.ListFieldEditPane.superclass._defaultConfig.apply(this, arguments), {
                forms: [],
                fields: [],
                selectedFields: [],
                relations: {},
                joinedFields: [],
                availableFields: YS.LimitFields.list,
                supportFormula: !0
            })
        }, _init: function () {
            this.subFieldMap = {}, YS.ListFieldEditPane.superclass._init.apply(this, arguments)
        }, _createFieldList: function () {
            var b = this, c = this.options, d = a('<div class="cfg_content"/>');
            this.$fieldList = a('<ul class="field-list"/>').appendTo(d), YS.Utils.forEach(c.fields, function (c, d) {
                var e = b._addFieldItem(d);
                if ("subform" === d.type) {
                    var f = a('<ul class="subform-fields"/>').appendTo(e);
                    YS.Utils.forEach(d.items, function (a, c) {
                        b._createSubFieldItem(c).appendTo(f)
                    }), b.subFieldMap[d.name] = e
                }
                b._isFieldVisible(d) || e.hide()
            }), d.appendTo(this.element)
        }, _createFieldSelect: function () {
            var a = YS.ListFieldEditPane.superclass._createFieldSelect.apply(this, arguments), b = this, c = this.options, d = [];
            return YS.Utils.forEach(c.relations, function (a, b) {
                YS.Utils.forEach(b, function (a, b) {
                    d.push(b)
                })
            }), new YS.EntryFieldSelectPane({
                renderEl: a,
                entryList: c.entryList,
                forms: c.forms,
                fields: c.selectedFields.length > 0 ? c.selectedFields : c.fields.slice(),
                joinedFields: c.joinedFields,
                excludeFields: d,
                availableFields: c.availableFields,
                onFieldSelect: function (a) {
                    return b._appendFieldItem(a), !1
                }
            }), a
        }, _appendFieldItem: function (a) {
            a.subform ? this._appendSubFieldItem(a) : YS.ListFieldEditPane.superclass._appendFieldItem.apply(this, arguments)
        }, _appendSubFieldItem: function (b) {
            var c, d, e = this.options, f = this.subFieldMap[b.subform], g = !1;
            f ? (d = f.children(".subform-fields"), c = f.data("field")) : (c = {
                tag: this._getTag(),
                appId: b.appId,
                id: b.id,
                name: b.subform,
                text: b.subformText || b.text,
                type: "subform",
                items: []
            }, f = this._addFieldItem(c), d = a('<ul class="subform-fields"/>').appendTo(f), this.subFieldMap[b.subform] = f, g = !0);
            var h = b.text.substr(b.subformText.length + 1), i = a.extend({}, b, {
                name: b.name.split(".")[1] || b.name,
                text: h || b.text,
                subform: b.subform
            });
            c.items.push(i), this._createSubFieldItem(i).appendTo(d), f.data("field", c), g && e.fields.push(c), YS.Utils.applyFunc(this, e.onAfterFieldAdd, [b], !1)
        }, _createSubFieldItem: function (b) {
            var c = a('<div class="field-label"/>').append(a('<div class="field-name"/>').text(b.text)).append(a('<div class="edit-group"/>').append(a('<i class="nav nav-edit icon-edit x-c-key hv"/>')).append(a('<i class="nav nav-remove icon-field-remove"/>')));
            return a('<li class="field-item subform-field"/>').append(c).data("field", b)
        }, _removeField: function (a) {
            var b = this.options;
            if (a.hasClass("subform-field")) {
                var c = a.data("field"), d = a.closest("li.field-item.main-field"), e = d.data("field"), f = this._findSubformFieldIndex(c, e);
                f > -1 && e.items.splice(f, 1), 0 === e.items.length ? (this._removeField(d), this.subFieldMap[e.name] = void 0) : (a.remove(), YS.Utils.applyFunc(this, b.onAfterFieldRemove, [c], !1))
            } else {
                var g = a.data("field");
                "subform" === g.type && (this.subFieldMap[g.name] = void 0), YS.ListFieldEditPane.superclass._removeField.apply(this, arguments)
            }
        }, _findSubformFieldIndex: function (a, b) {
            var c = -1;
            return YS.Utils.forEach(b.items, function (b, d) {
                if (a.name === d.name)return c = b, !1
            }), c
        }, _showFieldConfig: function (a, b) {
            var c = this, d = this.options, e = new YS.ListFieldConfigPane({
                $field: a,
                $anchor: b,
                editor: this,
                onAfterEdit: function (a) {
                    YS.Utils.applyFunc(c, d.onAfterFieldUpdate, [a], !1)
                }
            });
            e.show()
        }
    }), a.shortcut("list_field_edit", YS.ListFieldEditPane)
}(jQuery),function (a) {
    YS.GroupFieldEditPane = YS.extend(YS.BaseFieldEditPane, {
        _defaultConfig: function () {
            return a.extend(YS.GroupFieldEditPane.superclass._defaultConfig.apply(this, arguments), {
                forms: [],
                entryList: [],
                fields: [],
                selectedFields: [],
                joinedFields: [],
                availableFields: YS.LimitFields.group,
                supportFormula: !1,
                hasDetail: !1
            })
        }, _createFieldSelect: function () {
            var a = YS.GroupFieldEditPane.superclass._createFieldSelect.apply(this, arguments), b = this, c = this.options;
            return c.joinedFields.length > 0 ? new YS.JoinedFieldSelectPane({
                renderEl: a,
                entryList: c.entryList,
                forms: c.forms,
                fields: c.selectedFields.length > 0 ? c.selectedFields : c.fields.slice(),
                joinedFields: c.joinedFields,
                onFieldSelect: function (a) {
                    return b._appendFieldItem(a), !1
                }
            }) : new YS.EntryFieldSelectPane({
                renderEl: a,
                entryList: c.entryList,
                forms: c.forms,
                fields: c.selectedFields.length > 0 ? c.selectedFields : c.fields.slice(),
                availableFields: c.availableFields,
                onFieldSelect: function (a) {
                    return b._appendFieldItem(a), !1
                }
            }), a
        }, _showFieldConfig: function (a, b) {
            var c = this, d = this.options, e = new YS.GroupFieldConfigPane({
                $field: a,
                $anchor: b,
                hasDetail: d.hasDetail,
                onAfterEdit: function (a) {
                    YS.Utils.applyFunc(c, d.onAfterFieldUpdate, [a], !1)
                }
            });
            e.show()
        }
    }), a.shortcut("group_field_edit", YS.GroupFieldEditPane)
}(jQuery),function (a) {
    YS.ValueFieldEditPane = YS.extend(YS.BaseFieldEditPane, {
        _defaultConfig: function () {
            return a.extend(YS.ValueFieldEditPane.superclass._defaultConfig.apply(this, arguments), {
                forms: [],
                entryList: [],
                fields: [],
                selectedFields: [],
                availableFields: ["number", "subform"],
                supportFormula: !0,
                supportGroupFormula: !0,
                allowMultiTable: !0,
                showFormat: !0,
                showPercent: !0
            })
        }, _createFieldSelect: function () {
            var a = YS.ValueFieldEditPane.superclass._createFieldSelect.apply(this, arguments), b = this, c = this.options;
            return new YS.EntryFieldSelectPane({
                renderEl: a,
                entryList: c.entryList,
                forms: c.forms,
                fields: c.selectedFields.length > 0 ? c.selectedFields : c.fields.slice(),
                availableFields: c.availableFields,
                hasCount: !0,
                allowMultiTable: !0,
                onFieldSelect: function (a) {
                    return b._appendFieldItem(a), !1
                }
            }), a
        }, _showFieldConfig: function (a, b) {
            var c = this, d = this.options, e = new YS.ValueFieldConfigPane({
                $field: a,
                $anchor: b,
                editor: this,
                isAggregate: d.isAggregate,
                showPercent: d.showPercent,
                onAfterEdit: function (a) {
                    YS.Utils.applyFunc(c, d.onAfterFieldUpdate, [a], !1)
                }
            });
            e.show()
        }
    }), a.shortcut("value_field_edit", YS.ValueFieldEditPane)
}(jQuery),function (a) {
    YS.FilterFieldEditPane = YS.extend(YS.BaseFieldEditPane, {
        _defaultConfig: function () {
            return a.extend(YS.FilterFieldEditPane.superclass._defaultConfig.apply(this, arguments), {
                forms: [],
                fields: [],
                selectedFields: [],
                supportFormula: !1,
                entryFilter: null
            })
        }, _createFieldSelect: function () {
            var a = YS.FilterFieldEditPane.superclass._createFieldSelect.apply(this, arguments), b = this, c = this.options;
            return this._getFormList(function () {
                new YS.FilterFieldSelectPane({
                    renderEl: a,
                    entryList: b.formList,
                    forms: c.forms,
                    fields: c.selectedFields.length > 0 ? c.selectedFields : c.fields.slice(),
                    availableFields: c.availableFields,
                    allowMultiTable: !0,
                    onFieldSelect: function (a) {
                        return b._appendFieldItem(a), !1
                    }
                })
            }), a
        }, _getFieldByEntryList: function (a) {
            if (!this.ffMap) {
                this.ffMap = {};
                var b = this;
                YS.Utils.forEach(b.formList, function (a, c) {
                    b.ffMap[a] || (b.ffMap[a] = {}), YS.Utils.forEach(c.fields, function (c, d) {
                        d.id = a, b.ffMap[a][d.name] = d
                    })
                })
            }
            return this.ffMap[a.id] ? this.ffMap[a.id][a.name] : null
        }, _getFormList: function (a) {
            var b = this, c = this.options;
            this.formList ? a && a(this.formList) : YS.Utils.ajax({
                url: "/dashboard/fields/get",
                data: {hasAggregateTable: !0, forms: c.forms}
            }, function (c) {
                b.formList = c, a && a(b.formList)
            })
        }, _showFieldConfig: function (a, b) {
            var c = this, d = this.options;
            c._getFormList(function () {
                var e = new YS.FilterFieldConfigPane({
                    $field: a, $anchor: b, onBeforeEdit: function (a) {
                        return c._getFieldByEntryList(a)
                    }, onAfterEdit: function (b) {
                        YS.Utils.applyFunc(c, d.onAfterFieldUpdate, [b, a.index()], !1)
                    }
                });
                e.show()
            })
        }
    }), a.shortcut("filter_field_edit", YS.FilterFieldEditPane)
}(jQuery),function (a) {
    YS.linkFieldEditPane = YS.extend(YS.BaseFieldEditPane, {
        _defaultConfig: function () {
            return a.extend(YS.linkFieldEditPane.superclass._defaultConfig.apply(this, arguments), {
                fields: [],
                availableFields: [],
                subform: null
            })
        }, _createFieldSelect: function () {
            var a = YS.linkFieldEditPane.superclass._createFieldSelect.apply(this, arguments), b = this, c = this.options;
            return new YS.LinkFieldSelectPane({
                renderEl: a,
                items: c.availableFields,
                fields: c.fields,
                availableFields: c.subform ? YS.LimitFields.subLinkData : YS.LimitFields.linkData,
                onFieldSelect: function (a) {
                    return b._appendFieldItem(a), !1
                }
            }), a
        }, _getFieldAttr: function (b) {
            var c = {name: b.name, text: b.text, type: b.type};
            switch (b.type) {
                case"datetime":
                    a.extend(c, {fieldFormat: b.fieldFormat});
                    break;
                case"address":
                    a.extend(c, {needDetail: b.needDetail});
                    break;
                case"subform":
                    a.extend(c, {items: b.items})
            }
            return c
        }, _createFieldList: function () {
            var b = this, c = this.options, d = a("<div/>").appendTo(this.element);
            this.$fieldList = a('<ul class="field-list"/>').appendTo(d), YS.Utils.forEach(c.fields, function (a, c) {
                var d = b._addFieldItem(c);
                b._isFieldVisible(c) || d.hide()
            })
        }, _addFieldItem: function (b) {
            var c = a('<div class="field-label"/>').append(a('<div class="field-name" style="width: 215px"/>').text(b.text)).append(a('<div class="edit-group"/>').append(a('<i class="nav nav-edit icon-edit x-c-key hv"/>')).append(a('<i class="nav nav-remove icon-field-remove"/>')));
            return a('<li class="field-item main-field"/>').append(c).data("field", b).appendTo(this.$fieldList)
        }, _showFieldConfig: function (a, b) {
            var c = this, d = this.options, e = new YS.LinkFieldConfigPane({
                $field: a,
                $anchor: b,
                editor: this,
                onAfterEdit: function (b) {
                    YS.Utils.applyFunc(c, d.onAfterFieldUpdate, [b, a.index()], !1)
                }
            });
            e.show()
        }
    }), a.shortcut("link_field_edit", YS.linkFieldEditPane)
}(jQuery),function (a) {
    YS.FormulaEditPane = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.FormulaEditPane.superclass._defaultConfig.apply(this, arguments), {
                field: {},
                forms: [],
                formulaCategory: "calc",
                joinedSubform: null,
                entryList: YS.EditReport && YS.EditReport.entryList,
                selectedFields: [],
                operators: ["+", "-", "*", "/", "."],
                allowMultiTable: !1,
                hasCalcFormula: !1,
                onAfterFormulaAdd: null,
                onAfterFormulaUpdate: null,
                onOk: null,
                onCancel: null
            })
        }, _init: function () {
            YS.FormulaEditPane.superclass._init.apply(this, arguments), this._createFieldSelect(), this._createFieldEditor(), this._createEditDialog()
        }, _createFieldSelect: function () {
            var b = this, c = this.options;
            this.$fieldSelect = a('<div class="field-select"/>'), this.fieldSelect = new YS.EntryFieldSelectPane({
                renderEl: this.$fieldSelect,
                mode: "dialog",
                forms: c.forms,
                subform: c.joinedSubform,
                fields: c.selectedFields,
                availableFields: ["number", "subform"],
                hasCalcFormula: c.hasCalcFormula,
                allowMultiTable: c.allowMultiTable,
                allowSameField: !0,
                entryList: c.entryList,
                onFieldSelect: function (a) {
                    return b.formulaEditor.addField(a), !1
                }
            })
        }, _createFieldEditor: function () {
            var b = this, c = this.options;
            this.$formulaEditor = a('<div class="formula-editor"/>'), this.formulaEditor = new YS.FormulaPane({
                renderEl: this.$formulaEditor,
                width: 286,
                height: 390,
                text: c.field.text,
                formula: c.field.formula,
                subform: c.field.subform,
                joinedSubform: c.joinedSubform,
                entryList: c.entryList,
                selectedFields: c.selectedFields,
                operators: c.operators,
                allowNumber: c.allowNumber,
                onAfterFieldAdd: function (a) {
                    return b.fieldSelect.selectField(a), !1
                },
                onAfterFieldRemove: function (a) {
                    return b.fieldSelect.deselectField(a), !1
                }
            })
        }, _createEditDialog: function () {
            var b = this, c = this.options;
            this.dialog = new YS.ConfirmDialog({
                title: "公式编辑",
                width: 620,
                height: 510,
                contentWidget: {
                    rowSize: [390],
                    colSize: [286, 16, 286],
                    hgap: 0,
                    vgap: 16,
                    padding: 15,
                    items: [[this.$fieldSelect, {}, this.$formulaEditor]]
                },
                onOk: function () {
                    var d = b.formulaEditor.checkValidate();
                    if (!d)return !0;
                    var e = b.formulaEditor.getFormula();
                    return YS.Utils.isObjectEmpty(c.field) ? (c.field = a.extend({
                        name: c.field.name ? c.field.name : "_formula_" + YS.STATIC.IDBase++,
                        category: c.formulaCategory,
                        type: "formula"
                    }, e), YS.Utils.applyFunc(this, c.onAfterFormulaAdd, [c.field], !1)) : (a.extend(c.field, e), YS.Utils.applyFunc(this, c.onAfterFormulaUpdate, [c.field], !1)), YS.Utils.applyFunc(this, c.onOk, [c.field], !1)
                },
                onCancel: function () {
                    return YS.Utils.applyFunc(this, c.onCancel, [], !1)
                },
                onClose: function () {
                    return b.isEditing = !1, !1
                }
            })
        }, show: function () {
            this.isEditing = !0, this.dialog.show(), this.formulaEditor.focusEditor()
        }
    })
}(jQuery),function (a) {
    YS.FormulaPane = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.FormulaPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_formula_pane",
                text: "公式",
                formula: null,
                subform: null,
                entryList: null,
                selectedFields: [],
                operators: YS.Operators.group,
                allowNumber: !0,
                onAfterNameEdit: null,
                onAfterFieldAdd: null,
                onAfterFieldRemove: null
            })
        }, _init: function () {
            var b = this, c = this.options;
            YS.FormulaPane.superclass._init.apply(this, arguments), this.$title = a('<div class="formula-title"/>').appendTo(this.element);
            var d = a('<div class="formula-name"/>').appendTo(this.$title), e = 210;
            YS.Utils.isNumber(c.width) && (e = c.width - 30), this.nameInput = new YS.TextEditor({
                renderEl: d,
                value: c.text,
                width: e,
                height: 30,
                fieldIsnull: !1,
                onAfterEdit: function () {
                    YS.Utils.applyFunc(b, c.onAfterNameEdit, [this.getValue()], !1)
                }
            }), d.css({display: "inline-block"}), a('<span class="equal-sign"/>').css({"margin-left": "15px"}).text("=").appendTo(this.$title), this.$editor = a('<div class="formula-editor"/>').appendTo(this.element), this.$fakeInput = a('<input class="fake-input"/>').appendTo(this.element), a('<div class="formula-foot"><ul><li>请从左侧面板选择包含的字段名</li><li>公式编辑样式举例：<span class="formula-field">进货数量</span> + 20</li></ul></div>').appendTo(this.element), this.fields = [], this._initFormulaMap(), this._createCursor(), this._bindEditorKeyEvents(), this._bindEditorMouseEvents(), this._setFormula(), this.focusEditor()
        }, _initFormulaMap: function () {
            var a = this, b = this.options;
            this.formulaMap = {}, YS.Utils.forEach(b.selectedFields, function (b, c) {
                "formula" === c.type && (a.formulaMap[c.name] = c)
            })
        }, _createCursor: function () {
            var b = this;
            this.$cursor = a('<div class="cursor">').html("&nbsp;").appendTo(this.$editor);
            var c = function () {
                b.$cursor.animate({opacity: 0}, "fast", "swing").animate({opacity: 1}, "fast", "swing")
            };
            setInterval(c, 800)
        }, _bindEditorKeyEvents: function () {
            var a = this, b = (this.options, function () {
                var b = a.$fakeInput.val();
                b.length > 0 && (b.replace(" ", "").split("").forEach(function (b) {
                    a._insertItem({text: b})
                }), a.$fakeInput.val(""))
            });
            this.$fakeInput.keydown(function (c) {
                if (a.isEnabled()) {
                    a.$editor.removeClass("error");
                    var d = c.which || c.keyCode;
                    switch (d) {
                        case YS.Keys.BACKSPACE:
                            a._removeFormulaItem(a.$cursor.prev());
                            break;
                        case YS.Keys.DELETE:
                            a._removeFormulaItem(a.$cursor.next());
                            break;
                        case YS.Keys.LEFT:
                            a.$cursor.insertBefore(a.$cursor.prev());
                            break;
                        case YS.Keys.RIGHT:
                            a.$cursor.insertAfter(a.$cursor.next());
                            break;
                        default:
                            b()
                    }
                }
            }).keyup(function (a) {
                b()
            })
        }, focusEditor: function () {
            var a = this;
            this.$fakeInput.focus(), this.$editor.addClass("focus"), this.$cursor.css({display: "inline-block"}), this.$fakeInput.focusout(function () {
                a.$editor.removeClass("focus"), a.$cursor.hide()
            })
        }, _bindEditorMouseEvents: function () {
            var b = this, c = (this.options, function (c) {
                if (b.isEnabled()) {
                    var d = c.target, e = c.type, f = a(d).closest("span.fi");
                    "mousedown" === e && (f && f.length ? (b.focusEditor(), b.$cursor.insertBefore(f), c.stopEvent()) : (b.$editor.removeClass("error"), b.focusEditor(), b.$cursor.insertAfter(b.$editor.children(".fi").last()), c.stopEvent()))
                }
            });
            this.$editor.unbind(".formula-editor"), this.$editor.bind({"mousedown.formula-editor": c})
        }, _findField: function (b, c) {
            var d = this.options, e = null, f = null;
            if (/_formula_/.test(c))return this.formulaMap[c];
            if (c.indexOf(".") > -1) {
                var g = c.split(".");
                c = g[0], f = g[1]
            }
            return YS.Utils.forEach(d.entryList, function (d, g) {
                if (b !== g.entryId)return;
                return YS.Utils.forEach(g.fields, function (b, d) {
                    if (c === d.name)return YS.Utils.isEmpty(f) ? e = d : YS.Utils.forEach(d.items, function (b, g) {
                        if (f === g.name)return e = a.extend({}, g), e.text = [d.text, e.text].join("."), e.name = [d.name, e.name].join("."), e.subform = c, !1
                    }), !1
                }), !1
            }), e
        }, setText: function (a) {
            YS.FormulaPane.superclass.setText.apply(this, arguments), this.nameInput.setText(a), this.nameInput.setState(YS.States.NORMAL)
        }, setFormula: function (a) {
            var b = this.options;
            b.formula = a, b.subform = null, this.$editor.empty(), this.$cursor.appendTo(this.$editor), this.fields = [], this._setFormula()
        }, _setFormula: function () {
            var a = this, b = this.options;
            if (b.formula && b.formula.length > 0) {
                var c = b.formula.split(/(\$[0-9a-zA-Z\._#@]+)/g);
                YS.Utils.forEach(c, function (b, c) {
                    if (a._isItemField(c)) {
                        var d = c.replace("$", "").split("#"), e = d[0], f = d[1], g = a._findField(f, e);
                        if (g) {
                            var h = e;
                            g && (h = g.label || g.text);
                            var i = {text: h, name: e, id: f};
                            a.addField(i)
                        }
                    } else c.split("").forEach(function (b) {
                        a._insertItem({text: b})
                    })
                })
            }
        }, _insertItem: function (b) {
            var c = b.text;
            return a('<span class="fi"/>').text(c).insertBefore(this.$cursor)
        }, _removeFormulaItem: function (a) {
            var b = this.options;
            if (a.hasClass("field")) {
                var c = a.data("field"), d = this.fields.indexOf(c);
                d > -1 && this.fields.splice(d, 1), YS.Utils.applyFunc(this, b.onAfterFieldRemove, [c, this.fields], !1)
            }
            a.remove()
        }, addField: function (a) {
            var b = this.options, c = this._insertItem(a), d = a.id;
            "formula" === a.type && (d = a.forms[0]);
            var e = "$" + a.name + "#" + d;
            return c.addClass("field").data("fieldname", e).data("field", a).insertBefore(this.$cursor), this.fields.push(a), this.focusEditor(), YS.Utils.applyFunc(this, b.onAfterFieldAdd, [a, this.fields], !1), c
        }, checkValidate: function () {
            var a = this.options;
            if (!this.nameInput.getText())return this.nameInput.showErrorMsg("字段名必填"), !1;
            var b = this._getFormulaItems();
            return !!this._isFormulaValid(b) || (this.$editor.addClass("error"), YS.Msg.toast({
                    type: "warning",
                    msg: "公式不正确"
                }), a.formula = null, !1)
        }, getFormula: function () {
            var a = this.options, b = this._getFormulaItems(), c = this.nameInput.getText();
            if (a.formula = b.join(""), !a.formula.match(/\.\d*\./g))return {
                formula: a.formula,
                forms: this.forms,
                subform: a.subform,
                text: c
            }
        }, _getFormulaItems: function () {
            var b = [];
            return this.$editor.children(".fi").each(function (c, d) {
                var e = a(d);
                e.hasClass("field") ? b.push(e.data("fieldname")) : b.push(e.text().replace(/\s/, ""))
            }), b
        }, _isFormulaValid: function (a) {
            var b = this, c = this.options, d = !0, e = [], f = [];
            return b.forms = [], YS.Utils.forEach(a, function (a, g) {
                if ("(" === g)e.push(g), f = []; else if (")" === g)d &= !!e.pop(), d &= f.length > 0; else if (g && 0 !== g.length) {
                    if (YS.Utils.isNumber(g))d &= !!c.allowNumber; else if (b._isItemField(g)) {
                        var h = g.split("#");
                        if (h.length > 1) {
                            var i = h[1];
                            b.forms.indexOf(i) === -1 && b.forms.push(i)
                        }
                        var j = f.slice(-1)[0];
                        d &= !j || !b._isItemField(j)
                    } else c.operators.indexOf(g) !== -1 ? (d &= ["+", "-"].indexOf(g) > -1 || f.length > 0, d &= c.operators.indexOf(f.slice(-1)[0]) === -1) : d &= !1;
                    f.push(g)
                } else d &= !0;
                if (!d)return !1
            }), d &= c.operators.indexOf(f.slice(-1)[0]) === -1, d &= 0 === e.length, !!d
        }, _isItemField: function (a) {
            return /^\$_(widget|formula)_/.test(a)
        }, setEnable: function (a) {
            YS.FormulaPane.superclass.setEnable.apply(this, arguments), this.nameInput.setEnable(a), a ? (this.$fakeInput.removeAttr("disabled"), this.$fakeInput.focus()) : (this.$fakeInput.attr("disabled", "disabled"), this.$fakeInput.focusout())
        }
    }), a.shortcut("formulapane", YS.FormulaPane)
}(jQuery),function (a) {
    YS.ValidatorPane = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.ValidatorPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_validator_pane",
                validator: [],
                entryList: [],
                entryId: "",
                onAfterEdit: null
            })
        }, _init: function () {
            YS.ValidatorPane.superclass._init.apply(this, arguments), this._createValidatorList(), this._createValidatorBtn()
        }, _createValidatorBtn: function () {
            var b = this;
            new YS.Button({
                renderEl: a("<div/>").appendTo(this.element),
                type: "button",
                text: "添加校验条件",
                style: "white",
                height: 30,
                onClick: function () {
                    b._setValidator()
                }
            })
        }, _setValidator: function (a, b) {
            var c = this, d = this.options;
            new YS.FieldFormulaPane({
                formula: a,
                supportMultiForm: !1,
                formulaKeywords: Object.keys(YS.Formula).remove("MAP").remove("MAPX"),
                availableFieldValue: YS.LimitFields.validate,
                entryList: d.entryList,
                currentForm: d.entryId,
                labelMap: this.labelMap,
                onAfterFormulaEdit: function (a, e) {
                    b ? YS.Utils.isEmpty(a.formula) ? b.remove() : (b.data("formula", a.formula).data("remind", e), b.children("span").text(c._getTextFormFormula(a.formula))) : YS.Utils.isEmpty(a.formula) || c._createValidatorItem(a.formula, e), YS.Utils.applyFunc(c, d.onAfterEdit, [], !1)
                }
            })
        }, _createValidatorList: function () {
            var b = this, c = this.options;
            this.$list = a('<ul class="validator-list">').appendTo(this.element), YS.Utils.forEach(c.validator, function (a, c) {
                b._createValidatorItem(c.formula, c.remind)
            })
        }, _getTextFormFormula: function (a) {
            var b = [], c = this, d = a.split(/(\$[0-9a-zA-Z\._]+#[0-9A-Fa-f]*)/g);
            return YS.Utils.forEach(d, function (a, d) {
                if (YS.Utils.startWith(d, "$_field_")) {
                    var e = c._findFieldLabel(d);
                    b.push(e)
                } else b.push(d)
            }), b.join("")
        }, _findFieldLabel: function (a) {
            var b = this, c = this.options;
            return this.labelMap ? this.labelMap[a] : (this.labelMap = {}, YS.Utils.forEach(c.entryList, function (a, c) {
                YS.Utils.forEach(c.fields, function (a, c) {
                    var d = ["$", c.name, "#"].join("");
                    b.labelMap[d] = c.text
                })
            }), this.labelMap[a])
        }, _createValidatorItem: function (b, c) {
            var d = this, e = this.options, f = this._getTextFormFormula(b), g = a("<li/>").data("formula", b).data("remind", c).appendTo(this.$list);
            a("<span/>").text(f).appendTo(g), a('<i class="item-icon x-c-key icon-edit"/>').appendTo(g).click(function () {
                d._setValidator({formula: g.data("formula"), remind: g.data("remind")}, g)
            }), a('<i class="item-icon icon-trasho"/>').appendTo(g).click(function () {
                g.remove(), YS.Utils.applyFunc(d, e.onAfterEdit, [], !1)
            })
        }, getValue: function () {
            var b = [];
            return YS.Utils.forEach(this.$list.children("li"), function (c, d) {
                var e = a(d).data("formula");
                YS.Utils.isEmpty(e) || b.push({formula: e, remind: a(d).data("remind")})
            }), b
        }
    }), a.shortcut("validatorpane", YS.ValidatorPane)
}(jQuery),function (a) {
    YS.SelectionPane = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.SelectionPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_selection_pane",
                width: 500,
                height: 200,
                multi: !1,
                multiEdit: !0,
                contactOption: !1,
                onAfterDrop: null,
                onAfterItemSelect: null,
                onAfterItemRemove: null,
                onAfterItemAdd: null,
                onAfterItemEdit: null,
                onAfterWidgetsMapEdit: null,
                items: [],
                widgetView: null
            })
        }, _init: function () {
            YS.SelectionPane.superclass._init.apply(this, arguments);
            var b = this.options, c = this, d = a("<table class='dt-detail-table' />").appendTo(this.element);
            var thd = a("<thead><tr><th width='80'>默认选中</th><th width='160'>名称</th><th>值</th></tr></thead>").appendTo(d);
            var ct = a("<tbody />").appendTo(d);
            b.items && a.each(b.items, function (a, b) {
                var e = c._createItem(b);
                e && e.appendTo(d)
            });
        }, _initDialogItems: function (b, c, d) {
            var e = this.options, f = this, g = [];
            f.widgets = YS.EditForm.getNextItems(e.widgetView), YS.Utils.forEach(f.widgets, function (a, b) {
                g[a] = {}, g[a].value = b.widget.fieldId, g[a].text = b.label
            });
            var h = a("<ul/>").appendTo(b);
            this.comboWidgets = [], YS.Utils.forEach(d, function (b, c) {
                var d = a("<li/>").appendTo(h);
                YS.createWidget({
                    renderEl: a('<div class="contact_option_item"/>').appendTo(d),
                    type: "label",
                    text: c.text
                }), YS.createWidget({
                    renderEl: a('<div class="contact_option_label"/>').appendTo(d),
                    type: "label",
                    text: "关联以下控件"
                });
                var e = c.widgetsMap, j = [];
                YS.Utils.forEach(g, function (a, b) {
                    b.selected = !!(e && e.indexOf(b.value) > -1), b.selected && j.push(b.value)
                }), c.widgetsMap = j, f.comboWidgets.push(YS.createWidget({
                    renderEl: a("<li/>").appendTo(h),
                    type: "combocheck",
                    width: 270,
                    height: 30,
                    items: g,
                    onAfterItemSelect: function () {
                        f._setWidgetList(i)
                    }
                }))
            });
            var i = a("<ul/>").appendTo(c);
            YS.createWidget({renderEl: a("<li/>").appendTo(i), type: "label", text: "所有关联控件"}), f._setWidgetList(i)
        }, _showDialog: function () {
            var b = this, c = b.getResults().items, d = a('<div  class="contact_option_items"/>'), e = a('<div  class="contact_option_widgets"/>');
            b._initDialogItems(d, e, c);
            var f = new YS.ConfirmDialog({
                title: "选项关联控件",
                width: 570,
                height: 510,
                contentWidget: {
                    rowSize: [390],
                    colSize: [330, 10, 200],
                    hgap: 0,
                    vgap: 15,
                    padding: 15,
                    items: [[d, {}, e]]
                },
                onOk: function () {
                    return b.setWidgetsMap(), !1
                }
            });
            f.show()
        }, _showMultiEditDialog: function () {
            var b = this, c = this.options, d = [];
            c.items = this.getResults().items, YS.Utils.forEach(c.items, function (a, b) {
                b.isOther || d.push(b.text)
            });
        }, _setWidgetList: function (b) {
            var c = [];
            YS.Utils.forEach(this.comboWidgets, function (a, b) {
                c = c.concat(b.getValue())
            }), b.children(".contact_option_widget").remove(), YS.Utils.forEach(this.widgets, function (d, e) {
                var f = e.widget.fieldId;
                c.indexOf(f) > -1 && YS.createWidget({
                    renderEl: a('<li class="contact_option_widget"/>').appendTo(b),
                    type: "label",
                    text: e.label
                })
            })
        }, _createItem: function (b) {
            var c = this, d = this.options, e = a('<tr class="sel_item"/>').data("item",b);
            b.isOther && (e.addClass("item-other"), this.hasOtherItem = !0);
            var f = a('<td />').appendTo(e);
            d.multi ? (f.append("<input type='checkbox' />"), e.click(function () {
                a(this).toggleClass("select"),a(this).hasClass('select') ? a(this).find('input').attr('checked',!0) : a(this).find('input').attr('checked',!1), YS.Utils.applyFunc(c, d.onAfterItemSelect, [], !1)
            })) : (f.append("<input type='radio' />"), e.click(function () {
                a(this).hasClass("select") ? a(this).removeClass("select").find('input').attr('checked',!1) : (a("tr", c.element).removeClass("select"),a("input", c.element).attr('checked',!1), a(this).addClass("select").find('input').attr('checked',!0)), YS.Utils.applyFunc(c, d.onAfterItemSelect, [], !1)
            }));
            var g = a('<td />').text(b.text).appendTo(e),h = a('<td />').text(b.code).appendTo(e);
            b.selected && e.addClass("select").find('input').attr('checked',!0)
            return e
        }, _onOtherItemAdd: function () {
            this.$addOtherBtn.addClass("disabled"), this.hasOtherItem = !0
        }, _onOtherItemRemove: function () {
            this.$addOtherBtn.removeClass("disabled"), this.hasOtherItem = !1
        }, setWidgetsMap: function () {
            var b = [];
            YS.Utils.forEach(this.comboWidgets, function (a, c) {
                b[a] = c.getValue()
            });
            for (var c = a("tr.sel_item", this.element), d = this.options, e = 0, f = c.length; e < f; e++) {
                var g = c.eq(e);
                b[e] && (g.data("widgetsMap", b[e]), d.items && d.items[e] && (d.items[e].widgetsMap = b[e]))
            }
            YS.Utils.applyFunc(this, d.onAfterWidgetsMapEdit, [], !1)
        }, getResults: function () {
            for (var b = [], c = [], d = [], e = a("tr.sel_item", this.element), f = 0, g = e.length; f < g; f++) {
                var h = e.eq(f), i = h.data("item");
                i.selected && delete i.selected;
                h.hasClass("select") && (i.selected = !0),b.push(i)
            }
            return b
        }
    }), a.shortcut("selectionpane", YS.SelectionPane)
}(jQuery),function (a) {
    YS.SubformPane = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.SubformPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_subform_pane",
                multi: !1,
                availableAddions: {
                    text: "单行文本",
                    number: "数字",
                    datetime: "日期时间",
                    combo: "下拉框",
                    combocheck: "下拉复选框",
                    user: "成员单选",
                    usergroup: "成员多选",
                    dept: "部门单选",
                    deptgroup: "部门多选"
                    /*,linkquery: "关联查询",upload: "文件上传"
                     ,linkdata: "关联数据"*/
                },
                items: []
            })
        }, _init: function () {
            YS.SubformPane.superclass._init.apply(this, arguments);
            var b = this.options, c = this;
            this.$widgets = a('<ul class="fx_selection_pane"/>').appendTo(this.element);
            var d;
            this.$widgets.sortable({
                handle: "i.icon-drag", onDragStart: function (a, b, c, e) {
                    var f = a.offset(), g = b.rootGroup.pointer;
                    d = g.top - f.top, c(a)
                }, onDrag: function (a, b, c, e) {
                    b.left = 0, b.top -= d, c(a, b)
                }, onDrop: function (a, d, e, f) {
                    e(a), YS.Utils.applyFunc(c, b.onAfterDrop, [], !1)
                }
            }), new YS.Button({
                renderEl: a("<div/>").appendTo(this.element),
                customCls: "item-subwidget-add",
                style: "none",
                iconCls: "icon-add",
                text: "添加字段",
                onClick: function () {
                    e.show(), a(document).bind("mousedown.dropdown", function (b) {
                        var c = a(b.target);
                        0 === c.closest(e).length && (e.hide(), a(document).unbind("mousedown.dropdown"))
                    })
                }
            });
            var e = a('<ul class="x-dropdown x-dropdown-list"/>').css({top: "100%", left: 0}).click(function (b) {
                var d = a(b.target).closest("li.x-dropdown-item");
                if (d.length > 0) {
                    var f = d.attr("xtype");
                    c._addSubWidget({
                        labelName: d.text(),
                        fieldId: "_field_" + YS.STATIC.IDBase++,
                        type: f
                    }, !0)
                }
                e.hide(), a(document).unbind("mousedown.dropdown")
            }).appendTo(this.element);
            for (var f in b.availableAddions){
                a('<li class="x-dropdown-item"/>').attr("xtype", f).text(b.availableAddions[f]).appendTo(e);
            }
            YS.Utils.forEach(b.items, function (a, b) {
                c._addSubWidget(b, !1)
            }), this.$widgets.click(function (d) {
                var e = a(d.target), f = e.closest("li");
                if (f.length > 0) {
                    var g = f.index();
                    e.closest(".item-subwidget").length > 0 ? YS.Utils.applyFunc(c, b.onAfterItemSelect, [g], !1) : e.hasClass("icon-remove") && f.slideUp(200, function () {
                            YS.Utils.applyFunc(c, b.onAfterItemRemove, [g], !1), a(this).remove()
                        })
                }
            })
        }, _addSubWidget: function (b, c) {
            var d = this.options, e = b.labelName, f = b.type, g = a("<li/>").hide().data("item", b).appendTo(this.$widgets), h = a('<a class="x-btn style-white item-subwidget"/>').appendTo(g);
            a("<i/>").addClass("icon-widget-" + f).appendTo(h), a("<span/>").text(e).appendTo(h), a('<i class="icon-remove"/><i class="icon-drag"/>').appendTo(g), c ? (g.slideDown(200), YS.Utils.applyFunc(this, d.onAfterItemAdd, [b], !1)) : g.show()
        }, collectAllItems: function () {
            var b = [];
            return YS.Utils.forEach(this.$widgets.children("li"), function (c, d) {
                var e = a(d).data("item");
                b.push(e)
            }), b
        }
    }), a.shortcut("subformpane", YS.SubformPane)
}(jQuery), function (a) {
    YS.FieldFormulaPane = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.FieldFormulaPane.superclass._defaultConfig.apply(this, arguments), {
                formula: "",
                text: "公式",
                hasRemind: !0,
                hasFunction: !0,
                supportMultiForm: !0,
                availableFieldValue: ["number", "text", "datetime"],
                availableFieldName: ["number", "text", "datetime"],
                formulaKeywords: Object.keys(YS.Formula).remove("MAP"),
                currentForm: null,
                currentWidget: null,
                currentSubform: null,
                entryList: null,
                onAfterFormulaEdit: null,
                labelMap: null
            })
        }, _init: function () {
            YS.FieldFormulaPane.superclass._init.apply(this, arguments), this._createFieldSelect(), this._createEditDialog(), this.dialog.show()
        }, _createFieldSelect: function () {
            var b = this, c = this.options;
            this.$fieldSelect = a('<div class="fx_formula_field_tab"/>');
            var d = a('<div class="head"/>').appendTo(this.$fieldSelect), e = a('<div class="tab active"/>').text("当前表单字段").click(function () {
                e && e.addClass("active"), i && i.setVisible(!0), k && k.setVisible(!1)
            }).appendTo(d), f = [];
            if(c.currentForm === c.entryList[0].formId){
                f = c.entryList;
            }else{
                YS.Utils.forEach(c.entryList[0].fields, function (a, b) {
                    if(c.currentForm === b.name){
                        f[0] = {};
                        f[0].formName = b.text, f[0].fields = b.items, f[0].formId = b.name, f[0].type = "form";
                        $.each(b.items, function(idx, itm){
                            c.labelMap["$"+itm.name+"#"] = itm.text;
                        });
                        return;
                    }
                });
            }
            var g = c.hasRemind ? 320 : 350, h = [];
            c.currentWidget && h.push(c.currentWidget);
            var i = new YS.EntryFieldSelectPane({
                renderEl: a("<div/>").appendTo(this.$fieldSelect),
                mode: "dialog",
                height: g,
                fields: [],
                excludeFields: h,
                availableFields: c.availableFieldValue,
                allowMultiTable: !0,
                allowSameField: !0,
                allowMultiSubform: !0,
                entryList: f,
                onFieldSelect: function (a) {
                    b.dialog.getWidgetByName("formulaEditor").insertField(a, !1)
                },
                onFieldFilter: function (a) {
                    return !(!c.currentSubform || !a.subform) && a.subform !== c.currentSubform
                }
            });
        }, _createEditDialog: function () {
            var a = this.options, b = [380];
            a.hasRemind && (b = [350, 30]), this.dialog = new YS.ConfirmDialog({
                title: "公式编辑",
                width: 620,
                height: 510,
                contentWidget: {
                    rowSize: b,
                    colSize: [220, 350],
                    hgap: 15,
                    vgap: 10,
                    padding: 15,
                    items: [[this.$fieldSelect, {
                        type: "formulaeditor",
                        fieldId: "formulaEditor",
                        value: a.formula,
                        keywords: a.formulaKeywords,
                        text: a.text,
                        hasFunction: a.hasFunction,
                        labelMap: a.labelMap
                    }], [{type: "label", text: "校验错误提示", width: 130}, {
                        type: "text",
                        fieldId: "remindInfo",
                        value: a.fieldErrMsg,
                        width: 440
                    }]]
                },
                onOk: function () {
                    var b = this.getWidgetByName("formulaEditor");
                    if (!b.checkValidate()) {
                        var c = b.getInvalidateType(), d = "";
                        switch (c) {
                            case"invalid field":
                                d = "存在无效字段,请删除";
                                break;
                            case"deprecated field":
                                d = "MAP函数已过时,请改用MAPX函数";
                                break;
                            default:
                                d = "函数公式不正确"
                        }
                        return YS.Msg.toast({type: "warning", msg: d}), !0
                    }
                    var e = this.getWidgetByName("formulaEditor").getValue(), f = this.getWidgetByName("remindInfo"), g = null;
                    return f && (g = f.getValue()), YS.Utils.applyFunc(this, a.onAfterFormulaEdit, [e, g], !1), !1
                },
                onClose: function () {
                    return !1
                }
            })
        }
    }), a.shortcut("fieldformulapane", YS.FieldFormulaPane)
}(jQuery),function (a) {
    YS.CheckPane = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.CheckPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_check_pane",
                items: [{value: 1, text: "1", custom: !0}]
            })
        }, _init: function () {
            YS.CheckPane.superclass._init.apply(this, arguments);
            var a = this.options, b = this;
            this.checkItems = [], a.items && YS.Utils.forEach(a.items, function (a, c) {
                b._createItem(c)
            })
        }, _createItem: function (b) {
            var c = a('<div class="check_item"/>').appendTo(this.element), d = {
                renderEl: a("<div/>").appendTo(c),
                text: b.text,
                width: 80
            };
            b.custom && (d.onStateChange = function (a) {
                a ? c.children(".check_input").show() : c.children(".check_input").hide()
            });
            var e = new YS.CheckBox(d);
            e.setSelected(b.selected);
            var f;
            b.custom && (f = new YS.Number({
                renderEl: a('<div class="check_input"/>').appendTo(c),
                width: 75,
                value: b.value,
                fieldIsnull: !1,
                waterMark: "0 ~ 5"
            }), f.setVisible(b.selected)), this.checkItems.push({checkBox: e, custom: f})
        }, getValue: function () {
            var a = this.options, b = this, c = [];
            return YS.Utils.forEach(a.items, function (a, d) {
                var e = b.checkItems[a].checkBox.getValue();
                e && d.custom && (e = b.checkItems[a].custom.getValue()), c.push(e)
            }), c
        }
    }), a.shortcut("formatcheckpane", YS.CheckPane)
}(jQuery),function (a) {
    YS.FieldAuthPane = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.FieldAuthPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_fieldauth_pane",
                onAfterClick: null
            })
        }, _init: function () {
            YS.FieldAuthPane.superclass._init.apply(this, arguments);
            var b = this, c = this.options;
            this.$list = a("<ul />").appendTo(this.element);
            var d = a('<span class="editable"/>').text("可编辑");
            a("<li />").append(a('<span class="field"/>').text("字段")).append(a('<span class="fieldIsshow" />').text("可见")).append(d).appendTo(this.$list);
            var e = a('<i class="icon-help"/>').hover(function () {
                YS.UI.showPopover({position: "topLeft", anchor: e, content: a("<span/>").text("系统字段不可修改")})
            }, function () {
                YS.UI.closePopover()
            }).appendTo(d), f = a('<li class="select-all"/>').append(a('<span class="field"/>').text("全选")).append(a('<a class="x-check" />').addClass("fieldIsshow").append(a('<i class="x-iconfont"/>'))).append(a('<a class="x-check"/>').addClass("editable").append(a('<i class="x-iconfont"/>'))).appendTo(this.$list);
            this._bindSelectAllEvent(f), YS.Utils.forEach(c.items, function (a, c) {
                var d = b._createItem(c);
                d.appendTo(b.$list)
            })
        }, _bindSelectAllEvent: function (b) {
            var c = this, d = this.options;
            b.find("a").bind("click", function (b) {
                var e = a(b.currentTarget);
                if (!e.hasClass("x-ui-disable")) {
                    var f = e.hasClass("select"), g = e.hasClass("fieldIsshow") ? "fieldIsshow" : "editable";
                    f ? (e.removeClass("select"), c.$list.find("." + g + ":not(.x-ui-disable)").removeClass("select")) : (e.addClass("select"), c.$list.find("." + g + ":not(.x-ui-disable)").addClass("select")), YS.Utils.applyFunc(c, d.onAfterClick, [e], !1)
                }
            })
        }, _createItem: function (b) {
            var c = this, d = (this.options, a("<li/>").data("field", b.widget.fieldId).append(a('<span class="field"/>').text(b.label))), e = a('<a class="x-check" />').addClass("fieldIsshow").append(a('<i class="x-iconfont"/>')).appendTo(d), f = a('<a class="x-check"/>').addClass("editable").append(a('<i class="x-iconfont"/>')).appendTo(d);
            return f.addClass("x-ui-disable"), c._bindEvent(e, "fieldIsshow"), c._bindEvent(f, "editable"), d
        }, _bindEvent: function (a, b) {
            var c = this, d = this.options;
            a.bind("click", function (e) {
                a.hasClass("select");
                a.hasClass("x-ui-disable") || (a.toggleClass("select"), c._checkSelectAll(b), YS.Utils.applyFunc(c, d.onAfterClick, [a], !1))
            })
        }, setValue: function (b) {
            var c = this.$list.children("li");
            YS.Utils.forEach(c, function (c, d) {
                var e = a(d).data("field");
                if (e && !a(d).hasClass("x-ui-disable")) {
                    var f = b[e];
                    f && f.fieldIsshow && a(d).find(".fieldIsshow").addClass("select"), f && f.fieldEnable && a(d).find(".editable").addClass("select")
                }
            }), this._checkSelectAll("fieldIsshow"), this._checkSelectAll("editable")
        }, setValueByType: function (a, b) {
            var c = this.$list.find("." + a);
            b ? c.addClass("select") : c.removeClass("select")
        }, _checkSelectAll: function (a) {
            var b = this.$list.find("li.select-all a." + a), c = this.$list.find("li:not(.select-all) a." + a).length, d = this.$list.find("li:not(.select-all) a.select." + a).length;
            d === c ? b.addClass("select") : b.removeClass("select")
        }, checkValidate: function () {
            var a, b = this.getValue();
            for (a in b)if (b[a].fieldIsshow)return this.element.removeClass("error"), !0;
            return this.element.addClass("error"), YS.Msg.toast({type: "warning", msg: "请至少选择一个可见字段"}), !1
        }, getValue: function () {
            var b = {}, c = this.$list.children("li");
            return YS.Utils.forEach(c, function (c, d) {
                var e = a(d).data("field");
                if (e && !a(d).hasClass("x-ui-disable")) {
                    var f = a(d).find(".fieldIsshow").hasClass("select"), g = a(d).find(".editable").hasClass("select");
                    (f || g) && (b[e] = {fieldIsshow: f, fieldEnable: g})
                }
            }), b
        }
    }), a.shortcut("fieldauthpane", YS.FieldAuthPane)
}(jQuery),function (a) {
    YS.ProgressStepPane = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.ProgressStepPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_step_pane",
                steps: [],
                currentStep: 0
            })
        }, _init: function () {
            YS.ProgressStepPane.superclass._init.apply(this, arguments);
            var b = this.options, c = this;
            this.currentStep = b.currentStep, YS.Utils.forEach(b.steps, function (b, d) {
                var e = a('<div class="progress-step">').append(a('<div class="step-message"/>').text(d)).append(a('<span class="step-point"/>')).appendTo(c.element);
                e.addClass("step-" + b), 0 !== b && e.append(a('<div class="step-line"/>')), b <= c.currentStep && (e.addClass("select"), b === c.currentStep && e.addClass("current"))
            })
        }, goNextStep: function () {
            a(".progress-step.current", this.element).removeClass("current"), this.currentStep++, a(".progress-step.step-" + this.currentStep, this.element).addClass("select current")
        }, goPrevStep: function () {
            a(".progress-step.current", this.element).removeClass("current select"), this.currentStep--, a(".progress-step.step-" + this.currentStep, this.element).addClass("select current")
        }
    }), a.shortcut("progresssteppane", YS.ProgressStepPane)
}(jQuery),function (a) {
    YS.TitleEditor = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.TitleEditor.superclass._defaultConfig.apply(), {
                baseCls: "fx_title_editor",
                name: "",
                defaultName: "未命名",
                editable: !0,
                onStopEdit: null
            })
        }, _init: function () {
            YS.TitleEditor.superclass._init.apply(this, arguments);
            var b = this.options;
            b.editable ? this.element.append('<input value="' + b.formName + '"/><span class="name-pre">' + b.formName + "</span>") : this.element.append(a("<span>" + b.formName + "<span/>")), this._bindEvent()
        }, _bindEvent: function () {
            var b = this.options, c = this;
            if (b.editable) {
                this.needTip = !0;
                var d = this.element.children("input");
                b.formName === b.defaultName && d.focus().select();
                var e = this.element.children(".name-pre");
                d.width(e.outerWidth()+20), d.on("input", function () {
                    e.text(d.val()), d.width(e.outerWidth()+20)
                }), d.on("keydown", function (b) {
                    13 === b.keyCode && a(this).blur()
                }), d.on("focus", function () {
                    c.needTip = !1, YS.UI.closePopover()
                }), d.blur(function () {
                    c.needTip = !0;
                    var f = a(this).val();
                    f || (f = b.defaultName, e.text(f), a(this).val(f), d.width(e.outerWidth()+20)), f !== b.formName && YS.Utils.applyFunc(c, b.onStopEdit, [{formName: f}], !1)
                }), d.hover(function () {
                    c.needTip && YS.UI.showPopover({
                        position: "bottomLeft",
                        anchor: d,
                        content: a("<span/>").text("重命名"),
                        type: "dark"
                    })
                }, function () {
                    c.needTip && YS.UI.closePopover()
                })
            }
        }
    })
}(jQuery),function (a) {
    YS.EntryTitle = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.EntryTitle.superclass._defaultConfig.apply(), {
                baseCls: "fx_entry_title",
                entryId: "",
                formName: "",
                defaultName: "未命名",
                parent: "",
                onStopEdit: null,
                onNavHome: null
            })
        }, _init: function () {
            YS.EntryTitle.superclass._init.apply(this, arguments);
            var b = this.options, c = this;
            a('<span class="label-title">表单名称：</span>').appendTo(this.element);
            new YS.TitleEditor({
                renderEl: a("<div/>").appendTo(this.element),
                customCls: "nav-title",
                defaultName: b.defaultName,
                formName: b.formName,
                editable: !0,
                onStopEdit: function (a) {
                    c.saveAttr(a)
                }
            })
        }, saveAttr: function (b) {
            var c = this.options, d = this;
            YS.Utils.applyFunc(d, c.onStopEdit, [b], !1);
        }
    }), a.shortcut("entrytitle", YS.EntryTitle)
}(jQuery),function (a) {
    YS.ImageDialog = YS.extend(YS.ConfirmDialog, {
        _defaultConfig: function () {
            return a.extend(YS.ImageDialog.superclass._defaultConfig.apply(), {
                title: "添加图片",
                width: 630,
                height: 330,
                contentWidget: {padding: 16},
                onOk: null
            })
        }, _init: function () {
            YS.ImageDialog.superclass._init.apply(this, arguments), this.url = "", this.element.addClass("x-image-dialog"), this._bindTypeSelectEvents()
        }, _createContent: function (b) {
            var c = this, d = this.options;
            YS.Utils.applyFunc(this, d.onContentCreate, [b], !1) === !1 && (this.$typeSelect = a('<div class="type-select"/>').appendTo(b), this.$typeUpload = a('<div class="type-item type-upload"/>').append(a('<i class="icon-type icon-image"/>')).append(a('<span class="type-label"/>').text("上传图片")).appendTo(this.$typeSelect), this.$typeURL = a('<div class="type-item type-url"/>').append(a('<i class="icon-type icon-link"/>')).append(a('<span class="type-label"/>').text("插入图片 URL")).appendTo(this.$typeSelect), this.widgetContainer = new YS.TableContainer({
                renderEl: a('<div class="widget-container"/>').appendTo(b),
                rowSize: [30, 155, 30, 20, 30, 30],
                colSize: [430, 180],
                vgap: 8,
                items: [[{type: "label", customCls: "widget-title", text: "上传图片", width: 100}, {
                    type: "label",
                    customCls: "widget-subtitle",
                    text: "注：图片大小不能超过 1 MB"
                }], [{
                    type: "upload",
                    fileType: ["jpg", "png", "gif"],
                    maxFileSize: 1048576,
                    uploadToMedia: !0,
                    hasPreview: !1,
                    onUploadSuccess: function (a) {
                        var b = a[0];
                        b && (c.url = "")
                    }
                }, null], [{type: "label", customCls: "widget-title", text: "插入图片 URL"}, null], [{}, null], [{
                    type: "text",
                    waterMark: "https://",
                    fieldRegexl: "^http",
                    onStopEdit: function (a) {
                        a ? c.url = this.getValue() : this.showErrorMsg("不合法的 URL")
                    }
                }, null], [{type: "label", customCls: "widget-text", text: ""}, null]]
            }), this.$typeUpload.addClass("selected"), this.widgetContainer.setRowVisible([2, 3, 4, 5], !1))
        }, _bindTypeSelectEvents: function () {
            var b = this, c = function (c) {
                var d = c.target, e = c.type, f = a(d).closest(".type-item");
                f && f.length > 0 && "click" === e && (f.hasClass("type-upload") ? (b.$typeUpload.addClass("selected"), b.$typeURL.removeClass("selected"), b.widgetContainer.setRowVisible([0, 1], !0), b.widgetContainer.setRowVisible([2, 3, 4, 5], !1)) : f.hasClass("type-url") && (b.$typeUpload.removeClass("selected"), b.$typeURL.addClass("selected"), b.widgetContainer.setRowVisible([0, 1], !1), b.widgetContainer.setRowVisible([2, 3, 4, 5], !0)))
            };
            this.$typeSelect.unbind(".type-select"), this.$typeSelect.bind({"click.type-select": c})
        }, getWidgetByName: function () {
        }
    })
}(jQuery),function (a) {
    YS.BaseSelectPane = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.BaseSelectPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_base_select",
                title: "",
                value: [],
                multi: !0,
                editable: !1
            })
        }, _init: function () {
            YS.BaseSelectPane.superclass._init.apply(this, arguments)
        }, _createSelectList: function () {
            var b = this, c = this.options;
            this.$selectList ? this.$selectList.empty() : this.$selectList = a('<ul class="select-list"/>').appendTo(this.element), this.value && this.value.length > 0 && YS.Utils.forEach(this.value, function (a, c) {
                var d = b.selectMap[c];
                b._createSelectItem(d)
            });// : c.editable || a('<div class="select-empty" />').append(a("<span />").text(c.msg)).appendTo(this.$selectList)
        }, _createSelectItem: function (b) {
            if (!b)return null;
            var c = this, d = this.options, e = a('<li class="select-item"/>').append(a("<span/>").text(b.name)).appendTo(this.$selectList);
            return d.editable && d.multi && a('<span class="remove-btn" />').append(a('<i class="icon-close-large" />')).click(function () {
                c._removeSelectItem(b), c.refresh()
            }).appendTo(e), e
        }, _removeSelectItem: function (a) {
        }, _addSelectItem: function (a) {
        }, _createSelectPane: function () {
            var b = this, c = a('<div class="select-menu"/>').appendTo(this.element);
            return a('<i class="icon-search"/>').appendTo(c).click(function () {
                return a(".search-info").hide(), a(".search-input").animate({width: "100%"}, function () {
                    a("#searchInput").unbind("keydown"), a("#searchInput").keydown(function (c) {
                        13 === c.keyCode && $.trim(a(this).val()) && b._createSearchList(a(this).val())
                    }).focus()
                }).show(), a(document).bind("click.search", function (b) {
                    var c = b.target, d = a(c).closest(".search-input");
                    0 === d.length && (a(".search-info").show(), a(".search-input").animate({width: 0}, function () {
                        a(".search-input").hide()
                    }), a(document).unbind("click.search"))
                }), !1
            }), c.append(a('<div class="search-input"/>').append(a('<input id="searchInput"/>')).append(a('<i class="icon-search"/>'))), c
        }, _bindEditEvent: function () {
            var a = this, b = this.options;
            this.$selectList.unbind("click"), this.$selectList.bind("click", function () {
                var c = a._getEditConfig(), d = new YS.ConfirmDialog({
                    title: b.title,
                    height: 570,
                    width: 600,
                    contentWidget: {rowSize: [450], colSize: [570], padding: 15, items: [[c]]},
                    onOk: function () {
                        return YS.Utils.applyFunc(a, a._onStopEdit, [d], !1)
                    }
                });
                d.show()
            })
        }, _createSearchList: function () {
        }, _getEditConfig: function () {
            return {}
        }, _onStopEdit: function (a) {
        }, refresh: function () {
        }
    })
}(jQuery),function (a) {
    YS.LinkFilterPane = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.LinkFilterPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_link_filter",
                items: [],
                relyWidgets: [],
                linkWidgets: []
            })
        }, _init: function () {
            YS.LinkFilterPane.superclass._init.apply(this, arguments), this._createFilterList()
        }, _createFilterList: function () {
            var b = this.options, c = this;
            this.element.append(a('<span class="filter-label"/>').text("设置多个关联条件限定关联数据")), this._createAddBtn(), this.$filterList = a('<ul class="filter-list"/>').appendTo(this.element), this.items = [], this.widgetsMap = {}, YS.Utils.forEach(b.relyWidgets, function (a, b) {
                c.widgetsMap[b.name] = b
            }), YS.Utils.forEach(b.items, function (a, b) {
                c._createFilterItem(b)
            })
        }, _createFilterItem: function (b) {
            var c = this.options, d = this, e = a('<li class="filter-item"/>').appendTo(this.$filterList), f = new YS.ComboBox({
                renderEl: a('<div class="filter-combo"/>').appendTo(e),
                waterMark: "当前表单字段",
                width: 180,
                valueField: "name",
                value: b && b.rely,
                fieldIsnull: !1,
                searchable: !1,
                items: c.relyWidgets,
                onAfterItemSelect: function (a, b) {
                    g.options.items = d._getLinkWidgets(b), g.rebuild()
                }
            });
            e.append("<span>值等于</span>");
            var g = new YS.ComboBox({
                renderEl: a('<div class="filter-combo"/>').appendTo(e),
                waterMark: "关联表字段",
                width: 180,
                valueField: "name",
                value: b && b.link,
                fieldIsnull: !1,
                searchable: !1,
                items: b ? this._getLinkWidgets(this.widgetsMap[b.rely]) : []
            });
            a('<span class="remove-btn"/>').append(a('<i class="icon-trasho"/>')).click(function () {
                e.remove()
            }).appendTo(e), e.data({rely: f, link: g})
        }, _getLinkWidgets: function (a) {
            if (!a)return [];
            var b = this.options, c = [];
            return YS.Utils.forEach(b.linkWidgets, function (b, d) {
                YS.ValueTypeMap[a.type] === YS.ValueTypeMap[d.type] && c.push(d)
            }), c
        }, _createAddBtn: function () {
            var b = this;
            a('<span class="add-btn"/>').append(a('<i class="icon-add"/>')).append(a("<span/>").text("添加关联条件")).click(function () {
                b._createFilterItem()
            }).appendTo(this.element)
        }, getValue: function () {
            var b = [];
            return a(".filter-item", this.element).each(function (c, d) {
                var e = a(d).data("rely").getValue(), f = a(d).data("link").getValue();
                e && f && b.push({rely: e, link: f})
            }), b
        }
    }), a.shortcut("linkfilterpane", YS.LinkFilterPane)
}(jQuery),function (a) {
    YS.ValidCodePane = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.ValidCodePane.superclass._defaultConfig.apply(), {
                baseCls: "fx_valid_code",
                reloadTime: 60,
                waterMark: "",
                fieldRegexl: "",
                height: 40,
                btnText: "",
                onClick: null
            })
        }, _init: function () {
            YS.ValidCodePane.superclass._init.apply(this, arguments);
            var b = this, c = this.options;
            this.input = new YS.TextEditor({
                renderEl: a('<div class="code-input"/>').appendTo(this.element),
                waterMark: c.waterMark,
                width: null,
                height: c.height,
                fieldRegexl: c.fieldRegexl,
                value: c.value
            }), this.$btn = a('<div class="code-btn"/>').appendTo(this.element).css({
                height: c.height,
                "line-height": c.height - 2 + "px"
            }), c.btnText && this.$btn.text(c.btnText), this.$btn.click(function (a) {
                b.isEnabled() && YS.Utils.applyFunc(b, c.onClick, [a], !1)
            })
        }, setReloadState: function () {
            var a = this, b = this.options, c = b.reloadTime;
            this.setEnable(!1);
            var d = setInterval(function () {
                a.setBtnText("重新获取(" + c + ")"), c--, c <= 0 && (a.setBtnText(b.btnText), a.setEnable(!0), clearInterval(d))
            }, 1e3)
        }, setBtnText: function (a) {
            this.$btn.text(a)
        }, getValue: function () {
            return this.input.getValue()
        }, setValue: function (a) {
            this.input.setValue(a)
        }, checkValidate: function () {
            return this.input.checkValidate()
        }, showErrorMsg: function (a) {
            this.input.showErrorMsg(a)
        }
    }), a.shortcut("validcodepane", YS.ValidCodePane)
}(jQuery),function (a) {
    YS.DeptLimit = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.DeptLimit.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_dept_limit",
                items: [],
                fieldLimit: [],
                rely: null,
                limitWidget: null,
                title: "",
                onAfterLimitSet: null,
                onAfterTypeChange: null,
                onAfterWidgetSelect: null,
                onRelySet: null,
                onSetDefaultValue: null,
                onBeforeWidgetsCreate: null
            })
        }, _init: function () {
            YS.DeptLimit.superclass._init.apply(this, arguments);
            var b = this.options, c = this, d = "custom";
            YS.Utils.isObjectEmpty(b.rely) ? YS.Utils.isObjectEmpty(b.limitWidget) || (d = "widgets") : d = "rely", new YS.ComboBox({
                renderEl: a("<div/>").appendTo(this.element),
                items: b.items,
                searchable: !1,
                fieldIsnull: !1,
                value: d,
                onAfterItemSelect: function () {
                    var a = this.getValue();
                    c._setBtnVisible(a), YS.Utils.applyFunc(c, b.onAfterTypeChange, [a], !1)
                }
            }), this.$limitPane = a("<div/>").appendTo(this.element), this._setBtnVisible(d)
        }, _setBtnVisible: function (a) {
            switch (this.$limitPane.empty(), a) {
                case"custom":
                    this._createCustomBtn(), this._createDefaultValuePane();
                    break;
                case"rely":
                    this._createRelyBtn();
                    break;
                case"widgets":
                    this._createRelyWidgets()
            }
        }, _createRelyBtn: function () {
            var b = this.options, c = this;
            new YS.Button({
                renderEl: a('<div class="set-btn"/>').appendTo(this.$limitPane),
                text: "数据联动设置",
                height: 30,
                width: 240,
                style: "white",
                onClick: function () {
                    YS.Utils.applyFunc(c, b.onRelySet, [], !1)
                }
            })
        }, _createRelyWidgets: function () {
            var b = this.options, c = this;
            return YS.Utils.applyFunc(c, b.onBeforeWidgetsCreate, [], !1), YS.Utils.isObjectEmpty(this.deptWidgets) ? void this.$limitPane.append(a('<div class="empty-tip"/>').text("表单中没有部门控件")) : void new YS.RadioGroup({
                renderEl: a('<div class="set-btn"/>').appendTo(this.$limitPane),
                items: this.deptWidgets,
                value: b.limitWidget,
                onAfterItemSelect: function () {
                    YS.Utils.applyFunc(c, b.onAfterWidgetSelect, [this.getValue()], !1)
                }
            })
        }, _createCustomBtn: function () {
            var b = this.options, c = this;
            new YS.Button({
                renderEl: a('<div class="set-btn"/>').appendTo(this.$limitPane),
                text: "设置",
                height: 30,
                width: 240,
                style: "white",
                onClick: function () {
                    var a = new YS.ConfirmDialog({
                        title: b.title,
                        height: 570,
                        width: 600,
                        contentWidget: {
                            rowSize: [450],
                            colSize: [570],
                            items: [[{
                                fieldId: "memberSelect",
                                type: "deptgroup",
                                editable: !0,
                                value: b.fieldLimit ? b.fieldLimit.join(",") : "",
                                memberEnable: !1,
                                dynamicEnable: !0
                            }]]
                        },
                        onOk: function () {
                            var d = a.getWidgetByName("memberSelect");
                            return b.fieldLimit = d.getValue() ? d.getValue().split(",") : [], YS.Utils.applyFunc(c, b.onAfterLimitSet, [b.fieldLimit], !1), !1
                        }
                    });
                    a.show()
                }
            })
        }, _createDefaultValuePane: function () {
            var b = this, c = this.options, d = a('<div class="default-pane"/>').append(a('<div class="default-title"/>').text("默认值")).appendTo(this.$limitPane);
            new YS.Button({
                renderEl: a('<div class="set-btn"/>').appendTo(d),
                type: "button",
                text: "设置",
                height: 30,
                width: 240,
                style: "white",
                onClick: function () {
                    YS.Utils.applyFunc(b, c.onSetDefaultValue, [], !1)
                }
            })
        }, setDeptWidgets: function (a) {
            this.deptWidgets = a
        }
    }), a.shortcut("deptlimitpane", YS.DeptLimit)
}(jQuery),function (a) {
    YS.DateConfigPane = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return a.extend(YS.DateConfigPane.superclass._defaultConfig.apply(), {
                baseCls: "fx_date_config",
                fieldFormat: "yyyy-MM-dd",
                width4date: 160
            })
        }, _init: function () {
            YS.DateConfigPane.superclass._init.apply(this, arguments);
            var b = this, c = this.options;
            this.cfgType = new YS.ComboBox({
                renderEl: a('<div class="cfg-type"/>').appendTo(this.element),
                width: c.width4date,
                items: [{text: "当天", value: "today"}, {text: "昨天", value: "yesterday"}, {
                    text: "过去7天",
                    value: "lastWeek"
                }, {text: "本周", value: "thisWeek"}, {text: "本月", value: "thisMonth"}, {
                    text: "公式编辑",
                    value: "formula"
                }, {text: "自定义", value: "custom"}],
                onAfterEdit: function (a, c) {
                    c ? b.switchType(c.value) : b.switchType()
                }
            }), this.$cfgPane = a('<div class="cfg-pane"/>').appendTo(this.element)
        }, switchType: function (b) {
            var c = this.options;
            switch (this.cfgType.setValue(b), this.$cfgPane.empty(), b) {
                case"custom":
                    this.dataLimit = new YS.DateLimit({
                        renderEl: this.$cfgPane,
                        fieldFormat: c.fieldFormat,
                        width4date: c.width4date
                    });
                    break;
                case"formula":
                    this.container = new YS.TableContainer({
                        renderEl: this.$cfgPane,
                        rowSize: [30, 15, 30],
                        colSize: [95, 60],
                        hgap: 5,
                        vgap: 8,
                        items: [[{
                            type: "combo",
                            fieldId: "from",
                            searchable: !1,
                            fieldIsnull: !1,
                            value: "before",
                            items: [{text: "今天之前", value: "before"}, {text: "今天之后", value: "after"}]
                        }, {
                            type: "inputgroup",
                            fieldId: "numFrom",
                            inputEl: {width: 32, type: "number"},
                            nextEl: {type: "label", text: "天"}
                        }], [a("<span>~</span>")], [{
                            type: "combo",
                            fieldId: "to",
                            searchable: !1,
                            fieldIsnull: !1,
                            value: "after",
                            items: [{text: "今天之前", value: "before"}, {text: "今天之后", value: "after"}]
                        }, {
                            type: "inputgroup",
                            fieldId: "numTo",
                            inputEl: {width: 32, type: "number"},
                            nextEl: {type: "label", text: "天"}
                        }]]
                    })
            }
        }, checkValidate: function () {
            var a = this.cfgType.getValue();
            if ("formula" === a) {
                var b = this.container.getWidgetByName("numFrom"), c = this.container.getWidgetByName("numTo");
                return b.checkValidate() && c.checkValidate()
            }
            return !0
        }, getValue: function () {
            function b(a, b) {
                var c;
                return a = a || "before", b = b || 0, c = "before" === a ? -1 * b * 24 * 60 * 60 * 1e3 : 24 * b * 60 * 60 * 1e3
            }

            var c = this.cfgType.getValue(), d = {type: c};
            switch (c) {
                case"custom":
                    a.extend(d, this.dataLimit.getValue());
                    break;
                case"formula":
                    var e, f, g = this.container.getWidgetByName("from").getValue(), h = this.container.getWidgetByName("numFrom").getValue(), i = this.container.getWidgetByName("to").getValue(), j = this.container.getWidgetByName("numTo").getValue();
                    if (e = b(g, h), f = b(i, j), e > f) {
                        var k = e;
                        e = f, f = k
                    }
                    a.extend(d, {
                        min: {type: e < 0 ? "before" : "after", value: Math.abs(e)},
                        max: {type: f < 0 ? "before" : "after", value: Math.abs(f)}
                    })
            }
            return d
        }, setValue: function (a) {
            switch (this.switchType(a.type), a.type) {
                case"custom":
                    this.dataLimit.setValue({min: a.min, max: a.max});
                    break;
                case"formula":
                    var b = 864e5;
                    this.container.getWidgetByName("from").setValue(a.min.type), this.container.getWidgetByName("numFrom").setValue(a.min.value / b), this.container.getWidgetByName("to").setValue(a.max.type), this.container.getWidgetByName("numTo").setValue(a.max.value / b)
            }
        }
    }), a.shortcut("dateconfigpane", YS.DateConfigPane)
}(jQuery), function (e) {
    YS.ItemLinkPane = YS.extend(YS.Widget, {
        _defaultConfig: function () {
            return e.extend(YS.ItemLinkPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_item_link",
                linkWidgets: [],
                itemLinkeds: [],
                items: [],
                fields: [{name:"isHide",text:"隐藏控件"},{name:"isNull",text:"必填"}],
                currentItem: "",
                onBeforeEdit: null,
                onAfterEdit: null
            })
        }, _init: function () {
            YS.ItemLinkPane.superclass._init.apply(this, arguments), this.idx = 0, this.valueMap = {}, this._initLinkWidgetsMap(), this._createItemPane(), this._createWidgetPane(), this._bindEvent();
        }, _initLinkWidgetsMap: function () {
            var e = this, t = this.options;
            this.idx = t.currentItem, this.linkWidgetsMap = {}, YS.Utils.forEach(t.linkWidgets, function (t, i) {
                e.linkWidgetsMap[i.value] = !0
            });
            if(!t.currentItem && t.items.length>0){
            	this.idx = t.items[0].code;
            }
        }, _createItemPane: function () {
            var t = e('<div class="item-pane"><span class="title">选项</span></div>').appendTo(this.element);
            this._createItemList(t)
        }, _createItemList: function (t) {
            var i = this, a = this.options;
            this.$itemList = e('<ul class="item-list"/>').appendTo(t), $.each(a.items, function (e, t) {
                var c = [], b = a.itemLinkeds;
                b.length>0 && YS.Utils.forEach(b, function (d, f) {
                    if(f.value == t.code && i.linkWidgetsMap[f.toFieldId]){
                        c.push(f)
                    }
                }), i.valueMap[t.code] = c, i._createItem(t.code, t)
            });
        },  _createItem: function (t, i) {
            var a = e('<li class="item"/>').append(e("<span/>").text(i.text)).data("idx", i.code).appendTo(this.$itemList);
            t === this.idx && a.addClass("current-select")
        }, _createWidgetPane: function () {
            var t = e('<div class="widget-pane"><span class="title">关联控件</span></div>').appendTo(this.element);
            this._createWidgetList(t)
        }, _createWidgetList: function (t) {
            var i = this, a = this.options;
            this.$widgetList ? this.$widgetList.empty() : this._createWidgetsTableHead(t);
            YS.Utils.forEach(a.linkWidgets, function (e, t) {
                i._createWidget(t)
            })
        }, _createWidgetsTableHead: function(t){
            var a = this, b = this.options;
            var d = e('<table class="x-table x-table-bordered x-table-striped t-main"/>').appendTo($('<div style="height:364px;overflow:auto;border:1px solid #e5e5e5" />').appendTo(t));
            var f = e('<thead class="x-block-head" />').appendTo(d);
            var c = e('<tr class="t-row th-row" />').appendTo(f);
            e('<th field="labelName" class="t-cell th-cell" />').text("控件名称").appendTo(c);
            $.each(b.fields, function(f, g){
                e('<th field="'+g.name+'" class="t-cell th-cell" />').text(g.text).appendTo(c);
            });
            this.$widgetList = $('<tbody class="t-body" />').appendTo(d);
        }, _createWidget: function (t) {
            var a = this, b = this.options, i = e('<tr class="t-row tb-row"/>').append(e('<td class="t-cell td-cell" field="labelName"/>').text(t.text)).appendTo(this.$widgetList).data("name", t.value);
            $.each(b.fields, function(c, d){
                var f = e('<td class="t-cell td-cell">').attr("field",d.name).append(e('<input type="checkbox">')).appendTo(i);
                if(a.valueMap[a.idx]){
                    $.each(a.valueMap[a.idx],function(g, h){
                        if(h.toFieldId==t.value && h[d.name]){
                            f.addClass("select").find("input").attr("checked",true);
                        }
                    });
                }
                f.on("click", function(i){
                    var _this = $(this), attr = $(this).attr("field"), n = $(this).find("input");
                    _this.hasClass("select") ? (_this.removeClass("select"), n.attr("checked",!1), a.updateValue()) : (_this.addClass("select"), n.attr("checked",!0), a.updateValue())
                });
            });
        }, _bindEvent: function () {
            var t = this;
            this.$itemList.on("click", "li.item", function (i) {
                var a = e(i.currentTarget);
                a.addClass("current-select").siblings().removeClass("current-select"), t.idx = a.data("idx"), t._createWidgetList()
            });
        }, updateValue: function (t) {
            var i = [], _this = this;
            e("tr", this.$widgetList).each(function (t, a) {
                var b = {}, n = e(a).data("name"), c = e(a).find("td"), isLink = false;
                if(n && e(a).find("input:checked")[0]){
                    $.each(c, function(d, f){
                        var atr = e(f).attr("field"), ck = e(f).find("input");
                        ck[0] && ck.attr("checked") && (b[e(f).attr("field")] = 1);
                    });
                }
                $.isEmptyObject(b) || (b["toFieldId"] = n, b.value = _this.idx, i.push(b));
            });
            this.valueMap[this.idx] = i
        }, getValue: function () {
            return this.valueMap
        }
    }), e.shortcut("itemlinkpane", YS.ItemLinkPane)
}(jQuery)